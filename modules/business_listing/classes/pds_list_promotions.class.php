<?php/****************************************************************pds_list_promotions.class.phpGenerated by STRUCTY 2012.06.09 10:50:59.Copyright 2011 Structy. All rights reserved.****************************************************************/include_once (dirname(dirname(dirname(__FILE__))).'/templates/lib/function.php'); define('PDS_LIST_PROMOTIONS', 'pds_list_promotions'); class pds_list_promotions {	private $id;	private $list_id;	private $title;	private $pdf;	private $comments;	private $terms_desc; 	private $start_date;	private $end_date;	private $states;	private $metro_area;	private $promotion_id;	private $elgg_ent_ass;	private $img_ext;	private $views_count;	private $is_pdf_uploaded;	private $cupon_type;	private $allowed_cupons;	private $redimed_cupons; 		private $prom_code;	private $is_exclusive;	private $priority;	private $disc_aply_type;	private $disc_amt_type;	private $disc_amt;		private $prom_template_id;		private $is_event;	private $prm_restaurent;		private $prm_allow_multi_redeem;	private $prm_refer_frd_points;	public function setid($pArg='0') {$this->id=$pArg;}	public function setlist_id($pArg='0') {$this->list_id=$pArg;}	public function settitle($pArg='0') {$this->title=$pArg;}	public function setpdf($pArg='0') {$this->pdf=$pArg;}	public function setcomments($pArg='0') {$this->comments=$pArg;}	public function setterms_desc($pArg='0') {$this->terms_desc=$pArg;}	public function setstart_date($pArg='0') {$this->start_date=$pArg;}	public function setend_date($pArg='0') {$this->end_date=$pArg;}	public function setstates($pArg='0') {$this->states=$pArg;}	public function setmetro_area($pArg='0') {$this->metro_area=$pArg;}	public function setpromotion_id($pArg='0') {$this->promotion_id=$pArg;}	public function setelgg_ent_ass($pArg='0') {$this->elgg_ent_ass=$pArg;}	public function setimg_ext($pArg='0') {$this->img_ext=$pArg;}	public function setviews_count($pArg='0') {$this->views_count=$pArg;}	public function setis_pdf_uploaded($pArg='0') {$this->is_pdf_uploaded=$pArg;}	public function setcupon_type($pArg='0') {$this->cupon_type=$pArg;}	public function setallowed_cupons($pArg='0') {$this->allowed_cupons=$pArg;}	public function setredimed_cupons($pArg='0') {$this->redimed_cupons=$pArg;}		public function setprom_code($pArg='0') {$this->prom_code=$pArg;}	public function setis_exclusive($pArg='0') {$this->is_exclusive=$pArg;}	public function setpriority($pArg='0') {$this->priority=$pArg;}	public function setdisc_aply_type($pArg='0') {$this->disc_aply_type=$pArg;}	public function setdisc_amt_type($pArg='0') {$this->disc_amt_type=$pArg;}	public function setdisc_amt($pArg='0') {$this->disc_amt=$pArg;}			public function setprom_template_id($pArg='0') {$this->prom_template_id=$pArg;}	public function setprm_restaurent($pArg='0') {$this->prm_restaurent=$pArg;}		public function setis_event($pArg='0') {$this->is_event=$pArg;}		public function setprm_allow_multi_redeem($pArg='0') {$this->prm_allow_multi_redeem=$pArg;}	public function setprm_refer_frd_points($pArg='0') {$this->prm_refer_frd_points=$pArg;}		public function getid() {return $this->id;}	public function getlist_id() {return $this->list_id;}	public function gettitle() {return $this->title;}	public function getpdf() {return $this->pdf;}	public function getcomments() {return $this->comments;}	public function getterms_desc(){return $this->terms_desc;}	public function getstart_date() {return $this->start_date;}	public function getend_date() {return $this->end_date;}	public function getstates() {return $this->states;}	public function getmetro_area() {return $this->metro_area;}	public function getpromotion_id() {return $this->promotion_id;}	public function getelgg_ent_ass() {return $this->elgg_ent_ass;}	public function getimg_ext() {return $this->img_ext;}	public function getviews_count() {return $this->views_count;}    public function getis_pdf_uploaded() {return $this->is_pdf_uploaded;}    public function getcupon_type() {return $this->cupon_type;}	public function getallowed_cupons() {return $this->allowed_cupons;}	public function getredimed_cupons() {return $this->redimed_cupons;}		public function getprom_code() {return $this->prom_code;  }	public function getis_exclusive() {return $this->is_exclusive;  }	public function getpriority() {return $this->priority;  }	public function getdisc_aply_type() {return $this->disc_aply_type;  }	public function getdisc_amt_type() {return $this->disc_amt_type;  }	public function getdisc_amt() {return $this->disc_amt;  }		public function getprom_template_id() {return $this->prom_template_id;}	public function getprm_restaurent() {return $this->prm_restaurent;}	public function getis_event() {return $this->is_event;}		public function getprm_allow_multi_redeem() {return $this->prm_allow_multi_redeem;}	public function getprm_refer_frd_points() {return $this->prm_refer_frd_points;}    	public function readObject($array = array()) {		$qry = "SELECT *".RET."FROM ".PDS_LIST_PROMOTIONS.RET;		$and = "WHERE".RET;		if($array['id'] != "") {			$qry .= $and."id = '".$array['id']."'".RET;			$and = "AND".RET;		}		if($array['list_id'] != "") {			$qry .= $and."list_id = '".$array['list_id']."'".RET;			$and = "AND".RET;		}		if($array['title'] != "") {			$qry .= $and."title = '".$array['title']."'".RET;			$and = "AND".RET;		}		if($array['pdf'] != "") {			$qry .= $and."pdf = '".$array['pdf']."'".RET;			$and = "AND".RET;		}		if($array['comments'] != "") {			$qry .= $and."comments = '".$array['comments']."'".RET;			$and = "AND".RET;		}		if($array['start_date'] != "") {			$qry .= $and."start_date = '".$array['start_date']."'".RET;			$and = "AND".RET;		}		if($array['end_date'] != "") {			$qry .= $and."end_date = '".$array['end_date']."'".RET;			$and = "AND".RET;		}		if($array['states'] != "") {			$qry .= $and."states = '".$array['states']."'".RET;			$and = "AND".RET;		}		if($array['metro_area'] != "") {			$qry .= $and."metro_area = '".$array['metro_area']."'".RET;			$and = "AND".RET;		}		if($array['promotion_id'] != "") {			$qry .= $and."promotion_id = '".$array['promotion_id']."'".RET;			$and = "AND".RET;		}		if($array['elgg_ent_ass'] != "") {			$qry .= $and."elgg_ent_ass = '".$array['elgg_ent_ass']."'".RET;			$and = "AND".RET;		}		if($array['img_ext'] != "") {			$qry .= $and."img_ext = '".$array['img_ext']."'".RET;			$and = "AND".RET;		}		if($array['views_count'] != "") {			$qry .= $and."views_count = '".$array['views_count']."'".RET;			$and = "AND".RET;		}				if($array['is_pdf_uploaded'] != "") {			$qry .= $and."is_pdf_uploaded = '".$array['is_pdf_uploaded']."'".RET;			$and = "AND".RET;		}		if($array['cupon_type'] != "") {			$qry .= $and."cupon_type = '".$array['cupon_type']."'".RET;			$and = "AND".RET;		}				if($array['allowed_cupons'] != "") {			$qry .= $and."allowed_cupons = '".$array['allowed_cupons']."'".RET;			$and = "AND".RET;		}				if($array['redimed_cupons'] != "") {			$qry .= $and."redimed_cupons = '".$array['redimed_cupons']."'".RET;			$and = "AND".RET;		}				if($array['prom_code'] != "") {			$qry .= $and."prom_code = '".$array['prom_code']."'".RET;			$and = "AND".RET;		}		if($array['is_exclusive'] != "") {			$qry .= $and."is_exclusive = '".$array['is_exclusive']."'".RET;			$and = "AND".RET;		}		if($array['priority'] != "") {			$qry .= $and."priority = '".$array['priority']."'".RET;			$and = "AND".RET;		}		if($array['disc_aply_type'] != "") {			$qry .= $and."disc_aply_type = '".$array['disc_aply_type']."'".RET;			$and = "AND".RET;		}		if($array['disc_amt_type'] != "") {			$qry .= $and."disc_amt_type = '".$array['disc_amt_type']."'".RET;			$and = "AND".RET;		}		if($array['disc_amt'] != "") {			$qry .= $and."disc_amt = '".$array['disc_amt']."'".RET;			$and = "AND".RET;		}				if($array['prm_restaurent'] != "") {			$qry .= $and."prm_restaurent = ".$array['prm_restaurent'].RET;			$and = "AND".RET;		}				if($array['prom_template_id'] != "") {			$qry .= $and."prom_template_id = ".$array['prom_template_id'].RET;			$and = "AND".RET;		}				if($array['is_event'] != "") {			$qry .= $and."is_event = ".$array['is_event'].RET;			$and = "AND".RET;		}				if($array['prm_allow_multi_redeem'] != "") {			$qry .= $and."prm_allow_multi_redeem = ".$array['prm_allow_multi_redeem'].RET;			$and = "AND".RET;		}		    $result = mysql_query($qry);		if($result){            while ($row = mysql_fetch_array($result)) {			     $record = $row;				break;//end after first record			}            if(count($record[0]) == 0) {			    return array();			} else {				$this->setid($record['id']);				$this->setlist_id($record['list_id']);				$this->settitle($record['title']);				$this->setpdf($record['pdf']);				$this->setcomments($record['comments']);				$this->setterms_desc($record['terms_desc']);				$this->setstart_date($record['start_date']);				$this->setend_date($record['end_date']);				$this->setstates($record['states']);				$this->setmetro_area($record['metro_area']);				$this->setpromotion_id($record['promotion_id']);				$this->setelgg_ent_ass($record['elgg_ent_ass']);				$this->setimg_ext($record['img_ext']);				$this->setviews_count($record['views_count']);				$this->setis_pdf_uploaded($record['is_pdf_uploaded']);				$this->setcupon_type($record['cupon_type']);				$this->setallowed_cupons($record['allowed_cupons']);				$this->setredimed_cupons($record['redimed_cupons']);								$this->setprom_code($record['prom_code']);				$this->setis_exclusive($record['is_exclusive']);				$this->setpriority($record['priority']);				$this->setdisc_aply_type($record['disc_aply_type']);				$this->setdisc_amt_type($record['disc_amt_type']);				$this->setdisc_amt($record['disc_amt']);								$this->setprom_template_id($record['prom_template_id']);				$this->setprm_restaurent($record['prm_restaurent']);				$this->setis_event($record['is_event']);								$this->setprm_allow_multi_redeem($record['prm_allow_multi_redeem']);				$this->setprm_refer_frd_points($record['prm_refer_frd_points']);								return true;			}		}	}	public static function readArray($array = array()) {		$qry = "SELECT *".RET."FROM ".PDS_LIST_PROMOTIONS.RET;		$and = "WHERE".RET;		if($array['id'] != "") {			$qry .= $and."id = '".$array['id']."'".RET;			$and = "AND".RET;		}		if($array['list_id'] != "") {			$qry .= $and."list_id = '".$array['list_id']."'".RET;			$and = "AND".RET;		}		if($array['title'] != "") {			$qry .= $and."title = '".$array['title']."'".RET;			$and = "AND".RET;		}		if($array['pdf'] != "") {			$qry .= $and."pdf = '".$array['pdf']."'".RET;			$and = "AND".RET;		}		if($array['comments'] != "") {			$qry .= $and."comments = '".$array['comments']."'".RET;			$and = "AND".RET;		}		if($array['start_date'] != "") {			$qry .= $and."start_date = '".$array['start_date']."'".RET;			$and = "AND".RET;		}		if($array['end_date'] != "") {			$qry .= $and."end_date = '".$array['end_date']."'".RET;			$and = "AND".RET;		}		if($array['states'] != "") {			$qry .= $and."states = '".$array['states']."'".RET;			$and = "AND".RET;		}		if($array['metro_area'] != "") {			$qry .= $and."metro_area = '".$array['metro_area']."'".RET;			$and = "AND".RET;		}		if($array['promotion_id'] != "") {			$qry .= $and."promotion_id = '".$array['promotion_id']."'".RET;			$and = "AND".RET;		}		if($array['elgg_ent_ass'] != "") {			$qry .= $and."elgg_ent_ass = '".$array['elgg_ent_ass']."'".RET;			$and = "AND".RET;		}		if($array['img_ext'] != "") {			$qry .= $and."img_ext = '".$array['img_ext']."'".RET;			$and = "AND".RET;		}		if($array['views_count'] != "") {			$qry .= $and."views_count = '".$array['views_count']."'".RET;			$and = "AND".RET;		}        if($array['is_pdf_uploaded'] != "") {			$qry .= $and."is_pdf_uploaded = '".$array['is_pdf_uploaded']."'".RET;			$and = "AND".RET;		}        if($array['cupon_type'] != "") {			$qry .= $and."cupon_type = '".$array['cupon_type']."'".RET;			$and = "AND".RET;		}		if($array['allowed_cupons'] != "") {			$qry .= $and."allowed_cupons = '".$array['allowed_cupons']."'".RET;			$and = "AND".RET;		}		if($array['redimed_cupons'] != "") {			$qry .= $and."redimed_cupons = '".$array['redimed_cupons']."'".RET;			$and = "AND".RET;		}		if($array['prom_code'] != "") {			$qry .= $and."prom_code = '".$array['prom_code']."'".RET;			$and = "AND".RET;		}		if($array['is_exclusive'] != "") {			$qry .= $and."is_exclusive = '".$array['is_exclusive']."'".RET;			$and = "AND".RET;		}		if($array['priority'] != "") {			$qry .= $and."priority = '".$array['priority']."'".RET;			$and = "AND".RET;		}		if($array['disc_aply_type'] != "") {			$qry .= $and."disc_aply_type = '".$array['disc_aply_type']."'".RET;			$and = "AND".RET;		}		if($array['disc_amt_type'] != "") {			$qry .= $and."disc_amt_type = '".$array['disc_amt_type']."'".RET;			$and = "AND".RET;		}		if($array['disc_amt'] != "") {			$qry .= $and."disc_amt = '".$array['disc_amt']."'".RET;			$and = "AND".RET;		}				if($array['prm_restaurent'] != "") {			$qry .= $and."prm_restaurent = '".$array['prm_restaurent']."'".RET;			$and = "AND".RET;		}				if($array['prom_template_id'] != "") {			$qry .= $and."prom_template_id = ".$array['prom_template_id'].RET;			$and = "AND".RET;		}				if(($array['active_only'] != "") && ($array['active_only']==1)) {			$qry .= $and."`end_date` >= CURDATE()".RET;			$and = "AND".RET;		}				if($array['is_event'] != "") {			$qry .= $and."is_event = ".$array['is_event'].RET;			$and = "AND".RET;		}				if($array['prm_allow_multi_redeem'] != "") {			$qry .= $and."prm_allow_multi_redeem = ".$array['prm_allow_multi_redeem'].RET;			$and = "AND".RET;		}				//echo $qry;		$result = mysql_query($qry);		$class_objects = array();		if($result){      while ($record = mysql_fetch_assoc($result)) {				$class_object = new pds_list_promotions();				$class_object->setid($record['id']);				$class_object->setlist_id($record['list_id']);				$class_object->settitle($record['title']);				$class_object->setpdf($record['pdf']);				$class_object->setcomments($record['comments']);				$class_object->setterms_desc($record['terms_desc']);				$class_object->setstart_date($record['start_date']);				$class_object->setend_date($record['end_date']);				$class_object->setstates($record['states']);				$class_object->setmetro_area($record['metro_area']);				$class_object->setpromotion_id($record['promotion_id']);				$class_object->setelgg_ent_ass($record['elgg_ent_ass']);				$class_object->setimg_ext($record['img_ext']);				$class_object->setviews_count($record['views_count']);				$class_object->setis_pdf_uploaded($record['is_pdf_uploaded']);				$class_object->setcupon_type($record['cupon_type']);				$class_object->setallowed_cupons($record['allowed_cupons']);				$class_object->setredimed_cupons($record['redimed_cupons']);								$class_object->setprom_code($record['prom_code']);				$class_object->setis_exclusive($record['is_exclusive']);				$class_object->setpriority($record['priority']);				$class_object->setdisc_aply_type($record['disc_aply_type']);				$class_object->setdisc_amt_type($record['disc_amt_type']);				$class_object->setdisc_amt($record['disc_amt']);								$class_object->setprom_template_id($record['prom_template_id']);				$class_object->setprm_restaurent($record['prm_restaurent']);								$class_object->setis_event($record['is_event']);				$class_object->setprm_allow_multi_redeem($record['prm_allow_multi_redeem']);				$class_object->setprm_refer_frd_points($record['prm_refer_frd_points']);								$class_objects[$class_object->getid()] = $class_object;			}		}		return $class_objects;	}	public function insert() {		if($this->getid() != '') {			$qry  = "UPDATE ".PDS_LIST_PROMOTIONS.RET."SET".RET.			"id = '".mysql_real_escape_string($this->getid())."',".RET.			"list_id = '".mysql_real_escape_string($this->getlist_id())."',".RET.			"title = '".mysql_real_escape_string($this->gettitle())."',".RET.			"pdf = '".mysql_real_escape_string($this->getpdf())."',".RET.			"comments = '".mysql_real_escape_string($this->getcomments())."',".RET.			"terms_desc = '".mysql_real_escape_string($this->getterms_desc())."',".RET.   /*"start_date = '".mysql_real_escape_string($this->getstart_date())."',".RET.			"end_date = '".mysql_real_escape_string($this->getend_date())."',".RET.*/			"states = '".mysql_real_escape_string($this->getstates())."',".RET.			"metro_area = '".mysql_real_escape_string($this->getmetro_area())."',".RET.			"promotion_id = '".mysql_real_escape_string($this->getpromotion_id())."',".RET.			"elgg_ent_ass = '".mysql_real_escape_string($this->getelgg_ent_ass())."',".RET.			"img_ext = '".mysql_real_escape_string($this->getimg_ext())."',".RET.			"views_count = '".mysql_real_escape_string($this->getviews_count())."',".RET.			"is_pdf_uploaded = '".mysql_real_escape_string($this->getis_pdf_uploaded())."',".RET.			"cupon_type = '".mysql_real_escape_string($this->getcupon_type())."',".RET.			"allowed_cupons = '".mysql_real_escape_string($this->getallowed_cupons())."',".RET.			"redimed_cupons = '".mysql_real_escape_string($this->getredimed_cupons())."',".RET.						"prom_code = '".mysql_real_escape_string($this->getprom_code())."',".RET.			"is_exclusive = '".mysql_real_escape_string($this->getis_exclusive())."',".RET.			"priority = '".mysql_real_escape_string($this->getpriority())."',".RET.			"disc_aply_type = '".mysql_real_escape_string($this->getdisc_aply_type())."',".RET.			"disc_amt_type = '".mysql_real_escape_string($this->getdisc_amt_type())."',".RET.			"disc_amt = '".mysql_real_escape_string($this->getdisc_amt())."',".RET.						"is_event = '".mysql_real_escape_string($this->getis_event())."',".RET.						"prm_allow_multi_redeem = '".mysql_real_escape_string($this->getprm_allow_multi_redeem())."',".RET.			"prm_refer_frd_points = '".mysql_real_escape_string($this->getprm_refer_frd_points())."',".RET.						"start_date = '".mysql_real_escape_string($this->getstart_date())."',".RET.			"end_date = '".mysql_real_escape_string($this->getend_date())."',".RET.						"prom_template_id = '".mysql_real_escape_string($this->getprom_template_id())."'".RET.			/*"prm_restaurent = '".$this->getprm_restaurent()."'".RET.		*/				" WHERE id = ".$this->getid().RET;		 		     	$result = mysql_query($qry);						if($result){         	return mysql_affected_rows();  		}					} else {			 			$qry  = "INSERT INTO ".PDS_LIST_PROMOTIONS." (".RET.			"list_id, title, pdf, comments,terms_desc, start_date, end_date, states, metro_area, promotion_id, elgg_ent_ass, img_ext, views_count, is_pdf_uploaded,cupon_type,allowed_cupons,redimed_cupons,prom_code,is_exclusive,priority,disc_aply_type,disc_amt_type,disc_amt,prom_template_id,is_event,prm_restaurent,prm_allow_multi_redeem,prm_refer_frd_points ".RET.				") VALUES (".RET.			"'".mysql_real_escape_string($this->getlist_id())."',".RET.			"'".mysql_real_escape_string($this->gettitle())."',".RET.			"'".mysql_real_escape_string($this->getpdf())."',".RET.			"'".mysql_real_escape_string($this->getcomments())."',".RET.			"'".mysql_real_escape_string($this->getterms_desc())."',".RET.			"'".mysql_real_escape_string($this->getstart_date())."',".RET.			"'".mysql_real_escape_string($this->getend_date())."',".RET.			"'".mysql_real_escape_string($this->getstates())."',".RET.			"'".mysql_real_escape_string($this->getmetro_area())."',".RET.			"'".mysql_real_escape_string($this->getpromotion_id())."',".RET.			"'".mysql_real_escape_string($this->getelgg_ent_ass())."',".RET.			"'".mysql_real_escape_string($this->getimg_ext())."',".RET.			"'".mysql_real_escape_string($this->getviews_count())."',".RET.			"'".mysql_real_escape_string($this->getis_pdf_uploaded())."',".RET.			"'".mysql_real_escape_string($this->getcupon_type())."',".RET.			"'".mysql_real_escape_string($this->getallowed_cupons())."',".RET.			"'".mysql_real_escape_string($this->getredimed_cupons())."',".RET. 			"'".mysql_real_escape_string($this->getprom_code())."',".RET.			"'".mysql_real_escape_string($this->getis_exclusive())."',".RET.			"'".mysql_real_escape_string($this->getpriority())."',".RET.			"'".mysql_real_escape_string($this->getdisc_aply_type())."',".RET.			"'".mysql_real_escape_string($this->getdisc_amt_type())."',".RET.			"".mysql_real_escape_string($this->getdisc_amt())."".RET.",".RET.						"".mysql_real_escape_string($this->getprom_template_id())."".RET.",".RET.			"".mysql_real_escape_string($this->getis_event())."".RET.",".RET.						"".mysql_real_escape_string($this->getprm_restaurent()).",".RET.			"".mysql_real_escape_string($this->getprm_allow_multi_redeem()).",".RET.			"".mysql_real_escape_string($this->getprm_refer_frd_points())."".RET.			")".RET; 			 			 $result = mysql_query($qry); 			 $this->setid(mysql_insert_id());			 return $this->getid();		}	}	public static function delete($array = array()) {		$qry = "DELETE".RET."FROM ".PDS_LIST_PROMOTIONS.RET;		$and = "WHERE".RET;		if($array['id'] != "") {			$qry .= $and."id = '".$array['id']."'".RET;			$and = "AND".RET;		}		if($array['list_id'] != "") {			$qry .= $and."list_id = '".$array['list_id']."'".RET;			$and = "AND".RET;		}		if($array['title'] != "") {			$qry .= $and."title = '".$array['title']."'".RET;			$and = "AND".RET;		}		if($array['pdf'] != "") {			$qry .= $and."pdf = '".$array['pdf']."'".RET;			$and = "AND".RET;		}		if($array['comments'] != "") {			$qry .= $and."comments = '".$array['comments']."'".RET;			$and = "AND".RET;		}		if($array['start_date'] != "") {			$qry .= $and."start_date = '".$array['start_date']."'".RET;			$and = "AND".RET;		}		if($array['end_date'] != "") {			$qry .= $and."end_date = '".$array['end_date']."'".RET;			$and = "AND".RET;		}		if($array['states'] != "") {			$qry .= $and."states = '".$array['states']."'".RET;			$and = "AND".RET;		}		if($array['metro_area'] != "") {			$qry .= $and."metro_area = '".$array['metro_area']."'".RET;			$and = "AND".RET;		}		if($array['promotion_id'] != "") {			$qry .= $and."promotion_id = '".$array['promotion_id']."'".RET;			$and = "AND".RET;		}		if($array['elgg_ent_ass'] != "") {			$qry .= $and."elgg_ent_ass = '".$array['elgg_ent_ass']."'".RET;			$and = "AND".RET;		}		if($array['img_ext'] != "") {			$qry .= $and."img_ext = '".$array['img_ext']."'".RET;			$and = "AND".RET;		}		if($array['views_count'] != "") {			$qry .= $and."views_count = '".$array['views_count']."'".RET;			$and = "AND".RET;		}				if($array['is_pdf_uploaded'] != "") {			$qry .= $and."is_pdf_uploaded = '".$array['is_pdf_uploaded']."'".RET;			$and = "AND".RET;		}		if($array['cupon_type'] != "") {			$qry .= $and."cupon_type = '".$array['cupon_type']."'".RET;			$and = "AND".RET;		}		if($array['allowed_cupons'] != "") {			$qry .= $and."allowed_cupons = '".$array['allowed_cupons']."'".RET;			$and = "AND".RET;		}		if($array['redimed_cupons'] != "") {			$qry .= $and."redimed_cupons = '".$array['redimed_cupons']."'".RET;			$and = "AND".RET;		}				if($array['prom_code'] != "") {			$qry .= $and."prom_code = '".$array['prom_code']."'".RET;			$and = "AND".RET;		}		if($array['is_exclusive'] != "") {			$qry .= $and."is_exclusive = '".$array['is_exclusive']."'".RET;			$and = "AND".RET;		}		if($array['priority'] != "") {			$qry .= $and."priority = '".$array['priority']."'".RET;			$and = "AND".RET;		}		if($array['disc_aply_type'] != "") {			$qry .= $and."disc_aply_type = '".$array['disc_aply_type']."'".RET;			$and = "AND".RET;		}		if($array['disc_amt_type'] != "") {			$qry .= $and."disc_amt_type = '".$array['disc_amt_type']."'".RET;			$and = "AND".RET;		}		if($array['disc_amt'] != "") {			$qry .= $and."disc_amt = '".$array['disc_amt']."'".RET;			$and = "AND".RET;		}				if($array['prm_restaurent'] != "") {			$qry .= $and."prm_restaurent = '".$array['prm_restaurent']."'".RET;			$and = "AND".RET;		}				if($array['prom_template_id'] != "") {			$qry .= $and."prom_template_id = ".$array['prom_template_id'].RET;			$and = "AND".RET;		}				if($array['is_event'] != "") {			$qry .= $and."is_event = ".$array['is_event'].RET;			$and = "AND".RET;		}		$result = mysql_query($qry);				if($result){        return mysql_affected_rows();  	}  	return 0;			}		/*public function save($title, $userid, $keywords="", $business_title="", $categories="", $countries="", $states="", $metro_area="", $isPromotions=0, $id=""){		if((is_not_empty($title))&& (is_gt_zero_num($userid))){				$id = $this->isAlreadyThere($title, $userid, $isPromotions);	   			if(is_gt_zero_num($id)){	                $this->setid($id);	   			}else{	                $this->setid("");			    }				$this->setlist_id($data['list_id']);				$this->settitle($data['title']);				$this->setpdf($data['pdf']);				$this->setcomments($data['comments']);				$this->setstart_date($data['start_date']);				$this->setend_date($data['end_date']);				$this->setstates($data['states']);				$this->setmetro_area($data['metro_area']);				$this->setpromotion_id($data['promotion_id']);				$this->setelgg_ent_ass($data['elgg_ent_ass']);				$this->setimg_ext($data['img_ext']);				$this->setviews_count($data['views_count']);			   	$this->insert();			   	return $this->getid();		}        return 0;	}*/		public function create($list_id, $title, $comments, $start_date, $end_date, $states, $metro_area, $promotion_id=0,$cupon_type="none",$allowed_cupons=0,$terms_desc='',$prom_code='',$is_exclusive=0,$priority=1,$disc_aply_type='ORDER',$disc_amt_type='PERCENT',$disc_amt=0,$prm_restaurent=0,$template_id=0,$email_content='',$is_event=0,$prm_allow_multi_redeem=0,$prm_refer_frd_points=0){				$promotion_id = 0;				$this->setid("");        		$this->setlist_id($list_id);				$this->settitle($title);				$this->setpdf("");				$this->setcomments($comments);				$this->setterms_desc($terms_desc);				$this->setstart_date($start_date);				$this->setend_date($end_date);				$this->setstates($states);				$this->setmetro_area($metro_area);				$this->setpromotion_id($promotion_id);				$this->setviews_count(0);        $this->setcupon_type($cupon_type);        $this->setallowed_cupons($allowed_cupons);								$this->setprom_code($prom_code);				$this->setis_exclusive($is_exclusive);				$this->setpriority($priority);				$this->setdisc_aply_type($disc_aply_type);				$this->setdisc_amt_type($disc_amt_type);				$this->setdisc_amt($disc_amt);				$this->setprm_restaurent($prm_restaurent);				$this->setprom_template_id($template_id);								$this->setis_event($is_event);						$this->setprm_allow_multi_redeem($prm_allow_multi_redeem);									$this->setprm_refer_frd_points($prm_refer_frd_points);																$this->insert();								$_just_created_prom_id=$this->getid();				//..if promotion of the refer a friend type then auto create the reward				if(is_gt_zero_num($_just_created_prom_id) && ($cupon_type=='refer_friend')){					$objbiz_rewards= new biz_rewards();					$isSuccess = $objbiz_rewards->create($prm_restaurent,'REFER A FRIEND','refer_friend', 1, 0, 0, 'total', 'm', 0, 0, 1, 0, 1, $_just_created_prom_id, $start_date, $end_date, '', '',0);					unset($objbiz_rewards);					//..Update promotion reward id									}							  //$this->sendEmailToSubscribePerson($this->getid(),$template_id,$email_content);			  return $_just_created_prom_id; 	} 	    public function renewImageFile($source_id, $destination_id){       global $config;       $this->readObject(array( "id"=>$source_id));       $ext =  $this->getimg_ext();       if(is_not_empty($ext)){            $src = $config['root']."promotion_images/{$source_id}.{$ext}";            $dst = $config['root']."promotion_images/{$destination_id}.{$ext}";            if (file_exists($src)){                  if(copy($src, $dst)){                    $this->readObject(array( "id"=>$destination_id));                    $this->setimg_ext($ext);                    $this->insert();                    return $dst = $config['mainurl']."promotion_images/{$destination_id}.{$this->getimg_ext()}";                  }            }       }       return false;    }	public function isAlreadyThere($title, $userid){       $this->readObject(array( "title"=>$title, "userid"=>$userid));       return $this->getid();  	}  	   public function getActivePromotionsCount($list_id){      if(is_gt_zero_num($list_id)){            $active_count = -1;            $sql="SELECT Count(id) FROM ".PDS_LIST_PROMOTIONS." WHERE end_date>=CURDATE() AND list_id=$list_id";            $res = mysql_query($sql);           if($res){              $active_count = mysql_result($res,0);           }          return $active_count;      }      return 0;    }			 public static function GetPromotions($isActiveOnly=0){	 	  $arr = array(); 	 		if($res = mysql_query('SELECT id,title FROM '.PDS_LIST_PROMOTIONS.' WHERE `prm_restaurent`='.$_SESSION[SES_RESTAURANT].' AND `cupon_type`<>"reward" AND `cupon_type`<>"exclusive" '.(is_gt_zero_num($isActiveOnly)?' AND end_date>=CURDATE()':''). ' ORDER BY id DESC;')){				$x = 0;				while($row = mysql_fetch_assoc($res)){					$arr[$row['id']] = $row['title']; 					$x++;				}			}		 return $arr;		 }	 	 public static function GetRewards($isActiveOnly=0){	 	  $arr = array(); 	 		if($res = mysql_query('SELECT id,title FROM '.PDS_LIST_PROMOTIONS.' WHERE `prm_restaurent`='.$_SESSION[SES_RESTAURANT].' AND `cupon_type`="reward" '.(is_gt_zero_num($isActiveOnly)?' AND end_date>=CURDATE()':''). ' ORDER BY id DESC;')){				$x = 0;				while($row = mysql_fetch_assoc($res)){					$arr[$row['id']] = $row['title']; 					$x++;				}			}		 return $arr;		 }	 	public static function GetExclusiveOnly($isActiveOnly=0){	 	  $arr = array(); 	 	    // type exclusive  =>  invitation	 		if($res = mysql_query('SELECT id,title FROM '.PDS_LIST_PROMOTIONS.' WHERE `prm_restaurent`='.$_SESSION[SES_RESTAURANT].' AND `cupon_type`="invitation" '.(is_gt_zero_num($isActiveOnly)?' AND end_date>=CURDATE()':''). ' ORDER BY id DESC;')){				$x = 0;				while($row = mysql_fetch_assoc($res)){					$arr[$row['id']] = $row['title']; 					$x++;				}			}		 return $arr;		} 	 	public static function GetPromotionDetail($prom_id){	 	  $arr = array(); 	 	  if($res = mysql_query('SELECT * FROM '.PDS_LIST_PROMOTIONS.' WHERE id='.$prom_id)){				$x = 0;				while($row = mysql_fetch_assoc($res)){					$arr=$row; 					$x++;				}		  }		  return $arr;		 } 	    public function listOfActiveCoupons($list_id){     if(is_gt_zero_num($list_id)){            $sql="SELECT GROUP_CONCATE(`id`) FROM ".PDS_LIST_PROMOTIONS." WHERE `end_date`>=CURDATE() AND `cupon_type` <> 'none' AND `list_id`=$list_id";            $res = mysql_query($sql);           if($res){              $active_count = mysql_result($res,0);           }          return $active_count;      }      return 0;   } 	 	 public function sendEmailToSubscribePerson($prom_id,$template_id,$email_content=''){	 	global $sending_email,$website;		//..A] first get emails from the receipt		$subscriber_emails = array();		$arr = tbl_crm::readArray(array(CRM_IS_SUBSRIBED=>1,'isActive'=>1,CRM_RESTAURANT=>$_SESSION[SES_RESTAURANT]));				$obj_crm_prom_emails=new crm_prom_emails();			foreach($arr as $val){			if(is_not_empty($val[CRM_CUST_EMAIL]) && (strlen($val[CRM_CUST_EMAIL])>3)) {				//$subscriber_emails[] = $val[CRM_CUST_EMAIL];				$op=$this->email_promtoion($prom_id,$template_id,$val[CRM_CUST_EMAIL],$val[CRM_ID],'',$email_content);				if($op){					//..Add one record to crm notify table					$tmp_rslt=$obj_crm_prom_emails->create($val[CRM_ID], $prom_id, 0, '', '');				}			}		}		unset($obj_crm_prom_emails);		/*//..B] second now fetch from the crm sms facility		$arr =DB::ExecQry('SELECT `email` FROM `members` WHERE `sms_subscribed`=1'); 		foreach($arr as $val){			if(is_not_empty($val['email'])) $subscriber_emails[] = $val['email'];		}*/		//..C] take only unique emails		/*if(is_not_empty($subscriber_emails)){				$subscriber_emails=array_unique($subscriber_emails);		}*/				return 1;						//return $this->email_promtoion($prom_id,$template_id,$subscriber_emails,0,'',$email_content);		/*if(is_not_empty($subscriber_emails)){			$restaurant_info = tbl_restaurent::GetInfo($_SESSION[SES_RESTAURANT]);						if($this->readObject(array('id'=>$prom_id))){				$strOp = '<h1 align="center">'.$this->gettitle().'</h1>'.RET;				$strOp .= '<h4  align="center">Offer Valid Till '.date("F j, Y",strtotime($this->getend_date())).'</h4> '.RET;				$strOp .= '<p style="font-size:14px;">&nbsp;&nbsp;&nbsp;&nbsp;'.$this->getcomments().'</p>';  								$customer_email = biz_implode(',',$subscriber_emails); 				$subject =  $restaurant_info[RESTAURENT_NAME].' - New Promotion Added';				// Always set content-type when sending HTML email				$headers  = "MIME-Version: 1.0 "."\r\n";				$headers .= "Content-Type: text/html; charset=ISO-8859-1 "."\r\n";								$headers .= "From: ".$restaurant_info[RESTAURENT_NAME]."<".$restaurant_info[RESTAURENT_EMAIL]. ">\r\n";				$headers .= "Reply-To: <".$restaurant_info[RESTAURENT_EMAIL]. ">\r\n";				$content = "<html><body style=\"font-family: Arial !important;font-size:12px;\">";			 	$content .= "Hi, <br/>";				$content .= "{$strOp}" ; 				$content .= "<br/>Thanks<br/>";				$content .= "<a href='{$website}'>".$restaurant_info[RESTAURENT_NAME]."</a>"; 				return send_template($template_id,$prom_id,$customer_email ,$restaurant_info[RESTAURENT_EMAIL],$restaurant_info[RESTAURENT_NAME],$subject); 	   		//return mail($customer_email, $subject, $content, $headers,'-f'.$restaurant_info[RESTAURENT_EMAIL]); 			} 		}*/		//return FALSE;	}	//..function to email the promotion	public function email_promtoion($prom_id,$template_id,$subscriber_emails,$crm_id=0,$refer_by='',$msg_body='',$_filt_prom=array()){	 	global $sending_email,$website;				if(is_not_empty($subscriber_emails)){									if($this->readObject(array('id'=>$prom_id))){				$restaurant_info = tbl_restaurent::GetInfo($this->getprm_restaurent());											$strOp = '<h1 align="center">'.$this->gettitle().'</h1>'.RET;				$strOp .= '<h4 align="center">Offer Valid From '.date("F j, Y",strtotime($this->getstart_date())).' Till '.date("F j, Y",strtotime($this->getend_date())).'</h4><br>'.RET;								//..the content can be based on the promotion text or user provided text				$eml_cntnts=nl2br($this->getcomments());				if(is_not_empty($msg_body)){					$eml_cntnts=$msg_body;				}								$strOp .= '<p style="font-size:14px;">&nbsp;&nbsp;&nbsp;&nbsp;'.$eml_cntnts.'</p>';  								$customer_email = biz_implode(',',$subscriber_emails); 				$subject =  $this->gettitle().' From '.$restaurant_info[RESTAURENT_NAME];				//.' - New Promotion Added';http://192.168.100.2/restaurent_manager/modules/business_listing/show.php?show_type=PR&lid=1&promoid=361				if(is_not_empty($_filt_prom)){					$prom_link=biz_get_tiny_url($website."/modules/business_listing/show.php?show_type=PR&lid=".$this->getlist_id()."&promoid=".$prom_id."&prom_filt_rwd=".$_filt_prom['reward']."&prom_filt_usr=".$_filt_prom['user']);				}else{					if(is_gt_zero_num($crm_id)){						//$prom_link=$website."/modules/business_listing/show.php?show_type=PR&lid=".$this->getlist_id()."&promoid=".$prom_id."&prom_crm_id=".$crm_id;							$prom_link=biz_get_tiny_url($website."/modules/business_listing/show.php?show_type=PR&lid=".$this->getlist_id()."&promoid=".$prom_id."&prom_crm_id=".$crm_id);						}else{						$prom_link=biz_get_tiny_url($website."/modules/business_listing/show.php?show_type=PR&lid=".$this->getlist_id()."&promoid=".$prom_id);					}					}												// Always set content-type when sending HTML email				$headers  = "MIME-Version: 1.0 "."\r\n";				$headers .= "Content-Type: text/html; charset=ISO-8859-1 "."\r\n";								$headers .= "From: ".$restaurant_info[RESTAURENT_NAME]."<".$restaurant_info[RESTAURENT_EMAIL]. ">\r\n";				$headers .= "Reply-To: ".$restaurant_info[RESTAURENT_NAME]." <".$restaurant_info[RESTAURENT_EMAIL]. ">\r\n";				$headers .= "Return-Path: ".$restaurant_info[RESTAURENT_NAME]." <".$restaurant_info[RESTAURENT_EMAIL]. ">\r\n";								$headers .= "Organization: ".$restaurant_info[RESTAURENT_NAME]."\r\n";				$headers .= "X-Priority: 3\r\n";				$headers .= "X-Mailer: PHP". phpversion() ."\r\n" ;								$content = "<html><body style=\"font-family: Arial !important;font-size:12px;\">";				if(count($subscriber_emails)==1)			 		$content .= "Hello {$customer_email}, <br/>";				else					$content .= "Hello , <br/>";										$content .= "{$strOp} <br/>" ;				$content .= "Follow this <a href='{$prom_link}'>link </a> to claim this promotion.<br/>" ; 				if(is_not_empty($refer_by)){					$content .= "<br>This promotion is recommended to you by your friend {$refer_by}. <br/>" ; 				}				$content .= "<br/>Thanks,<br/>";				//$content .= "<a href='{$website}'>".$restaurant_info[RESTAURENT_NAME]."</a>";				$content .= $restaurant_info[RESTAURENT_NAME];								$content .= "<br/><hr/><br/>";								//$content .= "To unsubscribe from promotion subscription <a href='{$website}/user/tbl_crm_unsubscribe.php?crm_id={$crm_id}' target='_blank'>click here</a>";								//..Finally send the email with the above content				try {					//echo "{$customer_email} ------<hr>{$content}------<hr>{$prom_link}-<br><br>";					$_is_sub=tbl_crm::is_subscribed_usr('',$restaurant_info[RESTAURENT_ID],$customer_email);										$isSuccess=0;					if(is_gt_zero_num($_is_sub)){						$content .= "To unsubscribe from promotion subscription <a href='{$website}/user/tbl_crm_unsubscribe.php?crm_id={$_is_sub}' target='_blank'>click here</a>";						$isSuccess=mail($customer_email, $subject, $content, $headers,'-f'.$restaurant_info[RESTAURENT_EMAIL]);					}													//exit;										}catch(Exception $e){				  // echo 'Caught exception: ',  $e->getMessage(), "\n";				}				return $isSuccess; 				 				//..CURRENT..				//return send_template($this->getprom_template_id(),$prom_id,$customer_email ,$restaurant_info[RESTAURENT_EMAIL],$restaurant_info[RESTAURENT_NAME],$subject);				//return send_template($template_id,$prom_id,$customer_email ,$restaurant_info[RESTAURENT_EMAIL],$restaurant_info[RESTAURENT_NAME],$subject);					   		//return mail($customer_email, $subject, $content, $headers,'-f'.$restaurant_info[RESTAURENT_EMAIL]); 			} 		}		return FALSE;	}		//..function to email the promotion	public function email_preview_promtoion($prom_id,$msg_body=''){	 		global $sending_email,$website;			$refer_by='';			//$restaurant_info = tbl_restaurent::GetInfo($_SESSION[SES_RESTAURANT]);						if($this->readObject(array('id'=>$prom_id))){				$restaurant_info = tbl_restaurent::GetInfo($this->getprm_restaurent());									$strOp = '<h1 align="center">'.$this->gettitle().'</h1>'.RET;				$strOp .= '<h4 align="center">Offer Valid From '.date("F j, Y",strtotime($this->getstart_date())).' Till '.date("F j, Y",strtotime($this->getend_date())).'</h4><br>'.RET;								//..the content can be based on the promotion text or user provided text				$eml_cntnts=nl2br($this->getcomments());				if(is_not_empty($msg_body)){					$eml_cntnts=$msg_body;				}								$strOp .= '<p id="email_body_content" style="font-size:14px;">&nbsp;&nbsp;&nbsp;&nbsp;'.$eml_cntnts.'</p>';  								//$customer_email = biz_implode(',',$subscriber_emails); 				$subject =  $this->gettitle().' From '.$restaurant_info[RESTAURENT_NAME];				//.' - New Promotion Added';http://192.168.100.2/restaurent_manager/modules/business_listing/show.php?show_type=PR&lid=1&promoid=361								if(is_gt_zero_num($crm_id)){					$prom_link=biz_get_tiny_url($website."/modules/business_listing/show.php?show_type=PR&lid=".$this->getlist_id()."&promoid=".$prom_id."&prom_crm_id=".$crm_id);					}else{					$prom_link=$website."/modules/business_listing/show.php?show_type=PR&lid=".$this->getlist_id()."&promoid=".$prom_id;				}								// Always set content-type when sending HTML email				$headers  = "MIME-Version: 1.0 "."\r\n";				$headers .= "Content-Type: text/html; charset=ISO-8859-1 "."\r\n";								$headers .= "From: ".$restaurant_info[RESTAURENT_NAME]."<".$restaurant_info[RESTAURENT_EMAIL]. ">\r\n";				$headers .= "Reply-To: <".$restaurant_info[RESTAURENT_EMAIL]. ">\r\n";				$content = "<html><body style=\"font-family: Arial !important;font-size:12px;\">";			 	$content .= "Hello , <br/>";				$content .= "{$strOp} <br/>" ;				//$content .= "Use this <a href='{$prom_link}'>link </a> to claim it.<br/>" ;				 $content .= "Follow this <a href='{$prom_link}'>link </a> to claim this promotion.<br/>" ; 				if(is_not_empty($refer_by)){					$content .= "<br>This promotion is recommended to you by your friend {$refer_by}. <br/>" ; 				}				$content .= "<br/>Thanks,<br/>";				//$content .= "<a href='{$website}'>".$restaurant_info[RESTAURENT_NAME]."</a>";				$content .= $restaurant_info[RESTAURENT_NAME];								$content .= "<br/><hr/><br/>";								$content .= "To unsubscribe from promotion subscription <a href='{$website}/user/tbl_crm_unsubscribe.php?crm_id={$crm_id}' target='_blank'>click here</a>";								//..finally send the email with the above content							return $content;  			} 		return '';	}		//..function to sms the promotion	public function sms_promtoion($prom_id,$subscriber_phones,$crm_id=0,$sms_msg='',$_filt_prom=array()){	 	global $sending_email,$website,$config;				if(is_not_empty($subscriber_phones)){			//$restaurant_info = tbl_restaurent::GetInfo($_SESSION[SES_RESTAURANT]);						if($this->readObject(array('id'=>$prom_id))){				$restaurant_info = tbl_restaurent::GetInfo($this->getprm_restaurent());					//$strOp = $this->gettitle();				//$strOp .= ' , Offer Valid From '.date("m/d/y",strtotime($this->getstart_date())).'-'.date("m/d/y",strtotime($this->getend_date()));					//.' - New Promotion Added';http://192.168.100.2/restaurent_manager/modules/business_listing/show.php?show_type=PR&lid=1&promoid=361				$_unsub_lnk='';				if(is_not_empty($_filt_prom)){					$prom_link=biz_get_tiny_url($website."/modules/business_listing/show.php?show_type=PR&lid=".$this->getlist_id()."&promoid=".$prom_id."&prom_filt_rwd=".$_filt_prom['reward']."&prom_filt_usr=".$_filt_prom['user']);				}else{					if(is_gt_zero_num($crm_id)){						//$prom_link=$website."/modules/business_listing/show.php?show_type=PR&lid=".$this->getlist_id()."&promoid=".$prom_id."&prom_crm_id=".$crm_id;							$prom_link=biz_get_tiny_url($website."/modules/business_listing/show.php?show_type=PR&lid=".$this->getlist_id()."&promoid=".$prom_id."&prom_crm_id=".$crm_id);					}else{						//$prom_link=$website."/modules/business_listing/show.php?show_type=PR&lid=".$this->getlist_id()."&promoid=".$prom_id;						$prom_link=biz_get_tiny_url($website."/modules/business_listing/show.php?show_type=PR&lid=".$this->getlist_id()."&promoid=".$prom_id);					}					}											/*				if(is_gt_zero_num($crm_id)){					$prom_link=biz_get_tiny_url($website."/modules/business_listing/show.php?show_type=PR&lid=".$this->getlist_id()."&promoid=".$prom_id."&prom_crm_id=".$crm_id);					}else{					$prom_link=biz_get_tiny_url($website."/modules/business_listing/show.php?show_type=PR&lid=".$this->getlist_id()."&promoid=".$prom_id);				}						*/												if(is_not_empty($sms_msg)){					$strOp = "{$sms_msg} - {$prom_link}";				}else{					$strOp = " Use link {$prom_link}, From ".$restaurant_info[RESTAURENT_NAME];				}								//..Send SMS promotion			 								try {					//echo $strOp. "{$subscriber_phones}- {$prom_link} -<hr>";					//..if user is subscribed then only send sms to user 					$_is_sub=tbl_crm::is_subscribed_usr($subscriber_phones,$restaurant_info[RESTAURENT_ID]);										$isSuccess=0;					if(is_gt_zero_num($_is_sub)){						$_unsub_lnk = ' Unsubscribe:'.biz_get_tiny_url("{$website}/user/tbl_crm_unsubscribe.php?crm_id={$_is_sub}");						$isSuccess=@send_sms_using_twilio($subscriber_phones,"{$strOp} {$_unsub_lnk}");					}									}catch(Exception $e) {				  // echo 'Caught exception: ',  $e->getMessage(), "\n";				}								return $isSuccess; 			} 		}		return FALSE;	}		//...Function to email the feedback promtions to user	public function email_feedback_coupons($user_email){	 	global $survey_coupons,$website;		$lst_feedbk_coupons = pds_list_promotions::readArray(array('cupon_type' =>'survey','active_only'=>1,'prm_restaurent'=>$_SESSION[SES_RESTAURANT])); 		if(is_not_empty($lst_feedbk_coupons)){			foreach($lst_feedbk_coupons as $val){				 //echo $val->getid(),$val->getprom_template_id(),$user_email;				 //exit;				 $this->email_promtoion($val->getid(),$val->getprom_template_id(),array($user_email));			}				}						}	} ?>