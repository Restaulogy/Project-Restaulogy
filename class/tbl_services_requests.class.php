<?php/**********************************************************************tbl_services_requests.class.phpGenerated by STRUCTY 2013.03.18 11:47:20.Copyright 2011 Structy, Frédéric Aebi. All rights reserved.**********************************************************************/define('TBL_SERVICES_REQUESTS', 'tbl_services_requests'); define('SRVC_REQST_ID', 'srvc_reqst_id'); define('SRVC_REQST_CREATED_BY', 'srvc_reqst_created_by'); define('SRVC_REQST_SRVC_ID', 'srvc_reqst_srvc_id'); define('SRVC_REQST_TABLE_ID', 'srvc_reqst_table_id'); define('SRVC_REQST_EMP_ID', 'srvc_reqst_emp_id'); define('SRVC_REQST_SESSION_ID','srvc_reqst_session_id');define('SRVC_REQST_TBL_SFT_ASSOC_ID', 'srvc_reqst_tbl_sft_assoc_id'); /*define('SRVC_REQST_CAT_ID', 'srvc_reqst_cat_id'); */define('SRVC_REQST_STATUS', 'srvc_reqst_status');define('SRVC_REQST_SPECIAL_NOTE', 'srvc_reqst_special_note');define('SRVC_REQST_ADD_QUESTS', 'srvc_reqst_add_quests');define('SRVC_REQST_CREATED_ON', 'srvc_reqst_created_on'); define('SRVC_REQST_ATTENDED_ON', 'srvc_reqst_attended_on'); define('SRVC_REQST_COMPLETED_AT', 'srvc_reqst_completed_at');  define('SRVC_REQST_IS_DELAYED', 'srvc_reqst_is_delayed');define('SRVC_REQST_CUST_ID', 'srvc_reqst_cust_id');define('SRVC_REQST_CUST_TYPE', 'srvc_reqst_cust_type'); define('TBL_SERVICES_REQUESTS_ACTIVE_DATE', SRVC_REQST_CREATED_ON);define('TBL_SERVICES_REQUESTS_DEACTIVE_DATE', SRVC_REQST_COMPLETED_AT);$tbl_services_requests_active_condition= ' ('.TBL_SERVICES_REQUESTS_DEACTIVE_DATE.' is NULL OR '.TBL_SERVICES_REQUESTS_DEACTIVE_DATE.' = 0) ';//$tbl_services_requests_active_condition= ' ('.TBL_SERVICES_REQUESTS_DEACTIVE_DATE.' is NULL OR '.TBL_SERVICES_REQUESTS_DEACTIVE_DATE.' > CURDATE( )) ';//..Status constantsdefine('SERVICE_STATUS_CREATED', 1 );// 'is_created');define('SERVICE_STATUS_IN_PROCESS',2 );// 'in_process');define('SERVICE_STATUS_COMPLETD',3 );// 'completed');define('SERVICE_STATUS_CANCELLED',4); //.. canceleddefine('SERVICE_STATUS_DELAYED',5); //.. delayed class tbl_services_requests {	private $srvc_reqst_id;	private $srvc_reqst_created_by;	private $srvc_reqst_srvc_id;	private $srvc_reqst_table_id;	private $srvc_reqst_session_id;	private $srvc_reqst_emp_id;	private $srvc_reqst_tbl_sft_assoc_id;	/*private $srvc_reqst_cat_id;*/	private $srvc_reqst_status;	private $srvc_reqst_special_note;	private $srvc_reqst_add_quests;		private $srvc_reqst_is_delayed;	private $srvc_reqst_cust_id;	private $srvc_reqst_cust_type; 		private $srvc_reqst_created_on;	private $srvc_reqst_attended_on;	private $srvc_reqst_completed_at;	private $tbl_services_requests_active_date;	private $tbl_services_requests_deactive_date;		private $expted_time;	private $actual_time;		public function setsrvc_reqst_id($pArg="0") {$this->srvc_reqst_id=$pArg;}	public function setsrvc_reqst_created_by($pArg="0") {$this->srvc_reqst_created_by=$pArg;}	public function setsrvc_reqst_srvc_id($pArg="0") {$this->srvc_reqst_srvc_id=$pArg;}	public function setsrvc_reqst_table_id($pArg="0") {$this->srvc_reqst_table_id=$pArg;}	public function setsrvc_reqst_session_id($pArg="0") {$this->srvc_reqst_session_id=$pArg;}	public function setsrvc_reqst_emp_id($pArg="0") {$this->srvc_reqst_emp_id=$pArg;}	public function setsrvc_reqst_tbl_sft_assoc_id($pArg="0") {$this->srvc_reqst_tbl_sft_assoc_id=$pArg;}	/*public function setsrvc_reqst_cat_id($pArg="0") {$this->srvc_reqst_cat_id=$pArg;}*/	public function setsrvc_reqst_status($pArg="0") {$this->srvc_reqst_status=$pArg;}    public function setsrvc_reqst_special_note($pArg="0") {$this->srvc_reqst_special_note=$pArg;}    public function setsrvc_reqst_add_quests($pArg="0") {$this->srvc_reqst_add_quests=$pArg;}		public function setsrvc_reqst_is_delayed($pArg="0") {$this->srvc_reqst_is_delayed=$pArg;}public function setsrvc_reqst_cust_id($pArg="0") {$this->srvc_reqst_cust_id=$pArg;}public function setsrvc_reqst_cust_type($pArg="0") {$this->srvc_reqst_cust_type=$pArg;}        public function setsrvc_reqst_created_on($pArg="0") {$this->srvc_reqst_created_on=$pArg;}	public function setsrvc_reqst_attended_on($pArg="0") {$this->srvc_reqst_attended_on=$pArg;}	public function setsrvc_reqst_completed_at($pArg="0") {$this->srvc_reqst_completed_at=$pArg;}	public function settbl_services_requests_active_date($pArg="0") {$this->tbl_services_requests_active_date=$pArg;}	public function settbl_services_requests_deactive_date($pArg="0") {$this->tbl_services_requests_deactive_date=$pArg;}	public function getsrvc_reqst_id() {return $this->srvc_reqst_id;}	public function getsrvc_reqst_created_by() {return $this->srvc_reqst_created_by;}	public function getsrvc_reqst_srvc_id() {return $this->srvc_reqst_srvc_id;}	public function getsrvc_reqst_table_id() {return $this->srvc_reqst_table_id;}	public function getsrvc_reqst_session_id() {return $this->srvc_reqst_session_id;}	public function getsrvc_reqst_emp_id() {return $this->srvc_reqst_emp_id;}	public function getsrvc_reqst_tbl_sft_assoc_id() {return $this->srvc_reqst_tbl_sft_assoc_id;}	/*public function getsrvc_reqst_cat_id() {return $this->srvc_reqst_cat_id;}*/	public function getsrvc_reqst_status() {return $this->srvc_reqst_status;}	public function getsrvc_reqst_special_note() {return $this->srvc_reqst_special_note;}	public function getsrvc_reqst_add_quests() {return $this->srvc_reqst_add_quests;}	public function getsrvc_reqst_is_delayed() {return $this->srvc_reqst_is_delayed;}public function getsrvc_reqst_cust_id() {return $this->srvc_reqst_cust_id;}public function getsrvc_reqst_cust_type() {return $this->srvc_reqst_cust_type;}	public function getsrvc_reqst_created_on() {return $this->srvc_reqst_created_on;}	public function getsrvc_reqst_attended_on() {return $this->srvc_reqst_attended_on;}	public function getsrvc_reqst_completed_at() {return $this->srvc_reqst_completed_at;}	public function gettbl_services_requests_active_date($pArg="0") {return $this->tbl_services_requests_active_date;}	public function gettbl_services_requests_deactive_date($pArg="0") {return $this->tbl_services_requests_deactive_date;}	public function readObject($array = array()) {			$active_session = tbl_table_customer_session::getActiveSessionForAlltables();		$qry = "SELECT * ,(SELECT `status_exp_time`  FROM `tbl_statuses` WHERE `status_id`= ( SELECT `srvc_req_stg_service_stage_id` FROM `tbl_service_request_stage` WHERE `srvc_req_stg_request_id` = `srvc_reqst_id` ORDER BY `srvc_req_stg_id` DESC  LIMIT 1) LIMIT 1) as `expted_time`,  CASE ( FIND_IN_SET(`srvc_reqst_session_id`,'".$active_session."') AND (`srvc_reqst_status` NOT IN (".SERVICE_STATUS_COMPLETD." ,".SERVICE_STATUS_CANCELLED.")) )   	WHEN TRUE THEN  TIMESTAMPDIFF(SECOND,`srvc_reqst_created_on`,NOW())  ELSE (SELECT `srvc_req_stg_time_finished` FROM `tbl_service_request_stage` WHERE `srvc_req_stg_request_id`=`srvc_reqst_id` ORDER BY `srvc_req_stg_id` DESC  LIMIT 1) END  AS `actual_time`".RET."FROM ".TBL_SERVICES_REQUESTS.RET; 	//echo $qry;		$and = "WHERE".RET;		if($array[SRVC_REQST_ID] != "") {			$qry .= $and.SRVC_REQST_ID." = '".$array[SRVC_REQST_ID]."'".RET;			$and = "AND".RET;		}		if($array[SRVC_REQST_CREATED_BY] != "") {			$qry .= $and.SRVC_REQST_CREATED_BY." = '".$array[SRVC_REQST_CREATED_BY]."'".RET;			$and = "AND".RET;		}		if($array[SRVC_REQST_SRVC_ID] != "") {			$qry .= $and.SRVC_REQST_SRVC_ID." = '".$array[SRVC_REQST_SRVC_ID]."'".RET;			$and = "AND".RET;		}		if($array[SRVC_REQST_TABLE_ID] != "") {			$qry .= $and.SRVC_REQST_TABLE_ID." = '".$array[SRVC_REQST_TABLE_ID]."'".RET;			$and = "AND".RET;		}				if($array[SRVC_REQST_SESSION_ID] != "") {			$qry .= $and.SRVC_REQST_SESSION_ID." = '".$array[SRVC_REQST_SESSION_ID]."'".RET;			$and = "AND".RET;		}				if($array[SES_RESTAURANT] != "") {			$qry .= $and.chkTableInRestaurant(SRVC_REQST_TABLE_ID,$array[SES_RESTAURANT]);			$and = "AND".RET;		}		if($array[SRVC_REQST_EMP_ID] != "") {			$qry .= $and.SRVC_REQST_EMP_ID." = '".$array[SRVC_REQST_EMP_ID]."'".RET;			$and = "AND".RET;		}		if($array[SRVC_REQST_TBL_SFT_ASSOC_ID] != "") {			$qry .= $and.SRVC_REQST_TBL_SFT_ASSOC_ID." = '".$array[SRVC_REQST_TBL_SFT_ASSOC_ID]."'".RET;			$and = "AND".RET;		}/*		if($array[SRVC_REQST_CAT_ID] != "") {			$qry .= $and.SRVC_REQST_CAT_ID." = '".$array[SRVC_REQST_CAT_ID]."'".RET;			$and = "AND".RET;		}*/		if($array[SRVC_REQST_STATUS] != "") {			$qry .= $and.SRVC_REQST_STATUS." = '".$array[SRVC_REQST_STATUS]."'".RET;			$and = "AND".RET;		}				if($array[SRVC_REQST_SPECIAL_NOTE] != "") {			$qry .= $and.SRVC_REQST_SPECIAL_NOTE." = '".$array[SRVC_REQST_SPECIAL_NOTE]."'".RET;			$and = "AND".RET;		}				if($array[SRVC_REQST_ADD_QUESTS] != "") {			$qry .= $and.SRVC_REQST_ADD_QUESTS." = '".$array[SRVC_REQST_ADD_QUESTS]."'".RET;			$and = "AND".RET;		}		if($array[SRVC_REQST_CREATED_ON] != "") {			$qry .= $and.SRVC_REQST_CREATED_ON." = '".$array[SRVC_REQST_CREATED_ON]."'".RET;			$and = "AND".RET;		}		if($array[SRVC_REQST_ATTENDED_ON] != "") {			$qry .= $and.SRVC_REQST_ATTENDED_ON." = '".$array[SRVC_REQST_ATTENDED_ON]."'".RET;			$and = "AND".RET;		}		if($array[SRVC_REQST_COMPLETED_AT] != "") {			$qry .= $and.SRVC_REQST_COMPLETED_AT." = '".$array[SRVC_REQST_COMPLETED_AT]."'".RET;			$and = "AND".RET;		}		$result = mysql_query($qry);				if($result) {			while ($row = mysql_fetch_array($result)) {				$record = $row;				break;//end after first record			}			if(count($record[0]) == 0) {				return array();			} else {				$this->setsrvc_reqst_id($record[SRVC_REQST_ID]);				$this->setsrvc_reqst_created_by($record[SRVC_REQST_CREATED_BY]);				$this->setsrvc_reqst_srvc_id($record[SRVC_REQST_SRVC_ID]);				$this->setsrvc_reqst_table_id($record[SRVC_REQST_TABLE_ID]);				$this->setsrvc_reqst_session_id($record[SRVC_REQST_SESSION_ID]);				$this->setsrvc_reqst_emp_id($record[SRVC_REQST_EMP_ID]);				$this->setsrvc_reqst_tbl_sft_assoc_id($record[SRVC_REQST_TBL_SFT_ASSOC_ID]);				/*$this->setsrvc_reqst_cat_id($record[SRVC_REQST_CAT_ID]);*/				$this->setsrvc_reqst_status($record[SRVC_REQST_STATUS]);				$this->setsrvc_reqst_special_note($record[SRVC_REQST_SPECIAL_NOTE]);				$this->setsrvc_reqst_add_quests($record[SRVC_REQST_ADD_QUESTS]);								$this->setsrvc_reqst_created_on($record[SRVC_REQST_CREATED_ON]);				$this->setsrvc_reqst_attended_on($record[SRVC_REQST_ATTENDED_ON]);				$this->setsrvc_reqst_completed_at($record[SRVC_REQST_COMPLETED_AT]);				$this->settbl_services_requests_active_date($record[TBL_SERVICES_REQUESTS_ACTIVE_DATE]);				$this->settbl_services_requests_deactive_date($record[TBL_SERVICES_REQUESTS_DEACTIVE_DATE]);				$this->setsrvc_reqst_is_delayed($record[SRVC_REQST_IS_DELAYED]);				$this->setsrvc_reqst_cust_id($record[SRVC_REQST_CUST_ID]);				$this->setsrvc_reqst_cust_type($record[SRVC_REQST_CUST_TYPE]); 				$this->expted_time = $record["expted_time"];				$this->actual_time = $record["actual_time"];				return true;			}		}	}	public static function readArray($array = array(),&$result_found=0,$isArray=1) {		global $tbl_services_requests_active_condition;		//$qry = "SELECT *".RET."FROM ".TBL_SERVICES_REQUESTS.RET;		//..First get the live table session		$active_session = tbl_table_customer_session::getActiveSessionForAlltables();		$active_session=(is_not_empty($active_session) ? $active_session : "''");					$qry = "SELECT `srvc_reqst_id`, `srvc_reqst_created_by`,`srvc_reqst_srvc_id`, `srvc_reqst_table_id`, `srvc_reqst_emp_id`,`srvc_reqst_session_id`,`srvc_reqst_tbl_sft_assoc_id`, `srvc_reqst_special_note`, `srvc_reqst_add_quests`, `srvc_reqst_status`, `srvc_reqst_created_on`, `srvc_reqst_attended_on`, `srvc_reqst_completed_at`,(SELECT `status_exp_time`  FROM `tbl_statuses` WHERE `status_id`= ( SELECT `srvc_req_stg_service_stage_id` FROM `tbl_service_request_stage` WHERE `srvc_req_stg_request_id` = `srvc_reqst_id` ORDER BY `srvc_req_stg_id` DESC  LIMIT 1) LIMIT 1) as `expted_time`,  CASE ( FIND_IN_SET(`srvc_reqst_session_id`,'".$active_session."') AND (`srvc_reqst_status` NOT IN (".SERVICE_STATUS_COMPLETD." ,".SERVICE_STATUS_CANCELLED.")) )   	WHEN TRUE THEN TIMESTAMPDIFF(SECOND,`srvc_reqst_created_on`,NOW())  ELSE (SELECT `srvc_req_stg_time_finished` FROM `tbl_service_request_stage` WHERE `srvc_req_stg_request_id`=`srvc_reqst_id` ORDER BY `srvc_req_stg_id` DESC  LIMIT 1) END  AS `actual_time`,`tbl_services_code`.`srvc_name`,`tbl_services_code`.`srvc_description` ".RET."FROM ".TBL_SERVICES_REQUESTS.RET." INNER JOIN  	`tbl_services_code` ON `tbl_services_code`.`srvc_id`=`tbl_services_requests`.`srvc_reqst_srvc_id`"; 	  		$and = "WHERE".RET;		if($array[SRVC_REQST_ID] != "") {			$qry .= $and.SRVC_REQST_ID." = '".$array[SRVC_REQST_ID]."'".RET;			$and = "AND".RET;		}		if($array[SRVC_REQST_CREATED_BY] != "") {			$qry .= $and.SRVC_REQST_CREATED_BY." = '".$array[SRVC_REQST_CREATED_BY]."'".RET;			$and = "AND".RET;		}		if($array[SRVC_REQST_SRVC_ID] != "") {			$qry .= $and.SRVC_REQST_SRVC_ID." = '".$array[SRVC_REQST_SRVC_ID]."'".RET;			$and = "AND".RET;		}		if($array[SRVC_REQST_TABLE_ID] != "") {			$qry .= $and.SRVC_REQST_TABLE_ID." = '".$array[SRVC_REQST_TABLE_ID]."'".RET;			$and = "AND".RET;		}				if($array[SRVC_REQST_SESSION_ID] != "") {			$qry .= $and.SRVC_REQST_SESSION_ID." = '".$array[SRVC_REQST_SESSION_ID]."'".RET;			$and = "AND".RET;		}		if($array[SRVC_REQST_EMP_ID] != "") {			$qry .= $and.SRVC_REQST_EMP_ID." = '".$array[SRVC_REQST_EMP_ID]."'".RET;			$and = "AND".RET;		}		if($array[SRVC_REQST_TBL_SFT_ASSOC_ID] != "") {			$qry .= $and.SRVC_REQST_TBL_SFT_ASSOC_ID." = '".$array[SRVC_REQST_TBL_SFT_ASSOC_ID]."'".RET;			$and = "AND".RET;		}		if($array[SES_RESTAURANT] != "") {			$qry .= $and.chkTableInRestaurant(SRVC_REQST_TABLE_ID,$array[SES_RESTAURANT]);			$and = "AND".RET;		}				/*if($array[SRVC_REQST_CAT_ID] != "") {			$qry .= $and.SRVC_REQST_CAT_ID." = '".$array[SRVC_REQST_CAT_ID]."'".RET;			$and = "AND".RET;		}*/		if($array[SRVC_REQST_STATUS] != "") {			$qry .= $and.SRVC_REQST_STATUS." = '".$array[SRVC_REQST_STATUS]."'".RET;			$and = "AND".RET;		}		if($array['status_not_in'] != "") {			$qry .= $and.SRVC_REQST_STATUS." <> '".$array[SRVC_REQST_STATUS]."'".RET;			$and = "AND".RET;		}		    if($array[SRVC_REQST_ADD_QUESTS] != "") {			$qry .= $and.SRVC_REQST_ADD_QUESTS." = '".$array[SRVC_REQST_ADD_QUESTS]."'".RET;			$and = "AND".RET;		}		if($array[SRVC_REQST_CREATED_ON] != "") {			$qry .= $and.SRVC_REQST_CREATED_ON." = '".$array[SRVC_REQST_CREATED_ON]."'".RET;			$and = "AND".RET;		}		if($array[SRVC_REQST_ATTENDED_ON] != "") {			$qry .= $and.SRVC_REQST_ATTENDED_ON." = '".$array[SRVC_REQST_ATTENDED_ON]."'".RET;			$and = "AND".RET;		}		if($array[SRVC_REQST_COMPLETED_AT] != "") {			$qry .= $and.SRVC_REQST_COMPLETED_AT." = '".$array[SRVC_REQST_COMPLETED_AT]."'".RET;			$and = "AND".RET;		}		if(is_gt_zero_num($array["isActive"])) {			$qry .= $and.$tbl_services_requests_active_condition;			$and = "AND".RET;		}				if(is_not_empty($array['keyword'])) {					$qry .= $and."(`srvc_name` LIKE '%".$array['keyword']."%')OR(`srvc_description` LIKE '%".$array['keyword']."%')OR(".SRVC_REQST_SPECIAL_NOTE." LIKE '%".$array['keyword']."%')".RET;			$and = "AND".RET;		}				if(is_gt_zero_num($array['todays_requests'])) {					$qry .= $and.SRVC_REQST_CREATED_ON." >= '".date("Y-m-d")."'".RET;			$and = "AND".RET;		}		//..This condition returns only pending AND		//..Does not check for the active session show		if(is_not_empty($array['isPendingOnly'])) {		  if(is_gt_zero_num($array['isPendingOnly'])){		  	$qry .= $and.SRVC_REQST_STATUS." NOT IN (".SERVICE_STATUS_COMPLETD." ,".SERVICE_STATUS_CANCELLED.")".RET."AND".RET.SRVC_REQST_CREATED_ON." >= '".date("Y-m-d")."'".RET; 		  }else{		  	$qry .= $and."(".SRVC_REQST_STATUS." IN (".SERVICE_STATUS_COMPLETD." ,".SERVICE_STATUS_CANCELLED.") OR ".RET.SRVC_REQST_CREATED_ON." < '".date("Y-m-d")."')".RET; 		  }				  $and = "AND".RET;			}			 		if(is_not_empty($array['isPending'])) {			//..First get the live table session			//$active_session = tbl_table_customer_session::getActiveSessionForAlltables();			if(is_gt_zero_num($array["isPending"])) {				if(is_not_empty($active_session)){					//$qry .= $and.'('.SRVC_REQST_SESSION_ID.' IN ('.$active_session.') OR ('.SRVC_REQST_SESSION_ID.'=0 AND DATE('.SRVC_REQST_CREATED_ON.') = CURDATE())) AND '.SRVC_REQST_STATUS.' NOT IN ('.SERVICE_STATUS_COMPLETD.' ,'.SERVICE_STATUS_CANCELLED.') AND '.$tbl_services_requests_active_condition.RET;					$qry .= $and.'('.SRVC_REQST_SESSION_ID.' IN ('.$active_session.') OR ('.SRVC_REQST_SESSION_ID.'=0 AND DATE('.SRVC_REQST_CREATED_ON.') = CURDATE())) AND (('.$tbl_services_requests_active_condition.') OR ('.SRVC_REQST_STATUS.' IN ('.SERVICE_STATUS_COMPLETD.' ,'.SERVICE_STATUS_CANCELLED.')))'.RET;				}else{					//$qry = $and.' 0 '.RET;						 //$qry .= $and.'('.SRVC_REQST_SESSION_ID.'=0 AND DATE('.SRVC_REQST_CREATED_ON.') = CURDATE()) AND '.SRVC_REQST_STATUS.' NOT IN ('.SERVICE_STATUS_COMPLETD.' ,'.SERVICE_STATUS_CANCELLED.') AND '.$tbl_services_requests_active_condition.RET;					 $qry .= $and.'('.SRVC_REQST_SESSION_ID.'=0 AND DATE('.SRVC_REQST_CREATED_ON.') = CURDATE()) AND '.SRVC_REQST_STATUS.' NOT IN ('.SERVICE_STATUS_COMPLETD.' ,'.SERVICE_STATUS_CANCELLED.') AND (('.$tbl_services_requests_active_condition.') OR ('.SRVC_REQST_STATUS.' IN ('.SERVICE_STATUS_COMPLETD.' ,'.SERVICE_STATUS_CANCELLED.')))'.RET;				}			}else{				 $qry .= $and.'('.SRVC_REQST_SESSION_ID.' NOT IN ('.$active_session.')  OR (('.SRVC_REQST_COMPLETED_AT.' IS NOT NULL) AND ('.SRVC_REQST_COMPLETED_AT.' != 0))) AND ('.SRVC_REQST_STATUS.'  IN ('.SERVICE_STATUS_COMPLETD.' ,'.SERVICE_STATUS_CANCELLED.')  AND '.SRVC_REQST_SESSION_ID.' NOT IN ('.$active_session.' )) AND DATE('.SRVC_REQST_CREATED_ON.') <= CURDATE()'.RET;					//$qry .= $and.'('.SRVC_REQST_SESSION_ID.' NOT IN ('.$active_session.')  OR (('.SRVC_REQST_COMPLETED_AT.' IS NOT NULL) AND ('.SRVC_REQST_COMPLETED_AT.' != 0))) AND '.SRVC_REQST_STATUS.'  IN ('.SERVICE_STATUS_COMPLETD.' ,'.SERVICE_STATUS_CANCELLED.')   AND DATE('.SRVC_REQST_CREATED_ON.') <= CURDATE()'.RET;			 			}			$and = 'AND'.RET;					}				if(is_not_empty($array['isPendingIncCancelled'])) {		  if(is_gt_zero_num($array['isPendingIncCancelled'])){		  	//$qry .= $and.SRVC_REQST_STATUS." NOT IN (".SERVICE_STATUS_COMPLETD.")".RET."AND".RET.SRVC_REQST_CREATED_ON." >= '".date("Y-m-d")."'".RET; 				$qry .= $and.SRVC_REQST_CREATED_ON." >= '".date("Y-m-d")."'".RET; 		  }else{		  	//$qry .= $and."(".SRVC_REQST_STATUS." IN (".SERVICE_STATUS_COMPLETD.") OR ".RET.SRVC_REQST_CREATED_ON." < '".date("Y-m-d")."')".RET; 				$qry .= $and.SRVC_REQST_CREATED_ON." < '".date("Y-m-d")."')".RET; 		   }				  $and = "AND".RET;			}				if(is_not_empty($array['isTemp'])) {			if(is_gt_zero_num($array['isTemp'])){				$qry .= $and.SRVC_REQST_SESSION_ID." = 0 ".RET; 			}else{				//$qry .= $and.SRVC_REQST_SESSION_ID." <> 0 ".RET;				//..this condition is disabled since we need to show all temp records 				//..as well. 			}			$and = "AND".RET;			}		 				if(is_not_empty($array['created_on_start']) && is_not_empty($array['created_on_end'])){			$end_date_qry = "";			$start_date_qry = "";			if(is_gt_zero_num($array['table_status'])){				/*if(is_gt_zero_num(strtotime($array['created_on_end']))){					$end_date_qry = " AND srvc_reqst_created_on <= '".date(DATE_FORMAT,strtotime($array['created_on_end']))."'";				}							if(is_gt_zero_num(strtotime($array['created_on_start']))){					$start_date_qry = " AND srvc_reqst_created_on >= '".date(DATE_FORMAT,strtotime($array['created_on_start']))."'";				} */			}else{				 if(is_gt_zero_num(strtotime($array['created_on_end']))){					$end_date_qry = " AND srvc_reqst_created_on <= '".date("Y-m-d 23:59:59",strtotime($array['created_on_end']))."'";				}								if(is_gt_zero_num(strtotime($array['created_on_start']))){					$start_date_qry = " AND srvc_reqst_created_on >= '".date("Y-m-d 00:00:00",strtotime($array['created_on_start']))."'";				} 			}					/*$qry .= $and.SRVC_REQST_CREATED_ON." >= '".date("Y-m-d 00:00:00",strtotime($array['created_on_start']))."'".RET." ".RET;*/			 			$qry .= $start_date_qry.$end_date_qry;			$and = "AND".RET;		}		  		 if(is_not_empty($array['report'])){ 			switch($array['report']){				case "KEYWORD" : $qry .= " ORDER BY ".SRVC_REQST_TABLE_ID .",".SRVC_REQST_ID." DESC";   				break;				case "DAY" : $qry .= " ORDER BY ".SRVC_REQST_CREATED_ON .",".SRVC_REQST_ID." DESC";  				break;				case "TABLE" : $qry .= " ORDER BY ".SRVC_REQST_TABLE_ID .",".SRVC_REQST_ID." DESC";   				break;				case "EMPLOYEE" : $qry .= " ORDER BY ".SRVC_REQST_EMP_ID.",".SRVC_REQST_ID." DESC";  				break; 				default :				if(is_not_empty($array[SORT_ON]) && is_not_empty($array[SORT_BY])) {					$qry .=" ORDER BY ".$array[SORT_ON]." ".$array[SORT_BY].",".SRVC_REQST_ID." DESC";  				}else{					$qry .= " ORDER BY ".SRVC_REQST_ID." DESC"; 				}								break; 			} 		}elseif(is_not_empty($array[SORT_ON]) && is_not_empty($array[SORT_BY])) {			$qry .=" ORDER BY ".$array[SORT_ON]." ".$array[SORT_BY].",".SRVC_REQST_ID." DESC";  		}		if(is_not_empty($array["offset"]) && is_not_empty($array["limit"])) {			$qry_with_limit  = $qry." LIMIT ".$array["offset"].",".$array["limit"];		}else{			$qry_with_limit  = $qry;		} 	  //echo "$qry_with_limit"; 		$result = mysql_query ($qry_with_limit);		$r1 = mysql_query($qry); 		 		if($r1){			$result_found = mysql_num_rows($r1);			}			 //echo "<hr>".$qry_with_limit."<br>".$result_found;  		$class_objects = array();		if($result) {			while ($record = mysql_fetch_assoc($result)) {				$isActive= 0;				//..check deactive date is not set or 0				if(is_not_empty($record[TBL_SERVICES_REQUESTS_DEACTIVE_DATE])==false || strtotime($record[MEMBER_ROLE_DEACTIVE_DATE]) == 0){					$isActive = 1; 				}else{					//..check the deactive date is greater than todays date					if(strtotime($record[TBL_SERVICES_REQUESTS_DEACTIVE_DATE]) >  strtotime(date("Y-m-d h:i:s"))){						$isActive = 1;					}				}				if($isArray){					$class_object = array(); 					$class_object["id"]=$record[SRVC_REQST_ID];					$class_object["created_by"]=$record[SRVC_REQST_CREATED_BY];					$class_object["srvc_id"]=$record[SRVC_REQST_SRVC_ID];					$class_object["table_id"]=$record[SRVC_REQST_TABLE_ID];					$class_object["session_id"]=$record[SRVC_REQST_SESSION_ID];					$class_object["emp_id"]=$record[SRVC_REQST_EMP_ID];					$class_object["tbl_sft_assoc_id"]=$record[SRVC_REQST_TBL_SFT_ASSOC_ID];					/*$class_object["cat_id"]=$record[SRVC_REQST_CAT_ID];*/					$class_object["status"]=$record[SRVC_REQST_STATUS];					$class_object["srvc_reqst_special_note"]=$record[SRVC_REQST_SPECIAL_NOTE];					$class_object["srvc_reqst_add_quests"]=$record[SRVC_REQST_ADD_QUESTS];										$class_object["created_on"]=$record[SRVC_REQST_CREATED_ON];					$class_object["attended_on"]=$record[SRVC_REQST_ATTENDED_ON];					$class_object["completed_at"]=$record[SRVC_REQST_COMPLETED_AT];					$class_object["srvc_reqst_id"]=$record[SRVC_REQST_ID];					$class_object["srvc_reqst_created_by"]=$record[SRVC_REQST_CREATED_BY];					$class_object["srvc_reqst_srvc_id"]=$record[SRVC_REQST_SRVC_ID];					$class_object["srvc_reqst_table_id"]=$record[SRVC_REQST_TABLE_ID];					$class_object["srvc_reqst_emp_id"]=$record[SRVC_REQST_EMP_ID];					$class_object["srvc_reqst_session_id"]=$record[SRVC_REQST_SESSION_ID];					$class_object["srvc_reqst_tbl_sft_assoc_id"]=$record[SRVC_REQST_TBL_SFT_ASSOC_ID];					$class_object["service_name"] = $record['srvc_name'];					$class_object['friendly_created_on'] = friendly_time($class_object["created_on"],1);					$class_object['friendly_attended_on'] = friendly_time($class_object["attended_on"],1);					$class_object['friendly_completed_at'] = friendly_time($class_object["completed_at"],1);										/*$class_object["srvc_reqst_cat_id"]=$record[SRVC_REQST_CAT_ID];*/															$class_object["srvc_reqst_status"]=$record[SRVC_REQST_STATUS];					$class_object["srvc_reqst_created_on"]=$record[SRVC_REQST_CREATED_ON];					$class_object["srvc_reqst_attended_on"]=$record[SRVC_REQST_ATTENDED_ON];					$class_object["srvc_reqst_completed_at"]=$record[SRVC_REQST_COMPLETED_AT];					$class_object["expted_time"]=$record["expted_time"];					$class_object["actual_time"]=$record["actual_time"];					$class_object["diff_time"] = $record["actual_time"] - $record["expted_time"];				$class_object["expted_time_min"]=biz_convSecToMin($class_object["expted_time"]);								$info["actual_time_min"]=biz_convSecToMin($class_object["actual_time"]);				$info["diff_time_min"]=biz_convSecToMin($class_object["diff_time"] );				$class_object[SRVC_REQST_IS_DELAYED] = $record[SRVC_REQST_IS_DELAYED];				$class_object[SRVC_REQST_CUST_ID] =$record[SRVC_REQST_CUST_ID] ;				$class_object[SRVC_REQST_CUST_TYPE] = $record[SRVC_REQST_CUST_TYPE] ;					$class_object["isActive"]=$isActive;				}else{					$class_object = new tbl_services_requests();					$class_object->setsrvc_reqst_id($record[SRVC_REQST_ID]);					$class_object->setsrvc_reqst_created_by($record[SRVC_REQST_CREATED_BY]);					$class_object->setsrvc_reqst_srvc_id($record[SRVC_REQST_SRVC_ID]);					$class_object->setsrvc_reqst_table_id($record[SRVC_REQST_TABLE_ID]);					$class_object->setsrvc_reqst_session_id($record[SRVC_REQST_SESSION_ID]);					$class_object->setsrvc_reqst_emp_id($record[SRVC_REQST_EMP_ID]);					$class_object->setsrvc_reqst_tbl_sft_assoc_id($record[SRVC_REQST_TBL_SFT_ASSOC_ID]);					/*$class_object->setsrvc_reqst_cat_id($record[SRVC_REQST_CAT_ID]);*/					$class_object->setsrvc_reqst_status($record[SRVC_REQST_STATUS]);					$class_object->setsrvc_reqst_special_note($record[SRVC_REQST_SPECIAL_NOTE]);					$class_object->setsrvc_reqst_add_quests($record[SRVC_REQST_ADD_QUESTS]);										$class_object->setsrvc_reqst_created_on($record[SRVC_REQST_CREATED_ON]);					$class_object->setsrvc_reqst_attended_on($record[SRVC_REQST_ATTENDED_ON]);					$class_object->setsrvc_reqst_completed_at($record[SRVC_REQST_COMPLETED_AT]);					$class_object->setsrvc_reqst_is_delayed($record[SRVC_REQST_IS_DELAYED]);				$class_object->setsrvc_reqst_cust_id($record[SRVC_REQST_CUST_ID]);				$class_object->setsrvc_reqst_cust_type($record[SRVC_REQST_CUST_TYPE]);				}				$class_objects[$record[SRVC_REQST_ID]] = $class_object;			}		}		return $class_objects;	}//..End readArray	public function insert() {		if($this->getsrvc_reqst_id() != '') {			$qry  = "UPDATE ".TBL_SERVICES_REQUESTS.RET."SET".RET."			".SRVC_REQST_ID." = '".$this->getsrvc_reqst_id()."',".RET."			".SRVC_REQST_CREATED_BY." = '".$this->getsrvc_reqst_created_by()."',".RET."			".SRVC_REQST_SRVC_ID." = '".$this->getsrvc_reqst_srvc_id()."',".RET."			".SRVC_REQST_TABLE_ID." = '".$this->getsrvc_reqst_table_id()."',".RET."			".SRVC_REQST_SESSION_ID." = '".$this->getsrvc_reqst_session_id()."',".RET."			".SRVC_REQST_EMP_ID." = '".$this->getsrvc_reqst_emp_id()."',".RET."			".SRVC_REQST_TBL_SFT_ASSOC_ID." = '".$this->getsrvc_reqst_tbl_sft_assoc_id()."',".RET." 			".SRVC_REQST_STATUS." = '".$this->getsrvc_reqst_status()."',".RET."			".SRVC_REQST_SPECIAL_NOTE." = '".$this->getsrvc_reqst_special_note()."',".RET."			".SRVC_REQST_ADD_QUESTS." = '".$this->getsrvc_reqst_add_quests()."',".RET."			".SRVC_REQST_IS_DELAYED." = '".$this->getsrvc_reqst_is_delayed()."',".RET."			".SRVC_REQST_CUST_ID." = '".$this->getsrvc_reqst_cust_id()."',".RET."			".SRVC_REQST_CUST_TYPE." = '".$this->getsrvc_reqst_cust_type()."',".RET."			".SRVC_REQST_CREATED_ON." = '".$this->getsrvc_reqst_created_on()."',".RET."			".SRVC_REQST_ATTENDED_ON." = '".$this->getsrvc_reqst_attended_on()."',".RET."			".SRVC_REQST_COMPLETED_AT." = '".$this->getsrvc_reqst_completed_at()."'".RET.			"WHERE ".SRVC_REQST_ID." = ".$this->getsrvc_reqst_id().RET; 			/*echo $qry;			exit;*/			mysql_query($qry);		} else {			$qry  = "INSERT INTO ".TBL_SERVICES_REQUESTS." (".RET.			"".SRVC_REQST_CREATED_BY.", ".SRVC_REQST_SRVC_ID.", ".SRVC_REQST_TABLE_ID.", ".SRVC_REQST_SESSION_ID.", ".SRVC_REQST_EMP_ID.", ".SRVC_REQST_TBL_SFT_ASSOC_ID.", ".SRVC_REQST_STATUS.", ".SRVC_REQST_SPECIAL_NOTE.", ".SRVC_REQST_ADD_QUESTS.", ".SRVC_REQST_IS_DELAYED.",".SRVC_REQST_CUST_ID.",".SRVC_REQST_CUST_TYPE.", ".SRVC_REQST_CREATED_ON.", ".SRVC_REQST_ATTENDED_ON.", ".SRVC_REQST_COMPLETED_AT.RET.				") VALUES (".RET.			"'".$this->getsrvc_reqst_created_by()."',".RET.			"'".$this->getsrvc_reqst_srvc_id()."',".RET.			"'".$this->getsrvc_reqst_table_id()."',".RET.			"'".$this->getsrvc_reqst_session_id()."',".RET.			"'".$this->getsrvc_reqst_emp_id()."',".RET.			"'".$this->getsrvc_reqst_tbl_sft_assoc_id()."',".RET. 			"'".$this->getsrvc_reqst_status()."',".RET.			"'".$this->getsrvc_reqst_special_note()."',".RET.			"'".$this->getsrvc_reqst_add_quests()."',".RET.			"'".$this->getsrvc_reqst_is_delayed()."',".RET.			"'".$this->getsrvc_reqst_cust_id()."',".RET.			"'".$this->getsrvc_reqst_cust_type()."',".RET.			"'".$this->getsrvc_reqst_created_on()."',".RET.			"'".$this->getsrvc_reqst_attended_on()."',".RET.			"'".$this->getsrvc_reqst_completed_at()."'".RET.			")".RET; 	/*	 echo $qry;			exit;*/			$res = mysql_query($qry);			$this->setsrvc_reqst_id(mysql_insert_id());		}	}//..End Insert	public static function delete($array = array()) {		$qry = "DELETE".RET."FROM ".TBL_SERVICES_REQUESTS.RET;		$and = "WHERE".RET;		if($array[SRVC_REQST_ID] != "") {			$qry .= $and.SRVC_REQST_ID." = '".$array[SRVC_REQST_ID]."'".RET;			$and = "AND".RET;		}		if($array[SRVC_REQST_CREATED_BY] != "") {			$qry .= $and.SRVC_REQST_CREATED_BY." = '".$array[SRVC_REQST_CREATED_BY]."'".RET;			$and = "AND".RET;		}		if($array[SRVC_REQST_SRVC_ID] != "") {			$qry .= $and.SRVC_REQST_SRVC_ID." = '".$array[SRVC_REQST_SRVC_ID]."'".RET;			$and = "AND".RET;		}		if($array[SRVC_REQST_TABLE_ID] != "") {			$qry .= $and.SRVC_REQST_TABLE_ID." = '".$array[SRVC_REQST_TABLE_ID]."'".RET;			$and = "AND".RET;		}				if($array[SRVC_REQST_SESSION_ID] != "") {			$qry .= $and.SRVC_REQST_SESSION_ID." = '".$array[SRVC_REQST_SESSION_ID]."'".RET;			$and = "AND".RET;		}		if($array[SRVC_REQST_EMP_ID] != "") {			$qry .= $and.SRVC_REQST_EMP_ID." = '".$array[SRVC_REQST_EMP_ID]."'".RET;			$and = "AND".RET;		}		if($array[SRVC_REQST_TBL_SFT_ASSOC_ID] != "") {			$qry .= $and.SRVC_REQST_TBL_SFT_ASSOC_ID." = '".$array[SRVC_REQST_TBL_SFT_ASSOC_ID]."'".RET;			$and = "AND".RET;		}		/*if($array[SRVC_REQST_CAT_ID] != "") {			$qry .= $and.SRVC_REQST_CAT_ID." = '".$array[SRVC_REQST_CAT_ID]."'".RET;			$and = "AND".RET;		}*/		if($array[SRVC_REQST_STATUS] != "") {			$qry .= $and.SRVC_REQST_STATUS." = '".$array[SRVC_REQST_STATUS]."'".RET;			$and = "AND".RET;		}				if($array[SRVC_REQST_SPECIAL_NOTE] != "") {			$qry .= $and.SRVC_REQST_SPECIAL_NOTE." = '".$array[SRVC_REQST_SPECIAL_NOTE]."'".RET;			$and = "AND".RET;		}				if($array[SRVC_REQST_ADD_QUESTS] != "") {			$qry .= $and.SRVC_REQST_ADD_QUESTS." = '".$array[SRVC_REQST_ADD_QUESTS]."'".RET;			$and = "AND".RET;		}		if($array[SRVC_REQST_CREATED_ON] != "") {			$qry .= $and.SRVC_REQST_CREATED_ON." = '".$array[SRVC_REQST_CREATED_ON]."'".RET;			$and = "AND".RET;		}		if($array[SRVC_REQST_ATTENDED_ON] != "") {			$qry .= $and.SRVC_REQST_ATTENDED_ON." = '".$array[SRVC_REQST_ATTENDED_ON]."'".RET;			$and = "AND".RET;		}		if($array[SRVC_REQST_COMPLETED_AT] != "") {			$qry .= $and.SRVC_REQST_COMPLETED_AT." = '".$array[SRVC_REQST_COMPLETED_AT]."'".RET;			$and = "AND".RET;		}		mysql_query($qry);	}//..End Delete	public function isAlreadyThere($srvc_reqst_created_by ,$srvc_reqst_srvc_id , $srvc_reqst_table_id,$srvc_reqst_session_id, $srvc_reqst_emp_id ,$srvc_reqst_tbl_sft_assoc_id ,$srvc_reqst_status ,$srvc_reqst_created_on ,$srvc_reqst_attended_on ,$srvc_reqst_completed_at,$srvc_reqst_cust_id,$srvc_reqst_cust_type) {		$unique_arr = array();			//$unique_arr[SRVC_REQST_ID]=$srvc_reqst_id;			//$unique_arr[SRVC_REQST_CREATED_BY]=$srvc_reqst_created_by;			//$unique_arr[SRVC_REQST_SRVC_ID]=$srvc_reqst_srvc_id;			//$unique_arr[SRVC_REQST_TABLE_ID]=$srvc_reqst_table_id;			//$unique_arr[SRVC_REQST_EMP_ID]=$srvc_reqst_emp_id;			//$unique_arr[SRVC_REQST_TBL_SFT_ASSOC_ID]=$srvc_reqst_tbl_sft_assoc_id;			//$unique_arr[SRVC_REQST_CAT_ID]=$srvc_reqst_cat_id;			//$unique_arr[SRVC_REQST_STATUS]=$srvc_reqst_status;			//$unique_arr[SRVC_REQST_CREATED_ON]=$srvc_reqst_created_on;			//$unique_arr[SRVC_REQST_ATTENDED_ON]=$srvc_reqst_attended_on;			//$unique_arr[SRVC_REQST_COMPLETED_AT]=$srvc_reqst_completed_at;		if(is_not_empty($unique_arr)){			return $this->readObject($unique_arr);		}		return false;	}//..isAlreadyThere	public function create($srvc_reqst_created_by ,$srvc_reqst_srvc_id ,$srvc_reqst_table_id ,$srvc_reqst_session_id,$srvc_reqst_emp_id ,$srvc_reqst_tbl_sft_assoc_id ,$srvc_reqst_status,$srvc_reqst_special_note,$srvc_reqst_add_quests,$srvc_reqst_created_on ,$srvc_reqst_attended_on ,$srvc_reqst_completed_at,$srvc_reqst_cust_id,$srvc_reqst_cust_type) {				if(is_gt_zero_num($srvc_reqst_srvc_id) && is_gt_zero_num($srvc_reqst_table_id)){			if($this->isAlreadyThere($srvc_reqst_created_by ,$srvc_reqst_srvc_id ,$srvc_reqst_table_id,$srvc_reqst_session_id ,$srvc_reqst_emp_id ,$srvc_reqst_tbl_sft_assoc_id, $srvc_reqst_status ,$srvc_reqst_created_on ,$srvc_reqst_attended_on ,$srvc_reqst_completed_at,$srvc_reqst_cust_id,$srvc_reqst_cust_type)){				return -1;			}else{								$this->setsrvc_reqst_id("");				$this->setsrvc_reqst_created_by($srvc_reqst_created_by);				$this->setsrvc_reqst_srvc_id($srvc_reqst_srvc_id);				$this->setsrvc_reqst_session_id($srvc_reqst_session_id);				$this->setsrvc_reqst_table_id($srvc_reqst_table_id);				$this->setsrvc_reqst_emp_id($srvc_reqst_emp_id);				/*$this->setsrvc_reqst_tbl_sft_assoc_id($srvc_reqst_tbl_sft_assoc_id);				$this->setsrvc_reqst_cat_id($srvc_reqst_cat_id);*/				$this->setsrvc_reqst_status($srvc_reqst_status);				$this->setsrvc_reqst_special_note($srvc_reqst_special_note);				$this->setsrvc_reqst_add_quests($srvc_reqst_add_quests);				 				$this->setsrvc_reqst_cust_id($srvc_reqst_cust_id);				$this->setsrvc_reqst_cust_type($srvc_reqst_cust_type);				$this->setsrvc_reqst_created_on(date("Y-m-d H:i:s"));				$this->setsrvc_reqst_attended_on($srvc_reqst_attended_on);				$this->setsrvc_reqst_completed_at($srvc_reqst_completed_at);				$this->insert();				return $this->getsrvc_reqst_id();			}		}	}//..create	public function update($srvc_reqst_id, $srvc_reqst_created_by, $srvc_reqst_srvc_id, $srvc_reqst_table_id,$srvc_reqst_session_id, $srvc_reqst_emp_id, $srvc_reqst_tbl_sft_assoc_id, $srvc_reqst_status,$srvc_reqst_special_note,$srvc_reqst_add_quests, $srvc_reqst_created_on, $srvc_reqst_attended_on, $srvc_reqst_completed_at) {		if(is_gt_zero_num($srvc_reqst_id)){			if ($this->readObject(array(SRVC_REQST_ID=>$srvc_reqst_id))){				$this->setsrvc_reqst_created_by($srvc_reqst_created_by);				$this->setsrvc_reqst_srvc_id($srvc_reqst_srvc_id);				$this->setsrvc_reqst_table_id($srvc_reqst_table_id);				$this->setsrvc_reqst_session_id($srvc_reqst_session_id);				$this->setsrvc_reqst_emp_id($srvc_reqst_emp_id);				$this->setsrvc_reqst_tbl_sft_assoc_id($srvc_reqst_tbl_sft_assoc_id);				/*$this->setsrvc_reqst_cat_id($srvc_reqst_cat_id);*/				$this->setsrvc_reqst_status($srvc_reqst_status);				$this->setsrvc_reqst_special_note($srvc_reqst_special_note);				$this->setsrvc_reqst_add_quests($srvc_reqst_add_quests); 				$this->setsrvc_reqst_created_on($srvc_reqst_created_on);				$this->setsrvc_reqst_attended_on($srvc_reqst_attended_on);				$this->setsrvc_reqst_completed_at($srvc_reqst_completed_at);				$this->insert();				return 1;			}		}		return 0;	}//..update	public function activate($srvc_reqst_id){		if(is_gt_zero_num($srvc_reqst_id)){			if ($this->readObject(array(SRVC_REQST_ID=>$srvc_reqst_id))){				$qry  = "UPDATE ".TBL_SERVICES_REQUESTS.RET."SET".RET."			".TBL_SERVICES_REQUESTS_DEACTIVE_DATE." = '".date("0000-00-00")."' WHERE ".SRVC_REQST_ID."={$srvc_reqst_id}";				$res = mysql_query($qry);				if($res){					return 1;				}			}		}		return 0;	}//..end activate	public function deactivate($srvc_reqst_id){		if(is_gt_zero_num($srvc_reqst_id)){			if ($this->readObject(array(SRVC_REQST_ID=>$srvc_reqst_id))){				$qry  = "UPDATE ".TBL_SERVICES_REQUESTS.RET."SET".RET."			".TBL_SERVICES_REQUESTS_DEACTIVE_DATE." = '".date("Y-m-d")."' WHERE ".SRVC_REQST_ID."={$srvc_reqst_id}";				$res = mysql_query($qry);				if($res){					return 1;				}			}		}		return 0;	}//..end deactivate	public function GetInfo($srvc_reqst_id) {		$info = array();		if($srvc_reqst_id != ""){			if($this->readObject(array("srvc_reqst_id"=>$srvc_reqst_id))){				$info['id'] = 	$this->getsrvc_reqst_id();				$info['created_by'] = 	$this->getsrvc_reqst_created_by();				$info['srvc_id'] = 	$this->getsrvc_reqst_srvc_id();				 				$info['table_id'] =	$this->getsrvc_reqst_table_id();				$info['emp_id'] =	$this->getsrvc_reqst_emp_id();				$info['session_id'] =	$this->getsrvc_reqst_session_id();				$info['created_on'] =	$this->getsrvc_reqst_created_on();				$info['friendly_created_on'] =friendly_time(strtotime($this->getsrvc_reqst_created_on())); 								$info['attended_on'] =	$this->getsrvc_reqst_attended_on();				$info['friendly_attended_on'] =friendly_time(strtotime($this->getsrvc_reqst_attended_on()));								$info['completed_at'] =	$this->getsrvc_reqst_completed_at();				$info['friendly_completed_at'] = friendly_time(strtotime($this->getsrvc_reqst_completed_at()));				$info["srvc_reqst_id"]=$this->getsrvc_reqst_id();				$info["srvc_reqst_created_by"]=$this->getsrvc_reqst_created_by();				$info["srvc_reqst_srvc_id"]=$this->getsrvc_reqst_srvc_id();				$info["srvc_reqst_table_id"]=$this->getsrvc_reqst_table_id();				$info["srvc_reqst_emp_id"]=$this->getsrvc_reqst_emp_id();				$info["srvc_reqst_tbl_sft_assoc_id"]=$this->getsrvc_reqst_tbl_sft_assoc_id();				/*$info["srvc_reqst_cat_id"]=$this->getsrvc_reqst_cat_id();*/				$info["srvc_reqst_status"]=$this->getsrvc_reqst_status();				$info["srvc_reqst_special_note"]=$this->getsrvc_reqst_special_note();				$info["srvc_reqst_add_quests"]=$this->getsrvc_reqst_add_quests();				$info[SRVC_REQST_IS_DELAYED]=$this->getsrvc_reqst_is_delayed();				$info[SRVC_REQST_CUST_ID]=$this->getsrvc_reqst_cust_id();				$info[SRVC_REQST_CUST_TYPE]=$this->getsrvc_reqst_cust_type();				$info["srvc_reqst_created_on"]=$this->getsrvc_reqst_created_on();				$info["srvc_reqst_attended_on"]=$this->getsrvc_reqst_attended_on();				$info["srvc_reqst_completed_at"]=$this->getsrvc_reqst_completed_at();				$info["expted_time"]=$this->expted_time;				$info["actual_time"]=$this->actual_time;				$info["diff_time"] = $this->actual_time - $this->expted_time;				$info["expted_time_min"]=biz_convSecToMin($this->expted_time);								$info["actual_time_min"]=biz_convSecToMin($this->actual_time);				$info["diff_time_min"]=biz_convSecToMin($info["diff_time"]);				 $info['is_live'] = 0;								if(date(PH_DATE_FORMAT,strtotime($info['srvc_reqst_created_on'])) == date(PH_DATE_FORMAT)){					$info['is_live'] = 1;				}				    								$info["isActive"] = 0;				//..check deactive date is not set or 0				if(is_not_empty($this->gettbl_services_requests_deactive_date())==false  || strtotime($this->gettbl_services_requests_deactive_date()) == 0){					$info["isActive"] = 1;				}else{					//..check the deactive date is greater than todays date					if(strtotime($this->gettbl_services_requests_deactive_date()) >= strtotime(date("Y-m-d h:i:s"))){						$info["isActive"] = 1;					}				}			}		return $info;		}	}//..End GetInfo		public function attendRequest($request_id,$emp_id){	  if(is_gt_zero_num($request_id) && is_gt_zero_num($emp_id)){	  	if($this->readObject(array("srvc_reqst_id"=>$request_id))){	   		if(is_gt_zero_num($this->getsrvc_reqst_emp_id())){					$this->setsrvc_reqst_completed_at(date(EMPTY_DATE_FORMAT));						$this->insert();				  return -1;	 				}else{	        //.. Update attended status and attended time													$this->setsrvc_reqst_emp_id($emp_id);					$this->setsrvc_reqst_status(SERVICE_STATUS_IN_PROCESS);					$this->setsrvc_reqst_attended_on(date("Y-m-d h:i:s"));					$this->setsrvc_reqst_completed_at(date(EMPTY_DATE_FORMAT));							$this->insert();					return 1; 				} 	     }		  }	  return 0; 	}		//..Cancel request	public function assign_emp($request_id,$emp_id){	  if(is_gt_zero_num($request_id)){	  	if($this->readObject(array("srvc_reqst_id"=>$request_id))){	   					$this->setsrvc_reqst_emp_id($emp_id);			$this->insert();			return 1;			 	     }		  }	  return 0; 	}	//..Cancel request	public function cancelRequest($request_id){	  if(is_gt_zero_num($request_id)){	  	if($this->readObject(array("srvc_reqst_id"=>$request_id))){	   					$this->setsrvc_reqst_status(SERVICE_STATUS_CANCELLED);						$this->insert();			return 1;			 	     }		  }	  return 0; 	}	public function completeRequest($request_id,$emp_id){	/*echo "step : 0<br>";*/	  if(is_gt_zero_num($request_id) && is_gt_zero_num($emp_id)){	/*echo "step : 1<br>";*/	  	 if($this->readObject(array("srvc_reqst_id"=>$request_id))){		/*	  	echo "step : 2<br>"; 	  if($this->getsrvc_reqst_emp_id()==$emp_id){ 		echo "step : 3<br>";		echo " res: ".$this->getsrvc_reqst_completed_at()."<br>"; 		*/				if ((is_not_empty($this->getsrvc_reqst_completed_at())==false)||($this->getsrvc_reqst_completed_at() == "0000-00-00 00:00:00")){					/*echo "step : 4<br>";*/								 $this->setsrvc_reqst_status(SERVICE_STATUS_COMPLETD);				 $this->setsrvc_reqst_completed_at(date("Y-m-d h:i:s"));				 $this->insert();				 				 //Notifiy manager about this pay by cash if service pay by cash				 if($this->getsrvc_reqst_srvc_id()==SERVICE_PAY_BY_CASH){ 				 		//..Notifications based on the statuses @26 Oct 2013 							//..get the order of that particular customer  					$search_array=array();						$search_array['isActive']=1;					 	$search_array[ORDER_CUSTOMER_NAME] = $this->getsrvc_reqst_created_by();						$search_array[ORDER_SESSION_ID]= $this->getsrvc_reqst_session_id();							$search_array[ORDER_CUSTOMER_ID]=$this->getsrvc_reqst_cust_id();									$search_array[ORDER_CUSTOMER_TYPE]=$this->getsrvc_reqst_cust_type();						$search_array[LIMIT_TITLE]= 1;						//print_r($search_array);						$cust_order = tbl_orders::readArray($search_array);						if(is_not_empty($cust_order)){							$cust_order=array_shift($cust_order);														$order_id=$cust_order[ORDER_ID];									biz_send_status_notifications($this->getsrvc_reqst_table_id(),$this->getsrvc_reqst_created_by(),$order_id,STS_REQST_CUST_PAY_CASH,$this->getsrvc_reqst_emp_id());						}				 }				 				 return 1; 				}else{				  return -1;					}			/*}else{				  return -2;				} */		}	  }	  return 0; 	}	public static function getLastPendingRequest(){	   global  $lastPendingRequest;		$res = mysql_query('SELECT max(srvc_reqst_id) FROM '.TBL_SERVICES_REQUESTS.' where srvc_reqst_emp_id=0 and srvc_reqst_created_on > '.date('Y-m-d').'  AND '.chkTableInRestaurant(SRVC_REQST_TABLE_ID));	 		if($res){			$request_id = mysql_result($res,0);			if($request_id > $lastPendingRequest){				$lastPendingRequest = $request_id;			}		}	}		public static function request_stage($request,$remain_stages){	$info = array();	  $current_status_color = CLR_WHITE; 	  $current_status_icon = ICN_INITIATE; 	 if($request[SRVC_REQST_STATUS] == SERVICE_STATUS_CANCELLED){		 $info['current_status'] = SERVICE_STATUS_CANCELLED;		 $current_status_color = CLR_GRAY;		 $current_status_icon = ICN_CANCELLED;	}else{	 if(is_not_empty($remain_stages)){	 	$info['current_status'] = SERVICE_STATUS_IN_PROCESS;	 	//.. Check first item from the list	 		foreach($remain_stages as $val){				$current_stage = $val;break;			}			$cal_sec = 0; 		if(strtotime($request[SRVC_REQST_CREATED_ON]) > 0){		 $cal_sec = strtotime("now") - strtotime($request[SRVC_REQST_CREATED_ON]); 		}		//..if current stage is order picked stage 		if($current_stage['id'] == ORDER_PICKED){ 			if($current_stage['exp_time'] < $cal_sec){ 				if(isCustomer()){  					$current_status_color = CLR_YELLOW;					$current_status_icon = ICN_IN_PROCESS;  			 }else{ 					$current_status_color = CLR_RED;					$current_status_icon = ICN_NOT_IN_TIME;  			 } 			}else{				$current_status_color = CLR_GREEN;				$current_status_icon = ICN_COMPLETE; 			}		}else{			if($current_stage['exp_time'] < $cal_sec){ 				if(isCustomer()){  					$current_status_color = CLR_YELLOW;					$current_status_icon = ICN_IN_PROCESS;  			 }else{ 					$current_status_color = CLR_RED;					$current_status_icon = ICN_NOT_IN_TIME;  			 } 			}else{				$current_status_color = CLR_YELLOW;				$current_status_icon = ICN_IN_PROCESS;			}		}   				 }else{	 	 $info['current_status'] = SERVICE_STATUS_COMPLETD;		 $current_status_color = CLR_WHITE;		 $current_status_icon = ICN_COMPLETE;	 }	}	 $info['current_status_color'] = $current_status_color; 	 $info['current_status_icon'] = $current_status_icon; 			return $info;		}		/**	* Adding Delayed status in the requests which are completed at at time	* @return Integer	*/	 public static function mkDelayRequests(){	 			$active_session = tbl_table_customer_session::getActiveSessionForAlltables();		if(is_not_empty($active_session)){					}else{			$active_session = 0;		}		//$sql = 'SELECT * , (SELECT MAX( srvc_stg_thresh_hold_time ) FROM tbl_service_stage WHERE srvc_stg_service_id = srvc_reqst_srvc_id ) `complete_time` FROM  `tbl_services_requests` HAVING DATE_ADD(  `srvc_reqst_created_on` , INTERVAL  `complete_time` SECOND ) <= NOW( ) AND '.SRVC_REQST_SESSION_ID.' IN ('.$active_session.') AND '.SRVC_REQST_STATUS.' NOT IN ('.SERVICE_STATUS_COMPLETD.' ,'.SERVICE_STATUS_CANCELLED.') AND '.SRVC_REQST_CREATED_ON.' >= \''.date('Y-m-d').'\'';		//$sql = 'SELECT MAX('.SRVC_REQ_STG_ID.'), '.SRVC_REQST_ID.' , '.SRVC_REQST_CREATED_BY.' , '.SRVC_REQST_SRVC_ID.' , '.SRVC_REQST_TABLE_ID.' , '.SRVC_REQST_SESSION_ID.' , '.SRVC_REQST_STATUS.',  IF(DATE_ADD('.SRVC_REQST_CREATED_ON.',INTERVAL '.SRVC_STG_THRESH_HOLD_TIME.' SECOND) <= NOW(),1,0) \'isDelay\' ,'.SRVC_REQST_CREATED_ON.','.SRVC_REQST_COMPLETED_AT.','.SRVC_REQST_SESSION_ID.'  FROM '.TBL_SERVICE_REQUEST_STAGE.' INNER JOIN '.TBL_SERVICES_REQUESTS.' ON '.TBL_SERVICE_REQUEST_STAGE.'.'.SRVC_REQ_STG_REQUEST_ID.' = '.TBL_SERVICES_REQUESTS.'.'.SRVC_REQST_ID.' INNER JOIN '.TBL_SERVICE_STAGE.' ON '.TBL_SERVICE_STAGE.'.'.SRVC_STG_ID.'='.TBL_SERVICE_REQUEST_STAGE.'.'.SRVC_REQ_STG_SERVICE_STAGE_ID.' GROUP BY '.SRVC_REQ_STG_REQUEST_ID.','.SRVC_REQST_SESSION_ID.' HAVING ('.SRVC_REQST_COMPLETED_AT.' = NULL OR '.SRVC_REQST_COMPLETED_AT.'= 0) AND '.SRVC_REQST_SESSION_ID.' IN ('.$active_session.') AND '.SRVC_REQST_STATUS.' NOT IN ('.SERVICE_STATUS_COMPLETD.' ,'.SERVICE_STATUS_CANCELLED.') AND '.SRVC_REQST_CREATED_ON.' >= \''.date("Y-m-d").'\'';				 //SELECT MAX(`status_exp_time`) FROM `tbl_statuses` WHERE `status_event`= 'REQUEST' AND `status_hidden` = 0,				$sql = 'SELECT  '.SRVC_REQST_ID.', '.SRVC_REQST_CREATED_BY.','.SRVC_REQST_EMP_ID.', '.SRVC_REQST_TABLE_ID.' FROM  '.TBL_SERVICES_REQUESTS.'  WHERE DATE_ADD(  '.SRVC_REQST_CREATED_ON.' ,  INTERVAL(  SELECT MAX(`status_exp_time`) FROM `tbl_statuses` WHERE `status_event`= \'REQUEST\' AND `status_hidden` = 0) SECOND ) <= NOW( )  AND '.SRVC_REQST_SESSION_ID.' IN ('.$active_session.') AND '.SRVC_REQST_STATUS.' NOT IN ('.SERVICE_STATUS_COMPLETD.' ,'.SERVICE_STATUS_CANCELLED.') AND '.SRVC_REQST_CREATED_ON.' >= \''.date('Y-m-d').'\' AND  '.SRVC_REQST_IS_DELAYED.'=0 AND '.chkTableInRestaurant(SRVC_REQST_TABLE_ID); 		 //echo $sql; 		$delayed_requests = array();		$res = mysql_query($sql);		$cnt = 0;		if($res && is_gt_zero_num(mysql_num_rows($res))){ 			while($row=mysql_fetch_assoc($res)){				$delayed_requests[$row[SRVC_REQST_ID]]['customer'] = $row[SRVC_REQST_CREATED_BY];				$delayed_requests[$row[SRVC_REQST_ID]]['employee'] = $row[SRVC_REQST_EMP_ID];				$delayed_requests[$row[SRVC_REQST_ID]]['table'] = $row[SRVC_REQST_TABLE_ID];				$cnt++;	  			}		} 		if(is_gt_zero_num($cnt) && is_not_empty($delayed_requests)){			 			$res2 = mysql_query('UPDATE '.TBL_SERVICES_REQUESTS.' SET '.SRVC_REQST_IS_DELAYED.'= 1 WHERE '.SRVC_REQST_ID.' IN ('.biz_implode(',',array_keys($delayed_requests)).')');			if($res2){				foreach($delayed_requests as $key=>$requst){					/*if(is_gt_zero_num($requst['employee'])){						biz_send_alert($requst['table'],$requst['customer'],$key,'Request Delayed',$requst['employee'],ALERT_REQST);											} 					biz_send_alert($requst['table'],$requst['customer'],$key,'Request Delayed',ALERT_FOR_MANGER,ALERT_REQST);	 */					//..Notifications based on teh statuses @26 Oct 2013 					biz_send_status_notifications($requst['table'],$requst['customer'],$key,STS_REQST_DELAYED,$requst['employee']);				} 			} 		}  			return $cnt;	 }			public static function getPendingRequestForTable($table_id){		$info = array();		if(is_gt_zero_num($table_id)){			/*if(is_gt_zero_num($dont_show_active)){				$info =	self::readArray(array('isPending'=>1,SRVC_REQST_TABLE_ID=>$table_id,'status_not_in'=>SERVICE_STATUS_COMPLETD));			}else{*/				$info =	self::readArray(array('isPendingOnly'=>1,SRVC_REQST_TABLE_ID=>$table_id));				/*}*/		  		}		return $info;	}		public static function cancellAllpendingRequestForTable($table_id){		if(is_gt_zero_num($table_id)){ 		 return	mysql_query('UPDATE '.TBL_SERVICES_REQUESTS.' SET '.SRVC_REQST_STATUS.'='.SERVICE_STATUS_CANCELLED.' WHERE '.SRVC_REQST_TABLE_ID.'='.$table_id.' AND '.SRVC_REQST_STATUS.' <> '.SERVICE_STATUS_COMPLETD.''.RET.'AND'.RET.SRVC_REQST_CREATED_ON.' >= \''.date('Y-m-d').'\' AND '.chkTableInRestaurant(SRVC_REQST_TABLE_ID)); 		}		return '';	}		public static function updateAllPendingRequest($table_id,$tbl_sess_id){	  if(is_gt_zero_num($table_id) & is_gt_zero_num($tbl_sess_id)){	  		$res = mysql_query('UPDATE '.TBL_SERVICES_REQUESTS.' SET '.SRVC_REQST_SESSION_ID.' = '.$tbl_sess_id.'  WHERE DATE('.SRVC_REQST_CREATED_ON.') = CURDATE() AND '.SRVC_REQST_TABLE_ID.'='.$table_id.' AND '.SRVC_REQST_SESSION_ID.'=0 AND '.chkTableInRestaurant(SRVC_REQST_TABLE_ID)); 			return $res;	  }  	  return 0;	}		/*** update new sever after the transfer is done* @param undefined $table_id* @param undefined $new_server* */	public static function update_new_sever($table_id,$new_server){			  $arr = array(); 		if(is_gt_zero_num($table_id)){			$arr = self::readArray(array(SRVC_REQST_TABLE_ID=>$table_id,'isActive'=>1,'isPending'=>1)); 						if(is_not_empty($arr)){				$obj = new tbl_services_requests();								foreach($arr as $val){					if(is_gt_zero_num($val[SRVC_REQST_ID])){						$obj->assign_emp($val[SRVC_REQST_ID],$new_server);					}				}				unset($obj); 			}					} 		return $arr;	}			//public static function 			public static function getCurrentStatus($srvc_reqst_id){		if(is_gt_zero_num($srvc_reqst_id)){			return DB::ExecScalarQry('SELECT '.SRVC_REQST_STATUS.' FROM '.TBL_SERVICES_REQUESTS.' WHERE '.SRVC_REQST_ID.'='.$srvc_reqst_id,'0');		}		return '0';	}	}//..End tbl_services_requests?>