<?php/**********************************************************************tbl_order_details_options.class.phpGenerated by STRUCTY 2013.04.18 11:46:55.Copyright 2011 Structy, Frédéric Aebi. All rights reserved.**********************************************************************/define("TBL_ORDER_DETAILS_OPTIONS", "tbl_order_details_options"); define('ORD_DET_OPT_ID', 'ord_det_opt_id'); define('ORD_DET_OPT_ORDER_DETAIL', 'ord_det_opt_order_detail'); define('ORD_DET_OPT_OPTIONVALUE', 'ord_det_opt_optionvalue'); define('ORD_DET_OPT_QTY', 'ord_det_opt_qty'); define('ORD_DET_OPT_PRICE', 'ord_det_opt_price');define('ORD_DET_OPT_DISCOUNT', 'ord_det_opt_discount'); define("TBL_ORDER_DETAILS_OPTIONS_ACTIVE_DATE",  "");define("TBL_ORDER_DETAILS_OPTIONS_DEACTIVE_DATE",  "");$tbl_order_details_options_active_condition= " (".TBL_ORDER_DETAILS_OPTIONS_DEACTIVE_DATE." is NULL OR ".TBL_ORDER_DETAILS_OPTIONS_DEACTIVE_DATE." = 0 OR ".TBL_ORDER_DETAILS_OPTIONS_DEACTIVE_DATE." > CURDATE( )) ";class tbl_order_details_options {	private $ord_det_opt_id;	private $ord_det_opt_order_detail;	private $ord_det_opt_optionvalue;	private $ord_det_opt_qty;	private $ord_det_opt_price;	private $ord_det_opt_discount;		private $tbl_order_details_options_active_date;	private $tbl_order_details_options_deactive_date;	private $opt_value;		public function setord_det_opt_id($pArg="0") {$this->ord_det_opt_id=$pArg;}	public function setord_det_opt_order_detail($pArg="0") {$this->ord_det_opt_order_detail=$pArg;}	public function setord_det_opt_optionvalue($pArg="0") {$this->ord_det_opt_optionvalue=$pArg;}	public function setord_det_opt_qty($pArg="0") {$this->ord_det_opt_qty=$pArg;}	public function setord_det_opt_price($pArg="0") {$this->ord_det_opt_price=$pArg;}	public function setord_det_opt_discount($pArg="0") {$this->ord_det_opt_discount=$pArg;}		public function settbl_order_details_options_active_date($pArg="0") {$this->tbl_order_details_options_active_date=$pArg;}	public function settbl_order_details_options_deactive_date($pArg="0") {$this->tbl_order_details_options_deactive_date=$pArg;}	public function setopt_value($pArg="0") {$this->opt_value=$pArg;}		public function getord_det_opt_id() {return $this->ord_det_opt_id;}	public function getord_det_opt_order_detail() {return $this->ord_det_opt_order_detail;}	public function getord_det_opt_optionvalue() {return $this->ord_det_opt_optionvalue;}	public function getord_det_opt_qty() {return $this->ord_det_opt_qty;}	public function getord_det_opt_price() {return $this->ord_det_opt_price;}	public function getord_det_opt_discount() {return $this->ord_det_opt_discount;}		public function gettbl_order_details_options_active_date($pArg="0") {return $this->tbl_order_details_options_active_date;}	public function gettbl_order_details_options_deactive_date($pArg="0") {return $this->tbl_order_details_options_deactive_date;}	public function getopt_value($pArg="0") {return $this->opt_value;}	public function readObject($array = array()) {		//$qry = "SELECT *".RET."FROM ".TBL_ORDER_DETAILS_OPTIONS.RET;		$qry = "SELECT `ord_det_opt_id`,`ord_det_opt_order_detail`, 		`ord_det_opt_optionvalue`, `ord_det_opt_qty`, `ord_det_opt_price` ,`ord_det_opt_discount`,(			SELECT `dish_opt_val_value` 			FROM `tbl_dish_options_values` 			WHERE   `dish_opt_val_id`=`ord_det_opt_optionvalue`		) as `opt_value` , 		(			SELECT `dish_opt_type` 			FROM `tbl_dish_options`  inner join  `tbl_dish_options_values` on `dish_opt_id` = `dish_opt_val_option_id`			WHERE  `dish_opt_val_id`=`ord_det_opt_optionvalue`		) as `opt_type`".RET."FROM ".TBL_ORDER_DETAILS_OPTIONS.RET;		$and = "WHERE".RET;		if($array[ORD_DET_OPT_ID] != "") {			$qry .= $and.ORD_DET_OPT_ID." = '".$array[ORD_DET_OPT_ID]."'".RET;			$and = "AND".RET;		}		if($array[ORD_DET_OPT_ORDER_DETAIL] != "") {			$qry .= $and.ORD_DET_OPT_ORDER_DETAIL." = '".$array[ORD_DET_OPT_ORDER_DETAIL]."'".RET;			$and = "AND".RET;		}		if($array[ORD_DET_OPT_OPTIONVALUE] != "") {			$qry .= $and.ORD_DET_OPT_OPTIONVALUE." = '".$array[ORD_DET_OPT_OPTIONVALUE]."'".RET;			$and = "AND".RET;		}		if($array[ORD_DET_OPT_QTY] != "") {			$qry .= $and.ORD_DET_OPT_QTY." = '".$array[ORD_DET_OPT_QTY]."'".RET;			$and = "AND".RET;		}		if($array[ORD_DET_OPT_PRICE] != "") {			$qry .= $and.ORD_DET_OPT_PRICE." = '".$array[ORD_DET_OPT_PRICE]."'".RET;			$and = "AND".RET;		}	$result = mysql_query($qry);		if($result) {			while ($row = mysql_fetch_array($result)) {				$record = $row;				break;//end after first record			}			if(count($record[0]) == 0) {				return array();			} else {				$this->setord_det_opt_id($record[ORD_DET_OPT_ID]);				$this->setord_det_opt_order_detail($record[ORD_DET_OPT_ORDER_DETAIL]);				$this->setord_det_opt_optionvalue($record[ORD_DET_OPT_OPTIONVALUE]);				$this->setord_det_opt_qty($record[ORD_DET_OPT_QTY]);				$this->setord_det_opt_price($record[ORD_DET_OPT_PRICE]);				$this->setord_det_opt_discount($record[ORD_DET_OPT_DISCOUNT]);								$this->setopt_value($record["opt_value"]);								$this->settbl_order_details_options_active_date($record[TBL_ORDER_DETAILS_OPTIONS_ACTIVE_DATE]);				$this->settbl_order_details_options_deactive_date($record[TBL_ORDER_DETAILS_OPTIONS_DEACTIVE_DATE]);				return true;			}		}	}	public static function readArray($array = array(),&$result_found=0,$isArray=1) {		global $tbl_order_details_options_active_condition;		//$qry = "SELECT *".RET."FROM ".TBL_ORDER_DETAILS_OPTIONS.RET;		$qry = "SELECT `ord_det_opt_id`,`ord_det_opt_order_detail`, 		`ord_det_opt_optionvalue`, `ord_det_opt_qty`, `ord_det_opt_price` ,`ord_det_opt_discount`,(			SELECT `dish_opt_val_value` 			FROM `tbl_dish_options_values` 			WHERE `dish_opt_val_id`=`ord_det_opt_optionvalue`		) as `opt_value`  , 		(			SELECT `dish_opt_val_ethor_variant` 			FROM `tbl_dish_options_values` 			WHERE `dish_opt_val_id`=`ord_det_opt_optionvalue`		) as `ethor_variant`  ,		(			SELECT `dish_opt_type` 			FROM `tbl_dish_options`  inner join  `tbl_dish_options_values` on `dish_opt_id` = `dish_opt_val_option_id`			WHERE  `dish_opt_val_id`=`ord_det_opt_optionvalue`		) as `opt_type`".RET."FROM ".TBL_ORDER_DETAILS_OPTIONS.RET;		$and = "WHERE".RET;		if($array[ORD_DET_OPT_ID] != "") {			$qry .= $and.ORD_DET_OPT_ID." = '".$array[ORD_DET_OPT_ID]."'".RET;			$and = "AND".RET;		}		if($array[ORD_DET_OPT_ORDER_DETAIL] != "") {			$qry .= $and.ORD_DET_OPT_ORDER_DETAIL." = '".$array[ORD_DET_OPT_ORDER_DETAIL]."'".RET;			$and = "AND".RET;		}		if($array[ORD_DET_OPT_OPTIONVALUE] != "") {			$qry .= $and.ORD_DET_OPT_OPTIONVALUE." = '".$array[ORD_DET_OPT_OPTIONVALUE]."'".RET;			$and = "AND".RET;		}		if($array[ORD_DET_OPT_QTY] != "") {			$qry .= $and.ORD_DET_OPT_QTY." = '".$array[ORD_DET_OPT_QTY]."'".RET;			$and = "AND".RET;		}		if($array[ORD_DET_OPT_PRICE] != "") {			$qry .= $and.ORD_DET_OPT_PRICE." = '".$array[ORD_DET_OPT_PRICE]."'".RET;			$and = "AND".RET;		}		if(is_gt_zero_num($array["isActive"])) {			$qry .= $and.$tbl_order_details_options_active_condition;;			$and = "AND".RET;		}		if(is_not_empty($array[SORT_ON]) && is_not_empty($array[SORT_BY])) {		$qry .=" ORDER BY ".$array[SORT_ON]." ".$array[SORT_BY];		}		if(is_not_empty($array[OFFSET_TITLE]) && is_not_empty($array[LIMIT_TITLE])) {			$qry_with_limit  = $qry." LIMIT ".$array[OFFSET_TITLE].",".$array[LIMIT_TITLE];		}else{			$qry_with_limit  = $qry;		}		$result = mysql_query ($qry_with_limit);		$r1 = mysql_query($qry);		if($r1){			$result_found = mysql_num_rows($r1);		}		$class_objects = array();		if($result) {			while ($record = mysql_fetch_assoc($result)) {				$isActive= 0;				//..check deactive date is not set or 0				if((is_not_empty($record[TBL_ORDER_DETAILS_OPTIONS_DEACTIVE_DATE])==false) || (is_gt_zero_num(strtotime($record[TBL_ORDER_DETAILS_OPTIONS_DEACTIVE_DATE]))== false)){					$isActive = 1; 				}else{					//..check the deactive date is greater than todays date					if(strtotime($record[TBL_ORDER_DETAILS_OPTIONS_DEACTIVE_DATE]) > strtotime(date(DATE_FORMAT))){						$isActive = 1;					}				}				if($isArray){					$class_object = array();					$class_object["ord_det_opt_id"]=$record[ORD_DET_OPT_ID];					$class_object["ord_det_opt_order_detail"]=$record[ORD_DET_OPT_ORDER_DETAIL];					$class_object["ord_det_opt_optionvalue"]=$record[ORD_DET_OPT_OPTIONVALUE];					$class_object["ord_det_opt_qty"]=$record[ORD_DET_OPT_QTY];					$class_object["ord_det_opt_price"]=$record[ORD_DET_OPT_PRICE];					$class_object["ord_det_opt_discount"]=$record[ORD_DET_OPT_DISCOUNT];										$class_object["opt_value"]=$record["opt_value"];					$class_object["opt_type"]=$record["opt_type"];										$class_object["ethor_variant"]=$record["ethor_variant"];					$class_object["isActive"]=$isActive;				}else{					$class_object = new tbl_order_details_options();					$class_object->setord_det_opt_id($record[ORD_DET_OPT_ID]);					$class_object->setord_det_opt_order_detail($record[ORD_DET_OPT_ORDER_DETAIL]);					$class_object->setord_det_opt_optionvalue($record[ORD_DET_OPT_OPTIONVALUE]);					$class_object->setord_det_opt_qty($record[ORD_DET_OPT_QTY]);					$class_object->setord_det_opt_price($record[ORD_DET_OPT_PRICE]);					$class_object->setord_det_opt_discount($record[ORD_DET_OPT_DISCOUNT]);				}				$class_objects[$record[ORD_DET_OPT_ID]] = $class_object;			}		}		return $class_objects;	}//..End readArray	public function insert() {		if($this->getord_det_opt_id() != '') {			$qry  = "UPDATE ".TBL_ORDER_DETAILS_OPTIONS.RET."SET".RET."			".ORD_DET_OPT_ID." = '".$this->getord_det_opt_id()."',".RET."			".ORD_DET_OPT_ORDER_DETAIL." = '".$this->getord_det_opt_order_detail()."',".RET."			".ORD_DET_OPT_OPTIONVALUE." = '".$this->getord_det_opt_optionvalue()."',".RET."			".ORD_DET_OPT_QTY." = '".$this->getord_det_opt_qty()."',".RET."			".ORD_DET_OPT_PRICE." = '".$this->getord_det_opt_price()."'".RET.			"WHERE ".ORD_DET_OPT_ID." = ".$this->getord_det_opt_id().RET;			mysql_query($qry);		} else {			$qry  = "INSERT INTO ".TBL_ORDER_DETAILS_OPTIONS." (".RET.			"".ORD_DET_OPT_ORDER_DETAIL.", ".ORD_DET_OPT_OPTIONVALUE.", ".ORD_DET_OPT_QTY.", ".ORD_DET_OPT_PRICE.RET.				") VALUES (".RET.			"'".$this->getord_det_opt_order_detail()."',".RET.			"'".$this->getord_det_opt_optionvalue()."',".RET.			"'".$this->getord_det_opt_qty()."',".RET.			"'".$this->getord_det_opt_price()."'".RET.			")".RET;			 			$res = mysql_query($qry);			$this->setord_det_opt_id(mysql_insert_id());		}	}//..End Insert	public static function delete($array = array()) {		$qry = "DELETE".RET."FROM ".TBL_ORDER_DETAILS_OPTIONS.RET;		$and = "WHERE".RET;		if($array[ORD_DET_OPT_ID] != "") {			$qry .= $and.ORD_DET_OPT_ID." IN (".$array[ORD_DET_OPT_ID].")".RET;			$and = "AND".RET;		}		if($array[ORD_DET_OPT_ORDER_DETAIL] != "") {			$qry .= $and.ORD_DET_OPT_ORDER_DETAIL." IN (".$array[ORD_DET_OPT_ORDER_DETAIL].")".RET;			$and = "AND".RET;		}		if($array[ORD_DET_OPT_OPTIONVALUE] != "") {			$qry .= $and.ORD_DET_OPT_OPTIONVALUE." = '".$array[ORD_DET_OPT_OPTIONVALUE]."'".RET;			$and = "AND".RET;		}		if($array[ORD_DET_OPT_QTY] != "") {			$qry .= $and.ORD_DET_OPT_QTY." = '".$array[ORD_DET_OPT_QTY]."'".RET;			$and = "AND".RET;		}		if($array[ORD_DET_OPT_PRICE] != "") {			$qry .= $and.ORD_DET_OPT_PRICE." = '".$array[ORD_DET_OPT_PRICE]."'".RET;			$and = "AND".RET;		}		$res = mysql_query($qry);		if($res){			return OPERATION_SUCCESS;		};		return OPERATION_FAIL;	}//..End Delete	public function isAlreadyThere($ord_det_opt_order_detail ,$ord_det_opt_optionvalue ,$ord_det_opt_qty ,$ord_det_opt_price) {		$unique_arr = array();			//$unique_arr[ORD_DET_OPT_ID]=$ord_det_opt_id;			//$unique_arr[ORD_DET_OPT_ORDER_DETAIL]=$ord_det_opt_order_detail;			//$unique_arr[ORD_DET_OPT_OPTIONVALUE]=$ord_det_opt_optionvalue;			//$unique_arr[ORD_DET_OPT_QTY]=$ord_det_opt_qty;			//$unique_arr[ORD_DET_OPT_PRICE]=$ord_det_opt_price;		if(is_not_empty($unique_arr)){			return $this->readObject($unique_arr);		}		return false;	}//..isAlreadyThere	public function create($ord_det_opt_order_detail ,$ord_det_opt_optionvalue ,$ord_det_opt_qty ,$ord_det_opt_price) {		if(is_not_empty($ord_det_opt_order_detail)){						//..now insert new record			$this->setord_det_opt_id("");			$this->setord_det_opt_order_detail($ord_det_opt_order_detail);			$this->setord_det_opt_optionvalue($ord_det_opt_optionvalue);			$this->setord_det_opt_qty($ord_det_opt_qty);			$this->setord_det_opt_price($ord_det_opt_price);			$this->insert();			return $this->getord_det_opt_id();			/*if($this->isAlreadyThere($ord_det_opt_order_detail ,$ord_det_opt_optionvalue ,$ord_det_opt_qty ,$ord_det_opt_price)){				return OPERATION_DUPLICATE;			}else{				$this->setord_det_opt_id("");				$this->setord_det_opt_order_detail($ord_det_opt_order_detail);				$this->setord_det_opt_optionvalue($ord_det_opt_optionvalue);				$this->setord_det_opt_qty($ord_det_opt_qty);				$this->setord_det_opt_price($ord_det_opt_price);				$this->insert();				return $this->getord_det_opt_id();			}*/		}		return OPERATION_FAIL;	}//..create	public function update($ord_det_opt_id, $ord_det_opt_order_detail, $ord_det_opt_optionvalue, $ord_det_opt_qty, $ord_det_opt_price) {		if(is_gt_zero_num($ord_det_opt_id)){			if ($this->readObject(array(ORD_DET_OPT_ID=>$ord_det_opt_id))){				$this->setord_det_opt_order_detail($ord_det_opt_order_detail);				$this->setord_det_opt_optionvalue($ord_det_opt_optionvalue);				$this->setord_det_opt_qty($ord_det_opt_qty);				$this->setord_det_opt_price($ord_det_opt_price);				$this->insert();				return OPERATION_SUCCESS;			}		}		return OPERATION_FAIL;	}//..update		//..Add discount to the order detail item	public function addDiscountToDetailOption($ord_dtl_opt_id,$discount){				if(is_gt_zero_num($ord_dtl_opt_id) && is_gt_zero_num($discount)){			if ($this->readObject(array(ORD_DTL_OPT_ID=>$ord_dtl_opt_id))){				//..get the discount value				$discount_val=0;				$discount_detail=tbl_discounts::GetInfo($discount);								if(is_not_empty($discount_detail)){						if($discount_detail[DISCOUNT_TYPE]=='PERCENT'){							$discount_val=($this->getord_det_opt_price() *($discount_detail[DISCOUNT_PERCENT]/100));						}else{							$discount_val=($discount_detail[DISCOUNT_PERCENT]);						}				}				//unset($discount_detail);				$qry  = "UPDATE ".TBL_ORDER_DETAILS_OPTIONS.RET."SET".RET."			".ORD_DET_OPT_DISCOUNT." = ".$discount_val." WHERE ".ORD_DET_OPT_ID."={$ord_dtl_opt_id}";				$res = mysql_query($qry);				if($res){					return 1;				}			}		}		return 0;	}//..end activate	public function activate($ord_det_opt_id){		if(is_gt_zero_num($ord_det_opt_id)){			if ($this->readObject(array(ORD_DET_OPT_ID=>$ord_det_opt_id))){				$qry  = "UPDATE ".TBL_ORDER_DETAILS_OPTIONS.RET."SET".RET."			".TBL_ORDER_DETAILS_OPTIONS_DEACTIVE_DATE." = '".date(EMPTY_DATE_FORMAT)."' WHERE ".ORD_DET_OPT_ID."={$ord_det_opt_id}";				$res = mysql_query($qry);				if($res){					return 1;				}			}		}		return 0;	}//..end activate	public function deactivate($ord_det_opt_id){		if(is_gt_zero_num($ord_det_opt_id)){			if ($this->readObject(array(ORD_DET_OPT_ID=>$ord_det_opt_id))){				$qry  = "UPDATE ".TBL_ORDER_DETAILS_OPTIONS.RET."SET".RET."			".TBL_ORDER_DETAILS_OPTIONS_DEACTIVE_DATE." = '".date(DATE_FORMAT)."' WHERE ".ORD_DET_OPT_ID."={$ord_det_opt_id}";				$res = mysql_query($qry);				if($res){					return 1;				}			}		}		return 0;	}//..end deactivate	public static function GetInfo($ord_det_opt_id) {		$info = array();		if($ord_det_opt_id != ""){			$obj_tbl_order_details_options = new tbl_order_details_options();			if($obj_tbl_order_details_options->readObject(array("ord_det_opt_id"=>$ord_det_opt_id))){				$info["ord_det_opt_id"]=$obj_tbl_order_details_options->getord_det_opt_id();				$info["ord_det_opt_order_detail"]=$obj_tbl_order_details_options->getord_det_opt_order_detail();				$info["ord_det_opt_optionvalue"]=$obj_tbl_order_details_options->getord_det_opt_optionvalue();				$info["ord_det_opt_qty"]=$obj_tbl_order_details_options->getord_det_opt_qty();				$info["ord_det_opt_price"]=$obj_tbl_order_details_options->getord_det_opt_price();				$info["ord_det_opt_discount"]=$obj_tbl_order_details_options->getord_det_opt_discount();				$info["opt_value"]=$obj_tbl_order_details_options->getopt_value();				$info["isActive"] = 0;				//..check deactive date is not set or 0				if((is_not_empty($obj_tbl_order_details_options->gettbl_order_details_options_deactive_date())==false)  || (is_gt_zero_num(strtotime($obj_tbl_order_details_options->gettbl_order_details_options_deactive_date()))== false)){					$info["isActive"] = 1;				}else{					//..check the deactive date > todays date					if(strtotime($obj_tbl_order_details_options->gettbl_order_details_options_deactive_date()) > strtotime(date(DATE_FORMAT))){						$info["isActive"] = 1;					}				}			}		unset($obj_tbl_order_details_options);		return $info;		}	}//..End GetInfo	public static function GetFields($data){		global $tbl_order_details_options_active_condition;		$arr = array();		if(is_not_empty($data)){			$qry ="SELECT ".$data['key_field'].",".$data['value_field']." FROM ".TBL_ORDER_DETAILS_OPTIONS."";			if(is_gt_zero_num($data['isActive'])){				$qry .= " WHERE ".$tbl_order_details_options_active_condition;			}			$res = mysql_query($qry); 			if($res){				while($row=mysql_fetch_assoc($res)){					$arr[$row[$data['key_field']]] = $row[$data['value_field']];				}			}		}		return $arr;	}//.. End of GetFields		/*//..delete previous order details options for particular order deatil,option	public static function delete_ord_detls_options($ord_det_opt_order_detail,$ord_det_opt_optionvalue){		$qry  = "DELETE FROM ".TBL_ORDER_DETAILS_OPTIONS." WHERE ".ORD_DET_OPT_ORDER_DETAIL ."=".$ord_det_opt_order_detail. " AND ".ORD_DET_OPT_OPTIONVALUE."=".$ord_det_opt_optionvalue;		$res = mysql_query($qry);					return true;	}//..end delete_ord_detls*/		//..delete previous order details options for particular order,submenu dish	public static function delete_ord_detls_options($order_id,$ord_dtl_sbmenu_dish_id){		//..delete the options if exists for that deatils		$qry  = "DELETE FROM ".TBL_ORDER_DETAILS_OPTIONS." WHERE ".ORD_DET_OPT_ORDER_DETAIL ." IN (SELECT ORD_DTL_ID FROM ".TBL_ORDER_DETAILS.RET. " WHERE ".ORD_DTL_ORDER_ID ."=".$order_id. " AND ".ORD_DTL_SBMENU_DISH_ID."=".$ord_dtl_sbmenu_dish_id.")";		$res = mysql_query($qry);							return true;	}//..end delete_ord_detls}//..End tbl_order_details_options?>