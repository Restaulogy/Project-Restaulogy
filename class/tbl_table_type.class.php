<?php/**********************************************************************tbl_table_type.class.phpGenerated by STRUCTY 2013.03.19 07:20:27.Copyright 2011 Structy, Frédéric Aebi. All rights reserved.**********************************************************************/define("TBL_TABLE_TYPE", "tbl_table_type"); define('TBL_TYPE_ID', 'tbl_type_id'); define('TBL_TYPE_NAME', 'tbl_type_name'); define('TBL_TYPE_DESCRIPTION', 'tbl_type_description'); define('TBL_TYPE_START_DATE', 'tbl_type_start_date'); define('TBL_TYPE_ENDDATE', 'tbl_type_enddate'); define('TBL_TYPE_RESTARENT', 'tbl_type_restarent'); define("TBL_TABLE_TYPE_ACTIVE_DATE", "tbl_type_start_date");define("TBL_TABLE_TYPE_DEACTIVE_DATE", "tbl_type_enddate");$tbl_table_type_active_condition= " (".TBL_TABLE_TYPE_DEACTIVE_DATE." is NULL OR ".TBL_TABLE_TYPE_DEACTIVE_DATE." = 0 OR ".TBL_TABLE_TYPE_DEACTIVE_DATE." > CURDATE( )) ";class tbl_table_type {	private $tbl_type_id;	private $tbl_type_name;	private $tbl_type_description;	private $tbl_type_start_date;	private $tbl_type_enddate;		private $tbl_type_restarent;		private $tbl_table_type_active_date;	private $tbl_table_type_deactive_date;	public function settbl_type_id($pArg="0") {$this->tbl_type_id=$pArg;}	public function settbl_type_name($pArg="0") {$this->tbl_type_name=$pArg;}	public function settbl_type_description($pArg="0") {$this->tbl_type_description=$pArg;}	public function settbl_type_start_date($pArg="0") {$this->tbl_type_start_date=$pArg;}	public function settbl_type_enddate($pArg="0") {$this->tbl_type_enddate=$pArg;}	public function settbl_table_type_active_date($pArg="0") {$this->tbl_table_type_active_date=$pArg;}	public function settbl_table_type_deactive_date($pArg="0") {$this->tbl_table_type_deactive_date=$pArg;}		public function settbl_type_restarent($pArg="0") {$this->tbl_type_restarent=$pArg;}	public function gettbl_type_id() {return $this->tbl_type_id;}	public function gettbl_type_name() {return $this->tbl_type_name;}	public function gettbl_type_description() {return $this->tbl_type_description;}	public function gettbl_type_start_date() {return $this->tbl_type_start_date;}	public function gettbl_type_enddate() {return $this->tbl_type_enddate;}	public function gettbl_table_type_active_date($pArg="0") {return $this->tbl_table_type_active_date;}	public function gettbl_table_type_deactive_date($pArg="0") {return $this->tbl_table_type_deactive_date;}		public function gettbl_type_restarent() {return $this->tbl_type_restarent;}	public function readObject($array = array()) {		$qry = "SELECT *".RET."FROM ".TBL_TABLE_TYPE.RET;		$and = "WHERE".RET;		if($array[TBL_TYPE_ID] != "") {			$qry .= $and.TBL_TYPE_ID." = '".$array[TBL_TYPE_ID]."'".RET;			$and = "AND".RET;		}		if($array[TBL_TYPE_NAME] != "") {			$qry .= $and.TBL_TYPE_NAME." = '".$array[TBL_TYPE_NAME]."'".RET;			$and = "AND".RET;		}		if($array[TBL_TYPE_DESCRIPTION] != "") {			$qry .= $and.TBL_TYPE_DESCRIPTION." = '".$array[TBL_TYPE_DESCRIPTION]."'".RET;			$and = "AND".RET;		}		if($array[TBL_TYPE_START_DATE] != "") {			$qry .= $and.TBL_TYPE_START_DATE." = '".$array[TBL_TYPE_START_DATE]."'".RET;			$and = "AND".RET;		}		if($array[TBL_TYPE_ENDDATE] != "") {			$qry .= $and.TBL_TYPE_ENDDATE." = '".$array[TBL_TYPE_ENDDATE]."'".RET;			$and = "AND".RET;		}				if($array[TBL_TYPE_RESTARENT] != "") {			$qry .= $and.TBL_TYPE_RESTARENT." = '".$array[TBL_TYPE_RESTARENT]."'".RET;			$and = "AND".RET;		}	$result = mysql_query($qry);		if($result) {			while ($row = mysql_fetch_array($result)) {				$record = $row;				break;//end after first record			}			if(count($record[0]) == 0) {				return array();			} else {				$this->settbl_type_id($record[TBL_TYPE_ID]);				$this->settbl_type_name($record[TBL_TYPE_NAME]);				$this->settbl_type_description($record[TBL_TYPE_DESCRIPTION]);				$this->settbl_type_start_date($record[TBL_TYPE_START_DATE]);				$this->settbl_type_enddate($record[TBL_TYPE_ENDDATE]);				$this->settbl_table_type_active_date($record[TBL_TABLE_TYPE_ACTIVE_DATE]);				$this->settbl_table_type_deactive_date($record[TBL_TABLE_TYPE_DEACTIVE_DATE]);								$this->settbl_type_restarent($record[TBL_TYPE_RESTARENT]);								return true;			}		}	}	public static function readArray($array = array(),&$result_found=0,$isArray=1) {		global $tbl_table_type_active_condition;		$qry = "SELECT *".RET."FROM ".TBL_TABLE_TYPE.RET;		$and = "WHERE".RET;		if($array[TBL_TYPE_ID] != "") {			$qry .= $and.TBL_TYPE_ID." = '".$array[TBL_TYPE_ID]."'".RET;			$and = "AND".RET;		}		if($array[TBL_TYPE_NAME] != "") {			$qry .= $and.TBL_TYPE_NAME." = '".$array[TBL_TYPE_NAME]."'".RET;			$and = "AND".RET;		}		if($array[TBL_TYPE_DESCRIPTION] != "") {			$qry .= $and.TBL_TYPE_DESCRIPTION." = '".$array[TBL_TYPE_DESCRIPTION]."'".RET;			$and = "AND".RET;		}		if($array[TBL_TYPE_START_DATE] != "") {			$qry .= $and.TBL_TYPE_START_DATE." = '".$array[TBL_TYPE_START_DATE]."'".RET;			$and = "AND".RET;		}		if($array[TBL_TYPE_ENDDATE] != "") {			$qry .= $and.TBL_TYPE_ENDDATE." = '".$array[TBL_TYPE_ENDDATE]."'".RET;			$and = "AND".RET;		}		if(is_gt_zero_num($array["isActive"])) {			$qry .= $and.$tbl_table_type_active_condition;			$and = "AND".RET;		}				if($array[TBL_TYPE_RESTARENT] != "") {			$qry .= $and.TBL_TYPE_RESTARENT." = '".$array[TBL_TYPE_RESTARENT]."'".RET;			$and = "AND".RET;		}		if(is_not_empty($array["offset"]) && is_not_empty($array["limit"])) {			$qry_with_limit  = $qry." LIMIT ".$array["offset"].",".$array["limit"];		}else{			$qry_with_limit  = $qry;		}		 	 		$result = mysql_query ($qry_with_limit);		$r1 = mysql_query($qry);		$result_found = mysql_num_rows($r1);		$class_objects = array();		if($result) {			while ($record = mysql_fetch_assoc($result)) {				$isActive= chk_if_record_active($record[TBL_TABLE_TYPE_DEACTIVE_DATE]);				/*//..check deactive date is not set or 0				if(is_not_empty($record[TBL_TABLE_TYPE_DEACTIVE_DATE])==false || strtotime($record[TBL_TABLE_TYPE_DEACTIVE_DATE]) == 0){			 							$isActive = 1; 				}else{					//..check the deactive date is greater than todays date					if(strtotime($record[TBL_TABLE_TYPE_DEACTIVE_DATE]) > strtotime(date(DATE_FORMAT))){						 						$isActive = 1;					}				}*/				if($isArray){					$class_object = array();					$class_object["tbl_type_id"]=$record[TBL_TYPE_ID];					$class_object["tbl_type_name"]=$record[TBL_TYPE_NAME];					$class_object["tbl_type_description"]=$record[TBL_TYPE_DESCRIPTION];					$class_object["tbl_type_start_date"]=$record[TBL_TYPE_START_DATE];					$class_object["tbl_type_enddate"]=$record[TBL_TYPE_ENDDATE];					$class_object["isActive"]=$isActive;					$class_object["tbl_type_restarent"]=$tbl_type_restarent;				}else{					$class_object = new tbl_table_type();					$class_object->settbl_type_id($record[TBL_TYPE_ID]);					$class_object->settbl_type_name($record[TBL_TYPE_NAME]);					$class_object->settbl_type_description($record[TBL_TYPE_DESCRIPTION]);					$class_object->settbl_type_start_date($record[TBL_TYPE_START_DATE]);					$class_object->settbl_type_enddate($record[TBL_TYPE_ENDDATE]);					$class_object->settbl_type_restarent($record[TBL_TYPE_RESTARENT]);				}				$class_objects[$record[TBL_TYPE_ID]] = $class_object;			}		} 		return $class_objects;	}//..End readArray	public function insert() {		if($this->gettbl_type_id() != '') {			$qry  = "UPDATE ".TBL_TABLE_TYPE.RET."SET".RET."			".TBL_TYPE_ID." = '".$this->gettbl_type_id()."',".RET."			".TBL_TYPE_NAME." = '".$this->gettbl_type_name()."',".RET."			".TBL_TYPE_DESCRIPTION." = '".$this->gettbl_type_description()."',".RET."			".TBL_TYPE_START_DATE." = '".$this->gettbl_type_start_date()."',".RET."			".TBL_TYPE_ENDDATE." = '".$this->gettbl_type_enddate()."'".RET.			"WHERE ".TBL_TYPE_ID." = ".$this->gettbl_type_id().RET;			mysql_query($qry);		} else {			$qry  = "INSERT INTO ".TBL_TABLE_TYPE." (".RET.			"".TBL_TYPE_NAME.", ".TBL_TYPE_DESCRIPTION.", ".TBL_TYPE_START_DATE.", ".TBL_TYPE_ENDDATE.", ".TBL_TYPE_RESTARENT.RET.				") VALUES (".RET.			"'".$this->gettbl_type_name()."',".RET.			"'".$this->gettbl_type_description()."',".RET.			"'".$this->gettbl_type_start_date()."',".RET.			"'".$this->gettbl_type_enddate()."',".RET.			"'".$_SESSION[SES_RESTAURANT]."'".RET.			")".RET;			$res = mysql_query($qry);			$this->settbl_type_id(mysql_insert_id());		}	}//..End Insert	public static function delete($array = array()) {		$qry = "DELETE".RET."FROM ".TBL_TABLE_TYPE.RET;		$and = "WHERE".RET;		if($array[TBL_TYPE_ID] != "") {			$qry .= $and.TBL_TYPE_ID." IN (".$array[TBL_TYPE_ID].")".RET;			$and = "AND".RET;		}		if($array[TBL_TYPE_NAME] != "") {			$qry .= $and.TBL_TYPE_NAME." = '".$array[TBL_TYPE_NAME]."'".RET;			$and = "AND".RET;		}		if($array[TBL_TYPE_DESCRIPTION] != "") {			$qry .= $and.TBL_TYPE_DESCRIPTION." = '".$array[TBL_TYPE_DESCRIPTION]."'".RET;			$and = "AND".RET;		}		if($array[TBL_TYPE_START_DATE] != "") {			$qry .= $and.TBL_TYPE_START_DATE." = '".$array[TBL_TYPE_START_DATE]."'".RET;			$and = "AND".RET;		}		if($array[TBL_TYPE_ENDDATE] != "") {			$qry .= $and.TBL_TYPE_ENDDATE." = '".$array[TBL_TYPE_ENDDATE]."'".RET;			$and = "AND".RET;		}				if($array[TBL_TYPE_RESTARENT] != "") {			$qry .= $and.TBL_TYPE_RESTARENT." = '".$array[TBL_TYPE_RESTARENT]."'".RET;			$and = "AND".RET;		}		mysql_query($qry);	}//..End Delete	public function isAlreadyThere($tbl_type_name ,$tbl_type_description ,$tbl_type_start_date ,$tbl_type_enddate) {		$unique_arr = array();			//$unique_arr[TBL_TYPE_ID]=$tbl_type_id;			//$unique_arr[TBL_TYPE_NAME]=$tbl_type_name;			//$unique_arr[TBL_TYPE_DESCRIPTION]=$tbl_type_description;			//$unique_arr[TBL_TYPE_START_DATE]=$tbl_type_start_date;			//$unique_arr[TBL_TYPE_ENDDATE]=$tbl_type_enddate;		if(is_not_empty($unique_arr)){			return $this->readObject($unique_arr);		}		return false;	}//..isAlreadyThere	public function create($tbl_type_name ,$tbl_type_description ,$tbl_type_start_date ,$tbl_type_enddate) {		if(is_not_empty($tbl_type_name)){			if($this->isAlreadyThere($tbl_type_name ,$tbl_type_description ,$tbl_type_start_date ,$tbl_type_enddate)){				return OPERATION_DUPLICATE;			}else{				$this->settbl_type_id("");				$this->settbl_type_name($tbl_type_name);				$this->settbl_type_description($tbl_type_description);				$this->settbl_type_start_date($tbl_type_start_date);				$this->settbl_type_enddate($tbl_type_enddate);				$this->insert();				return $this->gettbl_type_id();			}		}	}//..create	public function update($tbl_type_id, $tbl_type_name, $tbl_type_description, $tbl_type_start_date, $tbl_type_enddate) {		if(is_gt_zero_num($tbl_type_id)){			if ($this->readObject(array(TBL_TYPE_ID=>$tbl_type_id))){				$this->settbl_type_name($tbl_type_name);				$this->settbl_type_description($tbl_type_description);				$this->settbl_type_start_date($tbl_type_start_date);				$this->settbl_type_enddate($tbl_type_enddate);				$this->insert();				return OPERATION_SUCCESS;			}		}		return 0;	}//..update	public function activate($tbl_type_id){		if(is_gt_zero_num($tbl_type_id)){			if ($this->readObject(array(TBL_TYPE_ID=>$tbl_type_id))){				$qry  = "UPDATE ".TBL_TABLE_TYPE.RET."SET".RET."			".TBL_TABLE_TYPE_DEACTIVE_DATE." = '".date("0000-00-00")."' WHERE ".TBL_TYPE_ID."={$tbl_type_id}";			 				$res = mysql_query($qry);				if($res){					return OPERATION_SUCCESS;				}			}		}		return OPERATION_FAIL;	}//..end activate	public function deactivate($tbl_type_id){		if(is_gt_zero_num($tbl_type_id)){			if ($this->readObject(array(TBL_TYPE_ID=>$tbl_type_id))){				$qry  = "UPDATE ".TBL_TABLE_TYPE.RET."SET".RET."			".TBL_TABLE_TYPE_DEACTIVE_DATE." = '".date(DATE_FORMAT)."' WHERE ".TBL_TYPE_ID."={$tbl_type_id}";		 						$res = mysql_query($qry);				if($res){					return OPERATION_SUCCESS;				}			}		}		return OPERATION_FAIL;	}//..end deactivate	public static function GetFields($data){		global $tbl_table_type_active_condition;		$arr = array();		if(is_not_empty($data)){			$qry ="SELECT ".$data['key_field'].",".$data['value_field']." FROM ".TBL_TABLE_TYPE."";			if(is_gt_zero_num($data['isActive'])){				$qry .= " WHERE ".TBL_TYPE_RESTARENT."=".$_SESSION[SES_RESTAURANT]." AND ".$tbl_table_type_active_condition;			}			$res = mysql_query($qry); 			if($res){				while($row=mysql_fetch_assoc($res)){					$arr[$row[$data['key_field']]] = $row[$data['value_field']];				}			}		}		return $arr;	}//.. End of GetFields		public static function GetInfo($tbl_type_id) {		$info = array();			if($tbl_type_id != ""){		$obj = new tbl_table_type();			if($obj->readObject(array("tbl_type_id"=>$tbl_type_id))){				$info["tbl_type_id"]=$obj->gettbl_type_id();				$info["tbl_type_name"]=$obj->gettbl_type_name();				$info["tbl_type_description"]=$obj->gettbl_type_description();				$info["tbl_type_restarent"]=$obj->gettbl_type_restarent();				$info["tbl_type_start_date"]=$obj->gettbl_type_start_date();				$info["tbl_type_enddate"]=$obj->gettbl_type_enddate();				$info["isActive"] = chk_if_record_active($info["tbl_type_enddate"]);				/*//..check deactive date is not set or 0				if(is_not_empty($obj->gettbl_table_type_deactive_date())==false  || strtotime($obj->gettbl_table_type_deactive_date()) == 0){					$info["isActive"] = 1;				}else{					//..check the deactive date is greater than todays date					if(strtotime($obj->gettbl_table_type_deactive_date()) >= strtotime(date("Y-m-d h:i:s"))){						$info["isActive"] = 1;					}				}*/			}		return $info;		}	}//..End GetInfo}//..End tbl_table_type?>