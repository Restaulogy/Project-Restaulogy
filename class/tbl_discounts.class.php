<?php/**********************************************************************tbl_discounts.class.phpGenerated by STRUCTY 2013.07.31 09:10:10.Copyright 2011 Structy, Frédéric Aebi. All rights reserved.**********************************************************************/define('TBL_DISCOUNTS', 'tbl_discounts'); define('DISCOUNT_ID', 'discount_id'); define('DISCOUNT_NAME', 'discount_name'); define('DISCOUNT_DESC', 'discount_desc'); define('DISCOUNT_PERCENT', 'discount_percent'); define('DISCOUNT_START_DATE', 'discount_start_date'); define('DISCOUNT_END_DATE', 'discount_end_date');define('DISCOUNT_TYPE', 'discount_type');define('DISCOUNT_RESTAURENT', 'discount_restaurent'); define('TBL_DISCOUNTS_ACTIVE_DATE',  DISCOUNT_START_DATE);define('TBL_DISCOUNTS_DEACTIVE_DATE',  DISCOUNT_END_DATE);$tbl_discounts_active_condition= ' ('.TBL_DISCOUNTS_DEACTIVE_DATE.' is NULL OR '.TBL_DISCOUNTS_DEACTIVE_DATE.' = 0 OR '.TBL_DISCOUNTS_DEACTIVE_DATE.' > CURDATE( )) ';class tbl_discounts {	private $discount_id;	private $discount_name;	private $discount_desc;	private $discount_percent;	private $discount_start_date;	private $discount_end_date;		private $discount_type;		private $tbl_discounts_active_date;	private $tbl_discounts_deactive_date;		private $discount_restaurent;	public function setdiscount_id($pArg='0') {$this->discount_id=$pArg;}	public function setdiscount_name($pArg='0') {$this->discount_name=$pArg;}	public function setdiscount_desc($pArg='0') {$this->discount_desc=$pArg;}	public function setdiscount_percent($pArg='0') {$this->discount_percent=$pArg;}	public function setdiscount_start_date($pArg='0') {$this->discount_start_date=$pArg;}	public function setdiscount_end_date($pArg='0') {$this->discount_end_date=$pArg;}	public function settbl_discounts_active_date($pArg='0') {$this->tbl_discounts_active_date=$pArg;}	public function settbl_discounts_deactive_date($pArg='0') {$this->tbl_discounts_deactive_date=$pArg;}		public function setdiscount_type($pArg='0') {$this->discount_type=$pArg;}		public function setdiscount_restaurent($pArg='0') {$this->discount_restaurent=$pArg;}		public function getdiscount_id() {return $this->discount_id;}	public function getdiscount_name() {return $this->discount_name;}	public function getdiscount_desc() {return $this->discount_desc;}	public function getdiscount_percent() {return $this->discount_percent;}	public function getdiscount_start_date() {return $this->discount_start_date;}	public function getdiscount_end_date() {return $this->discount_end_date;}	public function gettbl_discounts_active_date() {return $this->tbl_discounts_active_date;}	public function gettbl_discounts_deactive_date() {return $this->tbl_discounts_deactive_date;}	public function getdiscount_type() {return $this->discount_type;}	public function getdiscount_restaurent() {return $this->discount_restaurent;}	public function readObject($array = array()) {		$qry = "SELECT *".RET."FROM ".TBL_DISCOUNTS.RET;		$and = "WHERE".RET;		if($array[DISCOUNT_ID] != "") {			$qry .= $and.DISCOUNT_ID." = '".$array[DISCOUNT_ID]."'".RET;			$and = "AND".RET;		}		if($array[DISCOUNT_NAME] != "") {			$qry .= $and.DISCOUNT_NAME." = '".$array[DISCOUNT_NAME]."'".RET;			$and = "AND".RET;		}		if($array[DISCOUNT_DESC] != "") {			$qry .= $and.DISCOUNT_DESC." = '".$array[DISCOUNT_DESC]."'".RET;			$and = "AND".RET;		}		if($array[DISCOUNT_PERCENT] != "") {			$qry .= $and.DISCOUNT_PERCENT." = '".$array[DISCOUNT_PERCENT]."'".RET;			$and = "AND".RET;		}		if($array[DISCOUNT_START_DATE] != "") {			$qry .= $and.DISCOUNT_START_DATE." = '".$array[DISCOUNT_START_DATE]."'".RET;			$and = "AND".RET;		}		if($array[DISCOUNT_END_DATE] != "") {			$qry .= $and.DISCOUNT_END_DATE." = '".$array[DISCOUNT_END_DATE]."'".RET;			$and = "AND".RET;		}				if($array[DISCOUNT_TYPE] != "") {			$qry .= $and.DISCOUNT_TYPE." = '".$array[DISCOUNT_TYPE]."'".RET;			$and = "AND".RET;		}				if($array[DISCOUNT_RESTAURENT] != "") {			$qry .= $and.DISCOUNT_RESTAURENT." = '".$array[DISCOUNT_RESTAURENT]."'".RET;			$and = "AND".RET;		}	$result = mysql_query($qry);		if($result) {			while ($row = mysql_fetch_array($result)) {				$record = $row;				break;//end after first record			}			if(count($record[0]) == 0) {				return array();			} else {				$this->setdiscount_id($record[DISCOUNT_ID]);				$this->setdiscount_name($record[DISCOUNT_NAME]);				$this->setdiscount_desc($record[DISCOUNT_DESC]);				$this->setdiscount_percent($record[DISCOUNT_PERCENT]);				$this->setdiscount_type($record[DISCOUNT_TYPE]);				$this->setdiscount_start_date($record[DISCOUNT_START_DATE]);				$this->setdiscount_end_date($record[DISCOUNT_END_DATE]);				$this->settbl_discounts_active_date($record[TBL_DISCOUNTS_ACTIVE_DATE]);				$this->settbl_discounts_deactive_date($record[TBL_DISCOUNTS_DEACTIVE_DATE]);				$this->setdiscount_restaurent($record[DISCOUNT_RESTAURENT]);				return true;			}		}	}	public static function readArray($array = array(),&$result_found=0,$isArray=1) {		global $tbl_discounts_active_condition;		$qry = "SELECT *".RET."FROM ".TBL_DISCOUNTS.RET;		$and = "WHERE".RET;		if($array[DISCOUNT_ID] != "") {			$qry .= $and.DISCOUNT_ID." = '".$array[DISCOUNT_ID]."'".RET;			$and = "AND".RET;		}		if($array[DISCOUNT_NAME] != "") {			$qry .= $and.DISCOUNT_NAME." = '".$array[DISCOUNT_NAME]."'".RET;			$and = "AND".RET;		}		if($array[DISCOUNT_DESC] != "") {			$qry .= $and.DISCOUNT_DESC." = '".$array[DISCOUNT_DESC]."'".RET;			$and = "AND".RET;		}		if($array[DISCOUNT_PERCENT] != "") {			$qry .= $and.DISCOUNT_PERCENT." = '".$array[DISCOUNT_PERCENT]."'".RET;			$and = "AND".RET;		}		if($array[DISCOUNT_START_DATE] != "") {			$qry .= $and.DISCOUNT_START_DATE." = '".$array[DISCOUNT_START_DATE]."'".RET;			$and = "AND".RET;		}		if($array[DISCOUNT_END_DATE] != "") {			$qry .= $and.DISCOUNT_END_DATE." = '".$array[DISCOUNT_END_DATE]."'".RET;			$and = "AND".RET;		}		if(is_gt_zero_num($array["isActive"])) {			$qry .= $and.$tbl_discounts_active_condition;;			$and = "AND".RET;		}				if($array[DISCOUNT_TYPE] != "") {			$qry .= $and.DISCOUNT_TYPE." = '".$array[DISCOUNT_TYPE]."'".RET;			$and = "AND".RET;		}				if($array[DISCOUNT_RESTAURENT] != "") {			$qry .= $and.DISCOUNT_RESTAURENT." = '".$array[DISCOUNT_RESTAURENT]."'".RET;			$and = "AND".RET;		}		if(is_not_empty($array[SORT_ON]) && is_not_empty($array[SORT_BY])) {		$qry .=" ORDER BY ".$array[SORT_ON]." ".$array[SORT_BY];		}		if(is_not_empty($array[OFFSET_TITLE]) && is_not_empty($array[LIMIT_TITLE])) {			$qry_with_limit  = $qry." LIMIT ".$array[OFFSET_TITLE].",".$array[LIMIT_TITLE];		}else{			$qry_with_limit  = $qry;		}		$result = mysql_query ($qry_with_limit);		$r1 = mysql_query($qry);		if($r1){			$result_found = mysql_num_rows($r1);		}		$class_objects = array();		if($result) {			while ($record = mysql_fetch_assoc($result)) {				$isActive= 0;				//..check deactive date is not set or 0				if((is_not_empty($record[TBL_DISCOUNTS_DEACTIVE_DATE])==false) || (is_gt_zero_num(strtotime($record[TBL_DISCOUNTS_DEACTIVE_DATE]))== false)){					$isActive = 1; 				}else{					//..check the deactive date is greater than todays date					if(strtotime($record[TBL_DISCOUNTS_DEACTIVE_DATE]) > strtotime(date(DATE_FORMAT))){						$isActive = 1;					}				}				if($isArray){					$class_object = array();					$class_object['discount_id']=$record[DISCOUNT_ID];					$class_object['discount_name']=$record[DISCOUNT_NAME];					$class_object['discount_desc']=$record[DISCOUNT_DESC];					$class_object['discount_percent']=$record[DISCOUNT_PERCENT];					$class_object['discount_type']=$record[DISCOUNT_TYPE];					$class_object['discount_start_date']=$record[DISCOUNT_START_DATE];					$class_object['discount_end_date']=$record[DISCOUNT_END_DATE];					$class_object['isActive']=$isActive;					$class_object['discount_restaurent']=$record[DISCOUNT_RESTAURENT];				}else{					$class_object = new tbl_discounts();					$class_object->setdiscount_id($record[DISCOUNT_ID]);					$class_object->setdiscount_name($record[DISCOUNT_NAME]);					$class_object->setdiscount_desc($record[DISCOUNT_DESC]);					$class_object->setdiscount_percent($record[DISCOUNT_PERCENT]);					$class_object->setdiscount_type($record[DISCOUNT_TYPE]);										$class_object->setdiscount_start_date($record[DISCOUNT_START_DATE]);					$class_object->setdiscount_end_date($record[DISCOUNT_END_DATE]);					$class_object->setdiscount_restaurent($record[DISCOUNT_RESTAURENT]);				}				$class_objects[$record[DISCOUNT_ID]] = $class_object;			}		}		return $class_objects;	}//..End readArray	public function insert() {		if($this->getdiscount_id() != '') {			$qry  = "UPDATE ".TBL_DISCOUNTS.RET."SET".RET."			".DISCOUNT_ID." = '".$this->getdiscount_id()."',".RET."			".DISCOUNT_NAME." = '".$this->getdiscount_name()."',".RET."			".DISCOUNT_DESC." = '".$this->getdiscount_desc()."',".RET."			".DISCOUNT_PERCENT." = '".$this->getdiscount_percent()."',".RET."			".DISCOUNT_TYPE." = '".$this->getdiscount_type()."',".RET."			".DISCOUNT_RESTAURENT." = '".$_SESSION[SES_RESTAURANT]."',".RET."			".DISCOUNT_START_DATE." = '".$this->getdiscount_start_date()."',".RET."			".DISCOUNT_END_DATE." = '".$this->getdiscount_end_date()."'".RET.			"WHERE ".DISCOUNT_ID." = ".$this->getdiscount_id().RET;			mysql_query($qry);		} else {			$qry  = "INSERT INTO ".TBL_DISCOUNTS." (".RET.			"".DISCOUNT_NAME.", ".DISCOUNT_DESC.", ".DISCOUNT_PERCENT.", ".DISCOUNT_TYPE.", ".DISCOUNT_START_DATE.", ".DISCOUNT_END_DATE.", ".DISCOUNT_RESTAURENT.RET.				") VALUES (".RET.			"'".$this->getdiscount_name()."',".RET.			"'".$this->getdiscount_desc()."',".RET.			"'".$this->getdiscount_percent()."',".RET.			"'".$this->getdiscount_type()."',".RET.			"'".$this->getdiscount_start_date()."',".RET.			"'".$this->getdiscount_end_date()."',".RET.			"'".$_SESSION[SES_RESTAURANT]."'".RET.			")".RET;			$res = mysql_query($qry);			$this->setdiscount_id(mysql_insert_id());		}	}//..End Insert	public static function delete($array = array()) {		$qry = "DELETE".RET."FROM ".TBL_DISCOUNTS.RET;		$and = "WHERE".RET;		if($array[DISCOUNT_ID] != "") {			//$qry .= $and.DISCOUNT_ID." = '".$array[DISCOUNT_ID]."'".RET;			$qry .= $and.DISCOUNT_ID." IN (".$array[DISCOUNT_ID].")".RET;			$and = "AND".RET;		}		if($array[DISCOUNT_NAME] != "") {			$qry .= $and.DISCOUNT_NAME." = '".$array[DISCOUNT_NAME]."'".RET;			$and = "AND".RET;		}		if($array[DISCOUNT_DESC] != "") {			$qry .= $and.DISCOUNT_DESC." = '".$array[DISCOUNT_DESC]."'".RET;			$and = "AND".RET;		}		if($array[DISCOUNT_PERCENT] != "") {			$qry .= $and.DISCOUNT_PERCENT." = '".$array[DISCOUNT_PERCENT]."'".RET;			$and = "AND".RET;		}		if($array[DISCOUNT_START_DATE] != "") {			$qry .= $and.DISCOUNT_START_DATE." = '".$array[DISCOUNT_START_DATE]."'".RET;			$and = "AND".RET;		}		if($array[DISCOUNT_END_DATE] != "") {			$qry .= $and.DISCOUNT_END_DATE." = '".$array[DISCOUNT_END_DATE]."'".RET;			$and = "AND".RET;		}				if($array[DISCOUNT_TYPE] != "") {			$qry .= $and.DISCOUNT_TYPE." = '".$array[DISCOUNT_TYPE]."'".RET;			$and = "AND".RET;		}		if($array[DISCOUNT_RESTAURENT] != "") {			$qry .= $and.DISCOUNT_RESTAURENT." = '".$array[DISCOUNT_RESTAURENT]."'".RET;			$and = "AND".RET;		}		$res = mysql_query($qry);		if($res){			return OPERATION_SUCCESS;		};		return OPERATION_FAIL;	}//..End Delete	public function isAlreadyThere($discount_name ,$discount_desc ,$discount_percent ,$discount_start_date ,$discount_end_date) {		$unique_arr = array();			//$unique_arr[DISCOUNT_ID]=$discount_id;			$unique_arr[DISCOUNT_NAME]=$discount_name;			$unique_arr[DISCOUNT_RESTAURENT]=$_SESSION[SES_RESTAURANT];			//$unique_arr[DISCOUNT_DESC]=$discount_desc;			//$unique_arr[DISCOUNT_PERCENT]=$discount_percent;			//$unique_arr[DISCOUNT_START_DATE]=$discount_start_date;			//$unique_arr[DISCOUNT_END_DATE]=$discount_end_date;		if(is_not_empty($unique_arr)){			return $this->readObject($unique_arr);		}		return false;	}//..isAlreadyThere	public function create($discount_name ,$discount_desc ,$discount_percent,$discount_type ,$discount_start_date ,$discount_end_date) {		if(is_not_empty($discount_name)){			if($this->isAlreadyThere($discount_name ,$discount_desc ,$discount_percent ,$discount_start_date ,$discount_end_date)){				return OPERATION_DUPLICATE;			}else{				$this->setdiscount_id("");				$this->setdiscount_name($discount_name);				$this->setdiscount_desc($discount_desc);				$this->setdiscount_percent($discount_percent);				$this->setdiscount_type($discount_type);				$this->setdiscount_start_date(date(DATE_FORMAT));				$this->insert();				return $this->getdiscount_id();			}		}		return OPERATION_FAIL;	}//..create	public function update($discount_id, $discount_name, $discount_desc, $discount_percent,$discount_type, $discount_start_date, $discount_end_date) {		if(is_gt_zero_num($discount_id)){			if ($this->readObject(array(DISCOUNT_ID=>$discount_id))){				$this->setdiscount_name($discount_name);				$this->setdiscount_desc($discount_desc);				$this->setdiscount_percent($discount_percent);				$this->setdiscount_type($discount_type);				$this->insert();				return OPERATION_SUCCESS;			}		}		return OPERATION_FAIL;	}//..update	public function activate($discount_id){		if(is_gt_zero_num($discount_id)){			if ($this->readObject(array(DISCOUNT_ID=>$discount_id))){				$qry  = "UPDATE ".TBL_DISCOUNTS.RET."SET".RET."			".TBL_DISCOUNTS_DEACTIVE_DATE." = '".date(EMPTY_DATE_FORMAT)."' WHERE ".DISCOUNT_ID."={$discount_id}";				$res = mysql_query($qry);				if($res){					return 1;				}			}		}		return 0;	}//..end activate	public function deactivate($discount_id){		if(is_gt_zero_num($discount_id)){			if ($this->readObject(array(DISCOUNT_ID=>$discount_id))){				$qry  = "UPDATE ".TBL_DISCOUNTS.RET."SET".RET."			".TBL_DISCOUNTS_DEACTIVE_DATE." = '".date(DATE_FORMAT)."' WHERE ".DISCOUNT_ID."={$discount_id}";				$res = mysql_query($qry);				if($res){					return 1;				}			}		}		return 0;	}//..end deactivate	public static function GetInfo($discount_id) {		$info = array();		if($discount_id != ""){			$obj_tbl_discounts = new tbl_discounts();			if($obj_tbl_discounts->readObject(array("discount_id"=>$discount_id))){				$info["discount_id"]=$obj_tbl_discounts->getdiscount_id();				$info["discount_name"]=$obj_tbl_discounts->getdiscount_name();				$info["discount_desc"]=$obj_tbl_discounts->getdiscount_desc();				$info["discount_percent"]=$obj_tbl_discounts->getdiscount_percent();				$info["discount_type"]=$obj_tbl_discounts->getdiscount_type();								$info["discount_start_date"]=$obj_tbl_discounts->getdiscount_start_date();				$info["discount_end_date"]=$obj_tbl_discounts->getdiscount_end_date();				$info["isActive"] = 0;				$info["discount_restaurent"]=$obj_tbl_discounts->getdiscount_restaurent();				//..check deactive date is not set or 0				if((is_not_empty($obj_tbl_discounts->gettbl_discounts_deactive_date())==false)  || (is_gt_zero_num(strtotime($obj_tbl_discounts->gettbl_discounts_deactive_date()))== false)){					$info["isActive"] = 1;				}else{					//..check the deactive date is greater than todays date					if(strtotime($obj_tbl_discounts->gettbl_discounts_deactive_date()) > strtotime(date(DATE_FORMAT))){						$info["isActive"] = 1;					}				}			}		unset($obj_tbl_discounts);		return $info;		}	}//..End GetInfo	public static function GetFields($data){		global $tbl_discounts_active_condition;		$arr = array();		if(is_not_empty($data)){			$qry ="SELECT ".$data['key_field'].",".$data['value_field']." FROM ".TBL_DISCOUNTS."";			if(is_gt_zero_num($data['isActive'])){				$qry .= " WHERE ".$tbl_discounts_active_condition;			}			$res = mysql_query($qry); 			if($res){				while($row=mysql_fetch_assoc($res)){					$arr[$row[$data['key_field']]] = $row[$data['value_field']];				}			}		}		return $arr;	}//.. End of GetFields}//..End tbl_discounts?>