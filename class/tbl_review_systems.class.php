<?php/**********************************************************************tbl_review_systems.class.phpGenerated by STRUCTY 2014.11.11 10:17:43.Copyright 2011 Structy, Frédéric Aebi. All rights reserved.**********************************************************************/define("TBL_REVIEW_SYSTEMS", "tbl_review_systems"); define('REV_SYS_ID', 'rev_sys_id'); define('REV_SYS_RESTAURANT', 'rev_sys_restaurant'); define('REV_SYS_YELP', 'rev_sys_yelp'); define('REV_SYS_TRIPADVISOR', 'rev_sys_tripadvisor'); define('REV_SYS_URBANSPOON', 'rev_sys_urbanspoon'); define('REV_SYS_GOOGLE', 'rev_sys_google'); define("TBL_REVIEW_SYSTEMS_ACTIVE_DATE",  "");define("TBL_REVIEW_SYSTEMS_DEACTIVE_DATE",  "");$tbl_review_systems_active_condition= " (".TBL_REVIEW_SYSTEMS_DEACTIVE_DATE." is NULL OR ".TBL_REVIEW_SYSTEMS_DEACTIVE_DATE." = 0 OR ".TBL_REVIEW_SYSTEMS_DEACTIVE_DATE." > CURDATE( )) ";class tbl_review_systems {	private $rev_sys_id;	private $rev_sys_restaurant;	private $rev_sys_yelp;	private $rev_sys_tripadvisor;	private $rev_sys_urbanspoon;	private $rev_sys_google;	private $tbl_review_systems_active_date;	private $tbl_review_systems_deactive_date;	public function setrev_sys_id($pArg="0") {$this->rev_sys_id=$pArg;}	public function setrev_sys_restaurant($pArg="0") {$this->rev_sys_restaurant=$pArg;}	public function setrev_sys_yelp($pArg="0") {$this->rev_sys_yelp=$pArg;}	public function setrev_sys_tripadvisor($pArg="0") {$this->rev_sys_tripadvisor=$pArg;}	public function setrev_sys_urbanspoon($pArg="0") {$this->rev_sys_urbanspoon=$pArg;}	public function setrev_sys_google($pArg="0") {$this->rev_sys_google=$pArg;}	public function settbl_review_systems_active_date($pArg="0") {$this->tbl_review_systems_active_date=$pArg;}	public function settbl_review_systems_deactive_date($pArg="0") {$this->tbl_review_systems_deactive_date=$pArg;}	public function getrev_sys_id() {return $this->rev_sys_id;}	public function getrev_sys_restaurant() {return $this->rev_sys_restaurant;}	public function getrev_sys_yelp() {return $this->rev_sys_yelp;}	public function getrev_sys_tripadvisor() {return $this->rev_sys_tripadvisor;}	public function getrev_sys_urbanspoon() {return $this->rev_sys_urbanspoon;}	public function getrev_sys_google() {return $this->rev_sys_google;}	public function gettbl_review_systems_active_date($pArg="0") {return $this->tbl_review_systems_active_date;}	public function gettbl_review_systems_deactive_date($pArg="0") {return $this->tbl_review_systems_deactive_date;}	public function readObject($array = array()) {		$qry = "SELECT *".RET."FROM ".TBL_REVIEW_SYSTEMS.RET;		$and = "WHERE".RET;		if($array[REV_SYS_ID] != "") {			$qry .= $and.REV_SYS_ID." = '".$array[REV_SYS_ID]."'".RET;			$and = "AND".RET;		}		if($array[REV_SYS_RESTAURANT] != "") {			$qry .= $and.REV_SYS_RESTAURANT." = '".$array[REV_SYS_RESTAURANT]."'".RET;			$and = "AND".RET;		}		if($array[REV_SYS_YELP] != "") {			$qry .= $and.REV_SYS_YELP." = '".$array[REV_SYS_YELP]."'".RET;			$and = "AND".RET;		}		if($array[REV_SYS_TRIPADVISOR] != "") {			$qry .= $and.REV_SYS_TRIPADVISOR." = '".$array[REV_SYS_TRIPADVISOR]."'".RET;			$and = "AND".RET;		}		if($array[REV_SYS_URBANSPOON] != "") {			$qry .= $and.REV_SYS_URBANSPOON." = '".$array[REV_SYS_URBANSPOON]."'".RET;			$and = "AND".RET;		}		if($array[REV_SYS_GOOGLE] != "") {			$qry .= $and.REV_SYS_GOOGLE." = '".$array[REV_SYS_GOOGLE]."'".RET;			$and = "AND".RET;		}	$result = mysql_query($qry);		if($result) {			while ($row = mysql_fetch_array($result)) {				$record = $row;				break;//end after first record			}			if(count($record[0]) == 0) {				return array();			} else {				$this->setrev_sys_id($record[REV_SYS_ID]);				$this->setrev_sys_restaurant($record[REV_SYS_RESTAURANT]);				$this->setrev_sys_yelp($record[REV_SYS_YELP]);				$this->setrev_sys_tripadvisor($record[REV_SYS_TRIPADVISOR]);				$this->setrev_sys_urbanspoon($record[REV_SYS_URBANSPOON]);				$this->setrev_sys_google($record[REV_SYS_GOOGLE]);				$this->settbl_review_systems_active_date($record[TBL_REVIEW_SYSTEMS_ACTIVE_DATE]);				$this->settbl_review_systems_deactive_date($record[TBL_REVIEW_SYSTEMS_DEACTIVE_DATE]);				return true;			}		}	}	public static function readArray($array = array(),&$result_found=0,$isArray=1) {		global $tbl_review_systems_active_condition;		$qry = "SELECT *".RET."FROM ".TBL_REVIEW_SYSTEMS.RET;		$and = "WHERE".RET;		if($array[REV_SYS_ID] != "") {			$qry .= $and.REV_SYS_ID." = '".$array[REV_SYS_ID]."'".RET;			$and = "AND".RET;		}		if($array[REV_SYS_RESTAURANT] != "") {			$qry .= $and.REV_SYS_RESTAURANT." = '".$array[REV_SYS_RESTAURANT]."'".RET;			$and = "AND".RET;		}		if($array[REV_SYS_YELP] != "") {			$qry .= $and.REV_SYS_YELP." = '".$array[REV_SYS_YELP]."'".RET;			$and = "AND".RET;		}		if($array[REV_SYS_TRIPADVISOR] != "") {			$qry .= $and.REV_SYS_TRIPADVISOR." = '".$array[REV_SYS_TRIPADVISOR]."'".RET;			$and = "AND".RET;		}		if($array[REV_SYS_URBANSPOON] != "") {			$qry .= $and.REV_SYS_URBANSPOON." = '".$array[REV_SYS_URBANSPOON]."'".RET;			$and = "AND".RET;		}		if($array[REV_SYS_GOOGLE] != "") {			$qry .= $and.REV_SYS_GOOGLE." = '".$array[REV_SYS_GOOGLE]."'".RET;			$and = "AND".RET;		}		if(is_gt_zero_num($array["isActive"])) {			$qry .= $and.$tbl_review_systems_active_condition;;			$and = "AND".RET;		}		if(is_not_empty($array[SORT_ON]) && is_not_empty($array[SORT_BY])) {		$qry .=" ORDER BY ".$array[SORT_ON]." ".$array[SORT_BY];		}		if(is_not_empty($array[OFFSET_TITLE]) && is_not_empty($array[LIMIT_TITLE])) {			$qry_with_limit  = $qry." LIMIT ".$array[OFFSET_TITLE].",".$array[LIMIT_TITLE];		}else{			$qry_with_limit  = $qry;		}		$result = mysql_query ($qry_with_limit);		$r1 = mysql_query($qry);		if($r1){			$result_found = mysql_num_rows($r1);		}		$class_objects = array();		if($result) {			while ($record = mysql_fetch_assoc($result)) {				$isActive= 0;				//..check deactive date is not set or 0				if((is_not_empty($record[TBL_REVIEW_SYSTEMS_DEACTIVE_DATE])==false) || (is_gt_zero_num(strtotime($record[TBL_REVIEW_SYSTEMS_DEACTIVE_DATE]))== false)){					$isActive = 1; 				}else{					//..check the deactive date is greater than todays date					if(strtotime($record[TBL_REVIEW_SYSTEMS_DEACTIVE_DATE]) > strtotime(date(DATE_FORMAT))){						$isActive = 1;					}				}				if($isArray){					$class_object = array();					$class_object["rev_sys_id"]=$record[REV_SYS_ID];					$class_object["rev_sys_restaurant"]=$record[REV_SYS_RESTAURANT];					$class_object["rev_sys_yelp"]=$record[REV_SYS_YELP];					$class_object["rev_sys_tripadvisor"]=$record[REV_SYS_TRIPADVISOR];					$class_object["rev_sys_urbanspoon"]=$record[REV_SYS_URBANSPOON];					$class_object["rev_sys_google"]=$record[REV_SYS_GOOGLE];					$class_object["isActive"]=$isActive;				}else{					$class_object = new tbl_review_systems();					$class_object->setrev_sys_id($record[REV_SYS_ID]);					$class_object->setrev_sys_restaurant($record[REV_SYS_RESTAURANT]);					$class_object->setrev_sys_yelp($record[REV_SYS_YELP]);					$class_object->setrev_sys_tripadvisor($record[REV_SYS_TRIPADVISOR]);					$class_object->setrev_sys_urbanspoon($record[REV_SYS_URBANSPOON]);					$class_object->setrev_sys_google($record[REV_SYS_GOOGLE]);				}				$class_objects[$record[REV_SYS_ID]] = $class_object;			}		}		return $class_objects;	}//..End readArray	public function insert() {		if($this->getrev_sys_id() != '') {			$qry  = "UPDATE ".TBL_REVIEW_SYSTEMS.RET."SET".RET."			".REV_SYS_ID." = '".$this->getrev_sys_id()."',".RET."			".REV_SYS_RESTAURANT." = '".$this->getrev_sys_restaurant()."',".RET."			".REV_SYS_YELP." = '".$this->getrev_sys_yelp()."',".RET."			".REV_SYS_TRIPADVISOR." = '".$this->getrev_sys_tripadvisor()."',".RET."			".REV_SYS_URBANSPOON." = '".$this->getrev_sys_urbanspoon()."',".RET."			".REV_SYS_GOOGLE." = '".$this->getrev_sys_google()."'".RET.			"WHERE ".REV_SYS_ID." = ".$this->getrev_sys_id().RET;			mysql_query($qry);		} else {			$qry  = "INSERT INTO ".TBL_REVIEW_SYSTEMS." (".RET.			"".REV_SYS_RESTAURANT.", ".REV_SYS_YELP.", ".REV_SYS_TRIPADVISOR.", ".REV_SYS_URBANSPOON.", ".REV_SYS_GOOGLE.RET.				") VALUES (".RET.			"'".$this->getrev_sys_restaurant()."',".RET.			"'".$this->getrev_sys_yelp()."',".RET.			"'".$this->getrev_sys_tripadvisor()."',".RET.			"'".$this->getrev_sys_urbanspoon()."',".RET.			"'".$this->getrev_sys_google()."'".RET.			")".RET;			$res = mysql_query($qry);			$this->setrev_sys_id(mysql_insert_id());		}	}//..End Insert	public static function delete($array = array()) {		$qry = "DELETE".RET."FROM ".TBL_REVIEW_SYSTEMS.RET;		$and = "WHERE".RET;		if($array[REV_SYS_ID] != "") {			$qry .= $and.REV_SYS_ID." = '".$array[REV_SYS_ID]."'".RET;			$and = "AND".RET;		}		if($array[REV_SYS_RESTAURANT] != "") {			$qry .= $and.REV_SYS_RESTAURANT." = '".$array[REV_SYS_RESTAURANT]."'".RET;			$and = "AND".RET;		}		if($array[REV_SYS_YELP] != "") {			$qry .= $and.REV_SYS_YELP." = '".$array[REV_SYS_YELP]."'".RET;			$and = "AND".RET;		}		if($array[REV_SYS_TRIPADVISOR] != "") {			$qry .= $and.REV_SYS_TRIPADVISOR." = '".$array[REV_SYS_TRIPADVISOR]."'".RET;			$and = "AND".RET;		}		if($array[REV_SYS_URBANSPOON] != "") {			$qry .= $and.REV_SYS_URBANSPOON." = '".$array[REV_SYS_URBANSPOON]."'".RET;			$and = "AND".RET;		}		if($array[REV_SYS_GOOGLE] != "") {			$qry .= $and.REV_SYS_GOOGLE." = '".$array[REV_SYS_GOOGLE]."'".RET;			$and = "AND".RET;		}		$res = mysql_query($qry);		if($res){			return OPERATION_SUCCESS;		};		return OPERATION_FAIL;	}//..End Delete	public function isAlreadyThere($rev_sys_restaurant ,$rev_sys_yelp ,$rev_sys_tripadvisor ,$rev_sys_urbanspoon ,$rev_sys_google) {		$unique_arr = array();			//$unique_arr[REV_SYS_ID]=$rev_sys_id;			//$unique_arr[REV_SYS_RESTAURANT]=$rev_sys_restaurant;			//$unique_arr[REV_SYS_YELP]=$rev_sys_yelp;			//$unique_arr[REV_SYS_TRIPADVISOR]=$rev_sys_tripadvisor;			//$unique_arr[REV_SYS_URBANSPOON]=$rev_sys_urbanspoon;			//$unique_arr[REV_SYS_GOOGLE]=$rev_sys_google;		if(is_not_empty($unique_arr)){			return $this->readObject($unique_arr);		}		return false;	}//..isAlreadyThere	public function create($rev_sys_restaurant ,$rev_sys_yelp ,$rev_sys_tripadvisor ,$rev_sys_urbanspoon ,$rev_sys_google) {		if(is_not_empty($rev_sys_restaurant)){			if($this->isAlreadyThere($rev_sys_restaurant ,$rev_sys_yelp ,$rev_sys_tripadvisor ,$rev_sys_urbanspoon ,$rev_sys_google)){				return OPERATION_DUPLICATE;			}else{				$this->setrev_sys_id("");				$this->setrev_sys_restaurant($rev_sys_restaurant);				$this->setrev_sys_yelp($rev_sys_yelp);				$this->setrev_sys_tripadvisor($rev_sys_tripadvisor);				$this->setrev_sys_urbanspoon($rev_sys_urbanspoon);				$this->setrev_sys_google($rev_sys_google);				$this->insert();				return $this->getrev_sys_id();			}		}		return OPERATION_FAIL;	}//..create	public function update($rev_sys_id, $rev_sys_restaurant, $rev_sys_yelp, $rev_sys_tripadvisor, $rev_sys_urbanspoon, $rev_sys_google) {		if(is_gt_zero_num($rev_sys_id)){			if ($this->readObject(array(REV_SYS_ID=>$rev_sys_id))){				$this->setrev_sys_restaurant($rev_sys_restaurant);				$this->setrev_sys_yelp($rev_sys_yelp);				$this->setrev_sys_tripadvisor($rev_sys_tripadvisor);				$this->setrev_sys_urbanspoon($rev_sys_urbanspoon);				$this->setrev_sys_google($rev_sys_google);				$this->insert();				return OPERATION_SUCCESS;			}		}		return OPERATION_FAIL;	}//..update	public function activate($rev_sys_id){		if(is_gt_zero_num($rev_sys_id)){			if ($this->readObject(array(REV_SYS_ID=>$rev_sys_id))){				$qry  = "UPDATE ".TBL_REVIEW_SYSTEMS.RET."SET".RET."			".TBL_REVIEW_SYSTEMS_DEACTIVE_DATE." = '".date(EMPTY_DATE_FORMAT)."' WHERE ".REV_SYS_ID."={$rev_sys_id}";				$res = mysql_query($qry);				if($res){					return 1;				}			}		}		return 0;	}//..end activate	public function deactivate($rev_sys_id){		if(is_gt_zero_num($rev_sys_id)){			if ($this->readObject(array(REV_SYS_ID=>$rev_sys_id))){				$qry  = "UPDATE ".TBL_REVIEW_SYSTEMS.RET."SET".RET."			".TBL_REVIEW_SYSTEMS_DEACTIVE_DATE." = '".date(DATE_FORMAT)."' WHERE ".REV_SYS_ID."={$rev_sys_id}";				$res = mysql_query($qry);				if($res){					return 1;				}			}		}		return 0;	}//..end deactivate	public static function GetInfo($rev_sys_restaurant) {		$info = array();		if($rev_sys_restaurant != ""){			$obj_tbl_review_systems = new tbl_review_systems();			if($obj_tbl_review_systems->readObject(array("rev_sys_restaurant"=>$rev_sys_restaurant))){				$info["rev_sys_id"]=$obj_tbl_review_systems->getrev_sys_id();				$info["rev_sys_restaurant"]=$obj_tbl_review_systems->getrev_sys_restaurant();				if(is_not_empty($obj_tbl_review_systems->getrev_sys_yelp())){					$info["rev_sys_yelp"]=preg_replace('#^https?://#', '', rtrim($obj_tbl_review_systems->getrev_sys_yelp(),'/'));				}					if(is_not_empty($obj_tbl_review_systems->getrev_sys_tripadvisor())){					$info["rev_sys_tripadvisor"]=preg_replace('#^https?://#', '', rtrim($obj_tbl_review_systems->getrev_sys_tripadvisor(),'/'));				}					if(is_not_empty($obj_tbl_review_systems->getrev_sys_urbanspoon())){					$info["rev_sys_urbanspoon"]=preg_replace('#^https?://#', '', rtrim($obj_tbl_review_systems->getrev_sys_urbanspoon(),'/'));				}					if(is_not_empty($obj_tbl_review_systems->getrev_sys_google())){					$info["rev_sys_google"]=preg_replace('#^https?://#', '', rtrim($obj_tbl_review_systems->getrev_sys_google(),'/'));				}								/*$info["rev_sys_yelp"]=$obj_tbl_review_systems->getrev_sys_yelp();				$info["rev_sys_tripadvisor"]=$obj_tbl_review_systems->getrev_sys_tripadvisor();				$info["rev_sys_urbanspoon"]=$obj_tbl_review_systems->getrev_sys_urbanspoon();				$info["rev_sys_google"]=$obj_tbl_review_systems->getrev_sys_google();*/				$info["isActive"] = 0;				//..check deactive date is not set or 0				if((is_not_empty($obj_tbl_review_systems->gettbl_review_systems_deactive_date())==false)  || (is_gt_zero_num(strtotime($obj_tbl_review_systems->gettbl_review_systems_deactive_date()))== false)){					$info["isActive"] = 1;				}else{					//..check the deactive date is greater than todays date					if(strtotime($obj_tbl_review_systems->gettbl_review_systems_deactive_date()) > strtotime(date(DATE_FORMAT))){						$info["isActive"] = 1;					}				}			}		unset($obj_tbl_review_systems);		return $info;		}	}//..End GetInfo	public static function GetFields($data){		global $tbl_review_systems_active_condition;		$arr = array();		if(is_not_empty($data)){			$qry ="SELECT ".$data['key_field'].",".$data['value_field']." FROM ".TBL_REVIEW_SYSTEMS."";			if(is_gt_zero_num($data['isActive'])){				$qry .= " WHERE ".$tbl_review_systems_active_condition;			}			$res = mysql_query($qry); 			if($res){				while($row=mysql_fetch_assoc($res)){					$arr[$row[$data['key_field']]] = $row[$data['value_field']];				}			}		}		return $arr;	}//.. End of GetFields}//..End tbl_review_systems?>