<?php/**********************************************************************tbl_feedback.class.phpGenerated by STRUCTY 2013.04.01 10:25:55.Copyright 2011 Structy, Frédéric Aebi. All rights reserved.**********************************************************************/define('TBL_FEEDBACK', 'tbl_feedback'); define('ID', 'id'); define('POST_ID', 'post_id'); define('POST_TITLE', 'post_title'); define('POST_TYPE', 'post_type'); define('USER_ID', 'user_id');define('USER_TYPE', 'user_type');  define('RECOMM_TITLE', 'recomm_title'); define('RECOMM_DESC', 'recomm_desc'); define('RECOMM_RATING', 'recomm_rating'); define('RECOMM_QOS_RATING', 'recomm_QOS_rating'); define('RECOMM_QOF_RATING', 'recomm_QOF_rating'); define('RECOMM_AMBIENCE_RATING', 'recomm_ambience_rating'); define('RECOMM_EMAIL', 'recomm_email');define('RECOMM_PHONE', 'recomm_phone');define('RECOMM_TABLE', 'recomm_table');define('START_DATE', 'start_date'); define('END_DATE', 'end_date');define('FDBK_RESTAURENT', 'fdbk_restaurent');  define('DFLT_FEEDBACK_TYPE', 'Business');define('TBL_FEEDBACK_ACTIVE_DATE', 'start_date');define('TBL_FEEDBACK_DEACTIVE_DATE', 'end_date');$tbl_feedback_active_condition= ' ('.TBL_FEEDBACK_DEACTIVE_DATE.' is NULL OR '.TBL_FEEDBACK_DEACTIVE_DATE.' = 0) '; class tbl_feedback {	 const PST_TYP_BIZ 			 = 'Business';		 const PST_TYP_CUPON 		 = 'Promotions'; const PST_TYP_MNU 			 = 'Menu'; const PST_TYP_SUBMNU 		 = 'SubMenu'; const PST_TYP_SUBMNUDISH = 'SubMenuDish'; const PST_TYP_SUBMNUITM  = 'SubMenuDishItem'; 	private $id;	private $post_id;	private $post_title;	private $post_type;	private $user_id;	private $user_type;	private $recomm_title;	private $recomm_desc;	private $recomm_rating;	private $recomm_QOS_rating;	private $recomm_QOF_rating;	private $recomm_ambience_rating;	private $start_date;	private $end_date;		private $recomm_email;	private $recomm_phone;	private $recomm_table;			private $fdbk_restaurent;		private $tbl_feedback_active_date;	private $tbl_feedback_deactive_date;	 	public function setid($pArg='0') {$this->id=$pArg;}	public function setpost_id($pArg='0') {$this->post_id=$pArg;}	public function setpost_title($pArg='0') {$this->post_title=$pArg;}	public function setpost_type($pArg='0') {$this->post_type=$pArg;}	public function setuser_id($pArg='0') {$this->user_id=$pArg;}	public function setuser_type($pArg='0') {$this->user_type=$pArg;}	public function setrecomm_title($pArg='0') {$this->recomm_title=$pArg;}	public function setrecomm_desc($pArg='0') {$this->recomm_desc=$pArg;}	public function setrecomm_rating($pArg='0') {$this->recomm_rating=$pArg;}	public function setrecomm_QOS_rating($pArg='0') {$this->recomm_QOS_rating=$pArg;}	public function setrecomm_QOF_rating($pArg='0') {$this->recomm_QOF_rating=$pArg;}	public function setrecomm_ambience_rating($pArg='0') {$this->recomm_ambience_rating=$pArg;}		public function setrecomm_email($pArg='0') {$this->recomm_email=$pArg;}	public function setrecomm_phone($pArg='0') {$this->recomm_phone=$pArg;}	public function setrecomm_table($pArg='0') {$this->recomm_table=$pArg;}		public function setstart_date($pArg='0') {$this->start_date=$pArg;}	public function setend_date($pArg='0') {$this->end_date=$pArg;}	public function settbl_feedback_active_date($pArg='0') {$this->tbl_feedback_active_date=$pArg;}	public function settbl_feedback_deactive_date($pArg='0') {$this->tbl_feedback_deactive_date=$pArg;}		public function setfdbk_restaurent($pArg='0') {$this->fdbk_restaurent=$pArg;}	public function getid() {return $this->id;}	public function getpost_id() {return $this->post_id;}	public function getpost_title() {return $this->post_title;}	public function getpost_type() {return $this->post_type;}	public function getuser_id() {return $this->user_id;}	public function getuser_type() {return $this->user_type;}	public function getrecomm_title() {return $this->recomm_title;}	public function getrecomm_desc() {return $this->recomm_desc;}	public function getrecomm_rating() {return $this->recomm_rating;}	public function getrecomm_QOS_rating() {return $this->recomm_QOS_rating;}	public function getrecomm_QOF_rating() {return $this->recomm_QOF_rating;}	public function getrecomm_ambience_rating() {return $this->recomm_ambience_rating;}		public function getrecomm_email() {return $this->recomm_email;}	public function getrecomm_phone() {return $this->recomm_phone;}	public function getrecomm_table() {return $this->recomm_table;}		public function getstart_date() {return $this->start_date;}	public function getend_date() {return $this->end_date;}	public function gettbl_feedback_active_date() {return $this->tbl_feedback_active_date;}	public function gettbl_feedback_deactive_date() {return $this->tbl_feedback_deactive_date;}		public function getfdbk_restaurent() {return $this->fdbk_restaurent;}	public function readObject($array = array()) {		$qry = "SELECT *".RET."FROM ".TBL_FEEDBACK.RET;		$and = "WHERE".RET;		if($array[ID] != "") {			$qry .= $and.ID." = '".$array[ID]."'".RET;			$and = "AND".RET;		}		if($array[POST_ID] != "") {			$qry .= $and.POST_ID." = '".$array[POST_ID]."'".RET;			$and = "AND".RET;		}		if($array[POST_TITLE] != "") {			$qry .= $and.POST_TITLE." = '".$array[POST_TITLE]."'".RET;			$and = "AND".RET;		}		if($array[POST_TYPE] != "") {			$qry .= $and.POST_TYPE." = '".$array[POST_TYPE]."'".RET;			$and = "AND".RET;		}		if($array[USER_ID] != "") {			$qry .= $and.USER_ID." = '".$array[USER_ID]."'".RET;			$and = "AND".RET;		}				if($array[USER_TYPE] != "") {			$qry .= $and.USER_TYPE." = '".$array[USER_TYPE]."'".RET;			$and = "AND".RET;		}		if($array[RECOMM_TITLE] != "") {			$qry .= $and.RECOMM_TITLE." = '".$array[RECOMM_TITLE]."'".RET;			$and = "AND".RET;		}		if($array[RECOMM_DESC] != "") {			$qry .= $and.RECOMM_DESC." = '".$array[RECOMM_DESC]."'".RET;			$and = "AND".RET;		}		if($array[RECOMM_RATING] != "") {			$qry .= $and.RECOMM_RATING." = '".$array[RECOMM_RATING]."'".RET;			$and = "AND".RET;		}		if($array[RECOMM_QOS_RATING] != "") {			$qry .= $and.RECOMM_QOS_RATING." = '".$array[RECOMM_QOS_RATING]."'".RET;			$and = "AND".RET;		}		if($array[RECOMM_QOF_RATING] != "") {			$qry .= $and.RECOMM_QOF_RATING." = '".$array[RECOMM_QOF_RATING]."'".RET;			$and = "AND".RET;		}		if($array[RECOMM_AMBIENCE_RATING] != "") {			$qry .= $and.RECOMM_AMBIENCE_RATING." = '".$array[RECOMM_AMBIENCE_RATING]."'".RET;			$and = "AND".RET;		}				if($array[RECOMM_PHONE] != "") {			$qry .= $and.RECOMM_PHONE." = '".$array[RECOMM_PHONE]."'".RET;			$and = "AND".RET;		}				if($array[RECOMM_EMAIL] != "") {			$qry .= $and.RECOMM_EMAIL." = '".$array[RECOMM_EMAIL]."'".RET;			$and = "AND".RET;		}				if($array[RECOMM_TABLE] != "") {			$qry .= $and.RECOMM_TABLE." = '".$array[RECOMM_TABLE]."'".RET;			$and = "AND".RET;		}		if($array[START_DATE] != "") {			$qry .= $and.START_DATE." = '".$array[START_DATE]."'".RET;			$and = "AND".RET;		}		if($array[END_DATE] != "") {			$qry .= $and.END_DATE." = '".$array[END_DATE]."'".RET;			$and = "AND".RET;		}				if($array[FDBK_RESTAURENT] != "") {			$qry .= $and.FDBK_RESTAURENT." = '".$array[FDBK_RESTAURENT]."'".RET;			$and = "AND".RET;		}	  $result = mysql_query($qry);		if($result) {			while ($row = mysql_fetch_array($result)) {				$record = $row;				break;//end after first record			}			if(count($record[0]) == 0) {				return array();			} else {				$this->setid($record[ID]);				$this->setpost_id($record[POST_ID]);				$this->setpost_title($record[POST_TITLE]);				$this->setpost_type($record[POST_TYPE]);				$this->setuser_id($record[USER_ID]);				$this->setuser_type($record[USER_TYPE]);				$this->setrecomm_title($record[RECOMM_TITLE]);				$this->setrecomm_desc($record[RECOMM_DESC]);				$this->setrecomm_rating($record[RECOMM_RATING]);				$this->setrecomm_QOS_rating($record[RECOMM_QOS_RATING]);				$this->setrecomm_QOF_rating($record[RECOMM_QOF_RATING]);				$this->setrecomm_ambience_rating($record[RECOMM_AMBIENCE_RATING]);								$this->setrecomm_email($record[RECOMM_EMAIL]);				$this->setrecomm_phone($record[RECOMM_PHONE]);				$this->setrecomm_table($record[RECOMM_TABLE]);												$this->setstart_date($record[START_DATE]);				$this->setend_date($record[END_DATE]);				$this->settbl_feedback_active_date($record[TBL_FEEDBACK_ACTIVE_DATE]);				$this->settbl_feedback_deactive_date($record[TBL_FEEDBACK_DEACTIVE_DATE]);				$this->setfdbk_restaurent($record[FDBK_RESTAURENT]);				return true;			}		}	}	public static function readArray($array = array(),&$result_found=0,$isArray=1) {		global $tbl_feedback_active_condition;		$qry = "SELECT *, 		(		CASE ".USER_TYPE." WHEN '".CUST_TYPE_COOKIE."' THEN (		SELECT `devck_customer` FROM `tbl_device_cookies` WHERE `devck_id` = ".USER_ID."		) ELSE  (		SELECT CONCAT(`staff_fname`,' ',`staff_lname`) FROM `tbl_staff` WHERE `staff_member_id` = ".USER_ID." AND `staff_restaurent` = ".$_SESSION[SES_RESTAURANT]."		) 		END) `customer_name`,		(SELECT `table_number` FROM `tbl_dining_table` WHERE `table_id`=`recomm_table`) as `tbl_number` ".RET."FROM ".TBL_FEEDBACK.RET;		$and = "WHERE".RET;		if($array[ID] != "") {			$qry .= $and.ID." = '".$array[ID]."'".RET;			$and = "AND".RET;		}		if($array[POST_ID] != "") {			$qry .= $and.POST_ID." = '".$array[POST_ID]."'".RET;			$and = "AND".RET;		}		if($array[POST_TITLE] != "") {			$qry .= $and.POST_TITLE." = '".$array[POST_TITLE]."'".RET;			$and = "AND".RET;		}		if($array[POST_TYPE] != "") {			$qry .= $and.POST_TYPE." = '".$array[POST_TYPE]."'".RET;			$and = "AND".RET;		}		if($array[USER_ID] != "") {			$qry .= $and.USER_ID." = '".$array[USER_ID]."'".RET;			$and = "AND".RET;		}				if($array[USER_TYPE] != "") {			$qry .= $and.USER_TYPE." = '".$array[USER_TYPE]."'".RET;			$and = "AND".RET;		}		if($array[RECOMM_TITLE] != "") {			$qry .= $and.RECOMM_TITLE." = '".$array[RECOMM_TITLE]."'".RET;			$and = "AND".RET;		}		if($array[RECOMM_DESC] != "") {			$qry .= $and.RECOMM_DESC." = '".$array[RECOMM_DESC]."'".RET;			$and = "AND".RET;		}		if($array[RECOMM_RATING] != "") {			$qry .= $and.RECOMM_RATING." = '".$array[RECOMM_RATING]."'".RET;			$and = "AND".RET;		}		if($array[RECOMM_QOS_RATING] != "") {			$qry .= $and.RECOMM_QOS_RATING." = '".$array[RECOMM_QOS_RATING]."'".RET;			$and = "AND".RET;		}		if($array[RECOMM_QOF_RATING] != "") {			$qry .= $and.RECOMM_QOF_RATING." = '".$array[RECOMM_QOF_RATING]."'".RET;			$and = "AND".RET;		}		if($array[RECOMM_AMBIENCE_RATING] != "") {			$qry .= $and.RECOMM_AMBIENCE_RATING." = '".$array[RECOMM_AMBIENCE_RATING]."'".RET;			$and = "AND".RET;		}				if($array[RECOMM_PHONE] != "") {			$qry .= $and.RECOMM_PHONE." = '".$array[RECOMM_PHONE]."'".RET;			$and = "AND".RET;		}				if($array[RECOMM_EMAIL] != "") {			$qry .= $and.RECOMM_EMAIL." = '".$array[RECOMM_EMAIL]."'".RET;			$and = "AND".RET;		}		if($array[START_DATE] != "") {			$qry .= $and.START_DATE." = '".$array[START_DATE]."'".RET;			$and = "AND".RET;		}		if($array[RECOMM_TABLE] != "") {			$qry .= $and.RECOMM_TABLE." = '".$array[RECOMM_TABLE]."'".RET;			$and = "AND".RET;		}				if($array[END_DATE] != "") {			$qry .= $and.END_DATE." = '".$array[END_DATE]."'".RET;			$and = "AND".RET;		}		if(is_gt_zero_num($array["isActive"])) {			$qry .= $and.$tbl_feedback_active_condition;;			$and = "AND".RET;		}				if($array[FDBK_RESTAURENT] != "") {			$qry .= $and.FDBK_RESTAURENT." = '".$array[FDBK_RESTAURENT]."'".RET;			$and = "AND".RET;		}				if(is_not_empty($array[SORT_ON]) && is_not_empty($array[SORT_BY])) {			$qry .=" ORDER BY ".$array[SORT_ON]." ".$array[SORT_BY]."";		}		if(is_not_empty($array[OFFSET_TITLE]) && is_not_empty($array[LIMIT_TITLE])) {			$qry_with_limit  = $qry." LIMIT ".$array[OFFSET_TITLE].",".$array[LIMIT_TITLE];		}else{			$qry_with_limit  = $qry;		} 		 //echo $qry_with_limit;		$result = mysql_query ($qry_with_limit);		$r1 = mysql_query($qry);		$result_found = mysql_num_rows($r1);		$class_objects = array();		if($result) {			while ($record = mysql_fetch_assoc($result)) {				$isActive= 0;				//..check deactive date is not set or 0				if((is_not_empty($record[TBL_FEEDBACK_DEACTIVE_DATE])==false) || (is_gt_zero_num(strtotime($record[TBL_FEEDBACK_DEACTIVE_DATE]))== false)){					$isActive = 1; 				}else{					//..check the deactive date is greater than todays date					if(strtotime($record[TBL_FEEDBACK_DEACTIVE_DATE]) > strtotime(date(DATE_FORMAT))){						$isActive = 1;					}				}				if($isArray){					$class_object = array();					$class_object['id']=$record[ID];					$class_object['post_id']=$record[POST_ID];					$class_object['post_title']=$record[POST_TITLE];					$class_object['post_type']=$record[POST_TYPE];					$class_object['customer_name']=$record['customer_name'];					$class_object[USER_ID]=$record[USER_ID];					$class_object[USER_TYPE]=$record[USER_TYPE];					$class_object['recomm_title']=$record[RECOMM_TITLE];					$class_object['recomm_desc']=$record[RECOMM_DESC];					$class_object['recomm_rating']=$record[RECOMM_RATING];					$class_object['rate']=ceil($record[RECOMM_RATING] *2);					$class_object['recomm_QOS_rating']=$record[RECOMM_QOS_RATING];					$class_object['recomm_QOF_rating']=$record[RECOMM_QOF_RATING];					$class_object['recomm_ambience_rating']=$record[RECOMM_AMBIENCE_RATING];										$class_object['recomm_email']=$record[RECOMM_EMAIL];					$class_object['recomm_phone']=$record[RECOMM_PHONE];					$class_object['recomm_table']=$record[RECOMM_TABLE];						$class_object['recomm_table_number']=$record['tbl_number'];																		$class_object['start_date']=$record[START_DATE];					$class_object['end_date']=$record[END_DATE];					$class_object['isActive']=$isActive;					$class_object['fdbk_restaurent']=$record[FDBK_RESTAURENT];										$class_object['friendly_created_on'] = friendly_time($class_object[START_DATE],1);				}else{					$class_object = new tbl_feedback();					$class_object->setid($record[ID]);					$class_object->setpost_id($record[POST_ID]);					$class_object->setpost_title($record[POST_TITLE]);					$class_object->setpost_type($record[POST_TYPE]);					$class_object->setuser_id($record[USER_ID]);					$class_object->setuser_type($record[USER_TYPE]);					$class_object->setrecomm_title($record[RECOMM_TITLE]);					$class_object->setrecomm_desc($record[RECOMM_DESC]);					$class_object->setrecomm_rating($record[RECOMM_RATING]);					$class_object->setrecomm_QOS_rating($record[RECOMM_QOS_RATING]);					$class_object->setrecomm_QOF_rating($record[RECOMM_QOF_RATING]);					$class_object->setrecomm_ambience_rating($record[RECOMM_AMBIENCE_RATING]);										$class_object->setrecomm_email($record[RECOMM_EMAIL]);				  $class_object->setrecomm_phone($record[RECOMM_PHONE]);					$class_object->setrecomm_table($record[RECOMM_TABLE]);										$class_object->setstart_date($record[START_DATE]);					$class_object->setend_date($record[END_DATE]);					$class_object->setfdbk_restaurent($record[FDBK_RESTAURENT]);				}				$class_objects[$record[ID]] = $class_object;			}		}		return $class_objects;	}//..End readArray	public function insert() {		if($this->getid() != '') {			$qry  = "UPDATE ".TBL_FEEDBACK.RET."SET".RET."			".ID." = '".$this->getid()."',".RET."			".POST_ID." = '".$this->getpost_id()."',".RET."			".POST_TITLE." = '".$this->getpost_title()."',".RET."			".POST_TYPE." = '".$this->getpost_type()."',".RET."			".USER_ID." = '".$this->getuser_id()."',".RET."			".USER_TYPE." = '".$this->getuser_type()."',".RET."			".RECOMM_TITLE." = '".$this->getrecomm_title()."',".RET."			".RECOMM_DESC." = '".$this->getrecomm_desc()."',".RET."			".RECOMM_RATING." = '".$this->getrecomm_rating()."',".RET."			".RECOMM_QOS_RATING." = '".$this->getrecomm_QOS_rating()."',".RET."			".RECOMM_QOF_RATING." = '".$this->getrecomm_QOF_rating()."',".RET."			".RECOMM_AMBIENCE_RATING." = '".$this->getrecomm_ambience_rating()."',".RET."						".RECOMM_EMAIL." = '".$this->getrecomm_email()."',".RET."			".RECOMM_PHONE." = '".$this->getrecomm_phone()."',".RET."			".RECOMM_TABLE." = '".$this->getrecomm_table()."',".RET."						".START_DATE." = '".$this->getstart_date()."',".RET."			".END_DATE." = '".$this->getend_date()."'".RET.			"WHERE ".ID." = ".$this->getid().RET;			mysql_query($qry);		} else {			$qry  = "INSERT INTO ".TBL_FEEDBACK." (".RET.			"".POST_ID.", ".POST_TITLE.", ".POST_TYPE.", ".USER_ID.", ".USER_TYPE.", ".RECOMM_TITLE.", ".RECOMM_DESC.", ".RECOMM_RATING.", ".RECOMM_QOS_RATING.", ".RECOMM_QOF_RATING.", ".RECOMM_AMBIENCE_RATING.", ".RECOMM_EMAIL.", ".RECOMM_PHONE.", ".RECOMM_TABLE.", ".START_DATE.", ".END_DATE.", ".FDBK_RESTAURENT.RET.				") VALUES (".RET.			"'".$this->getpost_id()."',".RET.			"'".$this->getpost_title()."',".RET.			"'".$this->getpost_type()."',".RET.			"'".$this->getuser_id()."',".RET.			"'".$this->getuser_type()."',".RET.			"'".$this->getrecomm_title()."',".RET.			"'".$this->getrecomm_desc()."',".RET.			"'".$this->getrecomm_rating()."',".RET.			"'".$this->getrecomm_QOS_rating()."',".RET.			"'".$this->getrecomm_QOF_rating()."',".RET.			"'".$this->getrecomm_ambience_rating()."',".RET.						"'".$this->getrecomm_email()."',".RET.			"'".$this->getrecomm_phone()."',".RET.			"'".$this->getrecomm_table()."',".RET.						"'".$this->getstart_date()."',".RET.			"'".$this->getend_date()."',".RET.			"'".$_SESSION[SES_RESTAURANT]."'".RET.			")".RET;			$res = mysql_query($qry);			$this->setid(mysql_insert_id());		}	}//..End Insert	public static function delete($array = array()) {		$qry = "DELETE".RET."FROM ".TBL_FEEDBACK.RET;		$and = "WHERE".RET;		if($array[ID] != "") {			$qry .= $and.ID." IN (".$array[ID].")".RET;			$and = "AND".RET;		}		if($array[POST_ID] != "") {			$qry .= $and.POST_ID." = '".$array[POST_ID]."'".RET;			$and = "AND".RET;		}		if($array[POST_TITLE] != "") {			$qry .= $and.POST_TITLE." = '".$array[POST_TITLE]."'".RET;			$and = "AND".RET;		}		if($array[POST_TYPE] != "") {			$qry .= $and.POST_TYPE." = '".$array[POST_TYPE]."'".RET;			$and = "AND".RET;		}		if($array[USER_ID] != "") {			$qry .= $and.USER_ID." = '".$array[USER_ID]."'".RET;			$and = "AND".RET;		}				if($array[USER_TYPE] != "") {			$qry .= $and.USER_TYPE." = '".$array[USER_TYPE]."'".RET;			$and = "AND".RET;		}		if($array[RECOMM_TITLE] != "") {			$qry .= $and.RECOMM_TITLE." = '".$array[RECOMM_TITLE]."'".RET;			$and = "AND".RET;		}		if($array[RECOMM_DESC] != "") {			$qry .= $and.RECOMM_DESC." = '".$array[RECOMM_DESC]."'".RET;			$and = "AND".RET;		}		if($array[RECOMM_RATING] != "") {			$qry .= $and.RECOMM_RATING." = '".$array[RECOMM_RATING]."'".RET;			$and = "AND".RET;		}		if($array[RECOMM_QOS_RATING] != "") {			$qry .= $and.RECOMM_QOS_RATING." = '".$array[RECOMM_QOS_RATING]."'".RET;			$and = "AND".RET;		}		if($array[RECOMM_QOF_RATING] != "") {			$qry .= $and.RECOMM_QOF_RATING." = '".$array[RECOMM_QOF_RATING]."'".RET;			$and = "AND".RET;		}		if($array[RECOMM_AMBIENCE_RATING] != "") {			$qry .= $and.RECOMM_AMBIENCE_RATING." = '".$array[RECOMM_AMBIENCE_RATING]."'".RET;			$and = "AND".RET;		}		if($array[RECOMM_PHONE] != "") {			$qry .= $and.RECOMM_PHONE." = '".$array[RECOMM_PHONE]."'".RET;			$and = "AND".RET;		}				if($array[RECOMM_EMAIL] != "") {			$qry .= $and.RECOMM_EMAIL." = '".$array[RECOMM_EMAIL]."'".RET;			$and = "AND".RET;		}				if($array[RECOMM_TABLE] != "") {			$qry .= $and.RECOMM_TABLE." = '".$array[RECOMM_TABLE]."'".RET;			$and = "AND".RET;		}				if($array[START_DATE] != "") {			$qry .= $and.START_DATE." = '".$array[START_DATE]."'".RET;			$and = "AND".RET;		}		if($array[END_DATE] != "") {			$qry .= $and.END_DATE." = '".$array[END_DATE]."'".RET;			$and = "AND".RET;		}				if($array[FDBK_RESTAURENT] != "") {			$qry .= $and.FDBK_RESTAURENT." = '".$array[FDBK_RESTAURENT]."'".RET;			$and = "AND".RET;		}		$res = mysql_query($qry);		if($res){			return OPERATION_SUCCESS;		};		return OPERATION_FAIL;	}//..End Delete	public function isAlreadyThere($post_id ,$post_title ,$post_type ,$user_id ,$recomm_title ,$recomm_desc ,$recomm_rating ,$recomm_QOS_rating ,$recomm_QOF_rating ,$recomm_ambience_rating,$user_type=CUST_TYPE_LOGIN ) {				$unique_arr = array();			//$unique_arr[ID]=$id;			 $unique_arr[POST_ID]=$post_id;			//$unique_arr[POST_TITLE]=$post_title;			 $unique_arr[POST_TYPE]=$post_type;			 $unique_arr[USER_ID]=$user_id;			 $unique_arr[USER_TYPE]=$user_type;			 $unique_arr[FDBK_RESTAURENT]=$_SESSION[SES_RESTAURANT];			 			//$unique_arr[RECOMM_TITLE]=$recomm_title;			//$unique_arr[RECOMM_DESC]=$recomm_desc;			//$unique_arr[RECOMM_RATING]=$recomm_rating;			//$unique_arr[RECOMM_QOS_RATING]=$recomm_QOS_rating;			//$unique_arr[RECOMM_QOF_RATING]=$recomm_QOF_rating;			//$unique_arr[RECOMM_AMBIENCE_RATING]=$recomm_ambience_rating;			//$unique_arr[START_DATE]=$start_date;			//$unique_arr[END_DATE]=$end_date;		if(is_not_empty($unique_arr)){			return $this->readObject($unique_arr);		}		return false;	}//..isAlreadyThere	public function create($post_id ,$post_title ,$post_type ,$user_id ,$recomm_title ,$recomm_desc ,$recomm_rating ,$recomm_QOS_rating ,$recomm_QOF_rating ,$recomm_ambience_rating,$user_type=CUST_TYPE_LOGIN,$recomm_email=NULL,$recomm_phone=NULL,$recomm_table=NULL) {		if(is_not_empty($post_id)){			if($this->isAlreadyThere($post_id ,$post_title ,$post_type ,$user_id ,$recomm_title ,$recomm_desc ,$recomm_rating ,$recomm_QOS_rating ,$recomm_QOF_rating ,$recomm_ambience_rating)){				return OPERATION_DUPLICATE;			}else{				$this->setid("");				$this->setpost_id($post_id);				$this->setpost_title($post_title);				if(is_not_empty($post_type)){					$this->setpost_type($post_type);				}else{					$this->setpost_type(DFLT_FEEDBACK_TYPE);				}								$this->setuser_id($user_id);				$this->setuser_type($user_type);				$this->setrecomm_title($recomm_title);				$this->setrecomm_desc($recomm_desc);				$this->setrecomm_rating($recomm_rating);				$this->setrecomm_QOS_rating($recomm_QOS_rating);				$this->setrecomm_QOF_rating($recomm_QOF_rating);				$this->setrecomm_ambience_rating($recomm_ambience_rating);								$this->setrecomm_email($recomm_email);				$this->setrecomm_phone($recomm_phone);				$this->setrecomm_table($recomm_table);								$this->setstart_date(date(DATE_FORMAT)); 				$this->insert();				return $this->getid();			}		}		return OPERATION_FAIL;	}//..create	public function update($id, $post_id, $post_title, $post_type, $user_id, $recomm_title, $recomm_desc, $recomm_rating, $recomm_QOS_rating, $recomm_QOF_rating, $recomm_ambience_rating, $user_type=CUST_TYPE_LOGIN,$recomm_email=NULL,$recomm_phone=NULL,$recomm_table=NULL) {		if(is_gt_zero_num($id)){			if ($this->readObject(array(ID=>$id))){				$this->setpost_id($post_id);				$this->setpost_title($post_title);				$this->setpost_type($post_type);				$this->setuser_id($user_id);				$this->setuser_type($user_type);				$this->setrecomm_title($recomm_title);				$this->setrecomm_desc($recomm_desc);				$this->setrecomm_rating($recomm_rating);				$this->setrecomm_QOS_rating($recomm_QOS_rating);				$this->setrecomm_QOF_rating($recomm_QOF_rating);				$this->setrecomm_ambience_rating($recomm_ambience_rating);								$this->setrecomm_email($recomm_email);				$this->setrecomm_phone($recomm_phone);				$this->setrecomm_table($recomm_table);				 				$this->insert();				return OPERATION_SUCCESS;			}		}		return OPERATION_FAIL;	}//..update	public function activate($id){		if(is_not_empty($id)){			//if ($this->readObject(array(ID=>$id))){				$qry  = "UPDATE ".TBL_FEEDBACK.RET."SET".RET."			".TBL_FEEDBACK_DEACTIVE_DATE." = '".date(EMPTY_DATE_FORMAT)."' WHERE ".ID." IN ({$id})";				$res = mysql_query($qry);				if($res){					return 1;				}			//}		}		return 0;	}//..end activate	public function deactivate($id){		if(is_not_empty($id)){			//if ($this->readObject(array(ID=>$id))){				$qry  = "UPDATE ".TBL_FEEDBACK.RET."SET".RET."			".TBL_FEEDBACK_DEACTIVE_DATE." = '".date(DATE_FORMAT)."' WHERE ".ID." IN ({$id})";				$res = mysql_query($qry);				if($res){					return 1;				}			//}		}		return 0;	}//..end deactivate	public static function Get_Email_Content($id){		global $website,$_lang;				$str_body='';		$objtbl_feedback=new tbl_feedback();		$tbl_feedbackinfo= $objtbl_feedback->GetInfo($id);				$str_body .='<style type="text/css">.listTable{	width:98%; /*310px*/	border-collapse: collapse; 	margin:0px 5px 10px 5px; /*#f6f5e8*/   /*background:#F6F6EA  url(images/box.png) !important;   background:#efefef; */   border:1px solid #FF9600 ;} .listTable td {     padding:3px 3px 3px 3px;	font-weight:bold;	font-size: 12px; 	vertical-align: top; 	color:#fff;}.listTable b{	color:#8BB43F  !important;	font-weight: bold;}.listTable .fieldItem{	width:100px !important;	}.listTable td.fieldItem{	color:#8BB43F;	text-transform: capitalize;}.listTable td.valueItem{	color:#ff9600;} .listTable .valueItem{		width:200px !important;}	</style>				<table class="listTable">		<tr><td class="fieldItem">'.$_lang['tbl_feedback']['label']['recomm_title'].'<i>:</i></td><td class="valueItem">'.$tbl_feedbackinfo['recomm_title'].'</td></tr>		<tr><td class="fieldItem">'.$_lang['tbl_feedback']['label']['recomm_desc'].'<i>:</i></td><td class="valueItem">'.$tbl_feedbackinfo['recomm_desc'].'</td></tr>		<tr><td class="fieldItem">'.$_lang['tbl_feedback']['label']['recomm_rating'].'<i>:</i></td><td class="valueItem"><img src="'.$website.'/modules/business_listing/graphics/'.$tbl_feedbackinfo['recomm_rating'].'.gif" alt="'.$tbl_feedbackinfo['recomm_rating'].'"/></td></tr>		<tr><td class="fieldItem">'.$_lang['tbl_feedback']['label']['recomm_QOS_rating'].'<i>:</i></td><td class="valueItem"><img src="'.$website.'/modules/business_listing/graphics/'.$tbl_feedbackinfo['recomm_QOS_rating'].'.gif" alt="'.$tbl_feedbackinfo['recomm_QOS_rating'].'"/></td></tr>		<tr><td class="fieldItem">'.$_lang['tbl_feedback']['label']['recomm_QOF_rating'].'<i>:</i></td><td class="valueItem"><img src="'.$website.'/modules/business_listing/graphics/'.$tbl_feedbackinfo['recomm_QOF_rating'].'.gif" alt="'.$tbl_feedbackinfo['recomm_QOF_rating'].'"/></td></tr>		<tr><td class="fieldItem">'.$_lang['tbl_feedback']['label']['recomm_ambience_rating'].'<i>:</i></td><td class="valueItem"><img src="'.$website.'/modules/business_listing/graphics/'.$tbl_feedbackinfo['recomm_ambience_rating'].'.gif" alt="'.$tbl_feedbackinfo['recomm_ambience_rating'].'"/></td></tr>				<tr><td class="fieldItem">'.$_lang['tbl_feedback']['label']['recomm_posted_on'].'<i>:</i></td><td class="valueItem">'.date('m/d/y H:i:s',strtotime($tbl_feedbackinfo['start_date'])).'</td></tr></table>';		return $str_body;	}	public static function GetInfo($id) {		$info = array();		if($id != ''){			$obj_tbl_feedback = new tbl_feedback();			if($obj_tbl_feedback->readObject(array('id'=>$id))){				$info['id']=$obj_tbl_feedback->getid();				$info['post_id']=$obj_tbl_feedback->getpost_id();				$info['post_title']=$obj_tbl_feedback->getpost_title();				$info['post_type']=$obj_tbl_feedback->getpost_type();				$info['user_id']=$obj_tbl_feedback->getuser_id();				$info[USER_TYPE]=$obj_tbl_feedback->getuser_type();				$info['recomm_title']=$obj_tbl_feedback->getrecomm_title();				$info['recomm_desc']=$obj_tbl_feedback->getrecomm_desc();				$info['recomm_rating']=ceil($obj_tbl_feedback->getrecomm_rating() * 2);				$info['recomm_QOS_rating']=ceil($obj_tbl_feedback->getrecomm_QOS_rating() * 2);				$info['recomm_QOF_rating']=ceil($obj_tbl_feedback->getrecomm_QOF_rating() * 2);				$info['recomm_ambience_rating']=ceil($obj_tbl_feedback->getrecomm_ambience_rating() * 2);								$info['recomm_email']=$obj_tbl_feedback->getrecomm_email();				$info['recomm_phone']=$obj_tbl_feedback->getrecomm_phone();				$info['recomm_table']=$obj_tbl_feedback->getrecomm_table();												$info['start_date']=$obj_tbl_feedback->getstart_date();				$info['end_date']=$obj_tbl_feedback->getend_date();				$info['isActive'] = chk_if_record_active($obj_tbl_feedback->gettbl_feedback_deactive_date());				$info['fdbk_restaurent']=$obj_tbl_feedback->getfdbk_restaurent();								$info['friendly_created_on'] = friendly_time($obj_tbl_feedback->getstart_date(),1);				//..check deactive date is not set or 0							/*	 if((is_not_empty($obj_tbl_feedback->gettbl_feedback_deactive_date())==false)  || (is_gt_zero_num(strtotime($obj_tbl_feedback->gettbl_feedback_deactive_date()))== false)){					$info['isActive'] = 1;				}else{					//..check the deactive date is greater than todays date					if(strtotime($obj_tbl_feedback->gettbl_feedback_deactive_date()) >= strtotime(date(DATE_FORMAT))){						$info['isActive'] = 1;					} 				}*/			}		unset($obj_tbl_feedback);		return $info;		}	}//..End GetInfo	public static function GetFields($data){		global $tbl_feedback_active_condition;		$arr = array();		if(is_not_empty($data)){			$qry ="SELECT ".$data['key_field'].",".$data['value_field']." FROM ".TBL_DINING_TABLE."";			if(is_gt_zero_num($data['isActive'])){				$qry .= " WHERE `".FDBK_RESTAURENT."`=".$_SESSION[SES_RESTAURANT]." AND ".$tbl_feedback_active_condition;						}			$res = mysql_query($qry); 			if($res){				while($row=mysql_fetch_assoc($res)){					$arr[$row[$data['key_field']]] = $row[$data['value_field']];				}			}		}		return $arr;	}//.. End of GetFields		public static function Enum_OverAll_Rating(){		 //return array('0'=>'Select Rating','5'=>'Very Good', '4'=>'Good','3'=>'Average','2'=>'Poor','1'=>'Very Poor');				 return array('0'=>'Select Rating','5'=>'Excellent', '4'=>'Very Good','3'=>'Good','2'=>'Average','1'=>'Poor');	 	}		public static function Enum_QOS_Rating(){		 return array('0'=>'Select Rating','5'=>'Excellent', '4'=>'Very Good','3'=>'Good','2'=>'Average','1'=>'Poor');			}		public static function Enum_QOF_Rating(){		 return array('0'=>'Select Rating','5'=>'Excellent', '4'=>'Very Good','3'=>'Good','2'=>'Average','1'=>'Poor');			}		public static function Enum_Ambience_Rating(){		 return array('0'=>'Select Rating','5'=>'Excellent', '4'=>'Very Good','3'=>'Good','2'=>'Average','1'=>'Poor');		}		public static function Enum_Post_Type(){		return array('Business'=>'Business', 'Promotions'=>'Promotions', 'Menu'=>'Menu', 'SubMenu'=>'SubMenu', 'SubMenuDish'=>'SubMenuDish');	} 		/**	* Get Rating of the particular post	* @param int $post_id	* @param string $post_type	* @return integer 	*/	public static function getPostRating($post_id,$post_type){		$rating = 0;	 if(is_gt_zero_num($post_id) && is_not_empty($post_type)){	 		$res = 	mysql_query('SELECT Avg('.RECOMM_RATING.') FROM '.TBL_FEEDBACK.' WHERE '.POST_TYPE.'=\''.$post_type.'\' AND '.POST_ID.'='.$post_id);			if($res && is_gt_zero_num(mysql_num_rows($res))){				$rating =  mysql_result($res,0);				$rating = ceil($rating * 2);			}			 } 		return $rating;	}	  	public static function getUserRateId($post_id,$post_type,$user_id,$user_type=CUST_TYPE_LOGIN){		$rate_id = 0;	 if(is_gt_zero_num($post_id) && is_not_empty($post_type) && is_gt_zero_num($user_id)){	 		$res = 	mysql_query('SELECT DISTINCT '.ID.' FROM '.TBL_FEEDBACK.' WHERE '.POST_TYPE.'=\''.$post_type.'\' AND '.POST_ID.'='.$post_id.' AND '.USER_ID.'='.$user_id.' AND '.USER_TYPE.'=\''.$user_type.'\'');			if($res && is_gt_zero_num(mysql_num_rows($res))){				$rate_id =  mysql_result($res,0); 			} 	 } 		return $rate_id;	}		public static function bulkCreate($recom_title,$recom_desc,$post_type,$user_id,$user_type,$recom_ratings,$post_ids,$post_titles){		$sql_param = array();		foreach($post_ids as $key=>$post_id){		 			$sql_param[] = '('.$post_id.', \''.mysql_real_escape_string($post_titles[$key]).'\', \''.$post_type.'\', '.$user_id.', \''.$user_type.'\',  \''.mysql_real_escape_string($recom_title).'\', \''.mysql_real_escape_string($recom_desc).'\' ,\''.mysql_real_escape_string($recom_ratings[$key]).'\' ,'.$_SESSION[SES_RESTAURANT].')';		}		if($sql_param){			$sql = 'INSERT INTO '.TBL_FEEDBACK.' '.RET.' ('.POST_ID.', '.POST_TITLE.', '.POST_TYPE.', '.USER_ID.', '.USER_TYPE.', '.RECOMM_TITLE.', '.RECOMM_DESC.', '.RECOMM_RATING.', '.FDBK_RESTAURENT.') VALUES '.biz_implode(',',$sql_param).';';		 //echo $sql;exit;			$res = mysql_query($sql);			if($res) return OPERATION_SUCCESS;		}		return OPERATION_FAIL;	}	}//..End tbl_feedback?>