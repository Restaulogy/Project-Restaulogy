<?php/**********************************************************************tbl_wait_queue.class.phpGenerated by STRUCTY 2013.06.05 13:33:22.Copyright 2011 Structy, Frédéric Aebi. All rights reserved.**********************************************************************/define('TBL_WAIT_QUEUE', 'tbl_wait_queue'); define('WT_QUE_ID', 'wt_que_id'); define('WT_QUE_CUSTOMER', 'wt_que_customer'); define('WT_QUE_CUST_PH_NO', 'wt_que_cust_ph_no');define('WT_QUE_USER_ID', 'wt_que_user_id');define('WT_QUE_USER_TYPE', 'wt_que_user_type'); define('WT_QUE_PARTY_SIZE', 'wt_que_party_size'); define('WT_QUE_TABLE_TYPE', 'wt_que_table_type'); define('WT_QUE_TABLE_ID', 'wt_que_table_id'); define('WT_QUE_EXP_TIME', 'wt_que_exp_time'); define('WT_QUE_IS_CANCELLED', 'wt_que_is_cancelled'); define('WT_QUE_RESTAURANT', 'wt_que_restaurant'); define('WT_QUE_BY_CUST', 'wt_que_by_cust'); define('WT_QUE_CREATED_ON', 'wt_que_created_on'); define('WT_QUE_COMPLETED_ON', 'wt_que_completed_on'); define('WT_QUE_CUR_REMAIN_TIME','wt_que_cur_remain_time');define('TBL_WAIT_QUEUE_ACTIVE_DATE',  'wt_que_created_on');define('TBL_WAIT_QUEUE_DEACTIVE_DATE',  'wt_que_completed_on');$tbl_wait_queue_active_condition= ' ('.TBL_WAIT_QUEUE_DEACTIVE_DATE.' is NULL OR '.TBL_WAIT_QUEUE_DEACTIVE_DATE.' = 0 OR DATE('.TBL_WAIT_QUEUE_DEACTIVE_DATE.') > CURDATE( )) ';class tbl_wait_queue {	private $wt_que_id;	private $wt_que_customer;	private $wt_que_cust_ph_no;	private $wt_que_user_id;	private $wt_que_user_type; 	private $wt_que_party_size;	private $wt_que_table_type;	private $wt_que_table_id;	private $wt_que_exp_time;	private $wt_que_is_cancelled;	private $wt_que_restaurant;	private $wt_que_by_cust;	private $wt_que_created_on;	private $wt_que_completed_on;	private $wt_que_cur_remain_time;	private $tbl_wait_queue_active_date;	private $tbl_wait_queue_deactive_date;	public function setwt_que_id($pArg='0') {$this->wt_que_id=$pArg;}	public function setwt_que_customer($pArg='0') {$this->wt_que_customer=$pArg;}	public function setwt_que_cust_ph_no($pArg='0') {$this->wt_que_cust_ph_no=$pArg;}	public function setwt_que_user_id($pArg='0') {$this->wt_que_user_id=$pArg;}	public function setwt_que_user_type($pArg='0') {$this->wt_que_user_type=$pArg;}	public function setwt_que_party_size($pArg='0') {$this->wt_que_party_size=$pArg;}	public function setwt_que_table_type($pArg='0') {$this->wt_que_table_type=$pArg;}	public function setwt_que_table_id($pArg='0') {$this->wt_que_table_id=$pArg;}	public function setwt_que_exp_time($pArg='0') {$this->wt_que_exp_time=$pArg;}	public function setwt_que_is_cancelled($pArg='0') {$this->wt_que_is_cancelled=$pArg;}	public function setwt_que_restaurant($pArg='0') {$this->wt_que_restaurant=$pArg;}	public function setwt_que_by_cust($pArg='0') {$this->wt_que_by_cust=$pArg;}	public function setwt_que_created_on($pArg='0') {$this->wt_que_created_on=$pArg;}	public function setwt_que_completed_on($pArg='0') {$this->wt_que_completed_on=$pArg;} 	public function setwt_que_cur_remain_time($pArg='0') {$this->wt_que_cur_remain_time=$pArg;} 	public function settbl_wait_queue_active_date($pArg='0') {$this->tbl_wait_queue_active_date=$pArg;}	public function settbl_wait_queue_deactive_date($pArg='0') {$this->tbl_wait_queue_deactive_date=$pArg;}	public function getwt_que_id() {return $this->wt_que_id;}	public function getwt_que_customer() {return $this->wt_que_customer;}	public function getwt_que_cust_ph_no() {return $this->wt_que_cust_ph_no;}	public function getwt_que_user_id() {return $this->wt_que_user_id;}	public function getwt_que_user_type() {return $this->wt_que_user_type;}	public function getwt_que_party_size() {return $this->wt_que_party_size;}	public function getwt_que_table_type() {return $this->wt_que_table_type;}	public function getwt_que_table_id() {return $this->wt_que_table_id;}	public function getwt_que_exp_time() {return $this->wt_que_exp_time;}	public function getwt_que_is_cancelled() {return $this->wt_que_is_cancelled;}	public function getwt_que_restaurant() {return $this->wt_que_restaurant;}	public function getwt_que_by_cust() {return $this->wt_que_by_cust;}	public function getwt_que_created_on() {return $this->wt_que_created_on;}	public function getwt_que_completed_on() {return $this->wt_que_completed_on;}	public function getwt_que_cur_remain_time() {return $this->wt_que_cur_remain_time;}	public function gettbl_wait_queue_active_date() {return $this->tbl_wait_queue_active_date;}	public function gettbl_wait_queue_deactive_date() {return $this->tbl_wait_queue_deactive_date;}	public function readObject($array = array()) {		$qry = "SELECT *,(`wt_que_exp_time` - ROUND( TIME_TO_SEC( TIMEDIFF( CURTIME( ) , TIME(  `wt_que_created_on` ) ) ) /60 )) AS ".WT_QUE_CUR_REMAIN_TIME." ".RET."FROM ".TBL_WAIT_QUEUE.RET;		$and = "WHERE".RET;		if($array[WT_QUE_ID] != "") {			$qry .= $and.WT_QUE_ID." = '".$array[WT_QUE_ID]."'".RET;			$and = "AND".RET;		}		if($array[WT_QUE_CUSTOMER] != "") {			$qry .= $and.WT_QUE_CUSTOMER." = '".$array[WT_QUE_CUSTOMER]."'".RET;			$and = "AND".RET;		}		if($array[WT_QUE_CUST_PH_NO] != "") {			$qry .= $and.WT_QUE_CUST_PH_NO." = '".$array[WT_QUE_CUST_PH_NO]."'".RET;			$and = "AND".RET;		}				if($array[WT_QUE_USER_ID] != "") {			$qry .= $and.WT_QUE_USER_ID." = '".$array[WT_QUE_USER_ID]."'".RET;			$and = "AND".RET;		}				if($array[WT_QUE_USER_TYPE] != "") {			$qry .= $and.WT_QUE_USER_TYPE." = '".$array[WT_QUE_USER_TYPE]."'".RET;			$and = "AND".RET;		}		if($array[WT_QUE_PARTY_SIZE] != "") {			$qry .= $and.WT_QUE_PARTY_SIZE." = '".$array[WT_QUE_PARTY_SIZE]."'".RET;			$and = "AND".RET;		}		if($array[WT_QUE_TABLE_TYPE] != "") {			$qry .= $and.WT_QUE_TABLE_TYPE." = '".$array[WT_QUE_TABLE_TYPE]."'".RET;			$and = "AND".RET;		}		if($array[WT_QUE_TABLE_ID] != "") {			$qry .= $and.WT_QUE_TABLE_ID." = '".$array[WT_QUE_TABLE_ID]."'".RET;			$and = "AND".RET;		}		if($array[WT_QUE_EXP_TIME] != "") {			$qry .= $and.WT_QUE_EXP_TIME." = '".$array[WT_QUE_EXP_TIME]."'".RET;			$and = "AND".RET;		}		if($array[WT_QUE_IS_CANCELLED] != "") {			$qry .= $and.WT_QUE_IS_CANCELLED." = '".$array[WT_QUE_IS_CANCELLED]."'".RET;			$and = "AND".RET;		}		if($array[WT_QUE_RESTAURANT] != "") {			$qry .= $and.WT_QUE_RESTAURANT." = '".$array[WT_QUE_RESTAURANT]."'".RET;			$and = "AND".RET;		}		if($array[WT_QUE_BY_CUST] != "") {			$qry .= $and.WT_QUE_BY_CUST." = '".$array[WT_QUE_BY_CUST]."'".RET;			$and = "AND".RET;		}		if($array[WT_QUE_CREATED_ON] != "") {			$qry .= $and.WT_QUE_CREATED_ON." = '".$array[WT_QUE_CREATED_ON]."'".RET;			$and = "AND".RET;		}		if($array[WT_QUE_COMPLETED_ON] != "") {			$qry .= $and.WT_QUE_COMPLETED_ON." = '".$array[WT_QUE_COMPLETED_ON]."'".RET;			$and = "AND".RET;		} 	$result = mysql_query($qry);		if($result) {			while ($row = mysql_fetch_array($result)) {				$record = $row;				break;//end after first record			}			if(count($record[0]) == 0) {				return array();			} else {				$this->setwt_que_id($record[WT_QUE_ID]);				$this->setwt_que_customer($record[WT_QUE_CUSTOMER]);				$this->setwt_que_cust_ph_no($record[WT_QUE_CUST_PH_NO]);				$this->setwt_que_user_id($record[WT_QUE_USER_ID]);				$this->setwt_que_user_type($record[WT_QUE_USER_TYPE]);				$this->setwt_que_party_size($record[WT_QUE_PARTY_SIZE]);				$this->setwt_que_table_type($record[WT_QUE_TABLE_TYPE]);				$this->setwt_que_table_id($record[WT_QUE_TABLE_ID]);				$this->setwt_que_exp_time($record[WT_QUE_EXP_TIME]);				$this->setwt_que_is_cancelled($record[WT_QUE_IS_CANCELLED]);				$this->setwt_que_restaurant($record[WT_QUE_RESTAURANT]);				$this->setwt_que_by_cust($record[WT_QUE_BY_CUST]);				$this->setwt_que_created_on($record[WT_QUE_CREATED_ON]);				$this->setwt_que_completed_on($record[WT_QUE_COMPLETED_ON]);				$this->setwt_que_cur_remain_time($record[WT_QUE_CUR_REMAIN_TIME]);				$this->settbl_wait_queue_active_date($record[TBL_WAIT_QUEUE_ACTIVE_DATE]);				$this->settbl_wait_queue_deactive_date($record[TBL_WAIT_QUEUE_DEACTIVE_DATE]);				return true;			}		}	}	public static function readArray($array = array(),&$result_found=0,$isArray=1) {		global $tbl_wait_queue_active_condition;		$qry = "SELECT *,tbl_type_name,(`wt_que_exp_time` - ROUND( TIME_TO_SEC( TIMEDIFF( CURTIME( ) , TIME(  `wt_que_created_on` ) ) ) /60 )) AS ".WT_QUE_CUR_REMAIN_TIME."".RET."FROM ".TBL_WAIT_QUEUE."  INNER JOIN ".TBL_TABLE_TYPE." ON wt_que_table_type = tbl_type_id ".RET;		$and = "WHERE".RET;		if($array[WT_QUE_ID] != "") {			$qry .= $and.WT_QUE_ID." = '".$array[WT_QUE_ID]."'".RET;			$and = "AND".RET;		}		if($array[WT_QUE_CUSTOMER] != "") {			$qry .= $and.WT_QUE_CUSTOMER." = '".$array[WT_QUE_CUSTOMER]."'".RET;			$and = "AND".RET;		}		if($array[WT_QUE_CUST_PH_NO] != "") {			$qry .= $and.WT_QUE_CUST_PH_NO." = '".$array[WT_QUE_CUST_PH_NO]."'".RET;			$and = "AND".RET;		}		 		if($array[WT_QUE_USER_ID] != "") {			$qry .= $and.WT_QUE_USER_ID." = '".$array[WT_QUE_USER_ID]."'".RET;			$and = "AND".RET;		}				if($array[WT_QUE_USER_TYPE] != "") {			$qry .= $and.WT_QUE_USER_TYPE." = '".$array[WT_QUE_USER_TYPE]."'".RET;			$and = "AND".RET;		} 		if($array[WT_QUE_PARTY_SIZE] != "") {			$qry .= $and.WT_QUE_PARTY_SIZE." = '".$array[WT_QUE_PARTY_SIZE]."'".RET;			$and = "AND".RET;		}		if($array[WT_QUE_TABLE_TYPE] != "") {			$qry .= $and.WT_QUE_TABLE_TYPE." = '".$array[WT_QUE_TABLE_TYPE]."'".RET;			$and = "AND".RET;		}		if($array[WT_QUE_TABLE_ID] != "") {			$qry .= $and.WT_QUE_TABLE_ID." = '".$array[WT_QUE_TABLE_ID]."'".RET;			$and = "AND".RET;		}		if($array[WT_QUE_EXP_TIME] != "") {			$qry .= $and.WT_QUE_EXP_TIME." = '".$array[WT_QUE_EXP_TIME]."'".RET;			$and = "AND".RET;		}		if($array[WT_QUE_IS_CANCELLED] != "") {			$qry .= $and.WT_QUE_IS_CANCELLED." = '".$array[WT_QUE_IS_CANCELLED]."'".RET;			$and = "AND".RET;		}		if($array[WT_QUE_RESTAURANT] != "") {			$qry .= $and.WT_QUE_RESTAURANT." = '".$array[WT_QUE_RESTAURANT]."'".RET;			$and = "AND".RET;		}		if($array[WT_QUE_BY_CUST] != "") {			$qry .= $and.WT_QUE_BY_CUST." = '".$array[WT_QUE_BY_CUST]."'".RET;			$and = "AND".RET;		}		if($array[WT_QUE_CREATED_ON] != "") {			$qry .= $and.WT_QUE_CREATED_ON." = '".$array[WT_QUE_CREATED_ON]."'".RET;			$and = "AND".RET;		}		if($array[WT_QUE_COMPLETED_ON] != "") {			$qry .= $and.WT_QUE_COMPLETED_ON." = '".$array[WT_QUE_COMPLETED_ON]."'".RET;			$and = "AND".RET;		}		if(is_gt_zero_num($array["isActive"])) {			$qry .= $and.$tbl_wait_queue_active_condition;			$and = "AND".RET;		}				if(is_gt_zero_num($array["latestOnly"])) {			$qry .= $and." DATE(".WT_QUE_CREATED_ON.") = CURDATE()".RET;			$and = "AND".RET;		}		if(is_not_empty($array[SORT_ON]) && is_not_empty($array[SORT_BY])) {		 			$qry .=" ORDER BY ".$array[SORT_ON]." ".$array[SORT_BY];				}else{			$qry .=" ORDER BY ".WT_QUE_ID." DESC";				}		if(is_not_empty($array[OFFSET_TITLE]) && is_not_empty($array[LIMIT_TITLE])) {			$qry_with_limit  = $qry." LIMIT ".$array[OFFSET_TITLE].",".$array[LIMIT_TITLE];		}else{			$qry_with_limit  = $qry;		}		$result = mysql_query ($qry_with_limit);		$r1 = mysql_query($qry);		if($r1){			$result_found = mysql_num_rows($r1);		}		$class_objects = array();		if($result) {			while ($record = mysql_fetch_assoc($result)) {				$isActive= 0;				//..check deactive date is not set or 0				if((is_not_empty($record[TBL_WAIT_QUEUE_DEACTIVE_DATE])==false) || (is_gt_zero_num(strtotime($record[TBL_WAIT_QUEUE_DEACTIVE_DATE]))== false)){					$isActive = 1; 				}else{					//..check the deactive date is greater than todays date					if(strtotime($record[TBL_WAIT_QUEUE_DEACTIVE_DATE]) > strtotime(date(DATE_FORMAT))){						$isActive = 1;					}				}				if($isArray){					$class_object = array();					$class_object[WT_QUE_ID]=$record[WT_QUE_ID];					$class_object[WT_QUE_CUSTOMER]=$record[WT_QUE_CUSTOMER];					$class_object[WT_QUE_CUST_PH_NO]=$record[WT_QUE_CUST_PH_NO];					$class_object[WT_QUE_USER_ID]=$record[WT_QUE_USER_ID];					$class_object[WT_QUE_USER_TYPE]=$record[WT_QUE_USER_TYPE];					$class_object[WT_QUE_PARTY_SIZE]=$record[WT_QUE_PARTY_SIZE];					$class_object[WT_QUE_TABLE_TYPE]=$record[WT_QUE_TABLE_TYPE];					$class_object[WT_QUE_TABLE_ID]=$record[WT_QUE_TABLE_ID];					$class_object[WT_QUE_EXP_TIME]=$record[WT_QUE_EXP_TIME];					$class_object[WT_QUE_IS_CANCELLED]=$record[WT_QUE_IS_CANCELLED];					$class_object[WT_QUE_RESTAURANT]=$record[WT_QUE_RESTAURANT];					$class_object[WT_QUE_BY_CUST]=$record[WT_QUE_BY_CUST];					$class_object[WT_QUE_CREATED_ON]=$record[WT_QUE_CREATED_ON];					$class_object[WT_QUE_CUR_REMAIN_TIME] = $record[WT_QUE_CUR_REMAIN_TIME];  					$class_object[WT_QUE_COMPLETED_ON]=$record[WT_QUE_COMPLETED_ON];					$class_object["friendly_wt_que_created_on"]=friendly_time($record[WT_QUE_CREATED_ON],1);					$class_object["friendly_wt_que_completed_on"]=friendly_time($record[WT_QUE_COMPLETED_ON],1);										$class_object["tbl_type_name"] = $record["tbl_type_name"];					$class_object["isActive"]=$isActive;										if($isActive && $record[WT_QUE_CUR_REMAIN_TIME] <= 0){						$class_object["isExpTimeCompleted"]=1;					}									}else{					$class_object = new tbl_wait_queue();					$class_object->setwt_que_id($record[WT_QUE_ID]);					$class_object->setwt_que_customer($record[WT_QUE_CUSTOMER]);					$class_object->setwt_que_cust_ph_no($record[WT_QUE_CUST_PH_NO]);					$class_object->setwt_que_user_id($record[WT_QUE_USER_ID]);					$class_object->setwt_que_user_type($record[WT_QUE_USER_TYPE]);					$class_object->setwt_que_party_size($record[WT_QUE_PARTY_SIZE]);					$class_object->setwt_que_table_type($record[WT_QUE_TABLE_TYPE]);					$class_object->setwt_que_table_id($record[WT_QUE_TABLE_ID]);					$class_object->setwt_que_exp_time($record[WT_QUE_EXP_TIME]);					$class_object->setwt_que_is_cancelled($record[WT_QUE_IS_CANCELLED]);					$class_object->setwt_que_restaurant($record[WT_QUE_RESTAURANT]);					$class_object->setwt_que_by_cust($record[WT_QUE_BY_CUST]);					$class_object->setwt_que_created_on($record[WT_QUE_CREATED_ON]);					$class_object->setwt_que_completed_on($record[WT_QUE_COMPLETED_ON]);					$class_object->setwt_que_cur_remain_time($record[WT_QUE_CUR_REMAIN_TIME]);				}				$class_objects[$record[WT_QUE_ID]] = $class_object;			}		}		return $class_objects;	}//..End readArray	public function insert() {		if($this->getwt_que_id() != '') {			$qry  = "UPDATE ".TBL_WAIT_QUEUE.RET."SET".RET."			".WT_QUE_ID." = '".mysql_real_escape_string($this->getwt_que_id())."',".RET."			".WT_QUE_CUSTOMER." = '".mysql_real_escape_string($this->getwt_que_customer())."',".RET."			".WT_QUE_CUST_PH_NO." = '".mysql_real_escape_string($this->getwt_que_cust_ph_no())."',".RET."			".WT_QUE_USER_ID." = '".mysql_real_escape_string($this->getwt_que_user_id())."',".RET."			".WT_QUE_USER_TYPE." = '".mysql_real_escape_string($this->getwt_que_user_type())."',".RET."			".WT_QUE_PARTY_SIZE." = '".mysql_real_escape_string($this->getwt_que_party_size())."',".RET."			".WT_QUE_TABLE_TYPE." = '".mysql_real_escape_string($this->getwt_que_table_type())."',".RET."			".WT_QUE_TABLE_ID." = '".mysql_real_escape_string($this->getwt_que_table_id())."',".RET."			".WT_QUE_EXP_TIME." = '".mysql_real_escape_string($this->getwt_que_exp_time())."',".RET."			".WT_QUE_IS_CANCELLED." = '".mysql_real_escape_string($this->getwt_que_is_cancelled())."',".RET."			".WT_QUE_RESTAURANT." = '".mysql_real_escape_string($this->getwt_que_restaurant())."',".RET."			".WT_QUE_BY_CUST." = '".mysql_real_escape_string($this->getwt_que_by_cust())."',".RET."			".WT_QUE_CREATED_ON." = '".mysql_real_escape_string($this->getwt_que_created_on())."',".RET."			".WT_QUE_COMPLETED_ON." = '".mysql_real_escape_string($this->getwt_que_completed_on())."'".RET.			"WHERE ".WT_QUE_ID." = ".mysql_real_escape_string($this->getwt_que_id()).RET;			mysql_query($qry);		} else {			$qry  = "INSERT INTO ".TBL_WAIT_QUEUE." (".RET.			"".WT_QUE_CUSTOMER.", ".WT_QUE_CUST_PH_NO.",".WT_QUE_USER_ID.",".WT_QUE_USER_TYPE.", ".WT_QUE_PARTY_SIZE.", ".WT_QUE_TABLE_TYPE.", ".WT_QUE_TABLE_ID.", ".WT_QUE_EXP_TIME.", ".WT_QUE_IS_CANCELLED.", ".WT_QUE_RESTAURANT.", ".WT_QUE_BY_CUST.", ".WT_QUE_CREATED_ON.", ".WT_QUE_COMPLETED_ON.RET.				") VALUES (".RET.			"'".mysql_real_escape_string($this->getwt_que_customer())."',".RET.			"'".mysql_real_escape_string($this->getwt_que_cust_ph_no())."',".RET.			"'".mysql_real_escape_string($this->getwt_que_user_id())."',".RET.			"'".mysql_real_escape_string($this->getwt_que_user_type())."',".RET.			"'".mysql_real_escape_string($this->getwt_que_party_size())."',".RET.			"'".mysql_real_escape_string($this->getwt_que_table_type())."',".RET.			"'".mysql_real_escape_string($this->getwt_que_table_id())."',".RET.			"'".mysql_real_escape_string($this->getwt_que_exp_time())."',".RET.			"'".mysql_real_escape_string($this->getwt_que_is_cancelled())."',".RET.			"'".mysql_real_escape_string($this->getwt_que_restaurant())."',".RET.			"'".mysql_real_escape_string($this->getwt_que_by_cust())."',".RET.			"'".mysql_real_escape_string($this->getwt_que_created_on())."',".RET.			"'".mysql_real_escape_string($this->getwt_que_completed_on())."'".RET.			")".RET;			$res = mysql_query($qry);			$this->setwt_que_id(mysql_insert_id());		}	}//..End Insert	public static function delete($array = array()) {		$qry = "DELETE".RET."FROM ".TBL_WAIT_QUEUE.RET;		$and = "WHERE".RET;		if($array[WT_QUE_ID] != "") {			$qry .= $and.WT_QUE_ID." = '".$array[WT_QUE_ID]."'".RET;			$and = "AND".RET;		}		if($array[WT_QUE_CUSTOMER] != "") {			$qry .= $and.WT_QUE_CUSTOMER." = '".$array[WT_QUE_CUSTOMER]."'".RET;			$and = "AND".RET;		}		if($array[WT_QUE_CUST_PH_NO] != "") {			$qry .= $and.WT_QUE_CUST_PH_NO." = '".$array[WT_QUE_CUST_PH_NO]."'".RET;			$and = "AND".RET;		}				if($array[WT_QUE_USER_ID] != "") {				$qry .= $and.WT_QUE_USER_ID." = '".$array[WT_QUE_USER_ID]."'".RET;				$and = "AND".RET;			}						if($array[WT_QUE_USER_TYPE] != "") {				$qry .= $and.WT_QUE_USER_TYPE." = '".$array[WT_QUE_USER_TYPE]."'".RET;				$and = "AND".RET;			} 		if($array[WT_QUE_PARTY_SIZE] != "") {			$qry .= $and.WT_QUE_PARTY_SIZE." = '".$array[WT_QUE_PARTY_SIZE]."'".RET;			$and = "AND".RET;		}		if($array[WT_QUE_TABLE_TYPE] != "") {			$qry .= $and.WT_QUE_TABLE_TYPE." = '".$array[WT_QUE_TABLE_TYPE]."'".RET;			$and = "AND".RET;		}		if($array[WT_QUE_TABLE_ID] != "") {			$qry .= $and.WT_QUE_TABLE_ID." = '".$array[WT_QUE_TABLE_ID]."'".RET;			$and = "AND".RET;		}		if($array[WT_QUE_EXP_TIME] != "") {			$qry .= $and.WT_QUE_EXP_TIME." = '".$array[WT_QUE_EXP_TIME]."'".RET;			$and = "AND".RET;		}		if($array[WT_QUE_IS_CANCELLED] != "") {			$qry .= $and.WT_QUE_IS_CANCELLED." = '".$array[WT_QUE_IS_CANCELLED]."'".RET;			$and = "AND".RET;		}		if($array[WT_QUE_RESTAURANT] != "") {			$qry .= $and.WT_QUE_RESTAURANT." = '".$array[WT_QUE_RESTAURANT]."'".RET;			$and = "AND".RET;		}		if($array[WT_QUE_BY_CUST] != "") {			$qry .= $and.WT_QUE_BY_CUST." = '".$array[WT_QUE_BY_CUST]."'".RET;			$and = "AND".RET;		}		if($array[WT_QUE_CREATED_ON] != "") {			$qry .= $and.WT_QUE_CREATED_ON." = '".$array[WT_QUE_CREATED_ON]."'".RET;			$and = "AND".RET;		}		if($array[WT_QUE_COMPLETED_ON] != "") {			$qry .= $and.WT_QUE_COMPLETED_ON." = '".$array[WT_QUE_COMPLETED_ON]."'".RET;			$and = "AND".RET;		}		$res = mysql_query($qry);		if($res){			return OPERATION_SUCCESS;		};		return OPERATION_FAIL;	}//..End Delete	public function isAlreadyThere($wt_que_customer ,$wt_que_cust_ph_no , $wt_que_user_id, $wt_que_user_type, $wt_que_party_size ,$wt_que_table_type ,$wt_que_table_id ,$wt_que_exp_time ,$wt_que_is_cancelled ,$wt_que_restaurant ,$wt_que_by_cust ,$wt_que_created_on ,$wt_que_completed_on) {		$unique_arr = array();			//$unique_arr[WT_QUE_ID]=$wt_que_id;			 //$unique_arr[WT_QUE_CUSTOMER]=$wt_que_customer;			//$unique_arr[WT_QUE_CUST_PH_NO]=$wt_que_cust_ph_no;						//$unique_arr[WT_QUE_PARTY_SIZE]=$wt_que_party_size;			//$unique_arr[WT_QUE_TABLE_TYPE]=$wt_que_table_type;			//$unique_arr[WT_QUE_TABLE_ID]=$wt_que_table_id;			//$unique_arr[WT_QUE_EXP_TIME]=$wt_que_exp_time;			//$unique_arr[WT_QUE_IS_CANCELLED]=$wt_que_is_cancelled;			//$unique_arr[WT_QUE_RESTAURANT]=$wt_que_restaurant;			//$unique_arr[WT_QUE_BY_CUST]=$wt_que_by_cust;			//$unique_arr[WT_QUE_CREATED_ON]=$wt_que_created_on;			//$unique_arr[WT_QUE_COMPLETED_ON]=$wt_que_completed_on;		if(is_not_empty($unique_arr)){			return $this->readObject($unique_arr);		}		return false;	}//..isAlreadyThere	public function create($wt_que_customer ,$wt_que_cust_ph_no, $wt_que_user_id,$wt_que_user_type ,$wt_que_party_size ,$wt_que_table_type ,$wt_que_table_id ,$wt_que_exp_time ,$wt_que_is_cancelled ,$wt_que_restaurant ,$wt_que_by_cust ,$wt_que_created_on ,$wt_que_completed_on) {		if(is_not_empty($wt_que_customer)){			if($this->isAlreadyThere($wt_que_customer ,$wt_que_cust_ph_no, $wt_que_user_id, $wt_que_user_type ,$wt_que_party_size ,$wt_que_table_type ,$wt_que_table_id ,$wt_que_exp_time ,$wt_que_is_cancelled ,$wt_que_restaurant ,$wt_que_by_cust ,$wt_que_created_on ,$wt_que_completed_on)){				return OPERATION_DUPLICATE;			}else{				$this->setwt_que_id("");				$this->setwt_que_customer($wt_que_customer);				$this->setwt_que_cust_ph_no($wt_que_cust_ph_no);				$this->setwt_que_user_id($wt_que_user_id);				$this->setwt_que_user_type($wt_que_user_type);				$this->setwt_que_party_size($wt_que_party_size);				$this->setwt_que_table_type($wt_que_table_type);				$this->setwt_que_table_id($wt_que_table_id);				$this->setwt_que_exp_time($wt_que_exp_time);				$this->setwt_que_is_cancelled($wt_que_is_cancelled);				$this->setwt_que_restaurant($wt_que_restaurant);				$this->setwt_que_by_cust($wt_que_by_cust);				$this->setwt_que_created_on(date(DATE_FORMAT));				//$this->setwt_que_completed_on($wt_que_completed_on); 				$this->insert(); 				//..for generate future message				$this->generateFutureMsg($this->getwt_que_id());				/*if(is_gt_zero_num($this->getwt_que_id())){					//STEP 1..get the estimation time group					  $est_time_group = tbl_wait_estimation_times::getEstimatedGroupPartySize_TableType($this->getwt_que_table_type(), $this->getwt_que_party_size());										 //STEP 2 ..fetch all the msgs within the time limit and estimation time group					 $est_time_msgs =  tbl_wait_que_time_msgs::readArray(array(WTQ_TIME_MSG_EST_TIME=>$est_time_group['est_time_id'],'MaxTimeLimit'=>$this->getwt_que_exp_time(),SORT_ON=>WT_QUE_EXP_TIME,SORT_BY=>"ASC")); 					 					 if($est_time_msgs){					 	//..now for each message genrate alert with future time					 	$obj = new tbl_alerts();						foreach($est_time_msgs as $msgs){						$future_time = date(DATE_FORMAT,strtotime("+ {$msgs['wtq_time_msg_time']} min",strtotime($this->getwt_que_created_on()))); 						$obj->create(0,$wt_que_cust_ph_no,ALERT_WAIT_MSG,$this->getwt_que_id(),$msgs[WTQ_TIME_MSG_TEXT],1,$future_time);   						} 					  }			  			  ##########################################				} */				return $this->getwt_que_id();			}		}		return OPERATION_FAIL;	}//..create	public function update($wt_que_id, $wt_que_customer, $wt_que_cust_ph_no, $wt_que_user_id, $wt_que_user_type, $wt_que_party_size, $wt_que_table_type, $wt_que_table_id, $wt_que_exp_time, $wt_que_is_cancelled, $wt_que_restaurant, $wt_que_by_cust, $wt_que_created_on, $wt_que_completed_on) {		if(is_gt_zero_num($wt_que_id)){			if ($this->readObject(array(WT_QUE_ID=>$wt_que_id))){				$this->setwt_que_customer($wt_que_customer);				$this->setwt_que_cust_ph_no($wt_que_cust_ph_no);				$this->setwt_que_user_id($wt_que_user_id);				$this->setwt_que_user_type($wt_que_user_type);				$this->setwt_que_party_size($wt_que_party_size);				$this->setwt_que_table_type($wt_que_table_type);				$this->setwt_que_table_id($wt_que_table_id);				$this->setwt_que_exp_time($wt_que_exp_time);				$this->setwt_que_is_cancelled($wt_que_is_cancelled);				$this->setwt_que_restaurant($wt_que_restaurant);				$this->setwt_que_by_cust($wt_que_by_cust);				$this->setwt_que_created_on($wt_que_created_on);				$this->setwt_que_completed_on($wt_que_completed_on);				$this->insert();				return OPERATION_SUCCESS;			}		}		return OPERATION_FAIL;	}//..update	public function activate($wt_que_id){		if(is_gt_zero_num($wt_que_id)){			if ($this->readObject(array(WT_QUE_ID=>$wt_que_id))){				$qry  = "UPDATE ".TBL_WAIT_QUEUE.RET."SET".RET."			".TBL_WAIT_QUEUE_DEACTIVE_DATE." = '".date(EMPTY_DATE_FORMAT)."' WHERE ".WT_QUE_ID."={$wt_que_id}";				$res = mysql_query($qry);				if($res){					return 1;				}			}		}		return 0;	}//..end activate	public function deactivate($wt_que_id, $table_id="", $isCancelled=1){		if(is_gt_zero_num($wt_que_id)){			if ($this->readObject(array(WT_QUE_ID=>$wt_que_id))){			 if(is_not_empty($table_id)==false){			 	$table_id = $this->getwt_que_table_id();			 }							$qry  = "UPDATE ".TBL_WAIT_QUEUE.RET."SET".RET."			".WT_QUE_TABLE_ID."='".mysql_real_escape_string($table_id)."',".WT_QUE_IS_CANCELLED."=".$isCancelled.",".TBL_WAIT_QUEUE_DEACTIVE_DATE." = '".date(DATE_FORMAT)."' WHERE ".WT_QUE_ID."={$wt_que_id}";		 				$res = mysql_query($qry);				if($res){					//..delete all the notification of customer					tbl_alerts::delete(array(ALERT_POST_ID=>$wt_que_id,ALERT_TO_CUST=>1));										return 1;				}			}		}		return 0;	}//..end deactivate	public static function GetInfo($wt_que_id) {		$info = array();		if($wt_que_id != ''){			$obj_tbl_wait_queue = new tbl_wait_queue();			if($obj_tbl_wait_queue->readObject(array('wt_que_id'=>$wt_que_id))){				$info['wt_que_id']=$obj_tbl_wait_queue->getwt_que_id();				$info['wt_que_customer']=$obj_tbl_wait_queue->getwt_que_customer();				$info['wt_que_cust_ph_no']=$obj_tbl_wait_queue->getwt_que_cust_ph_no();				$info['wt_que_user_id']=$obj_tbl_wait_queue->getwt_que_cust_ph_no();				$info['wt_que_user_type']=$obj_tbl_wait_queue->getwt_que_cust_ph_no();				$info['wt_que_party_size']=$obj_tbl_wait_queue->getwt_que_party_size();				$info['wt_que_table_type']=$obj_tbl_wait_queue->getwt_que_table_type();				$info['wt_que_table_id']=$obj_tbl_wait_queue->getwt_que_table_id();				$info['wt_que_exp_time']=$obj_tbl_wait_queue->getwt_que_exp_time();				$info['wt_que_is_cancelled']=$obj_tbl_wait_queue->getwt_que_is_cancelled();				$info['wt_que_restaurant']=$obj_tbl_wait_queue->getwt_que_restaurant();				$info['wt_que_by_cust']=$obj_tbl_wait_queue->getwt_que_by_cust();				$info['wt_que_created_on']=$obj_tbl_wait_queue->getwt_que_created_on();											 				$info['friendly_wt_que_created_on']=friendly_time($obj_tbl_wait_queue->getwt_que_created_on(),1);								$info['wt_que_completed_on']=$obj_tbl_wait_queue->getwt_que_completed_on();				$info['friendly_wt_que_completed_on']=friendly_time($obj_tbl_wait_queue->getwt_que_completed_on(),1);				 $info['wt_que_cur_remain_time']=$obj_tbl_wait_queue->getwt_que_cur_remain_time();				$info['isActive'] = 0;				//..check deactive date is not set or 0				if((is_not_empty($obj_tbl_wait_queue->gettbl_wait_queue_deactive_date())==false)  || (is_gt_zero_num(strtotime($obj_tbl_wait_queue->gettbl_wait_queue_deactive_date()))== false)){					$info['isActive'] = 1;				}else{					//..check the deactive date is greater than todays date					if(strtotime($obj_tbl_wait_queue->gettbl_wait_queue_deactive_date()) > strtotime(date(DATE_FORMAT))){						$info['isActive'] = 1;					}				}								if($info['isActive'] && $info['wt_que_cur_remain_time'] <= 0){						$info['isExpTimeCompleted'] = 1;				}			}		unset($obj_tbl_wait_queue);		return $info;		}	}//..End GetInfo	public static function GetFields($data){		global $tbl_wait_queue_active_condition;		$arr = array();		if(is_not_empty($data)){			$qry ="SELECT ".$data['key_field'].",".$data['value_field']." FROM ".TBL_WAIT_QUEUE."";			if(is_gt_zero_num($data['isActive'])){				$qry .= " WHERE ".$tbl_wait_queue_active_condition;			}			$res = mysql_query($qry); 			if($res){				while($row=mysql_fetch_assoc($res)){					$arr[$row[$data['key_field']]] = $row[$data['value_field']];				}			}		}		return $arr;	}//.. End of GetFields		public static function calculate_est_time($table_type,$party_size,$cur_que_id=0){		$cal_est_time = 0;		if(is_gt_zero_num($_SESSION[SES_EST_TIME])){			$cal_est_time = $_SESSION[SES_EST_TIME]; 		}else{			$record = array(); 			$record = tbl_wait_estimation_times::getEstimatedGroupPartySize_TableType($table_type, $party_size);			/* print_r($record);*/			$que_id =  self::getLastQueuerForDay($table_type, $record['first_limit'],$record['second_limit'],$cur_que_id); 			 			if($que_id > 0){				$que_info = tbl_wait_queue::GetInfo($que_id);				/* print_r($que_info); */				$cal_est_time = $record['est_time']  + $que_info["wt_que_cur_remain_time"];  			}else{				$cal_est_time = $record['est_time'];			} 		}		if($cal_est_time < 0){			$cal_est_time = 0;		} 		return $cal_est_time;	}		public static function getLastQueuerForDay($table_type,$party_size_first_limit,$party_size_second_limit,$cur_que_id=0){		global $tbl_wait_queue_active_condition;		$que_id = 0;		$qry = "SELECT ".WT_QUE_ID." FROM ".TBL_WAIT_QUEUE." WHERE ".WT_QUE_TABLE_TYPE." = ".$table_type. " AND ".WT_QUE_PARTY_SIZE." BETWEEN ".$party_size_first_limit." AND ".$party_size_second_limit." AND ".WT_QUE_ID." <> ".$cur_que_id." AND DATE(".WT_QUE_CREATED_ON.") = CURDATE()  AND ".$tbl_wait_queue_active_condition." ORDER BY ".WT_QUE_ID." DESC LIMIT 1";		//		//echo $qry;		$res = mysql_query($qry);		if($res && is_gt_zero_num(mysql_num_rows($res))){			$que_id = mysql_result($res,0);		}		return $que_id;	}			public static function getQueCompletedExpTime(){		global $tbl_wait_queue_active_condition, $_lang;				$cnt = 0;		$qry = "SELECT ".WT_QUE_ID.",".WT_QUE_CUST_PH_NO.",".WT_QUE_CREATED_ON.",".WT_QUE_COMPLETED_ON." ,(`wt_que_exp_time` - ROUND( TIME_TO_SEC( TIMEDIFF( CURTIME( ) , TIME(  `wt_que_created_on` ) ) ) /60 )) AS ".WT_QUE_CUR_REMAIN_TIME."".RET."FROM ".TBL_WAIT_QUEUE." HAVING ".WT_QUE_CUR_REMAIN_TIME."   <=0 AND DATE(".WT_QUE_CREATED_ON.") = CURDATE() AND ".$tbl_wait_queue_active_condition." WHERE ".WT_QUE_ID." not in (SELECT ".ALERT_POST_ID." FROM ".TBL_ALERTS." WHERE ".ALERT_POST_TYPE."=".ALERT_TIME_OUT.")";		$res = mysql_query($qry);				if($res){			 $obj = new tbl_alerts();			while($row=mysql_fetch_assoc($res)){				$obj->create(0,$row[WT_QUE_CUST_PH_NO] ,ALERT_TIME_OUT ,$row[WT_QUE_ID],$_lang[TBL_ALERTS]['manager'][ALERT_TIME_OUT]);				 $cnt++;			}			 unset($obj);			 		}		return $cnt;	} 		//.. For Generate all The future Messages For Que	public static function generateFutureMsg($que_id){	 if(is_gt_zero_num($que_id)){	 	$que_info = self::GetInfo($que_id);		if(is_not_empty($que_info)){		 //STEP 1..get the estimation time group		  $est_time_group = tbl_wait_estimation_times::getEstimatedGroupPartySize_TableType($que_info['wt_que_table_type'], $que_info['wt_que_party_size']);				 //STEP 2 ..fetch all the msgs within the time limit and estimation time group		 $est_time_msgs =  tbl_wait_que_time_msgs::readArray(array(WTQ_TIME_MSG_EST_TIME=>$est_time_group['est_time_id'],'MaxTimeLimit'=>$que_info['wt_que_exp_time'] )); 		 if($est_time_msgs){		 	//..now for each message genrate alert with future time		 	$obj = new tbl_alerts();			foreach($est_time_msgs as $msgs){			#####################################################			#..calculate future time						# future time =  created time + $msg_remain_time  			# where  msg_remain_time = expected time - msg_time		 	#####################################################			$msg_remain_time = $que_info[WT_QUE_EXP_TIME]- $msgs[WTQ_TIME_MSG_TIME];			//$msg_remain_time = $que_info['wt_que_cur_remain_time'] - $msgs['wtq_time_msg_time'];			$future_time = date(DATE_FORMAT,strtotime("+ {$msg_remain_time} min",strtotime($que_info[WT_QUE_CREATED_ON]))); 			$obj->create(0,$que_info[WT_QUE_CUST_PH_NO],ALERT_WAIT_MSG,$que_id,$msgs[WTQ_TIME_MSG_TEXT],1,$future_time);   			} 			unset($obj);		  }	 		} 	 } 		}		public static function getActiveQueForPhone($phone){		global $tbl_wait_queue_active_condition;		$qry = "SELECT ".WT_QUE_ID." FROM ".TBL_WAIT_QUEUE." WHERE ".WT_QUE_CUST_PH_NO."='".$phone."' AND DATE(".WT_QUE_CREATED_ON.") = CURDATE() AND ".$tbl_wait_queue_active_condition; 		/*echo $qry;*/		$res = mysql_query($qry);		if($res && (is_gt_zero_num(mysql_num_rows($res)))){			return mysql_result($res,0,WT_QUE_ID);		}		return 0;	}		//..this will cancelled all expired Queues	public static function  cancelExpQues(){		$qry  = "UPDATE ".TBL_WAIT_QUEUE.RET."SET".RET.WT_QUE_IS_CANCELLED."=1,".TBL_WAIT_QUEUE_DEACTIVE_DATE." = '".date(DATE_FORMAT)."' WHERE (".TBL_WAIT_QUEUE_DEACTIVE_DATE." is NULL OR ".TBL_WAIT_QUEUE_DEACTIVE_DATE." = 0) AND DATE(".WT_QUE_CREATED_ON.")  < CURDATE()";  		mysql_query($qry); 	}		 }//..End tbl_wait_queue?>