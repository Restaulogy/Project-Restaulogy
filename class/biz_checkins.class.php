<?php/**********************************************************************biz_checkins.class.phpGenerated by STRUCTY 2013.12.28 03:51:52.Copyright 2011 Structy, Frédéric Aebi. All rights reserved.**********************************************************************/define("BIZ_CHECKINS", "biz_checkins"); define('CHKIN_ID', 'chkin_id'); define('CHKIN_BUSS_ID', 'chkin_buss_id'); define('CHKIN_RWD_ID', 'chkin_rwd_id'); define('CHKIN_USER_ID', 'chkin_user_id'); define('CHKIN_SESSION', 'chkin_session'); define('CHKIN_POINTS', 'chkin_points'); define('CHKIN_AMOUNT', 'chkin_amount');define('CHKIN_EDIT_COMMNT', 'chkin_edit_commnt');define('CHKIN_SERV_PIN', 'chkin_serv_pin'); define('CHKIN_DATE', 'chkin_date'); define('CHKIN_INVOICE', 'chkin_invoice'); define("BIZ_CHECKINS_ACTIVE_DATE",  "");define("BIZ_CHECKINS_DEACTIVE_DATE",  "");$biz_checkins_active_condition= " (".BIZ_CHECKINS_DEACTIVE_DATE." is NULL OR ".BIZ_CHECKINS_DEACTIVE_DATE." = 0 OR ".BIZ_CHECKINS_DEACTIVE_DATE." > CURDATE( )) ";class biz_checkins {	private $chkin_id;	private $chkin_buss_id;	private $chkin_rwd_id;	private $chkin_user_id;	private $chkin_session;	private $chkin_points;	private $chkin_date;		private $chkin_amount;	private $chkin_serv_pin;		private $chkin_edit_commnt;	private $chkin_invoice;		private $biz_checkins_active_date;	private $biz_checkins_deactive_date;	public function setchkin_id($pArg="0") {$this->chkin_id=$pArg;}	public function setchkin_buss_id($pArg="0") {$this->chkin_buss_id=$pArg;}	public function setchkin_rwd_id($pArg="0") {$this->chkin_rwd_id=$pArg;}	public function setchkin_user_id($pArg="0") {$this->chkin_user_id=$pArg;}	public function setchkin_session($pArg="0") {$this->chkin_session=$pArg;}	public function setchkin_points($pArg="0") {$this->chkin_points=$pArg;}		public function setchkin_serv_pin($pArg="0") {$this->chkin_serv_pin=$pArg;}		public function setchkin_amount($pArg="0") {$this->chkin_amount=$pArg;}		public function setchkin_edit_commnt($pArg="0") {$this->chkin_edit_commnt=$pArg;}	public function setchkin_invoice($pArg="0") {$this->chkin_invoice=$pArg;}		public function setchkin_date($pArg="0") {$this->chkin_date=$pArg;}	public function setbiz_checkins_active_date($pArg="0") {$this->biz_checkins_active_date=$pArg;}	public function setbiz_checkins_deactive_date($pArg="0") {$this->biz_checkins_deactive_date=$pArg;}	public function getchkin_id() {return $this->chkin_id;}	public function getchkin_buss_id() {return $this->chkin_buss_id;}	public function getchkin_rwd_id() {return $this->chkin_rwd_id;}	public function getchkin_user_id() {return $this->chkin_user_id;}	public function getchkin_session() {return $this->chkin_session;}	public function getchkin_points() {return $this->chkin_points;}		public function getchkin_serv_pin() {return $this->chkin_serv_pin;}	public function getchkin_amount() {return $this->chkin_amount;}		public function getchkin_edit_commnt() {return $this->chkin_edit_commnt;}	public function getchkin_invoice() {return $this->chkin_invoice;}		public function getchkin_date() {return $this->chkin_date;}	public function getbiz_checkins_active_date($pArg="0") {return $this->biz_checkins_active_date;}	public function getbiz_checkins_deactive_date($pArg="0") {return $this->biz_checkins_deactive_date;}	public function readObject($array = array()) {		$qry = "SELECT *".RET."FROM ".BIZ_CHECKINS.RET;		$and = "WHERE".RET;		if($array[CHKIN_ID] != "") {			$qry .= $and.CHKIN_ID." = '".$array[CHKIN_ID]."'".RET;			$and = "AND".RET;		}		if($array[CHKIN_BUSS_ID] != "") {			$qry .= $and.CHKIN_BUSS_ID." = '".$array[CHKIN_BUSS_ID]."'".RET;			$and = "AND".RET;		}		if($array[CHKIN_RWD_ID] != "") {			$qry .= $and.CHKIN_RWD_ID." = '".$array[CHKIN_RWD_ID]."'".RET;			$and = "AND".RET;		}		if($array[CHKIN_USER_ID] != "") {			$qry .= $and.CHKIN_USER_ID." = '".$array[CHKIN_USER_ID]."'".RET;			$and = "AND".RET;		}		if($array[CHKIN_SESSION] != "") {			$qry .= $and.CHKIN_SESSION." = '".$array[CHKIN_SESSION]."'".RET;			$and = "AND".RET;		}		if($array[CHKIN_POINTS] != "") {			$qry .= $and.CHKIN_POINTS." = '".$array[CHKIN_POINTS]."'".RET;			$and = "AND".RET;		}				if($array[CHKIN_SERV_PIN] != "") {			$qry .= $and.CHKIN_SERV_PIN." = ".$array[CHKIN_SERV_PIN]."".RET;			$and = "AND".RET;		}		if($array[CHKIN_DATE] != "") {			$qry .= $and.CHKIN_DATE." = '".$array[CHKIN_DATE]."'".RET;			$and = "AND".RET;		}				if($array[CHKIN_AMOUNT] != "") {			$qry .= $and.CHKIN_AMOUNT." = '".$array[CHKIN_AMOUNT]."'".RET;			$and = "AND".RET;		}				if($array[CHKIN_INVOICE] != "") {			$qry .= $and.CHKIN_INVOICE." = '".$array[CHKIN_INVOICE]."'".RET;			$and = "AND".RET;		}					$result = mysql_query($qry);		if($result) {			while ($row = mysql_fetch_array($result)) {				$record = $row;				break;//end after first record			}			if(count($record[0]) == 0) {				return array();			} else {				$this->setchkin_id($record[CHKIN_ID]);				$this->setchkin_buss_id($record[CHKIN_BUSS_ID]);				$this->setchkin_rwd_id($record[CHKIN_RWD_ID]);				$this->setchkin_user_id($record[CHKIN_USER_ID]);				$this->setchkin_session($record[CHKIN_SESSION]);				$this->setchkin_points($record[CHKIN_POINTS]);								$this->setchkin_serv_pin($record[CHKIN_SERV_PIN]);				$this->setchkin_amount($record[CHKIN_AMOUNT]);								$this->setchkin_edit_commnt($record[CHKIN_EDIT_COMMNT]);				$this->setchkin_invoice($record[CHKIN_INVOICE]);								$this->setchkin_date($record[CHKIN_DATE]);				$this->setbiz_checkins_active_date($record[BIZ_CHECKINS_ACTIVE_DATE]);				$this->setbiz_checkins_deactive_date($record[BIZ_CHECKINS_DEACTIVE_DATE]);				return true;			}		}	}	public static function readArray($array = array(),&$result_found=0,$isArray=1) {		global $biz_checkins_active_condition;		$qry = "SELECT *".RET."FROM ".BIZ_CHECKINS.RET;		$and = "WHERE".RET;		if($array[CHKIN_ID] != "") {			$qry .= $and.CHKIN_ID." = '".$array[CHKIN_ID]."'".RET;			$and = "AND".RET;		}		if($array[CHKIN_BUSS_ID] != "") {			$qry .= $and.CHKIN_BUSS_ID." = '".$array[CHKIN_BUSS_ID]."'".RET;			$and = "AND".RET;		}		if($array[CHKIN_RWD_ID] != "") {			$qry .= $and.CHKIN_RWD_ID." = '".$array[CHKIN_RWD_ID]."'".RET;			$and = "AND".RET;		}		if($array[CHKIN_USER_ID] != "") {			$qry .= $and.CHKIN_USER_ID." = '".$array[CHKIN_USER_ID]."'".RET;			$and = "AND".RET;		}		if($array[CHKIN_SESSION] != "") {			$qry .= $and.CHKIN_SESSION." = '".$array[CHKIN_SESSION]."'".RET;			$and = "AND".RET;		}		if($array[CHKIN_POINTS] != "") {			$qry .= $and.CHKIN_POINTS." = '".$array[CHKIN_POINTS]."'".RET;			$and = "AND".RET;		}		if($array[CHKIN_SERV_PIN] != "") {			$qry .= $and.CHKIN_SERV_PIN." = ".$array[CHKIN_SERV_PIN]."".RET;			$and = "AND".RET;		}				if($array[CHKIN_DATE] != "") {			$qry .= $and.CHKIN_DATE." = '".$array[CHKIN_DATE]."'".RET;			$and = "AND".RET;		}				if($array[CHKIN_AMOUNT] != "") {			$qry .= $and.CHKIN_AMOUNT." = '".$array[CHKIN_AMOUNT]."'".RET;			$and = "AND".RET;		}				if($array[CHKIN_INVOICE] != "") {			$qry .= $and.CHKIN_INVOICE." = '".$array[CHKIN_INVOICE]."'".RET;			$and = "AND".RET;		}				if(is_not_empty($array['search_from_dt']) && is_not_empty($array['search_to_dt'])){				$qry .= $and.CHKIN_DATE.' >= \''.date('Y-m-d 00:00:00',strtotime($array['search_from_dt'])).'\''.RET.'AND '.CHKIN_DATE.' <= \''.date('Y-m-d 23:59:59',strtotime($array['search_to_dt'])).'\''.RET;			$and = 'AND'.RET;		}				if(is_gt_zero_num($array['todays_only'])){						$qry .= $and.CHKIN_DATE.' >= \''.date('Y-m-d 00:00:00').'\''.RET.'AND '.CHKIN_DATE.' <= \''.date('Y-m-d 23:59:59').'\''.RET;			$and = 'AND'.RET;		}			if(is_gt_zero_num($array["isActive"])) {			$qry .= $and.$biz_checkins_active_condition;;			$and = "AND".RET;		}		if(is_not_empty($array[SORT_ON]) && is_not_empty($array[SORT_BY])) {		$qry .=" ORDER BY ".$array[SORT_ON]." ".$array[SORT_BY];		}		if(is_not_empty($array[OFFSET_TITLE]) && is_not_empty($array[LIMIT_TITLE])) {			$qry_with_limit  = $qry." LIMIT ".$array[OFFSET_TITLE].",".$array[LIMIT_TITLE];		}else{			$qry_with_limit  = $qry;		}		//echo $qry_with_limit;		$result = mysql_query ($qry_with_limit);		$r1 = mysql_query($qry);		if($r1){			$result_found = mysql_num_rows($r1);		}		$class_objects = array();		if($result) {			while ($record = mysql_fetch_assoc($result)) {				$isActive= 0;				/*//..check deactive date is not set or 0				if((is_not_empty($record[BIZ_CHECKINS_DEACTIVE_DATE])==false) || (is_gt_zero_num(strtotime($record[BIZ_CHECKINS_DEACTIVE_DATE]))== false)){					$isActive = 1; 				}else{					//..check the deactive date is greater than todays date					if(strtotime($record[BIZ_CHECKINS_DEACTIVE_DATE]) > strtotime(date(DATE_FORMAT))){						$isActive = 1;					}				}*/				if($isArray){					$class_object = array();					$class_object["chkin_id"]=$record[CHKIN_ID];					$class_object["chkin_buss_id"]=$record[CHKIN_BUSS_ID];					$class_object["chkin_rwd_id"]=$record[CHKIN_RWD_ID];					$class_object["chkin_user_id"]=$record[CHKIN_USER_ID];					$class_object["chkin_session"]=$record[CHKIN_SESSION];					$class_object["chkin_points"]=$record[CHKIN_POINTS];										$class_object["chkin_amount"]=$record[CHKIN_AMOUNT];					$class_object["chkin_edit_commnt"]=$record[CHKIN_EDIT_COMMNT];					$class_object["chkin_invoice"]=$record[CHKIN_INVOICE];										$class_object["chkin_serv_pin"]=$record[CHKIN_SERV_PIN];										$class_object["chkin_date"]=$record[CHKIN_DATE];					$class_object["isActive"]=$isActive;				}else{					$class_object = new biz_checkins();					$class_object->setchkin_id($record[CHKIN_ID]);					$class_object->setchkin_buss_id($record[CHKIN_BUSS_ID]);					$class_object->setchkin_rwd_id($record[CHKIN_RWD_ID]);					$class_object->setchkin_user_id($record[CHKIN_USER_ID]);										$class_object->setchkin_serv_pin($record[CHKIN_SERV_PIN]);										$class_object->setchkin_amount($record[CHKIN_AMOUNT]);					$class_object->setchkin_edit_commnt($record[CHKIN_EDIT_COMMNT]);					$class_object->setchkin_invoice($record[CHKIN_INVOICE]);										$class_object->setchkin_session($record[CHKIN_SESSION]);					$class_object->setchkin_points($record[CHKIN_POINTS]);					$class_object->setchkin_date($record[CHKIN_DATE]);				}				$class_objects[$record[CHKIN_ID]] = $class_object;			}		}		return $class_objects;	}//..End readArray	public function insert() {		if($this->getchkin_id() != '') {			$qry  = "UPDATE ".BIZ_CHECKINS.RET."SET".RET."			".CHKIN_ID." = '".$this->getchkin_id()."',".RET."			".CHKIN_BUSS_ID." = '".$this->getchkin_buss_id()."',".RET."			".CHKIN_RWD_ID." = '".$this->getchkin_rwd_id()."',".RET."			".CHKIN_USER_ID." = '".$this->getchkin_user_id()."',".RET."			".CHKIN_SESSION." = '".$this->getchkin_session()."',".RET."			".CHKIN_POINTS." = '".$this->getchkin_points()."',".RET."						".CHKIN_SERV_PIN." = '".$this->getchkin_serv_pin()."',".RET."			".CHKIN_AMOUNT." = '".$this->getchkin_amount()."',".RET."						".CHKIN_EDIT_COMMNT." = '".$this->getchkin_edit_commnt()."',".RET."			".CHKIN_INVOICE." = '".$this->getchkin_invoice()."',".RET."						".CHKIN_DATE." = '".$this->getchkin_date()."'".RET.			"WHERE ".CHKIN_ID." = ".$this->getchkin_id().RET;			mysql_query($qry);		} else {			$qry  = "INSERT INTO ".BIZ_CHECKINS." (".RET.			"".CHKIN_BUSS_ID.", ".CHKIN_RWD_ID.", ".CHKIN_USER_ID.", ".CHKIN_SESSION.", ".CHKIN_POINTS.", ".CHKIN_SERV_PIN.", ".CHKIN_AMOUNT.", ".CHKIN_EDIT_COMMNT.", ".CHKIN_DATE.", ".CHKIN_INVOICE.RET.				") VALUES (".RET.			"'".$this->getchkin_buss_id()."',".RET.			"'".$this->getchkin_rwd_id()."',".RET.			"'".$this->getchkin_user_id()."',".RET.			"'".$this->getchkin_session()."',".RET.			"'".$this->getchkin_points()."',".RET.						"'".$this->getchkin_serv_pin()."',".RET.			"'".$this->getchkin_amount()."',".RET.						"'".$this->getchkin_edit_commnt()."',".RET.						"'".$this->getchkin_date()."',".RET.			"'".$this->getchkin_invoice()."'".RET.			")".RET;			$res = mysql_query($qry);			$this->setchkin_id(mysql_insert_id());		}	}//..End Insert	public static function delete($array = array()) {		$qry = "DELETE".RET."FROM ".BIZ_CHECKINS.RET;		$and = "WHERE".RET;		if($array[CHKIN_ID] != "") {			$qry .= $and.CHKIN_ID." = '".$array[CHKIN_ID]."'".RET;			$and = "AND".RET;		}		if($array[CHKIN_BUSS_ID] != "") {			$qry .= $and.CHKIN_BUSS_ID." = '".$array[CHKIN_BUSS_ID]."'".RET;			$and = "AND".RET;		}		if($array[CHKIN_RWD_ID] != "") {			$qry .= $and.CHKIN_RWD_ID." = '".$array[CHKIN_RWD_ID]."'".RET;			$and = "AND".RET;		}		if($array[CHKIN_USER_ID] != "") {			$qry .= $and.CHKIN_USER_ID." = '".$array[CHKIN_USER_ID]."'".RET;			$and = "AND".RET;		}		if($array[CHKIN_SESSION] != "") {			$qry .= $and.CHKIN_SESSION." = '".$array[CHKIN_SESSION]."'".RET;			$and = "AND".RET;		}		if($array[CHKIN_POINTS] != "") {			$qry .= $and.CHKIN_POINTS." = '".$array[CHKIN_POINTS]."'".RET;			$and = "AND".RET;		}		if($array[CHKIN_DATE] != "") {			$qry .= $and.CHKIN_DATE." = '".$array[CHKIN_DATE]."'".RET;			$and = "AND".RET;		}				if($array[CHKIN_INVOICE] != "") {			$qry .= $and.CHKIN_INVOICE." = '".$array[CHKIN_INVOICE]."'".RET;			$and = "AND".RET;		}		$res = mysql_query($qry);		if($res){			return OPERATION_SUCCESS;		};		return OPERATION_FAIL;	}//..End Delete	public function isAlreadyThere($chkin_buss_id ,$chkin_rwd_id ,$chkin_user_id ,$chkin_session ,$chkin_points ,$chkin_date) {		$unique_arr = array();			//$unique_arr[CHKIN_ID]=$chkin_id;			//$unique_arr[CHKIN_BUSS_ID]=$chkin_buss_id;			//$unique_arr[CHKIN_RWD_ID]=$chkin_rwd_id;			//$unique_arr[CHKIN_USER_ID]=$chkin_user_id;			//$unique_arr[CHKIN_SESSION]=$chkin_session;			//$unique_arr[CHKIN_POINTS]=$chkin_points;			//$unique_arr[CHKIN_DATE]=$chkin_date;		if(is_not_empty($unique_arr)){			return $this->readObject($unique_arr);		}		return false;	}//..isAlreadyThere	public function create($chkin_buss_id ,$chkin_rwd_id ,$chkin_user_id ,$chkin_session ,$chkin_points ,$chkin_date,$chkin_serv_pin=0,$chkin_amount=0,$chkin_edit_commnt='',$chkin_invoice='') {		if(is_not_empty($chkin_buss_id)){			if($this->isAlreadyThere($chkin_buss_id ,$chkin_rwd_id ,$chkin_user_id ,$chkin_session ,$chkin_points ,$chkin_date)){				return OPERATION_DUPLICATE;			}else{				$this->setchkin_id("");				$this->setchkin_buss_id($chkin_buss_id);				$this->setchkin_rwd_id($chkin_rwd_id);				$this->setchkin_user_id($chkin_user_id);				$this->setchkin_session($chkin_session);				$this->setchkin_points($chkin_points);								if($_SESSION['rest_menu_opt_det'][RST_MNU_REWARD_CONF]=='RESTAURANT' && $Global_member['member_role_id'] != ROLE_SERVER){					$chkin_serv_pin=0;				}				$this->setchkin_serv_pin($chkin_serv_pin);								$this->setchkin_amount($chkin_amount);				$this->setchkin_edit_commnt($chkin_edit_commnt);								$this->setchkin_invoice($chkin_invoice); 								$this->setchkin_date(date(DATE_FORMAT));				$this->insert();				return $this->getchkin_id();			}		}		return OPERATION_FAIL;	}//..create	public function update($chkin_id, $chkin_buss_id, $chkin_rwd_id, $chkin_user_id, $chkin_session, $chkin_points, $chkin_date,$chkin_serv_pin=0,$chkin_amount=0,$chkin_edit_commnt='',$chkin_invoice='') {		if(is_gt_zero_num($chkin_id)){			if ($this->readObject(array(CHKIN_ID=>$chkin_id))){				$this->setchkin_buss_id($chkin_buss_id);				$this->setchkin_rwd_id($chkin_rwd_id);				$this->setchkin_user_id($chkin_user_id);				$this->setchkin_session($chkin_session);				$this->setchkin_points($chkin_points);								$this->setchkin_amount($chkin_amount);				$this->setchkin_edit_commnt($chkin_edit_commnt);				$this->setchkin_invoice($chkin_invoice);				$this->setchkin_serv_pin($chkin_serv_pin);								//$this->setchkin_date($chkin_date);				$this->insert();				return OPERATION_SUCCESS;			}		}		return OPERATION_FAIL;	}//..update	public function activate($chkin_id){		if(is_gt_zero_num($chkin_id)){			if ($this->readObject(array(CHKIN_ID=>$chkin_id))){				$qry  = "UPDATE ".BIZ_CHECKINS.RET."SET".RET."			".BIZ_CHECKINS_DEACTIVE_DATE." = '".date(EMPTY_DATE_FORMAT)."' WHERE ".CHKIN_ID."={$chkin_id}";				$res = mysql_query($qry);				if($res){					return 1;				}			}		}		return 0;	}//..end activate	public function deactivate($chkin_id){		if(is_gt_zero_num($chkin_id)){			if ($this->readObject(array(CHKIN_ID=>$chkin_id))){				$qry  = "UPDATE ".BIZ_CHECKINS.RET."SET".RET."			".BIZ_CHECKINS_DEACTIVE_DATE." = '".date(DATE_FORMAT)."' WHERE ".CHKIN_ID."={$chkin_id}";				$res = mysql_query($qry);				if($res){					return 1;				}			}		}		return 0;	}//..end deactivate		public function update_point($chkin_id,$chkin_points,$chkin_edit_commnt=''){		if(is_gt_zero_num($chkin_id)){			if ($this->readObject(array(CHKIN_ID=>$chkin_id))){				$qry  = "UPDATE ".BIZ_CHECKINS.RET."SET".RET."			`".CHKIN_POINTS."` = ".$chkin_points.",`".CHKIN_EDIT_COMMNT."` = '".$chkin_edit_commnt."' WHERE ".CHKIN_ID."={$chkin_id}";				$res = mysql_query($qry);				if($res){					return 1;				}			}		}		return 0;	}//..end update_point		public static function GetInfo($chkin_id) {		$info = array();		if($chkin_id != ""){			$obj_biz_checkins = new biz_checkins();			if($obj_biz_checkins->readObject(array("chkin_id"=>$chkin_id))){				$info["chkin_id"]=$obj_biz_checkins->getchkin_id();				$info["chkin_buss_id"]=$obj_biz_checkins->getchkin_buss_id();				$info["chkin_rwd_id"]=$obj_biz_checkins->getchkin_rwd_id();				$info["chkin_user_id"]=$obj_biz_checkins->getchkin_user_id();				$info["chkin_session"]=$obj_biz_checkins->getchkin_session();				$info["chkin_points"]=$obj_biz_checkins->getchkin_points();								$info["chkin_amount"]=$obj_biz_checkins->getchkin_amount();				$info["chkin_edit_commnt"]=$obj_biz_checkins->getchkin_edit_commnt();				$info["chkin_invoice"]=$obj_biz_checkins->getchkin_invoice();								$info["chkin_serv_pin"]=$obj_biz_checkins->getchkin_serv_pin();								$info["chkin_date"]=$obj_biz_checkins->getchkin_date();				$info["isActive"] = 0;				/*//..check deactive date is not set or 0				if((is_not_empty($obj_biz_checkins->getbiz_checkins_deactive_date())==false)  || (is_gt_zero_num(strtotime($obj_biz_checkins->getbiz_checkins_deactive_date()))== false)){					$info["isActive"] = 1;				}else{					//..check the deactive date is greater than todays date					if(strtotime($obj_biz_checkins->getbiz_checkins_deactive_date()) > strtotime(date(DATE_FORMAT))){						$info["isActive"] = 1;					}				}*/			}		unset($obj_biz_checkins);		return $info;		}	}//..End GetInfo	public static function GetFields($data){		global $biz_checkins_active_condition;		$arr = array();		if(is_not_empty($data)){			$qry ="SELECT ".$data['key_field'].",".$data['value_field']." FROM ".BIZ_CHECKINS."";			if(is_gt_zero_num($data['isActive'])){				$qry .= " WHERE ".$biz_checkins_active_condition;			}			$res = mysql_query($qry); 			if($res){				while($row=mysql_fetch_assoc($res)){					$arr[$row[$data['key_field']]] = $row[$data['value_field']];				}			}		}		return $arr;	}//.. End of GetFields		public static function chk_if_record_wthin_2_hrs($cust_id,$tbl_id){				$is_found=DB::ExecScalarQry('SELECT COUNT(`'.CHKIN_ID.'`) as `is_fnd` FROM `'.BIZ_CHECKINS.'` WHERE  `'.CHKIN_USER_ID.'`='.$cust_id.' AND `'.CHKIN_SESSION.'`='.$tbl_id.' AND `'.CHKIN_DATE.'` > SUBDATE( "'.date(DATE_FORMAT).'", INTERVAL 2 HOUR);');		return $is_found;	} 		public static function _get_award_redeem_history($array = array(),&$result_found=0,$isArray=1) {		global $biz_checkins_active_condition;		//$qry = "SELECT *".RET."FROM ".BIZ_CHECKINS.RET;					$filt_cond='';					if(is_not_empty($array['search_from_dt']) && is_not_empty($array['search_to_dt'])){				$filt_cond = ' AND `posted_on` >= \''.date('Y-m-d 00:00:00',strtotime($array['search_from_dt'])).'\''.RET.'AND `posted_on` <= \''.date('Y-m-d 23:59:59',strtotime($array['search_to_dt'])).'\'';		}						//ORDER BY `c`.`chkin_date` DESC 		$qry=  'SELECT `c`.`chkin_buss_id`, `s`.`staff_phone`,`s`.`staff_lname`,`s`.`staff_fname`,									 `s`.`staff_member_id`,`c`.`chkin_points` as `award_points`,									 "--" as `promotion`,"--" as `reward_point`,									 `c`.`chkin_serv_pin` as `server_pin`,`c`.`chkin_date` as `posted_on`,									 `c`.`chkin_id` ,`c`.`chkin_edit_commnt`,`c`.`chkin_invoice` as `invoice` 						FROM `'.BIZ_CHECKINS.'` `c`			 						INNER JOIN '.MEMBERS.' as `m` ON 						`c`.`chkin_user_id`=`m`.`id` 						INNER JOIN `'.TBL_STAFF.'` as `s` ON						`s`.`'.STAFF_MEMBER_ID.'`=`m`.`id` 					  HAVING `c`.`chkin_buss_id`='.$array[SES_RESTAURANT].$filt_cond.'												UNION														SELECT `r`.`rwd_buss_id`,`s`.`staff_phone`,`s`.`staff_lname`,`s`.`staff_fname`,									 `s`.`staff_member_id`,"--" as `award_points`,									 `p`.`title` as `promotion`,`c`.`rwd_points` as `reward_point`,									 `c`.`cup_serv_pin` as `server_pin`,`c`.`redimed_date` as `posted_on`,									 "0" as `chkin_id`,"--" as `chkin_edit_commnt`,`c`.`rwd_invoice` as `invoice`						FROM `pds_redim_cupons` as `c`						INNER JOIN `'.BIZ_REWARDS.'` as `r` ON  						`r`.`'.RWD_ID.'`=`c`.`rwd_deals_sel`						INNER JOIN `pds_list_promotions` as `p` ON 						`p`.`id` = `c`.`promotion_id`												INNER JOIN '.MEMBERS.' as `m` ON 						`c`.`rwd_usr_id`=`m`.`id` 						INNER JOIN `'.TBL_STAFF.'` as `s` ON						`s`.`'.STAFF_MEMBER_ID.'`=`m`.`id` 					  HAVING `r`.`rwd_buss_id`='.$array[SES_RESTAURANT].$filt_cond.'						ORDER BY `posted_on` DESC';								if(is_not_empty($array[OFFSET_TITLE]) && is_not_empty($array[LIMIT_TITLE])) {			$qry_with_limit  = $qry." LIMIT ".$array[OFFSET_TITLE].",".$array[LIMIT_TITLE];		}else{			$qry_with_limit  = $qry;		}					//echo $qry_with_limit;		//exit;				$result = mysql_query ($qry_with_limit);		$r1 = mysql_query($qry);		if($r1){			$result_found = mysql_num_rows($r1);		}		$class_objects = array();		$cnt=0;		if($result) {			while ($record = mysql_fetch_assoc($result)) {				$isActive= 0;								if($isArray){					$class_object = array();										$class_object["name"]=implode(' ',array($record['staff_fname'],$record['staff_lname']));					//$class_object["email"]=$record['email'];						$class_object["phone"]=$record['staff_phone'];											$class_object['usr_without_email']=_chk_if_usr_witout_email($record['email']);								$class_object["award_points"]=$record['award_points'];					$class_object["promotion"]=$record['promotion'];					$class_object["reward_point"]=$record['reward_point'];					if(is_gt_zero_num($record['server_pin'])){						//..get the server id from the pin ID						$tbl_server_pin_record=tbl_server_pin::GetInfo($record['server_pin']);						if(is_not_empty($tbl_server_pin_record))							$class_object["server_name"]=GetMembersFromIDs($tbl_server_pin_record[SRV_PIN_SERVER]) ;						unset($tbl_server_pin_record);					}					$class_object["posted_on"]=$record['posted_on'];						$class_object["chkin_id"]=$record['chkin_id'];					$class_object["chkin_edit_commnt"]=$record['chkin_edit_commnt'];					$class_object["chkin_invoice"]=$record['invoice'];									$class_object["isActive"]=$isActive;				}								$class_objects[$cnt] = $class_object;				$cnt++;			}		}		return $class_objects;	}//..End readArray}//..End biz_checkins?>