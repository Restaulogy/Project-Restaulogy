<?php/**********************************************************************tbl_sub_menu.class.phpGenerated by STRUCTY 2013.04.15 07:15:22.Copyright 2011 Structy, Frédéric Aebi. All rights reserved.**********************************************************************/define("TBL_SUB_MENU", "tbl_sub_menu"); define('SUBMNU_ID', 'submnu_id'); define('SUBMNU_IMAGE', 'submnu_image');define('SUBMNU_NAME', 'submnu_name'); define('SUBMNU_MENU', 'submnu_menu'); define('SUBMNU_DISPLAY_ORDER', 'submnu_display_order'); define('SUBMNU_DESCRIPTION', 'submnu_description'); define('SUBMNU_SPL_NOTE', 'submnu_spl_note'); define('SUBMNU_START_DATE', 'submnu_start_date'); define('SUBMNU_END_DATE', 'submnu_end_date'); define("TBL_SUB_MENU_ACTIVE_DATE",  SUBMNU_START_DATE);define("TBL_SUB_MENU_DEACTIVE_DATE",  SUBMNU_END_DATE);$tbl_sub_menu_active_condition= " (".TBL_SUB_MENU_DEACTIVE_DATE." is NULL OR ".TBL_SUB_MENU_DEACTIVE_DATE." = 0 OR ".TBL_SUB_MENU_DEACTIVE_DATE." > NOW( )) ";class tbl_sub_menu {	private $submnu_id;		private $submnu_image;		private $submnu_name;	private $submnu_menu;	private $submnu_display_order;	private $submnu_description;	private $submnu_spl_note;	private $submnu_start_date;	private $submnu_end_date;	private $tbl_sub_menu_active_date;	private $tbl_sub_menu_deactive_date;	public function setsubmnu_id($pArg="0") {$this->submnu_id=$pArg;}		public function setsubmnu_image($pArg="0") {$this->submnu_image=$pArg;}		public function setsubmnu_name($pArg="0") {$this->submnu_name=$pArg;}	public function setsubmnu_menu($pArg="0") {$this->submnu_menu=$pArg;}	public function setsubmnu_display_order($pArg="0") {$this->submnu_display_order=$pArg;}	public function setsubmnu_description($pArg="0") {$this->submnu_description=$pArg;}	public function setsubmnu_spl_note($pArg="0") {$this->submnu_spl_note=$pArg;}	public function setsubmnu_start_date($pArg="0") {$this->submnu_start_date=$pArg;}	public function setsubmnu_end_date($pArg="0") {$this->submnu_end_date=$pArg;}	public function settbl_sub_menu_active_date($pArg="0") {$this->tbl_sub_menu_active_date=$pArg;}	public function settbl_sub_menu_deactive_date($pArg="0") {$this->tbl_sub_menu_deactive_date=$pArg;}	public function getsubmnu_id() {return $this->submnu_id;}		public function getsubmnu_image() {return $this->submnu_image;}		public function getsubmnu_name() {return $this->submnu_name;}	public function getsubmnu_menu() {return $this->submnu_menu;}	public function getsubmnu_display_order() {return $this->submnu_display_order;}	public function getsubmnu_description() {return $this->submnu_description;}	public function getsubmnu_spl_note() {return $this->submnu_spl_note;}	public function getsubmnu_start_date() {return $this->submnu_start_date;}	public function getsubmnu_end_date() {return $this->submnu_end_date;}	public function gettbl_sub_menu_active_date($pArg="0") {return $this->tbl_sub_menu_active_date;}	public function gettbl_sub_menu_deactive_date($pArg="0") {return $this->tbl_sub_menu_deactive_date;}	public function readObject($array = array()) {		$qry = "SELECT *".RET."FROM ".TBL_SUB_MENU.RET;		$and = "WHERE".RET;		if($array[SUBMNU_ID] != "") {			$qry .= $and.SUBMNU_ID." = '".$array[SUBMNU_ID]."'".RET;			$and = "AND".RET;		}		if($array[SUBMNU_NAME] != "") {			$qry .= $and.SUBMNU_NAME." = '".$array[SUBMNU_NAME]."'".RET;			$and = "AND".RET;		}		if($array[SUBMNU_MENU] != "") {			$qry .= $and.SUBMNU_MENU." = '".$array[SUBMNU_MENU]."'".RET;			$and = "AND".RET;		}		if($array[SUBMNU_DISPLAY_ORDER] != "") {			$qry .= $and.SUBMNU_DISPLAY_ORDER." = '".$array[SUBMNU_DISPLAY_ORDER]."'".RET;			$and = "AND".RET;		}		if($array[SUBMNU_DESCRIPTION] != "") {			$qry .= $and.SUBMNU_DESCRIPTION." = '".$array[SUBMNU_DESCRIPTION]."'".RET;			$and = "AND".RET;		}		if($array[SUBMNU_SPL_NOTE] != "") {			$qry .= $and.SUBMNU_SPL_NOTE." = '".$array[SUBMNU_SPL_NOTE]."'".RET;			$and = "AND".RET;		}		if($array[SUBMNU_START_DATE] != "") {			$qry .= $and.SUBMNU_START_DATE." = '".$array[SUBMNU_START_DATE]."'".RET;			$and = "AND".RET;		}		if($array[SUBMNU_END_DATE] != "") {			$qry .= $and.SUBMNU_END_DATE." = '".$array[SUBMNU_END_DATE]."'".RET;			$and = "AND".RET;		}	$result = mysql_query($qry);		if($result) {			while ($row = mysql_fetch_array($result)) {				$record = $row;				break;//end after first record			}			if(count($record[0]) == 0) {				return array();			} else {				$this->setsubmnu_id($record[SUBMNU_ID]);								$this->setsubmnu_image($record[SUBMNU_IMAGE]);								$this->setsubmnu_name($record[SUBMNU_NAME]);				$this->setsubmnu_menu($record[SUBMNU_MENU]);				$this->setsubmnu_display_order($record[SUBMNU_DISPLAY_ORDER]);				$this->setsubmnu_description($record[SUBMNU_DESCRIPTION]);				$this->setsubmnu_spl_note($record[SUBMNU_SPL_NOTE]);				$this->setsubmnu_start_date($record[SUBMNU_START_DATE]);				$this->setsubmnu_end_date($record[SUBMNU_END_DATE]);				$this->settbl_sub_menu_active_date($record[TBL_SUB_MENU_ACTIVE_DATE]);				$this->settbl_sub_menu_deactive_date($record[TBL_SUB_MENU_DEACTIVE_DATE]);				return true;			}		}	}	public static function readArray($array = array(),&$result_found=0,$isArray=1) {		global $tbl_sub_menu_active_condition;		$qry = "SELECT *".RET."FROM ".TBL_SUB_MENU." INNER JOIN ".TBL_MENU." ON ".SUBMNU_MENU."=".MENU_ID.RET;		$and = "WHERE".RET;		if($array[SUBMNU_ID] != "") {			$qry .= $and.SUBMNU_ID." IN (".$array[SUBMNU_ID].")".RET;			$and = "AND".RET;		}		if($array[SUBMNU_NAME] != "") {			$qry .= $and.SUBMNU_NAME." = '".$array[SUBMNU_NAME]."'".RET;			$and = "AND".RET;		}		if($array[SUBMNU_MENU] != "") {			$qry .= $and.SUBMNU_MENU." = '".$array[SUBMNU_MENU]."'".RET;			$and = "AND".RET;		}		if($array[SUBMNU_DISPLAY_ORDER] != "") {			$qry .= $and.SUBMNU_DISPLAY_ORDER." = '".$array[SUBMNU_DISPLAY_ORDER]."'".RET;			$and = "AND".RET;		}		if($array[SUBMNU_DESCRIPTION] != "") {			$qry .= $and.SUBMNU_DESCRIPTION." = '".$array[SUBMNU_DESCRIPTION]."'".RET;			$and = "AND".RET;		}		if($array[SUBMNU_SPL_NOTE] != "") {			$qry .= $and.SUBMNU_SPL_NOTE." = '".$array[SUBMNU_SPL_NOTE]."'".RET;			$and = "AND".RET;		}		if($array[SUBMNU_START_DATE] != "") {			$qry .= $and.SUBMNU_START_DATE." = '".$array[SUBMNU_START_DATE]."'".RET;			$and = "AND".RET;		}		if($array[SUBMNU_END_DATE] != "") {			$qry .= $and.SUBMNU_END_DATE." = '".$array[SUBMNU_END_DATE]."'".RET;			$and = "AND".RET;		}				if($array[MENU_RESTAURENT] != "") {			$qry .= $and.MENU_RESTAURENT." = '".$array[MENU_RESTAURENT]."'".RET;			$and = "AND".RET;		}		if(is_gt_zero_num($array["isActive"])) {			$qry .= $and.$tbl_sub_menu_active_condition;;			$and = "AND".RET;		}		if(is_not_empty($array[SORT_ON]) && is_not_empty($array[SORT_BY])) {			$qry .=" ORDER BY ".$array[SORT_ON]." ".$array[SORT_BY];						}else{			$qry .=" ORDER BY ".SUBMNU_DISPLAY_ORDER." ASC";			}		if(is_not_empty($array[OFFSET_TITLE]) && is_not_empty($array[LIMIT_TITLE])) {			$qry_with_limit  = $qry." LIMIT ".$array[OFFSET_TITLE].",".$array[LIMIT_TITLE];		}else{			$qry_with_limit  = $qry;		}		$result = mysql_query ($qry_with_limit);		$r1 = mysql_query($qry);		if($r1){			$result_found = mysql_num_rows($r1);		}		$class_objects = array();		if($result) {			while ($record = mysql_fetch_assoc($result)) {				$isActive= 0;				//..check deactive date is not set or 0				if((is_not_empty($record[TBL_SUB_MENU_DEACTIVE_DATE])==false) || (is_gt_zero_num(strtotime($record[TBL_SUB_MENU_DEACTIVE_DATE]))== false)){					$isActive = 1; 				}else{					//..check the deactive date is greater than todays date					if(strtotime($record[TBL_SUB_MENU_DEACTIVE_DATE]) > strtotime(date(DATE_FORMAT))){						$isActive = 1;					}				}				if($isArray){					$class_object = array();					$class_object["submnu_id"]=$record[SUBMNU_ID];										$class_object["submnu_image"]=$record[SUBMNU_IMAGE];										$class_object["submnu_name"]=$record[SUBMNU_NAME];					$class_object["submnu_menu"]=$record[SUBMNU_MENU];					$class_object["submnu_display_order"]=$record[SUBMNU_DISPLAY_ORDER];					$class_object["submnu_description"]=$record[SUBMNU_DESCRIPTION];					$class_object["submnu_spl_note"]=$record[SUBMNU_SPL_NOTE];					$class_object["submnu_start_date"]=$record[SUBMNU_START_DATE];					$class_object["submnu_end_date"]=$record[SUBMNU_END_DATE];					$class_object[MENU_NAME]=$record[MENU_NAME];					$class_object["isActive"]=$isActive;				}else{					$class_object = new tbl_sub_menu();					$class_object->setsubmnu_id($record[SUBMNU_ID]);										$class_object->setsubmnu_image($record[SUBMNU_IMAGE]);										$class_object->setsubmnu_name($record[SUBMNU_NAME]);					$class_object->setsubmnu_menu($record[SUBMNU_MENU]);					$class_object->setsubmnu_display_order($record[SUBMNU_DISPLAY_ORDER]);					$class_object->setsubmnu_description($record[SUBMNU_DESCRIPTION]);					$class_object->setsubmnu_spl_note($record[SUBMNU_SPL_NOTE]);					$class_object->setsubmnu_start_date($record[SUBMNU_START_DATE]);					$class_object->setsubmnu_end_date($record[SUBMNU_END_DATE]);				}				$class_objects[$record[SUBMNU_ID]] = $class_object;			}		}		return $class_objects;	}//..End readArray	public function insert() {		if($this->getsubmnu_id() != '') {			$qry  = "UPDATE ".TBL_SUB_MENU.RET."SET".RET."			".SUBMNU_ID." = '".$this->getsubmnu_id()."',".RET."						".SUBMNU_IMAGE." = '".$this->getsubmnu_image()."',".RET."						".SUBMNU_NAME." = '".$this->getsubmnu_name()."',".RET."			".SUBMNU_MENU." = '".$this->getsubmnu_menu()."',".RET."			".SUBMNU_DISPLAY_ORDER." = '".$this->getsubmnu_display_order()."',".RET."			".SUBMNU_DESCRIPTION." = '".$this->getsubmnu_description()."',".RET."			".SUBMNU_SPL_NOTE." = '".$this->getsubmnu_spl_note()."',".RET."			".SUBMNU_START_DATE." = '".$this->getsubmnu_start_date()."',".RET."			".SUBMNU_END_DATE." = '".$this->getsubmnu_end_date()."'".RET.			"WHERE ".SUBMNU_ID." = ".$this->getsubmnu_id().RET;			//echo "$qry <br>";			mysql_query($qry);		} else {			$qry  = "INSERT INTO ".TBL_SUB_MENU." (".RET.			"".SUBMNU_NAME.", ".SUBMNU_IMAGE.", ".SUBMNU_MENU.", ".SUBMNU_DISPLAY_ORDER.", ".SUBMNU_DESCRIPTION.", ".SUBMNU_SPL_NOTE.", ".SUBMNU_START_DATE.", ".SUBMNU_END_DATE.RET.				") VALUES (".RET.			"'".$this->getsubmnu_name()."',".RET.						"'".$this->getsubmnu_image()."',".RET.						"'".$this->getsubmnu_menu()."',".RET.			"'".$this->getsubmnu_display_order()."',".RET.			"'".$this->getsubmnu_description()."',".RET.			"'".$this->getsubmnu_spl_note()."',".RET.			"'".$this->getsubmnu_start_date()."',".RET.			"'".$this->getsubmnu_end_date()."'".RET.			")".RET;			//echo "$qry <br>";			//exit;			$res = mysql_query($qry);			$this->setsubmnu_id(mysql_insert_id());		}	}//..End Insert	public static function delete($array = array()) {		$qry = "DELETE".RET."FROM ".TBL_SUB_MENU.RET;		$and = "WHERE".RET;		if($array[SUBMNU_ID] != "") {			$qry .= $and.SUBMNU_ID." IN (".$array[SUBMNU_ID].")".RET;			$and = "AND".RET;		}		if($array[SUBMNU_NAME] != "") {			$qry .= $and.SUBMNU_NAME." = '".$array[SUBMNU_NAME]."'".RET;			$and = "AND".RET;		}		if($array[SUBMNU_MENU] != "") {			$qry .= $and.SUBMNU_MENU." = '".$array[SUBMNU_MENU]."'".RET;			$and = "AND".RET;		}		if($array[SUBMNU_DISPLAY_ORDER] != "") {			$qry .= $and.SUBMNU_DISPLAY_ORDER." = '".$array[SUBMNU_DISPLAY_ORDER]."'".RET;			$and = "AND".RET;		}		if($array[SUBMNU_DESCRIPTION] != "") {			$qry .= $and.SUBMNU_DESCRIPTION." = '".$array[SUBMNU_DESCRIPTION]."'".RET;			$and = "AND".RET;		}		if($array[SUBMNU_SPL_NOTE] != "") {			$qry .= $and.SUBMNU_SPL_NOTE." = '".$array[SUBMNU_SPL_NOTE]."'".RET;			$and = "AND".RET;		}		if($array[SUBMNU_START_DATE] != "") {			$qry .= $and.SUBMNU_START_DATE." = '".$array[SUBMNU_START_DATE]."'".RET;			$and = "AND".RET;		}		if($array[SUBMNU_END_DATE] != "") {			$qry .= $and.SUBMNU_END_DATE." = '".$array[SUBMNU_END_DATE]."'".RET;			$and = "AND".RET;		}		 		$res = mysql_query($qry);		if($res){			return OPERATION_SUCCESS;		};		return OPERATION_FAIL;	}//..End Delete	public function isAlreadyThere($submnu_name ,$submnu_menu ,$submnu_display_order ,$submnu_description ,$submnu_spl_note ,$submnu_start_date ,$submnu_end_date) {		$unique_arr = array();			//$unique_arr[SUBMNU_ID]=$submnu_id;			$unique_arr[SUBMNU_NAME]=$submnu_name;			$unique_arr[SUBMNU_MENU]=$submnu_menu;			//$unique_arr[SUBMNU_DISPLAY_ORDER]=$submnu_display_order;			//$unique_arr[SUBMNU_DESCRIPTION]=$submnu_description;			//$unique_arr[SUBMNU_SPL_NOTE]=$submnu_spl_note;			//$unique_arr[SUBMNU_START_DATE]=$submnu_start_date;			//$unique_arr[SUBMNU_END_DATE]=$submnu_end_date;		if(is_not_empty($unique_arr)){			return $this->readObject($unique_arr);		}		return false;	}//..isAlreadyThere	public function create($submnu_name ,$submnu_menu ,$submnu_display_order ,$submnu_description ,$submnu_spl_note ,$submnu_start_date ,$submnu_end_date,$submnu_image='') {		if(is_not_empty($submnu_name)){			if($this->isAlreadyThere($submnu_name ,$submnu_menu ,$submnu_display_order ,$submnu_description ,$submnu_spl_note ,$submnu_start_date ,$submnu_end_date)){				return OPERATION_DUPLICATE;			}else{				$this->setsubmnu_id("");								$this->setsubmnu_image($submnu_image);								$this->setsubmnu_name($submnu_name);				$this->setsubmnu_menu($submnu_menu);				$this->setsubmnu_display_order($submnu_display_order);				$this->setsubmnu_description($submnu_description);				$this->setsubmnu_spl_note($submnu_spl_note);				$this->setsubmnu_start_date(date(DATE_FORMAT));				$this->insert();				return $this->getsubmnu_id();			}		}		return OPERATION_FAIL;	}//..create	public function update($submnu_id, $submnu_name, $submnu_menu, $submnu_display_order, $submnu_description, $submnu_spl_note, $submnu_start_date, $submnu_end_date,$submnu_image='') {		if(is_gt_zero_num($submnu_id)){			if ($this->readObject(array(SUBMNU_ID=>$submnu_id))){				$this->setsubmnu_name($submnu_name);				if($submnu_image!='')					$this->setsubmnu_image($submnu_image);								$this->setsubmnu_menu($submnu_menu);				$this->setsubmnu_display_order($submnu_display_order);				$this->setsubmnu_description($submnu_description);				$this->setsubmnu_spl_note($submnu_spl_note);				$this->insert();				return OPERATION_SUCCESS;			}		}		return OPERATION_FAIL;	}//..update	public function activate($submnu_id){		if(is_not_empty($submnu_id)){		 //if ($this->readObject(array(SUBMNU_ID=>$submnu_id))){				$qry  = 'UPDATE '.TBL_SUB_MENU.RET.'SET'.RET.'			'.TBL_SUB_MENU_DEACTIVE_DATE.' = \''.date(EMPTY_DATE_FORMAT).'\' WHERE '.SUBMNU_ID.' IN ('.$submnu_id.')';			 				$res = mysql_query($qry);				if($res){					return 1;				}		 //}		}		return 0;	}//..end activate	public function deactivate($submnu_id){		if(is_not_empty($submnu_id)){		 //if ($this->readObject(array(SUBMNU_ID=>$submnu_id))){			$qry  = 'UPDATE '.TBL_SUB_MENU.RET.'SET'.RET.'			'.TBL_SUB_MENU_DEACTIVE_DATE.' = \''.date(DATE_FORMAT).'\' WHERE '.SUBMNU_ID.' IN ('.$submnu_id.')';				$res = mysql_query($qry);				if($res){					return 1;				}			//}		}		return 0;	}//..end deactivate	public static function GetInfo($submnu_id) {		$info = array();		if($submnu_id != ""){			$obj_tbl_sub_menu = new tbl_sub_menu();			if($obj_tbl_sub_menu->readObject(array("submnu_id"=>$submnu_id))){				$info["submnu_id"]=$obj_tbl_sub_menu->getsubmnu_id();								$info["submnu_image"]=$obj_tbl_sub_menu->getsubmnu_image();								$info["submnu_name"]=$obj_tbl_sub_menu->getsubmnu_name();				$info["submnu_menu"]=$obj_tbl_sub_menu->getsubmnu_menu();				$info["submnu_display_order"]=$obj_tbl_sub_menu->getsubmnu_display_order();				$info["submnu_description"]=$obj_tbl_sub_menu->getsubmnu_description();				$info["submnu_spl_note"]=$obj_tbl_sub_menu->getsubmnu_spl_note();				$info["submnu_start_date"]=$obj_tbl_sub_menu->getsubmnu_start_date();				$info["submnu_end_date"]=$obj_tbl_sub_menu->getsubmnu_end_date();				$info["isActive"] = 0;				//..check deactive date is not set or 0				if((is_not_empty($obj_tbl_sub_menu->gettbl_sub_menu_deactive_date())==false)  || (is_gt_zero_num(strtotime($obj_tbl_sub_menu->gettbl_sub_menu_deactive_date()))== false)){					$info["isActive"] = 1;				}else{					//..check the deactive date is greater than todays date					if(strtotime($obj_tbl_sub_menu->gettbl_sub_menu_deactive_date()) > strtotime(date(DATE_FORMAT))){						$info["isActive"] = 1;					}				}			}		unset($obj_tbl_sub_menu);		return $info;		}	}//..End GetInfo	public static function GetFields($data){		global $tbl_sub_menu_active_condition;		$arr = array();		if(is_not_empty($data)){			$qry ='SELECT '.$data['key_field'].','.$data['value_field'].' FROM '.TBL_SUB_MENU.' WHERE 1 ';			//$qry ='SELECT '.$data['key_field'].','.$data['value_field'].' FROM '.TBL_SUB_MENU.' WHERE '.DISH_RESTAURENT.'='.$_SESSION[SES_RESTAURANT];			if(is_gt_zero_num($data['isActive'])){				$qry .= ' AND '.$tbl_sub_menu_active_condition;				}						if(is_not_empty($data['filter_field']) && is_not_empty($data['filter_value'])){				$qry .= ' AND '.$data['filter_field'].' = \''.$data['filter_value'].'\'';								}					 			$res = mysql_query($qry); 			if($res){				while($row=mysql_fetch_assoc($res)){					$arr[$row[$data['key_field']]] = $row[$data['value_field']];				}			}		}		return $arr;	}//.. End of GetFields		public static function deletePrevSubMnuImg($submnu_id,$save_path="") {		if(is_gt_zero_num($submnu_id)){			$obj_tbl_sub_menu = new tbl_sub_menu();			if ($obj_tbl_sub_menu->readObject(array(SUBMNU_ID=>$submnu_id))){								$submnu_image=$obj_tbl_sub_menu->getsubmnu_image();				if(is_not_empty($submnu_image))					unlink($save_path.$submnu_image);			}		}			}//..update }//..End tbl_sub_menu?>