<?php/**********************************************************************tbl_sbmnu_dish_opt_price.class.phpGenerated by STRUCTY 2013.04.11 10:41:39.Copyright 2011 Structy, Frédéric Aebi. All rights reserved.**********************************************************************/define('TBL_SBMNU_DISH_OPT_PRICE', 'tbl_sbmnu_dish_opt_price'); define('SBMDOPT_PR_ID', 'sbmdopt_pr_id'); define('SBMDOPT_PR_SBMNU_DISH', 'sbmdopt_pr_sbmnu_dish'); define('SBMDOPT_PR_OPTION_VALUE', 'sbmdopt_pr_option_value'); define('SBMDOPT_PR_PRICE', 'sbmdopt_pr_price'); define('TBL_SBMNU_DISH_OPT_PRICE_ACTIVE_DATE',  '');define('TBL_SBMNU_DISH_OPT_PRICE_DEACTIVE_DATE',  '');$tbl_sbmnu_dish_opt_price_active_condition= ' ('.TBL_SBMNU_DISH_OPT_PRICE_DEACTIVE_DATE.' is NULL OR '.TBL_SBMNU_DISH_OPT_PRICE_DEACTIVE_DATE.' = 0 OR '.TBL_SBMNU_DISH_OPT_PRICE_DEACTIVE_DATE.' > CURDATE( )) ';class tbl_sbmnu_dish_opt_price {	private $sbmdopt_pr_id;	private $sbmdopt_pr_sbmnu_dish;	private $sbmdopt_pr_option_value;	private $sbmdopt_pr_price;	private $tbl_sbmnu_dish_opt_price_active_date;	private $tbl_sbmnu_dish_opt_price_deactive_date;	public function setsbmdopt_pr_id($pArg='0') {$this->sbmdopt_pr_id=$pArg;}	public function setsbmdopt_pr_sbmnu_dish($pArg='0') {$this->sbmdopt_pr_sbmnu_dish=$pArg;}	public function setsbmdopt_pr_option_value($pArg='0') {$this->sbmdopt_pr_option_value=$pArg;}	public function setsbmdopt_pr_price($pArg='0') {$this->sbmdopt_pr_price=$pArg;}	public function settbl_sbmnu_dish_opt_price_active_date($pArg='0') {$this->tbl_sbmnu_dish_opt_price_active_date=$pArg;}	public function settbl_sbmnu_dish_opt_price_deactive_date($pArg='0') {$this->tbl_sbmnu_dish_opt_price_deactive_date=$pArg;}	public function getsbmdopt_pr_id() {return $this->sbmdopt_pr_id;}	public function getsbmdopt_pr_sbmnu_dish() {return $this->sbmdopt_pr_sbmnu_dish;}	public function getsbmdopt_pr_option_value() {return $this->sbmdopt_pr_option_value;}	public function getsbmdopt_pr_price() {return $this->sbmdopt_pr_price;}	public function gettbl_sbmnu_dish_opt_price_active_date() {return $this->tbl_sbmnu_dish_opt_price_active_date;}	public function gettbl_sbmnu_dish_opt_price_deactive_date() {return $this->tbl_sbmnu_dish_opt_price_deactive_date;}	public function readObject($array = array()) {		$qry = "SELECT *".RET."FROM ".TBL_SBMNU_DISH_OPT_PRICE.RET;		$and = "WHERE".RET;		if($array[SBMDOPT_PR_ID] != "") {			$qry .= $and.SBMDOPT_PR_ID." = '".$array[SBMDOPT_PR_ID]."'".RET;			$and = "AND".RET;		}		if($array[SBMDOPT_PR_SBMNU_DISH] != "") {			$qry .= $and.SBMDOPT_PR_SBMNU_DISH." = '".$array[SBMDOPT_PR_SBMNU_DISH]."'".RET;			$and = "AND".RET;		}		if($array[SBMDOPT_PR_OPTION_VALUE] != "") {			$qry .= $and.SBMDOPT_PR_OPTION_VALUE." = '".$array[SBMDOPT_PR_OPTION_VALUE]."'".RET;			$and = "AND".RET;		}		if($array[SBMDOPT_PR_PRICE] != "") {			$qry .= $and.SBMDOPT_PR_PRICE." = '".$array[SBMDOPT_PR_PRICE]."'".RET;			$and = "AND".RET;		}/*	echo $qry;*/	$result = mysql_query($qry);		if($result) {			while ($row = mysql_fetch_array($result)) {				$record = $row;				break;//end after first record			}			if(count($record[0]) == 0) {				return array();			} else {				$this->setsbmdopt_pr_id($record[SBMDOPT_PR_ID]);				$this->setsbmdopt_pr_sbmnu_dish($record[SBMDOPT_PR_SBMNU_DISH]);				$this->setsbmdopt_pr_option_value($record[SBMDOPT_PR_OPTION_VALUE]);				$this->setsbmdopt_pr_price($record[SBMDOPT_PR_PRICE]);				$this->settbl_sbmnu_dish_opt_price_active_date($record[TBL_SBMNU_DISH_OPT_PRICE_ACTIVE_DATE]);				$this->settbl_sbmnu_dish_opt_price_deactive_date($record[TBL_SBMNU_DISH_OPT_PRICE_DEACTIVE_DATE]);				return true;			}		}	}	public static function readArray($array = array(),&$result_found=0,$isArray=1) {		global $tbl_sbmnu_dish_opt_price_active_condition;		$qry = "SELECT *".RET."FROM ".TBL_SBMNU_DISH_OPT_PRICE.RET;		$and = "WHERE".RET;		if($array[SBMDOPT_PR_ID] != "") {			$qry .= $and.SBMDOPT_PR_ID." = '".$array[SBMDOPT_PR_ID]."'".RET;			$and = "AND".RET;		}		if($array[SBMDOPT_PR_SBMNU_DISH] != "") {			$qry .= $and.SBMDOPT_PR_SBMNU_DISH." = '".$array[SBMDOPT_PR_SBMNU_DISH]."'".RET;			$and = "AND".RET;		}		if($array[SBMDOPT_PR_OPTION_VALUE] != "") {			$qry .= $and.SBMDOPT_PR_OPTION_VALUE." = '".$array[SBMDOPT_PR_OPTION_VALUE]."'".RET;			$and = "AND".RET;		}		if($array[SBMDOPT_PR_PRICE] != "") {			$qry .= $and.SBMDOPT_PR_PRICE." = '".$array[SBMDOPT_PR_PRICE]."'".RET;			$and = "AND".RET;		}		if(is_gt_zero_num($array["isActive"])) {			$qry .= $and.$tbl_sbmnu_dish_opt_price_active_condition;;			$and = "AND".RET;		}		if(is_not_empty($array[SORT_ON]) && is_not_empty($array[SORT_BY])) {		$qry .=" ORDER BY ".$array[SORT_ON]." ".$array[SORT_BY];		}		if(is_not_empty($array[OFFSET_TITLE]) && is_not_empty($array[LIMIT_TITLE])) {			$qry_with_limit  = $qry." LIMIT ".$array[OFFSET_TITLE].",".$array[LIMIT_TITLE];		}else{			$qry_with_limit  = $qry;		}		$result = mysql_query ($qry_with_limit);		$r1 = mysql_query($qry);		if($r1){			$result_found = mysql_num_rows($r1);		}		$class_objects = array();		if($result) {			while ($record = mysql_fetch_assoc($result)) {				$isActive= 0;				//..check deactive date is not set or 0				if((is_not_empty($record[TBL_SBMNU_DISH_OPT_PRICE_DEACTIVE_DATE])==false) || (is_gt_zero_num(strtotime($record[TBL_SBMNU_DISH_OPT_PRICE_DEACTIVE_DATE]))== false)){					$isActive = 1; 				}else{					//..check the deactive date is greater than todays date					if(strtotime($record[TBL_SBMNU_DISH_OPT_PRICE_DEACTIVE_DATE]) > strtotime(date(DATE_FORMAT))){						$isActive = 1;					}				}				if($isArray){					$class_object = array();					$class_object['sbmdopt_pr_id']=$record[SBMDOPT_PR_ID];					$class_object['sbmdopt_pr_sbmnu_dish']=$record[SBMDOPT_PR_SBMNU_DISH];					$class_object['sbmdopt_pr_option_value']=$record[SBMDOPT_PR_OPTION_VALUE];					$class_object['sbmdopt_pr_price']=$record[SBMDOPT_PR_PRICE];					$class_object['isActive']=$isActive;				}else{					$class_object = new tbl_sbmnu_dish_opt_price();					$class_object->setsbmdopt_pr_id($record[SBMDOPT_PR_ID]);					$class_object->setsbmdopt_pr_sbmnu_dish($record[SBMDOPT_PR_SBMNU_DISH]);					$class_object->setsbmdopt_pr_option_value($record[SBMDOPT_PR_OPTION_VALUE]);					$class_object->setsbmdopt_pr_price($record[SBMDOPT_PR_PRICE]);				}				$class_objects[$record[SBMDOPT_PR_ID]] = $class_object;			}		}		return $class_objects;	}//..End readArray	public function insert() {		if($this->getsbmdopt_pr_id() != '') {			$qry  = "UPDATE ".TBL_SBMNU_DISH_OPT_PRICE.RET."SET".RET."			".SBMDOPT_PR_ID." = '".$this->getsbmdopt_pr_id()."',".RET."			".SBMDOPT_PR_SBMNU_DISH." = '".$this->getsbmdopt_pr_sbmnu_dish()."',".RET."			".SBMDOPT_PR_OPTION_VALUE." = '".$this->getsbmdopt_pr_option_value()."',".RET."			".SBMDOPT_PR_PRICE." = '".$this->getsbmdopt_pr_price()."'".RET.			"WHERE ".SBMDOPT_PR_ID." = ".$this->getsbmdopt_pr_id().RET;			mysql_query($qry);		} else {			$qry  = "INSERT INTO ".TBL_SBMNU_DISH_OPT_PRICE." (".RET.			"".SBMDOPT_PR_SBMNU_DISH.", ".SBMDOPT_PR_OPTION_VALUE.", ".SBMDOPT_PR_PRICE.RET.				") VALUES (".RET.			"'".$this->getsbmdopt_pr_sbmnu_dish()."',".RET.			"'".$this->getsbmdopt_pr_option_value()."',".RET.			"'".$this->getsbmdopt_pr_price()."'".RET.			")".RET;			$res = mysql_query($qry);			$this->setsbmdopt_pr_id(mysql_insert_id());		}	}//..End Insert	public static function delete($array = array()) {		$qry = "DELETE".RET."FROM ".TBL_SBMNU_DISH_OPT_PRICE.RET;		$and = "WHERE".RET;		if($array[SBMDOPT_PR_ID] != "") {			$qry .= $and.SBMDOPT_PR_ID." = '".$array[SBMDOPT_PR_ID]."'".RET;			$and = "AND".RET;		}		if($array[SBMDOPT_PR_SBMNU_DISH] != "") {			$qry .= $and.SBMDOPT_PR_SBMNU_DISH." = '".$array[SBMDOPT_PR_SBMNU_DISH]."'".RET;			$and = "AND".RET;		}		if($array[SBMDOPT_PR_OPTION_VALUE] != "") {			$qry .= $and.SBMDOPT_PR_OPTION_VALUE." = '".$array[SBMDOPT_PR_OPTION_VALUE]."'".RET;			$and = "AND".RET;		}			 if($array[DISH_OPT_ID] != "") {			$qry .= $and.SBMDOPT_PR_OPTION_VALUE." IN  (SELECT ".DISH_OPT_VAL_ID." FROM ".TBL_DISH_OPTIONS_VALUES." WHERE ".DISH_OPT_VAL_OPTION_ID." IN (".$array[DISH_OPT_ID]."))".RET;			$and = "AND".RET;	 }  		if($array[SBMDOPT_PR_PRICE] != "") {			$qry .= $and.SBMDOPT_PR_PRICE." = '".$array[SBMDOPT_PR_PRICE]."'".RET;			$and = "AND".RET;		}		$res = mysql_query($qry);		if($res){			return OPERATION_SUCCESS;		};		return OPERATION_FAIL;	}//..End Delete	public function isAlreadyThere($sbmdopt_pr_sbmnu_dish ,$sbmdopt_pr_option_value ,$sbmdopt_pr_price) {		$unique_arr = array();			//$unique_arr[SBMDOPT_PR_ID]=$sbmdopt_pr_id;			$unique_arr[SBMDOPT_PR_SBMNU_DISH]=$sbmdopt_pr_sbmnu_dish;			$unique_arr[SBMDOPT_PR_OPTION_VALUE]=$sbmdopt_pr_option_value;			//$unique_arr[SBMDOPT_PR_PRICE]=$sbmdopt_pr_price;		if(is_not_empty($unique_arr)){			return $this->readObject($unique_arr);		}		return false;	}//..isAlreadyThere	public function create($sbmdopt_pr_sbmnu_dish ,$sbmdopt_pr_option_value ,$sbmdopt_pr_price) {		if(is_not_empty($sbmdopt_pr_sbmnu_dish)){			if($this->isAlreadyThere($sbmdopt_pr_sbmnu_dish ,$sbmdopt_pr_option_value ,$sbmdopt_pr_price)){				return OPERATION_DUPLICATE;			}else{				$this->setsbmdopt_pr_id('');				$this->setsbmdopt_pr_sbmnu_dish($sbmdopt_pr_sbmnu_dish);				$this->setsbmdopt_pr_option_value($sbmdopt_pr_option_value);				$this->setsbmdopt_pr_price($sbmdopt_pr_price);				$this->insert();				return $this->getsbmdopt_pr_id();			}		}		return OPERATION_FAIL;	}//..create	public function update($sbmdopt_pr_id, $sbmdopt_pr_sbmnu_dish, $sbmdopt_pr_option_value, $sbmdopt_pr_price) {		if(is_gt_zero_num($sbmdopt_pr_id)){			if ($this->readObject(array(SBMDOPT_PR_ID=>$sbmdopt_pr_id))){				$this->setsbmdopt_pr_sbmnu_dish($sbmdopt_pr_sbmnu_dish);				$this->setsbmdopt_pr_option_value($sbmdopt_pr_option_value);				$this->setsbmdopt_pr_price($sbmdopt_pr_price);				$this->insert();				return OPERATION_SUCCESS;			}		}		return OPERATION_FAIL;	}//..update	public function activate($sbmdopt_pr_id){		if(is_gt_zero_num($sbmdopt_pr_id)){			if ($this->readObject(array(SBMDOPT_PR_ID=>$sbmdopt_pr_id))){					$qry  = 'UPDATE '.TBL_SBMNU_DISH_OPT_PRICE.RET.'SET'.RET.''.TBL_SBMNU_DISH_OPT_PRICE_DEACTIVE_DATE.' = \''.date(EMPTY_DATE_FORMAT).'\' WHERE '.SBMDOPT_PR_ID.'='.$sbmdopt_pr_id;				$res = mysql_query($qry);				if($res){					return 1;				}			}		}		return 0;	}//..end activate	public function deactivate($sbmdopt_pr_id){		if(is_gt_zero_num($sbmdopt_pr_id)){			if ($this->readObject(array(SBMDOPT_PR_ID=>$sbmdopt_pr_id))){				$qry  = 'UPDATE '.TBL_SBMNU_DISH_OPT_PRICE.RET.'SET'.RET.''.TBL_SBMNU_DISH_OPT_PRICE_DEACTIVE_DATE.' = \''.date(DATE_FORMAT).'\' WHERE '.SBMDOPT_PR_ID.'='.$sbmdopt_pr_id;				$res = mysql_query($qry);				if($res){					return 1;				}			}		}		return 0;	}//..end deactivate	public static function GetInfo($sbmdopt_pr_id) {		$info = array();		if($sbmdopt_pr_id != ''){			$obj_tbl_sbmnu_dish_opt_price = new tbl_sbmnu_dish_opt_price();			if($obj_tbl_sbmnu_dish_opt_price->readObject(array('sbmdopt_pr_id'=>$sbmdopt_pr_id))){				$info['sbmdopt_pr_id']=$obj_tbl_sbmnu_dish_opt_price->getsbmdopt_pr_id();				$info['sbmdopt_pr_sbmnu_dish']=$obj_tbl_sbmnu_dish_opt_price->getsbmdopt_pr_sbmnu_dish();				$info['sbmdopt_pr_option_value']=$obj_tbl_sbmnu_dish_opt_price->getsbmdopt_pr_option_value();				$info['sbmdopt_pr_price']=$obj_tbl_sbmnu_dish_opt_price->getsbmdopt_pr_price();				$info['isActive'] = 0;				//..check deactive date is not set or 0				if((is_not_empty($obj_tbl_sbmnu_dish_opt_price->gettbl_sbmnu_dish_opt_price_deactive_date())==false)  || (is_gt_zero_num(strtotime($obj_tbl_sbmnu_dish_opt_price->gettbl_sbmnu_dish_opt_price_deactive_date()))== false)){					$info['isActive'] = 1;				}else{					//..check the deactive date is greater than todays date					if(strtotime($obj_tbl_sbmnu_dish_opt_price->gettbl_sbmnu_dish_opt_price_deactive_date()) > strtotime(date(DATE_FORMAT))){						$info['isActive'] = 1;					}				}			}		unset($obj_tbl_sbmnu_dish_opt_price);		return $info;		}	}//..End GetInfo	public static function GetFields($data){		global $tbl_sbmnu_dish_opt_price_active_condition;		$arr = array();		if(is_not_empty($data)){			$qry ='SELECT '.$data['key_field'].','.$data['value_field'].' FROM '.TBL_SBMNU_DISH_OPT_PRICE.'';			if(is_gt_zero_num($data['isActive'])){				$qry .= ' WHERE '.$tbl_sbmnu_dish_opt_price_active_condition;}			$res = mysql_query($qry); 			if($res){				while($row=mysql_fetch_assoc($res)){					$arr[$row[$data['key_field']]] = $row[$data['value_field']];				}			}		}		return $arr;	}//.. End of GetFields		/*	public static function getAllOptionValuePricesForDish($dish_id){	 $info = array();	 if(is_gt_zero_num($dish_id)){	 	$sql = "SELECT dish_opt_val_id, dish_opt_val_value, dish_opt_id, dish_opt_name, dish_opt_type, sbmdopt_pr_id, sbmdopt_pr_sbmnu_dish, sbmdopt_pr_price FROM ".TBL_SBMNU_DISH_OPT_PRICE." RIGHT OUTER JOIN ".TBL_DISH_OPTIONS_VALUES." ON ".SBMDOPT_PR_OPTION_VALUE." = ".dish_opt_val_id."INNER JOIN ".TBL_DISH_OPTIONS." ON ".DISH_OPT_VAL_OPTION_ID." = ".DISH_OPT_ID." WHERE ".DISH_OPT_DISH_ID." ={$dish_id}"; 		if($res = mysql_query($sql)){			$x = 0;			while($row=mysql_fetch_assoc($res)){				$info[$x] = $row;				$x++;			}		}	 } 	 return $info;	}	*///***** Current Coding 		public static function getAllOptionValuePricesForDish($sub_menu_dish_id,$dish_id,$only_matched=0){	 	 $info = array();	 $new_info = array();	 $xnew_info = array();	 if(is_gt_zero_num($sub_menu_dish_id) && is_gt_zero_num($dish_id)){	 		 	$info = tbl_dish_options_values::getAllDishOptionsValuesForDish($dish_id);		$options_arr =array(); 	 		$x = 0;		foreach($info as $val){			$options_arr[$x]  = $val['dish_opt_val_id'];			$xnew_info[$val['dish_opt_val_id']] = $val;			$xnew_info[$val['dish_opt_val_id']]['sbmdopt_pr_id'] = '';			$xnew_info[$val['dish_opt_val_id']]['sbmdopt_pr_sbmnu_dish'] = '';			$xnew_info[$val['dish_opt_val_id']]['sbmdopt_pr_option_value'] =  '';			$xnew_info[$val['dish_opt_val_id']]['sbmdopt_pr_price'] = '0.00';			$xnew_info[$val['dish_opt_val_id']]['isFromSubmenu'] = 0;			$x++;			}  		 		if($only_matched == 1){ 			$new_info = array();	  }else{  			$new_info = $xnew_info;		}		 $sql = 'SELECT  sbmdopt_pr_id, sbmdopt_pr_sbmnu_dish, sbmdopt_pr_option_value, sbmdopt_pr_price FROM '.TBL_SBMNU_DISH_OPT_PRICE.' WHERE '.SBMDOPT_PR_OPTION_VALUE.' in('.implode($options_arr,',').') and sbmdopt_pr_sbmnu_dish = '.$sub_menu_dish_id;  		 if ($res = mysql_query($sql)){		 	while($row = mysql_fetch_assoc($res)){			 		$new_info[$row['sbmdopt_pr_option_value']]  = $xnew_info[$row['sbmdopt_pr_option_value']]; 					$new_info[$row['sbmdopt_pr_option_value']]['sbmdopt_pr_id']	= $row['sbmdopt_pr_id']; 					$new_info[$row['sbmdopt_pr_option_value']]['sbmdopt_pr_sbmnu_dish']	= $row['sbmdopt_pr_sbmnu_dish'];					$new_info[$row['sbmdopt_pr_option_value']]['sbmdopt_pr_price']	= $row['sbmdopt_pr_price']; 			 			}		 }	   	 }	 unset($xnew_info); 	 return $new_info;	}	 	 	 public static function getAllOptionValuePricesForSubmenu($sub_menu_dish_id,$submenu_id,$only_matched=0){	 	 $info = array();	 $new_info = array();	 $xnew_info = array();	 if(is_gt_zero_num($sub_menu_dish_id) && is_gt_zero_num($submenu_id)){ 	 	$info = tbl_dish_options_values::getAllDishOptionsValuesForSubmenu($submenu_id);		$options_arr =array(); 	 		$x = 0;		foreach($info as $val){			$options_arr[$x]  = $val['dish_opt_val_id'];			$xnew_info[$val['dish_opt_val_id']] = $val;			$xnew_info[$val['dish_opt_val_id']]['sbmdopt_pr_id'] = '';			$xnew_info[$val['dish_opt_val_id']]['sbmdopt_pr_sbmnu_dish'] = '';			$xnew_info[$val['dish_opt_val_id']]['sbmdopt_pr_option_value'] =  '';			$xnew_info[$val['dish_opt_val_id']]['sbmdopt_pr_price'] = '0.00';			$xnew_info[$val['dish_opt_val_id']]['isFromSubmenu'] = 1;			$x++;			}  		 		if($only_matched == 1){ 			$new_info = array();	  }else{  			$new_info = $xnew_info;		}		 $sql = 'SELECT  sbmdopt_pr_id, sbmdopt_pr_sbmnu_dish, sbmdopt_pr_option_value, sbmdopt_pr_price FROM '.TBL_SBMNU_DISH_OPT_PRICE.' WHERE '.SBMDOPT_PR_OPTION_VALUE.' in('.implode($options_arr,',').') and sbmdopt_pr_sbmnu_dish = '.$sub_menu_dish_id;  		 if ($res = mysql_query($sql)){		 	while($row = mysql_fetch_assoc($res)){			 		$new_info[$row['sbmdopt_pr_option_value']]  = $xnew_info[$row['sbmdopt_pr_option_value']]; 					$new_info[$row['sbmdopt_pr_option_value']]['sbmdopt_pr_id']	= $row['sbmdopt_pr_id']; 					$new_info[$row['sbmdopt_pr_option_value']]['sbmdopt_pr_sbmnu_dish']	= $row['sbmdopt_pr_sbmnu_dish'];					$new_info[$row['sbmdopt_pr_option_value']]['sbmdopt_pr_price']	= $row['sbmdopt_pr_price']; 			 			}		 }	   	 }	 unset($xnew_info); 	 return $new_info;	}	}//..End tbl_sbmnu_dish_opt_price?>