<?php/**********************************************************************tbl_staff.class.phpGenerated by STRUCTY 2013.03.20 10:22:45.Copyright 2011 Structy, Frédéric Aebi. All rights reserved.**********************************************************************/define("TBL_STAFF", "tbl_staff"); define('STAFF_ID', 'staff_id'); define('STAFF_MEMBER_ID', 'staff_member_id'); define('STAFF_ADDRESS', 'staff_address'); define('STAFF_LNAME', 'staff_lname'); define('STAFF_FNAME', 'staff_fname'); define('STAFF_CITY', 'staff_city'); define('STAFF_STATE', 'staff_state'); define('STAFF_METRO', 'staff_metro'); define('STAFF_COUNTRY', 'staff_country'); define('STAFF_ZIP', 'staff_zip'); define('STAFF_PHONE', 'staff_phone'); define('STAFF_FAX', 'staff_fax'); define('STAFF_WEBSITE', 'staff_website'); define('STAFF_DEVICE_ID', 'staff_device_id'); define('STAFF_GCM_REG_ID', 'staff_gcm_reg_id'); define('STAFF_DESCRIPTION', 'staff_description'); define('STAFF_DESIGATION', 'staff_desigation'); define('STAFF_START_DATE', 'staff_start_date'); define('STAFF_END_DATE', 'staff_end_date'); define('STAFF_RESTAURENT', 'staff_restaurent'); define('STAFF_IS_REWARD', 'staff_is_reward');define('STAFF_IS_CRM_SUBSCRIBED', 'staff_is_crm_subscribed');define('STAFF_FACEBOOK', 'staff_facebook');define('STAFF_BIRTH_DATE', 'staff_birth_date');define('STAFF_ANIVERSARY_DT', 'staff_aniversary_dt');define('STAFF_LOYALTY_LEVEL', 'staff_loyalty_level'); define('STAFF_SIGNUP_FLG', 'staff_signup_flg');define("TBL_STAFF_ACTIVE_DATE", "staff_start_date");define("TBL_STAFF_DEACTIVE_DATE", "staff_end_date");$tbl_staff_active_condition= " (".TBL_STAFF_DEACTIVE_DATE." is NULL OR ".TBL_STAFF_DEACTIVE_DATE." = 0 OR ".TBL_STAFF_DEACTIVE_DATE." > CURDATE( )) ";class tbl_staff {	private $staff_id;	private $staff_member_id;	private $staff_address;	private $staff_lname;	private $staff_fname;	private $staff_city;	private $staff_state;	private $staff_metro;	private $staff_country;	private $staff_zip;	private $staff_phone;	private $staff_fax;	private $staff_website;	private $staff_device_id;	private $staff_gcm_reg_id;	private $staff_description;	private $staff_desigation;	private $staff_start_date;	private $staff_end_date;	private $staff_restaurent;	private $tbl_staff_active_date;	private $tbl_staff_deactive_date;		private $staff_is_reward;	private $staff_is_crm_subscribed;		private $staff_facebook;	private $staff_birth_date;	private $staff_aniversary_dt;		public $staff_email;	public $staff_password;	private $staff_role;	private $staff_loyalty_level;	private $staff_signup_flg;	public function setstaff_id($pArg="0") {$this->staff_id=$pArg;}	public function setstaff_member_id($pArg="0") {$this->staff_member_id=$pArg;}	public function setstaff_address($pArg="0") {$this->staff_address=$pArg;}	public function setstaff_lname($pArg="0") {$this->staff_lname=$pArg;}	public function setstaff_fname($pArg="0") {$this->staff_fname=$pArg;}	public function setstaff_city($pArg="0") {$this->staff_city=$pArg;}	public function setstaff_state($pArg="0") {$this->staff_state=$pArg;}	public function setstaff_metro($pArg="0") {$this->staff_metro=$pArg;}	public function setstaff_country($pArg="0") {$this->staff_country=$pArg;}	public function setstaff_zip($pArg="0") {$this->staff_zip=$pArg;}	public function setstaff_phone($pArg="0") {$this->staff_phone=$pArg;}	public function setstaff_fax($pArg="0") {$this->staff_fax=$pArg;}	public function setstaff_website($pArg="0") {$this->staff_website=$pArg;}	public function setstaff_device_id($pArg="0") {$this->staff_device_id=$pArg;}	public function setstaff_gcm_reg_id($pArg="0") {$this->staff_gcm_reg_id=$pArg;}	public function setstaff_description($pArg="0") {$this->staff_description=$pArg;}	public function setstaff_desigation($pArg="0") {$this->staff_desigation=$pArg;}	public function setstaff_start_date($pArg="0") {$this->staff_start_date=$pArg;}	public function setstaff_end_date($pArg="0") {$this->staff_end_date=$pArg;}	public function setstaff_restaurent($pArg="0") {$this->staff_restaurent=$pArg;}	public function settbl_staff_active_date($pArg="0") {$this->tbl_staff_active_date=$pArg;}	public function settbl_staff_deactive_date($pArg="0") {$this->tbl_staff_deactive_date=$pArg;}	public function setstaff_role($pArg="0") {$this->staff_role=$pArg;}		public function setstaff_email($pArg="0") {$this->staff_email=$pArg;}	public function setstaff_password($pArg="0") {$this->staff_password=$pArg;}			public function setstaff_is_reward($pArg="0") {$this->staff_is_reward=$pArg;}	public function setstaff_is_crm_subscribed($pArg="0") {$this->staff_is_crm_subscribed=$pArg;}		public function setstaff_facebook($pArg="0") {$this->staff_facebook=$pArg;}	public function setstaff_birth_date($pArg="0") {$this->staff_birth_date=$pArg;}	public function setstaff_aniversary_dt($pArg="0") {$this->staff_aniversary_dt=$pArg;}	public function setstaff_loyalty_level($pArg="0") {$this->staff_loyalty_level=$pArg;}	public function setstaff_signup_flg($pArg="0") {$this->staff_signup_flg=$pArg;}		public function getstaff_id() {return $this->staff_id;}	public function getstaff_member_id() {return $this->staff_member_id;}	public function getstaff_address() {return $this->staff_address;}	public function getstaff_lname() {return $this->staff_lname;}	public function getstaff_fname() {return $this->staff_fname;}	public function getstaff_city() {return $this->staff_city;}	public function getstaff_state() {return $this->staff_state;}	public function getstaff_metro() {return $this->staff_metro;}	public function getstaff_country() {return $this->staff_country;}	public function getstaff_zip() {return $this->staff_zip;}	public function getstaff_phone() {return $this->staff_phone;}	public function getstaff_fax() {return $this->staff_fax;}	public function getstaff_website() {return $this->staff_website;}		public function getstaff_role() {return $this->staff_role;}		public function getstaff_email() {return $this->staff_email;}	public function getstaff_password() {return $this->staff_password;}		public function getstaff_is_reward() {return $this->staff_is_reward;}	public function getstaff_is_crm_subscribed() {return $this->staff_is_crm_subscribed;}		public function getstaff_facebook() {return $this->staff_facebook;}	public function getstaff_birth_date() {return $this->staff_birth_date;}	public function getstaff_aniversary_dt() {return $this->staff_aniversary_dt;}	public function getstaff_loyalty_level() {return $this->staff_loyalty_level;}	public function getstaff_signup_flg() {return $this->staff_signup_flg;}		public function getstaff_device_id() {return $this->staff_device_id;}	public function getstaff_gcm_reg_id() {return $this->staff_gcm_reg_id;}	public function getstaff_description() {return $this->staff_description;}	public function getstaff_desigation() {return $this->staff_desigation;}	public function getstaff_start_date() {return $this->staff_start_date;}	public function getstaff_end_date() {return $this->staff_end_date;}	public function getstaff_restaurent() {return $this->staff_restaurent;}	public function gettbl_staff_active_date($pArg="0") {return $this->tbl_staff_active_date;}	public function gettbl_staff_deactive_date($pArg="0") {return $this->tbl_staff_deactive_date;}	public function readObject($array = array()) {		//$qry = "SELECT *".RET."FROM ".TBL_STAFF.RET;		//$qry = "SELECT `tbl_staff`.*,`members`.`member_role_id` ".RET."FROM ".TBL_STAFF." inner join ".MEMBERS." ON ".STAFF_MEMBER_ID."=".MEMBERS.".`id` WHERE `member_role_id`=".ROLE_WAITER.RET;		$qry = "SELECT `tbl_staff`.*,`members`.`member_role_id`, `members`.`email`, `members`.`password` ".RET."FROM ".TBL_STAFF." inner join ".MEMBERS." ON ".STAFF_MEMBER_ID."=".MEMBERS.".`id` ".RET;		$and = "WHERE ".RET;				//$and = "WHERE".RET;		if($array[STAFF_ID] != "") {			$qry .= $and.STAFF_ID." IN (".$array[STAFF_ID].")".RET;			$and = "AND".RET;		}		if($array[STAFF_MEMBER_ID] != "") {			$qry .= $and.STAFF_MEMBER_ID." = '".$array[STAFF_MEMBER_ID]."'".RET;			$and = "AND".RET;		}		if($array[STAFF_ADDRESS] != "") {			$qry .= $and.STAFF_ADDRESS." = '".$array[STAFF_ADDRESS]."'".RET;			$and = "AND".RET;		}		if($array[STAFF_LNAME] != "") {			$qry .= $and.STAFF_LNAME." = '".$array[STAFF_LNAME]."'".RET;			$and = "AND".RET;		}		if($array[STAFF_FNAME] != "") {			$qry .= $and.STAFF_FNAME." = '".$array[STAFF_FNAME]."'".RET;			$and = "AND".RET;		}		if($array[STAFF_CITY] != "") {			$qry .= $and.STAFF_CITY." = '".$array[STAFF_CITY]."'".RET;			$and = "AND".RET;		}		if($array[STAFF_STATE] != "") {			$qry .= $and.STAFF_STATE." = '".$array[STAFF_STATE]."'".RET;			$and = "AND".RET;		}		if($array[STAFF_METRO] != "") {			$qry .= $and.STAFF_METRO." = '".$array[STAFF_METRO]."'".RET;			$and = "AND".RET;		}		if($array[STAFF_COUNTRY] != "") {			$qry .= $and.STAFF_COUNTRY." = '".$array[STAFF_COUNTRY]."'".RET;			$and = "AND".RET;		}		if($array[STAFF_ZIP] != "") {			$qry .= $and.STAFF_ZIP." = '".$array[STAFF_ZIP]."'".RET;			$and = "AND".RET;		}		if($array[STAFF_PHONE] != "") {			$qry .= $and.STAFF_PHONE." = '".$array[STAFF_PHONE]."'".RET;			$and = "AND".RET;		}		if($array[STAFF_FAX] != "") {			$qry .= $and.STAFF_FAX." = '".$array[STAFF_FAX]."'".RET;			$and = "AND".RET;		}		if($array[STAFF_WEBSITE] != "") {			$qry .= $and.STAFF_WEBSITE." = '".$array[STAFF_WEBSITE]."'".RET;			$and = "AND".RET;		}		if($array[STAFF_DEVICE_ID] != "") {			$qry .= $and.STAFF_DEVICE_ID." = '".$array[STAFF_DEVICE_ID]."'".RET;			$and = "AND".RET;		}		if($array[STAFF_GCM_REG_ID] != "") {			$qry .= $and.STAFF_GCM_REG_ID." = '".$array[STAFF_GCM_REG_ID]."'".RET;			$and = "AND".RET;		}		if($array[STAFF_DESCRIPTION] != "") {			$qry .= $and.STAFF_DESCRIPTION." = '".$array[STAFF_DESCRIPTION]."'".RET;			$and = "AND".RET;		}		if($array[STAFF_DESIGATION] != "") {			$qry .= $and.STAFF_DESIGATION." = '".$array[STAFF_DESIGATION]."'".RET;			$and = "AND".RET;		}		if($array[STAFF_START_DATE] != "") {			$qry .= $and.STAFF_START_DATE." = '".$array[STAFF_START_DATE]."'".RET;			$and = "AND".RET;		}		if($array[STAFF_END_DATE] != "") {			$qry .= $and.STAFF_END_DATE." = '".$array[STAFF_END_DATE]."'".RET;			$and = "AND".RET;		}		if($array[STAFF_RESTAURENT] != "") {			$qry .= $and.STAFF_RESTAURENT." = '".$array[STAFF_RESTAURENT]."'".RET;			$and = "AND".RET;		}				if($array[STAFF_IS_REWARD] != "") {			$qry .= $and.STAFF_IS_REWARD." = '".$array[STAFF_IS_REWARD]."'".RET;			$and = "AND".RET;		}				if($array[STAFF_IS_CRM_SUBSCRIBED] != "") {			$qry .= $and.STAFF_IS_CRM_SUBSCRIBED." = '".$array[STAFF_IS_CRM_SUBSCRIBED]."'".RET;			$and = "AND".RET;		}				if($array[STAFF_FACEBOOK] != "") {			$qry .= $and.STAFF_FACEBOOK." = '".$array[STAFF_FACEBOOK]."'".RET;			$and = "AND".RET;		}				if($array[STAFF_BIRTH_DATE] != "") {			$qry .= $and.STAFF_BIRTH_DATE." = '".$array[STAFF_BIRTH_DATE]."'".RET;			$and = "AND".RET;		}				if($array[STAFF_ANIVERSARY_DT] != "") {			$qry .= $and.STAFF_ANIVERSARY_DT." = '".$array[STAFF_ANIVERSARY_DT]."'".RET;			$and = "AND".RET;		}				if($array[STAFF_LOYALTY_LEVEL] != "") {			$qry .= $and.STAFF_LOYALTY_LEVEL." = '".$array[STAFF_LOYALTY_LEVEL]."'".RET;			$and = "AND".RET;		}				if($array[STAFF_SIGNUP_FLG] != "") {			$qry .= $and.STAFF_SIGNUP_FLG." = '".$array[STAFF_SIGNUP_FLG]."'".RET;			$and = "AND".RET;		}//echo "qry=$qry";		$result = mysql_query($qry);		if($result) {			while ($row = mysql_fetch_array($result)) {				$record = $row;				break;//end after first record			}			if(count($record[0]) == 0) {				return array();			} else {				$this->setstaff_id($record[STAFF_ID]);				$this->setstaff_member_id($record[STAFF_MEMBER_ID]);				$this->setstaff_role($record['member_role_id']);				$this->setstaff_email($record['email']);				$this->setstaff_password($record['password']);				$this->setstaff_address($record[STAFF_ADDRESS]);				$this->setstaff_lname($record[STAFF_LNAME]);				$this->setstaff_fname($record[STAFF_FNAME]);				$this->setstaff_city($record[STAFF_CITY]);				$this->setstaff_state($record[STAFF_STATE]);				$this->setstaff_metro($record[STAFF_METRO]);				$this->setstaff_country($record[STAFF_COUNTRY]);				$this->setstaff_zip($record[STAFF_ZIP]);				$this->setstaff_phone($record[STAFF_PHONE]);				$this->setstaff_fax($record[STAFF_FAX]);				$this->setstaff_website($record[STAFF_WEBSITE]);				$this->setstaff_device_id($record[STAFF_DEVICE_ID]);				$this->setstaff_gcm_reg_id($record[STAFF_GCM_REG_ID]);				$this->setstaff_description($record[STAFF_DESCRIPTION]);				$this->setstaff_desigation($record[STAFF_DESIGATION]);				$this->setstaff_start_date($record[STAFF_START_DATE]);				$this->setstaff_end_date($record[STAFF_END_DATE]);				$this->setstaff_restaurent($record[STAFF_RESTAURENT]);				$this->settbl_staff_active_date($record[TBL_STAFF_ACTIVE_DATE]);				$this->settbl_staff_deactive_date($record[TBL_STAFF_DEACTIVE_DATE]);								$this->setstaff_is_reward($record[STAFF_IS_REWARD]);				$this->setstaff_is_crm_subscribed($record[STAFF_IS_CRM_SUBSCRIBED]);								$this->setstaff_facebook($record[STAFF_FACEBOOK]);				$this->setstaff_birth_date($record[STAFF_BIRTH_DATE]);				$this->setstaff_aniversary_dt($record[STAFF_ANIVERSARY_DT]);				$this->setstaff_loyalty_level($record[STAFF_LOYALTY_LEVEL]);				$this->setstaff_signup_flg($record[STAFF_SIGNUP_FLG]);								return true;			}		}	}	public static function readArray($array = array(),&$result_found=0,$isArray=1) {		global $tbl_staff_active_condition;		 //$qry = "SELECT *".RET."FROM ".TBL_STAFF." inner join ".MEMBERS." ON ".STAFF_MEMBER_ID."=".MEMBERS.".`id` WHERE `member_role_id`=".ROLE_WAITER.RET;	 	/*$qry = "SELECT ".TBL_STAFF.".*, ".MEMBERS.".email as `staff_email`,".MEMBERS.".is_reward as `staff_is_reward`,`member_role`.`member_role_name` FROM ".TBL_STAFF." inner join ".MEMBERS." ON ".STAFF_MEMBER_ID."=".MEMBERS.".`id` INNER JOIN `member_role` ON ".MEMBERS.".`member_role_id`=`member_role`.`member_role_id`  ".RET;*/ 		$qry = "SELECT ".TBL_STAFF.".*, ".MEMBERS.".email as `staff_email`,`member_role`.`member_role_name` FROM ".TBL_STAFF." inner join ".MEMBERS." ON ".STAFF_MEMBER_ID."=".MEMBERS.".`id` INNER JOIN `member_role` ON ".MEMBERS.".`member_role_id`=`member_role`.`member_role_id`  ".RET;		$and = "WHERE ".RET;				if($array['only_banned'] == 1) {			$qry .= $and." `banned` = 1 ".RET;			$and = "AND".RET;		}				if($array['exclude_banned'] == 1) {			$qry .= $and." `banned` = 0 ".RET;			$and = "AND".RET;		}		if($array[STAFF_ID] != "") {			$qry .= $and.STAFF_ID." = '".$array[STAFF_ID]."'".RET;			$and = "AND".RET;		}		if($array[STAFF_MEMBER_ID] != "") {			$qry .= $and.STAFF_MEMBER_ID." = '".$array[STAFF_MEMBER_ID]."'".RET;			$and = "AND".RET;		}		if($array[STAFF_ADDRESS] != "") {			$qry .= $and.STAFF_ADDRESS." = '".$array[STAFF_ADDRESS]."'".RET;			$and = "AND".RET;		}		if($array[STAFF_LNAME] != "") {			$qry .= $and.STAFF_LNAME." = '".$array[STAFF_LNAME]."'".RET;			$and = "AND".RET;		}		if($array[STAFF_FNAME] != "") {			$qry .= $and.STAFF_FNAME." = '".$array[STAFF_FNAME]."'".RET;			$and = "AND".RET;		}		if($array[STAFF_CITY] != "") {			$qry .= $and.STAFF_CITY." = '".$array[STAFF_CITY]."'".RET;			$and = "AND".RET;		}		if($array[STAFF_STATE] != "") {			$qry .= $and.STAFF_STATE." = '".$array[STAFF_STATE]."'".RET;			$and = "AND".RET;		}		if($array[STAFF_METRO] != "") {			$qry .= $and.STAFF_METRO." = '".$array[STAFF_METRO]."'".RET;			$and = "AND".RET;		}		if($array[STAFF_COUNTRY] != "") {			$qry .= $and.STAFF_COUNTRY." = '".$array[STAFF_COUNTRY]."'".RET;			$and = "AND".RET;		}		if($array[STAFF_ZIP] != "") {			$qry .= $and.STAFF_ZIP." = '".$array[STAFF_ZIP]."'".RET;			$and = "AND".RET;		}		if($array[STAFF_PHONE] != "") {			$qry .= $and.STAFF_PHONE." = '".$array[STAFF_PHONE]."'".RET;			$and = "AND".RET;		}		if($array[STAFF_FAX] != "") {			$qry .= $and.STAFF_FAX." = '".$array[STAFF_FAX]."'".RET;			$and = "AND".RET;		}		if($array[STAFF_WEBSITE] != "") {			$qry .= $and.STAFF_WEBSITE." = '".$array[STAFF_WEBSITE]."'".RET;			$and = "AND".RET;		}		if($array[STAFF_DEVICE_ID] != "") {			$qry .= $and.STAFF_DEVICE_ID." = '".$array[STAFF_DEVICE_ID]."'".RET;			$and = "AND".RET;		}		if($array[STAFF_GCM_REG_ID] != "") {			$qry .= $and.STAFF_GCM_REG_ID." = '".$array[STAFF_GCM_REG_ID]."'".RET;			$and = "AND".RET;		}		if($array[STAFF_DESCRIPTION] != "") {			$qry .= $and.STAFF_DESCRIPTION." = '".$array[STAFF_DESCRIPTION]."'".RET;			$and = "AND".RET;		}		if($array[STAFF_DESIGATION] != "") {			$qry .= $and.STAFF_DESIGATION." = '".$array[STAFF_DESIGATION]."'".RET;			$and = "AND".RET;		}		if($array[STAFF_START_DATE] != "") {			$qry .= $and.STAFF_START_DATE." = '".$array[STAFF_START_DATE]."'".RET;			$and = "AND".RET;		}		if($array[STAFF_END_DATE] != "") {			$qry .= $and.STAFF_END_DATE." = '".$array[STAFF_END_DATE]."'".RET;			$and = "AND".RET;		}		if($array[STAFF_RESTAURENT] != "") {			$qry .= $and.STAFF_RESTAURENT." = '".$array[STAFF_RESTAURENT]."'".RET;			$and = "AND".RET;		}				if($array[STAFF_IS_REWARD] != "") {			$qry .= $and.STAFF_IS_REWARD." = '".$array[STAFF_IS_REWARD]."'".RET;			$and = "AND".RET;		}				if($array[STAFF_IS_CRM_SUBSCRIBED] != "") {			$qry .= $and.STAFF_IS_CRM_SUBSCRIBED." = '".$array[STAFF_IS_CRM_SUBSCRIBED]."'".RET;			$and = "AND".RET;		}				if($array[STAFF_FACEBOOK] != "") {			$qry .= $and.STAFF_FACEBOOK." = '".$array[STAFF_FACEBOOK]."'".RET;			$and = "AND".RET;		}				if($array[STAFF_BIRTH_DATE] != "") {			$qry .= $and.STAFF_BIRTH_DATE." = '".$array[STAFF_BIRTH_DATE]."'".RET;			$and = "AND".RET;		}				if($array[STAFF_ANIVERSARY_DT] != "") {			$qry .= $and.STAFF_ANIVERSARY_DT." = '".$array[STAFF_ANIVERSARY_DT]."'".RET;			$and = "AND".RET;		}		if(is_gt_zero_num($array["isActive"])) {			$qry .= $and.$tbl_staff_active_condition;			$and = "AND".RET;		}				if(is_gt_zero_num($array["only_employee"])) {			$qry .= $and." ".MEMBERS.".`member_role_id` != ".ROLE_CUSTOMER;			$and = "AND".RET;		}					if(is_gt_zero_num($array["only_customers"])) {			$qry .= $and." ".MEMBERS.".`member_role_id` = ".ROLE_CUSTOMER;			$and = "AND".RET;		}				if(is_gt_zero_num($array["sms_subscribed"])) {			$qry .= $and." ".MEMBERS.".`sms_subscribed` = ".$array["sms_subscribed"];			$and = "AND".RET;		}					if($array[STAFF_LOYALTY_LEVEL] != "") {			$qry .= $and.STAFF_LOYALTY_LEVEL." = '".$array[STAFF_LOYALTY_LEVEL]."'".RET;			$and = "AND".RET;		}					if($array[STAFF_SIGNUP_FLG] != "") {			$qry .= $and.STAFF_SIGNUP_FLG." = '".$array[STAFF_SIGNUP_FLG]."'".RET;			$and = "AND".RET;		}		if(is_not_empty($array[OFFSET_TITLE]) && is_not_empty($array[LIMIT_TITLE])) {			$qry_with_limit  = $qry." LIMIT ".$array[OFFSET_TITLE].",".$array[LIMIT_TITLE];		}else{			$qry_with_limit  = $qry;		}		$result = mysql_query ($qry_with_limit);		// echo $qry_with_limit;				$r1 = mysql_query($qry);		$result_found = mysql_num_rows($r1);		$class_objects = array();		if($result) {			while ($record = mysql_fetch_assoc($result)) {				$isActive= 0;				//..check deactive date is not set or 0				if((is_not_empty($record[TBL_STAFF_DEACTIVE_DATE])==false) || (is_gt_zero_num(strtotime($record[TBL_STAFF_DEACTIVE_DATE]))== false)){									$isActive = 1; 				}else{					//..check the deactive date is greater than todays date					if(strtotime($record[TBL_STAFF_DEACTIVE_DATE]) > strtotime(date(DATE_FORMAT))){						$isActive = 1;					}				}								if($isArray){					$class_object = array();					$class_object['staff_id']=$record[STAFF_ID];					$class_object['staff_member_id']=$record[STAFF_MEMBER_ID];					$class_object['staff_address']=$record[STAFF_ADDRESS];					$class_object['staff_lname']=$record[STAFF_LNAME];					$class_object['staff_fname']=$record[STAFF_FNAME];					$class_object['staff_full_name']= implode(' ',array($record[STAFF_FNAME],$record[STAFF_LNAME]));					$class_object['member_role_name']= $record['member_role_name'];					$class_object['staff_city']=$record[STAFF_CITY];					$class_object['staff_state']=$record[STAFF_STATE];					$class_object['staff_metro']=$record[STAFF_METRO];					$class_object['staff_country']=$record[STAFF_COUNTRY];					$class_object['staff_zip']=$record[STAFF_ZIP];					$class_object['staff_phone']=$record[STAFF_PHONE];					$class_object['staff_fax']=$record[STAFF_FAX];										$class_object['staff_device_id']=$record[STAFF_DEVICE_ID];					$class_object['staff_gcm_reg_id']=$record[STAFF_GCM_REG_ID];					$class_object['staff_description']=$record[STAFF_DESCRIPTION];					$class_object['staff_desigation']=$record[STAFF_DESIGATION];					$class_object['staff_start_date']=$record[STAFF_START_DATE];					$class_object['staff_end_date']=$record[STAFF_END_DATE];					$class_object['staff_restaurent']=$record[STAFF_RESTAURENT];										$class_object['staff_email']=$record['staff_email'];										$class_object['staff_is_reward']=$record[STAFF_IS_REWARD];					$class_object['staff_is_crm_subscribed']=$record[STAFF_IS_CRM_SUBSCRIBED];										$class_object['staff_facebook']=$record[STAFF_FACEBOOK];					$class_object['staff_birth_date']=$record[STAFF_BIRTH_DATE];					$class_object['staff_aniversary_dt']=$record[STAFF_ANIVERSARY_DT];					$class_object["staff_loyalty_level"]=$record[STAFF_LOYALTY_LEVEL];					$class_object["staff_signup_flg"]=$record[STAFF_SIGNUP_FLG];										$class_object['isActive']=$isActive;				}else{					$class_object = new tbl_staff();					$class_object->setstaff_id($record[STAFF_ID]);					$class_object->setstaff_member_id($record[STAFF_MEMBER_ID]);					$class_object->setstaff_address($record[STAFF_ADDRESS]);					$class_object->setstaff_lname($record[STAFF_LNAME]);					$class_object->setstaff_fname($record[STAFF_FNAME]);					$class_object->setstaff_city($record[STAFF_CITY]);					$class_object->setstaff_state($record[STAFF_STATE]);					$class_object->setstaff_metro($record[STAFF_METRO]);					$class_object->setstaff_country($record[STAFF_COUNTRY]);					$class_object->setstaff_zip($record[STAFF_ZIP]);					$class_object->setstaff_phone($record[STAFF_PHONE]);					$class_object->setstaff_fax($record[STAFF_FAX]);					$class_object->setstaff_website($record[STAFF_WEBSITE]);					$class_object->setstaff_device_id($record[STAFF_DEVICE_ID]);					$class_object->setstaff_gcm_reg_id($record[STAFF_GCM_REG_ID]);					$class_object->setstaff_description($record[STAFF_DESCRIPTION]);					$class_object->setstaff_desigation($record[STAFF_DESIGATION]);					$class_object->setstaff_start_date($record[STAFF_START_DATE]);					$class_object->setstaff_end_date($record[STAFF_END_DATE]);					$class_object->setstaff_restaurent($record[STAFF_RESTAURENT]);										$class_object->setstaff_is_reward($record[STAFF_IS_REWARD]);					$class_object->setstaff_is_crm_subscribed($record[STAFF_IS_CRM_SUBSCRIBED]);															$class_object->setstaff_facebook($record[STAFF_FACEBOOK]);					$class_object->setstaff_birth_date($record[STAFF_BIRTH_DATE]);					$class_object->setstaff_aniversary_dt($record[STAFF_ANIVERSARY_DT]);					$class_object->setstaff_loyalty_level($record[STAFF_LOYALTY_LEVEL]);					$class_object->setstaff_signup_flg($record[STAFF_SIGNUP_FLG]);									}				$class_objects[$record[STAFF_ID]] = $class_object;			}		}		return $class_objects;	}//..End readArray	public function insert() {		if($this->getstaff_id() != '') {			$qry  = "UPDATE ".TBL_STAFF.RET."SET".RET."			".STAFF_ID." = '".$this->getstaff_id()."',".RET."			".STAFF_MEMBER_ID." = '".$this->getstaff_member_id()."',".RET."			".STAFF_ADDRESS." = '".$this->getstaff_address()."',".RET."			".STAFF_LNAME." = '".$this->getstaff_lname()."',".RET."			".STAFF_FNAME." = '".$this->getstaff_fname()."',".RET."			".STAFF_CITY." = '".$this->getstaff_city()."',".RET."			".STAFF_STATE." = '".$this->getstaff_state()."',".RET."			".STAFF_METRO." = '".$this->getstaff_metro()."',".RET."			".STAFF_COUNTRY." = '".$this->getstaff_country()."',".RET."			".STAFF_ZIP." = '".$this->getstaff_zip()."',".RET."			".STAFF_PHONE." = '".$this->getstaff_phone()."',".RET."			".STAFF_FAX." = '".$this->getstaff_fax()."',".RET."			".STAFF_WEBSITE." = '".$this->getstaff_website()."',".RET."			".STAFF_DEVICE_ID." = '".$this->getstaff_device_id()."',".RET."			".STAFF_GCM_REG_ID." = '".$this->getstaff_gcm_reg_id()."',".RET."			".STAFF_DESCRIPTION." = '".$this->getstaff_description()."',".RET."			".STAFF_DESIGATION." = '".$this->getstaff_desigation()."',".RET."						".STAFF_BIRTH_DATE." = '".$this->getstaff_birth_date()."',".RET."			".STAFF_ANIVERSARY_DT." = '".$this->getstaff_aniversary_dt()."',".RET."						".STAFF_LOYALTY_LEVEL." = '".$this->getstaff_loyalty_level()."',".RET."			".STAFF_SIGNUP_FLG." = '".$this->getstaff_signup_flg()."',".RET."						".STAFF_RESTAURENT." = '".$this->getstaff_restaurent()."'".RET.			"WHERE ".STAFF_ID." = ".$this->getstaff_id().RET;						/*			".STAFF_START_DATE." = '".$this->getstaff_start_date()."',".RET."			".STAFF_END_DATE." = '".$this->getstaff_end_date()."',".RET."			".STAFF_IS_REWARD." = '".$this->getstaff_is_reward()."',".RET."			".STAFF_IS_CRM_SUBSCRIBED." = '".$this->getstaff_is_crm_subscribed()."',".RET."				".STAFF_FACEBOOK." = '".$this->getstaff_facebook()."',".RET."			*/						mysql_query($qry);		} else {			$qry  = "INSERT INTO ".TBL_STAFF." (".RET.			"".STAFF_MEMBER_ID.", ".STAFF_ADDRESS.", ".STAFF_LNAME.", ".STAFF_FNAME.", ".STAFF_CITY.", ".STAFF_STATE.", ".STAFF_METRO.", ".STAFF_COUNTRY.", ".STAFF_ZIP.", ".STAFF_PHONE.", ".STAFF_FAX.", ".STAFF_WEBSITE.", ".STAFF_DEVICE_ID.", ".STAFF_GCM_REG_ID.", ".STAFF_DESCRIPTION.", ".STAFF_DESIGATION.", ".STAFF_START_DATE.", ".STAFF_END_DATE.", ".STAFF_IS_REWARD.", ".STAFF_IS_CRM_SUBSCRIBED.", ".STAFF_FACEBOOK.", ".STAFF_BIRTH_DATE.", ".STAFF_ANIVERSARY_DT.", ".STAFF_LOYALTY_LEVEL.", ".STAFF_SIGNUP_FLG.", ".STAFF_RESTAURENT.RET.				") VALUES (".RET.			"'".$this->getstaff_member_id()."',".RET.			"'".$this->getstaff_address()."',".RET.			"'".$this->getstaff_lname()."',".RET.			"'".$this->getstaff_fname()."',".RET.			"'".$this->getstaff_city()."',".RET.			"'".$this->getstaff_state()."',".RET.			"'".$this->getstaff_metro()."',".RET.			"'".$this->getstaff_country()."',".RET.			"'".$this->getstaff_zip()."',".RET.			"'".$this->getstaff_phone()."',".RET.			"'".$this->getstaff_fax()."',".RET.			"'".$this->getstaff_website()."',".RET.			"'".$this->getstaff_device_id()."',".RET.			"'".$this->getstaff_gcm_reg_id()."',".RET.			"'".$this->getstaff_description()."',".RET.			"'".$this->getstaff_desigation()."',".RET.			"'".$this->getstaff_start_date()."',".RET.			"'".$this->getstaff_end_date()."',".RET.						"'".$this->getstaff_is_reward()."',".RET.			"'".$this->getstaff_is_crm_subscribed()."',".RET.						"'".$this->getstaff_facebook()."',".RET.			"'".$this->getstaff_birth_date()."',".RET.			"'".$this->getstaff_aniversary_dt()."',".RET.						"'".$this->getstaff_loyalty_level()."',".RET.			"'".$this->getstaff_signup_flg()."',".RET.						"'".$this->getstaff_restaurent()."'".RET.			")".RET; 			$res = mysql_query($qry);			$this->setstaff_id(mysql_insert_id());		}	}//..End Insert		public static function delete($array = array()) {		$qry = "DELETE".RET."FROM ".TBL_STAFF.RET;		$and = "WHERE".RET;		if($array[STAFF_ID] != "") {			//$qry .= $and.STAFF_ID." = '".$array[STAFF_ID]."'".RET;			$qry .= $and.STAFF_ID." In (".$array[STAFF_ID].")".RET;			$and = "AND".RET;		}		if($array[STAFF_MEMBER_ID] != "") {			$qry .= $and.STAFF_MEMBER_ID." = '".$array[STAFF_MEMBER_ID]."'".RET;			$and = "AND".RET;		}		if($array[STAFF_ADDRESS] != "") {			$qry .= $and.STAFF_ADDRESS." = '".$array[STAFF_ADDRESS]."'".RET;			$and = "AND".RET;		}		if($array[STAFF_LNAME] != "") {			$qry .= $and.STAFF_LNAME." = '".$array[STAFF_LNAME]."'".RET;			$and = "AND".RET;		}		if($array[STAFF_FNAME] != "") {			$qry .= $and.STAFF_FNAME." = '".$array[STAFF_FNAME]."'".RET;			$and = "AND".RET;		}		if($array[STAFF_CITY] != "") {			$qry .= $and.STAFF_CITY." = '".$array[STAFF_CITY]."'".RET;			$and = "AND".RET;		}		if($array[STAFF_STATE] != "") {			$qry .= $and.STAFF_STATE." = '".$array[STAFF_STATE]."'".RET;			$and = "AND".RET;		}		if($array[STAFF_METRO] != "") {			$qry .= $and.STAFF_METRO." = '".$array[STAFF_METRO]."'".RET;			$and = "AND".RET;		}		if($array[STAFF_COUNTRY] != "") {			$qry .= $and.STAFF_COUNTRY." = '".$array[STAFF_COUNTRY]."'".RET;			$and = "AND".RET;		}		if($array[STAFF_ZIP] != "") {			$qry .= $and.STAFF_ZIP." = '".$array[STAFF_ZIP]."'".RET;			$and = "AND".RET;		}		if($array[STAFF_PHONE] != "") {			$qry .= $and.STAFF_PHONE." = '".$array[STAFF_PHONE]."'".RET;			$and = "AND".RET;		}		if($array[STAFF_FAX] != "") {			$qry .= $and.STAFF_FAX." = '".$array[STAFF_FAX]."'".RET;			$and = "AND".RET;		}		if($array[STAFF_WEBSITE] != "") {			$qry .= $and.STAFF_WEBSITE." = '".$array[STAFF_WEBSITE]."'".RET;			$and = "AND".RET;		}		if($array[STAFF_DEVICE_ID] != "") {			$qry .= $and.STAFF_DEVICE_ID." = '".$array[STAFF_DEVICE_ID]."'".RET;			$and = "AND".RET;		}		if($array[STAFF_GCM_REG_ID] != "") {			$qry .= $and.STAFF_GCM_REG_ID." = '".$array[STAFF_GCM_REG_ID]."'".RET;			$and = "AND".RET;		}		if($array[STAFF_DESCRIPTION] != "") {			$qry .= $and.STAFF_DESCRIPTION." = '".$array[STAFF_DESCRIPTION]."'".RET;			$and = "AND".RET;		}		if($array[STAFF_DESIGATION] != "") {			$qry .= $and.STAFF_DESIGATION." = '".$array[STAFF_DESIGATION]."'".RET;			$and = "AND".RET;		}		if($array[STAFF_START_DATE] != "") {			$qry .= $and.STAFF_START_DATE." = '".$array[STAFF_START_DATE]."'".RET;			$and = "AND".RET;		}		if($array[STAFF_END_DATE] != "") {			$qry .= $and.STAFF_END_DATE." = '".$array[STAFF_END_DATE]."'".RET;			$and = "AND".RET;		}		if($array[STAFF_RESTAURENT] != "") {			$qry .= $and.STAFF_RESTAURENT." = '".$array[STAFF_RESTAURENT]."'".RET;			$and = "AND".RET;		}				if($array[STAFF_LOYALTY_LEVEL] != "") {			$qry .= $and.STAFF_LOYALTY_LEVEL." = '".$array[STAFF_LOYALTY_LEVEL]."'".RET;			$and = "AND".RET;		}				if($array[STAFF_SIGNUP_FLG] != "") {			$qry .= $and.STAFF_SIGNUP_FLG." = '".$array[STAFF_SIGNUP_FLG]."'".RET;			$and = "AND".RET;		}		$res = mysql_query($qry);		if($res){			return OPERATION_SUCCESS;		}		return OPERATION_FAIL;	}//..End Delete	public function isAlreadyThere($staff_member_id ,$staff_address ,$staff_lname ,$staff_fname ,$staff_zip ,$staff_phone ,$staff_device_id ,$staff_gcm_reg_id ,$staff_description ,$staff_desigation ,$staff_start_date ,$staff_end_date ,$staff_restaurent) {		$unique_arr = array();			//$unique_arr[STAFF_ID]=$staff_id;			//$unique_arr[STAFF_MEMBER_ID]=$staff_member_id;			//$unique_arr[STAFF_ADDRESS]=$staff_address;			 //$unique_arr[STAFF_LNAME]=$staff_lname;			 //$unique_arr[STAFF_FNAME]=$staff_fname;			//$unique_arr[STAFF_ZIP]=$staff_zip;			//$unique_arr[STAFF_PHONE]=$staff_phone;			//$unique_arr[STAFF_DEVICE_ID]=$staff_device_id;			//$unique_arr[STAFF_GCM_REG_ID]=$staff_gcm_reg_id;			//$unique_arr[STAFF_DESCRIPTION]=$staff_description;			//$unique_arr[STAFF_DESIGATION]=$staff_desigation;			//$unique_arr[STAFF_START_DATE]=$staff_start_date;			//$unique_arr[STAFF_END_DATE]=$staff_end_date;			//$unique_arr[STAFF_RESTAURENT]=$staff_restaurent;		if(is_not_empty($unique_arr)){			return $this->readObject($unique_arr);		}		return false;	}//..isAlreadyThere	//public function create($staff_member_id ,$staff_address ,$staff_lname ,$staff_fname ,$staff_zip ,$staff_phone ,$staff_device_id ,$staff_gcm_reg_id ,$staff_description ,$staff_desigation ,$staff_start_date ,$staff_end_date ,$staff_restaurent) {		public function create($staff_member_id, $staff_address, $staff_lname, $staff_fname, $staff_city, $staff_state, $staff_metro, $staff_country, $staff_zip, $staff_phone, $staff_fax, $staff_website, $staff_device_id, $staff_gcm_reg_id, $staff_description, $staff_desigation, $staff_restaurent,$staff_is_reward=0,$staff_is_crm_subscribed=1,$staff_facebook=NULL,$staff_birth_date=NULL,$staff_aniversary_dt=NULL,$staff_loyalty_level=0,$staff_signup_flg=''){					 		/*if (is_gt_zero_num($staff_member_id) && is_not_empty($staff_address) && is_not_empty($staff_lname)&& is_not_empty($staff_fname)){*/		if (is_gt_zero_num($staff_member_id) && is_not_empty($staff_lname)&& is_not_empty($staff_fname)){			if($this->isAlreadyThere($staff_member_id ,$staff_address ,$staff_lname ,$staff_fname ,$staff_zip ,$staff_phone ,$staff_device_id ,$staff_gcm_reg_id ,$staff_description ,$staff_desigation ,$staff_start_date ,$staff_end_date ,$staff_restaurent)){				return OPERATION_DUPLICATE;			}else{				$this->setstaff_id("");				$this->setstaff_member_id($staff_member_id);				$this->setstaff_address($staff_address);				$this->setstaff_lname($staff_lname);				$this->setstaff_fname($staff_fname);				$this->setstaff_zip($staff_zip);				if(is_not_empty($staff_phone)){					//$staff_phone= str_replace(array('+', '-'), '', filter_var($staff_phone, FILTER_SANITIZE_NUMBER_INT));					$staff_phone= _get_us_phone_without1($staff_phone);				}				$this->setstaff_phone($staff_phone);												$this->setstaff_city($staff_city);				$this->setstaff_state($staff_state);				$this->setstaff_country($staff_country);				$this->setstaff_device_id($staff_device_id);				$this->setstaff_gcm_reg_id($staff_gcm_reg_id);				$this->setstaff_website($staff_website);				$this->setstaff_description($staff_description);				$this->setstaff_desigation($staff_desigation);				$this->setstaff_start_date(date(DATE_FORMAT)); 				$this->setstaff_restaurent($staff_restaurent);								$this->setstaff_is_reward($staff_is_reward);				$this->setstaff_is_crm_subscribed($staff_is_crm_subscribed);								if(is_not_empty($staff_birth_date)){					$this->setstaff_birth_date(date(DAY_FORMAT,strtotime($staff_birth_date)));				}else{					$this->setstaff_birth_date(NULL);				}				if(is_not_empty($staff_aniversary_dt)){					$this->setstaff_aniversary_dt(date(DAY_FORMAT,strtotime($staff_aniversary_dt)));				}else{					$this->setstaff_aniversary_dt(NULL);				}				$this->setstaff_loyalty_level($staff_loyalty_level);				$this->setstaff_signup_flg($staff_signup_flg);				$this->setstaff_facebook($staff_facebook);								//echo "staff_restaurent=$staff_restaurent";				$this->insert();				return $this->getstaff_id();			}		}		return OPERATION_FAIL;	}//..create	/*public function update($staff_id, $staff_member_id, $staff_address, $staff_lname, $staff_fname, $staff_zip, $staff_phone, $staff_device_id, $staff_gcm_reg_id, $staff_description, $staff_desigation, $staff_start_date, $staff_end_date, $staff_restaurent) {		if(is_gt_zero_num($staff_id)){			if ($this->readObject(array(STAFF_ID=>$staff_id))){				$this->setstaff_member_id($staff_member_id);				$this->setstaff_address($staff_address);				$this->setstaff_lname($staff_lname);				$this->setstaff_fname($staff_fname);				$this->setstaff_zip($staff_zip);				$this->setstaff_phone($staff_phone);				$this->setstaff_device_id($staff_device_id);				$this->setstaff_gcm_reg_id($staff_gcm_reg_id);				$this->setstaff_description($staff_description);				$this->setstaff_desigation($staff_desigation); 				$this->setstaff_restaurent($staff_restaurent);				$this->insert();				return OPERATION_SUCCESS;			}		}		return OPERATION_FAIL;	}//..update*/		public function update($staff_member_id, $staff_address, $staff_lname, $staff_fname, $staff_city, $staff_state, $staff_metro, $staff_country, $staff_zip, $staff_phone, $staff_fax, $staff_website, $staff_device_id, $staff_gcm_reg_id, $staff_description, $staff_desigation, $staff_restaurent,$staff_is_reward=0,$staff_is_crm_subscribed=0,$staff_facebook=NULL,$staff_birth_date=NULL,$staff_aniversary_dt=NULL,$staff_loyalty_level=0,$staff_signup_flg='') {		if(is_gt_zero_num($staff_member_id)){			if ($this->readObject(array(STAFF_MEMBER_ID=>$staff_member_id))){				 				$this->setstaff_address($staff_address);				$this->setstaff_lname($staff_lname);				$this->setstaff_fname($staff_fname);				$this->setstaff_city($staff_city);				$this->setstaff_state($staff_state);				$this->setstaff_metro($staff_metro);				$this->setstaff_country($staff_country);				$this->setstaff_zip($staff_zip);				if(is_not_empty($staff_phone)){					//$staff_phone= str_replace(array('+', '-'), '', filter_var($staff_phone, FILTER_SANITIZE_NUMBER_INT));					$staff_phone= _get_us_phone_without1($staff_phone);				}				$this->setstaff_phone($staff_phone);								$this->setstaff_fax($staff_fax);				$this->setstaff_website($staff_website);				$this->setstaff_device_id($staff_device_id);				$this->setstaff_gcm_reg_id($staff_gcm_reg_id);				$this->setstaff_description($staff_description);				$this->setstaff_desigation($staff_desigation); 				$this->setstaff_restaurent($staff_restaurent);								$this->setstaff_is_reward($staff_is_reward);				$this->setstaff_is_crm_subscribed($staff_is_crm_subscribed);								$this->setstaff_facebook($staff_facebook);				if(is_not_empty($staff_birth_date)){					$this->setstaff_birth_date(date(DAY_FORMAT,strtotime($staff_birth_date)));				}else{					$this->setstaff_birth_date(NULL);				}				if(is_not_empty($staff_aniversary_dt)){					$this->setstaff_aniversary_dt(date(DAY_FORMAT,strtotime($staff_aniversary_dt)));				}else{					$this->setstaff_aniversary_dt(NULL);				}				$this->setstaff_loyalty_level($staff_loyalty_level);				$this->setstaff_signup_flg($staff_signup_flg);				//$this->setstaff_birth_date($staff_birth_date);								$this->insert();				return OPERATION_SUCCESS;			}		}		return OPERATION_FAIL;	}//..update	public function ban_user($staff_id){		if(is_not_empty($staff_id)){								//$qry  = "UPDATE ".MEMBERS.RET."SET".RET." `banned`=1 WHERE `id`={$staff_member_id}";  				$qry  = "UPDATE `".MEMBERS."` SET".RET." `banned`=1 WHERE `id` IN (SELECT `staff_member_id` FROM `".TBL_STAFF."` WHERE `".STAFF_ID."` IN ({$staff_id}))";  				//echo "$qry";								$res = mysql_query($qry);				if($res){										return 1;				}		}		return 0;	}//..end ban_user		public function unban_user($staff_id){		if(is_not_empty($staff_id)){				//$qry  = "UPDATE ".MEMBERS.RET."SET".RET." `banned`=0 WHERE `id`={$staff_member_id}";  				$qry  = "UPDATE `".MEMBERS."` SET".RET." `banned`=0 WHERE `id` IN (SELECT `staff_member_id` FROM `".TBL_STAFF."` WHERE `".STAFF_ID."` IN ({$staff_id}))";  				//echo $qry;				//exit;				$res = mysql_query($qry);				if($res){										return 1;				}		}		return 0;	}//..end ban_user		public function activate($staff_id){		if(is_not_empty($staff_id)){			if ($this->readObject(array(STAFF_ID=>$staff_id))){				$qry  = "UPDATE ".TBL_STAFF.RET."SET".RET."			".TBL_STAFF_DEACTIVE_DATE." = '".date(EMPTY_DATE_FORMAT)."' WHERE ".STAFF_ID." IN ({$staff_id})";  				$res = mysql_query($qry);				if($res){					/*if($this->getstaff_role()==ROLE_WAITER){						@tbl_emp_shift_assignment::mkActiveDeactiveByEmployee($this->getstaff_member_id(),1);					}*/					return 1;				}							}		}		return 0;	}//..end activate	public function deactivate($staff_id){		if(is_not_empty($staff_id)){			if ($this->readObject(array(STAFF_ID=>$staff_id))){				$qry  = "UPDATE ".TBL_STAFF.RET."SET".RET."			".TBL_STAFF_DEACTIVE_DATE." = '".date(DATE_FORMAT)."' WHERE ".STAFF_ID." IN ({$staff_id})";				$res = mysql_query($qry); 				if($res){					if($this->getstaff_role()==ROLE_WAITER){						@tbl_emp_shift_assignment::mkActiveDeactiveByEmployee($this->getstaff_member_id(),0);					}					return 1;				}			}		}		return 0;	}//..end deactivate	public static function GetInfo($member_id=0, $staffid=0){		$arr = array(); 		$info = array();		if(is_gt_zero_num($member_id)){			 $arr['staff_member_id'] = $member_id;		}		if(is_gt_zero_num($staffid)){			 $arr['staff_id'] = $staffid;		}		//...new changes for multi restaurant login		/*if(is_gt_zero_num($_SESSION[SES_RESTAURANT])){			 $arr['staff_restaurent'] = $_SESSION[SES_RESTAURANT];		}*/				if(is_not_empty($arr)){  			$obj = new tbl_staff();			if($obj->readObject($arr)){				//..old coding				$info['staff_id']= $obj->getstaff_id();				$info['member_id']= $obj->getstaff_member_id();								$info['staff_role']= $obj->getstaff_role();				/*				$info['staff_email'] = $obj->staff_email;				$info['staff_password'] = $obj->staff_password;				*/				$info['staff_email'] = $obj->getstaff_email();				$info['staff_password'] = $obj->getstaff_password();								$info['first_name']= $obj->getstaff_fname();				$info['last_name']= $obj->getstaff_lname();				$info['full_name']= $obj->getstaff_fname()." ".$obj->getstaff_lname();				$info['zip']= $obj->getstaff_zip();				$info['phone']= $obj->getstaff_phone();				$info['address']= $obj->getstaff_address();				$info['device_id']= $obj->getstaff_device_id();				$info['gcm_reg_id']= $obj->getstaff_gcm_reg_id();				$info['description']= $obj->getstaff_description();				$info['desigation']= $obj->getstaff_desigation();				$info['restaurent']= $obj->getstaff_restaurent();								 				$info['start_date']= $obj->getstaff_start_date();        		$info['end_date']= $obj->getstaff_end_date();								///.. new info				$info["staff_id"]=$obj->getstaff_id();				$info["staff_member_id"]=$obj->getstaff_member_id();				$info["staff_address"]=$obj->getstaff_address();				$info["staff_lname"]=$obj->getstaff_lname();				$info["staff_fname"]=$obj->getstaff_fname();				$info["staff_full_name"]= implode(" ",array($obj->getstaff_fname(),$obj->getstaff_lname()));				$info["staff_city"]=$obj->getstaff_city();				$info["staff_state"]=$obj->getstaff_state();				$info["staff_metro"]=$obj->getstaff_metro();				$info["staff_country"]=$obj->getstaff_country();				$info["staff_zip"]=$obj->getstaff_zip();				$info["staff_phone"]=$obj->getstaff_phone();				$info["staff_fax"]=$obj->getstaff_fax();				$info["staff_website"]=$obj->getstaff_website();				$info["staff_device_id"]=$obj->getstaff_device_id();				$info["staff_gcm_reg_id"]=$obj->getstaff_gcm_reg_id();				$info["staff_description"]=$obj->getstaff_description();				$info["staff_desigation"]=$obj->getstaff_desigation();				$info["staff_start_date"]=$obj->getstaff_start_date();				$info["staff_end_date"]=$obj->getstaff_end_date();				$info["staff_restaurent"]=$obj->getstaff_restaurent();								$info['staff_is_reward']= $obj->getstaff_is_reward();				$info['staff_is_crm_subscribed']= $obj->getstaff_is_crm_subscribed();								$info['staff_facebook']= $obj->getstaff_facebook();				$info['staff_birth_date']=$obj->getstaff_birth_date();					$info['staff_aniversary_dt']=$obj->getstaff_aniversary_dt();									$info["staff_loyalty_level"]=$obj->getstaff_loyalty_level();				$info["staff_signup_flg"]=$obj->getstaff_signup_flg();								//..get user multiplier based on the loyalty level				$info["staff_award_multiplier"]=tbl_loyalty_level::GetAwardMultiplier($info["staff_loyalty_level"],$info['restaurent']);								$info["isActive"] = 0;				//..check deactive date is not set or 0				if((is_not_empty($obj->gettbl_staff_deactive_date())==false)  || (is_gt_zero_num(strtotime($obj->gettbl_staff_deactive_date()))== false)){					$info["isActive"] = 1;				}else{					//..check the deactive date is greater than todays date					if(strtotime($obj->gettbl_staff_deactive_date()) >= strtotime(date(DATE_FORMAT))){						$info["isActive"] = 1;					}				}			} 					unset($obj);		} 		return $info; 	}//..End GetInfo	public function updateStatus($id, $isDeactive=0){		 if($this->readObject(array("staff_id"=>$id))){		 if(is_gt_zero_num($isDeactive)){			$this->setstaff_start_date("0000-00-00 00:00:00");			$this->setallergy_end_date(date("Y-m-d H:i:s"));		 }else{		 	$this->setstaff_start_date(date("Y-m-d H:i:s"));			$this->setstaff_end_date("0000-00-00 00:00:00");		 }		 	$this->insert();		 }	}		public static function GetActiveEmployees(){		$arr = array();		$res = mysql_query('SELECT staff_member_id `employee_id`, CONCAT(`staff_fname`,\' \',`staff_lname`) AS `employee_name` FROM '.TBL_STAFF.' inner join '.MEMBERS.' on  '.MEMBERS.'.id = staff_member_id WHERE member_role_id = 1 AND staff_restaurent = '.$_SESSION[SES_RESTAURANT].' AND staff_start_date > 0 AND ( staff_end_date > CURDATE() OR staff_end_date =0 OR staff_end_date IS NULL)'); 		if($res){			while($row=mysql_fetch_assoc($res)){				$arr[$row['employee_id']] = $row['employee_name'];			}		}		//print_r($arr);		return $arr;	}	//...unsubscribe the user from sending promotion sms	public function unsubscribe_from_prom($member_id,$_rest_id) {			if(is_gt_zero_num($member_id)){							$qry  = 'UPDATE `'.TBL_STAFF.'` SET `'.STAFF_IS_CRM_SUBSCRIBED.'`=0 WHERE `'.STAFF_MEMBER_ID.'`='.$member_id.' AND `'.STAFF_RESTAURENT.'`='.$_rest_id.' ;';														$_is_success= DB::ExecNonQry($qry);								return $_is_success;						}				return OPERATION_FAIL;	}//..update		public static function getRewardUserPointsDetails($array = array(),&$result_found=0,$isArray=1) {		global $tbl_staff_active_condition;		 	/*		$qry = "SELECT ".TBL_STAFF.".*, `".MEMBERS."`.`email` as `staff_email`,										`".MEMBERS."`.`is_reward`,										`member_role`.`member_role_name`,										(SELECT IFNULL(SUM(`".CHKIN_POINTS."`),0) 										 FROM `".BIZ_CHECKINS."` 										 WHERE `".CHKIN_USER_ID."`=`".STAFF_MEMBER_ID."`) as `pts_earned`,										(SELECT IFNULL(SUM(`c`.`rwd_points`),0) 										 FROM `pds_redim_cupons` as `c`															 WHERE `c`.`rwd_usr_id`=`".STAFF_MEMBER_ID."`) as `pts_redeemed`						FROM ".TBL_STAFF." 						INNER JOIN ".MEMBERS." ON 						".STAFF_MEMBER_ID."=".MEMBERS.".`id` 						INNER JOIN `member_role` ON 						".MEMBERS.".`member_role_id`=`member_role`.`member_role_id`".RET;						*/ 	 $sql='SELECT GROUP_CONCAT(`'.RESTAURENT_ID.'`) 					FROM `'.TBL_RESTAURENT.'` 					WHERE `'.RESTAURENT_GROUP.'`='.$_SESSION['curr_restant'][RESTAURENT_GROUP];	 $_rest_ids=DB::ExecScalarQry($sql);			 $qry = "SELECT ".TBL_STAFF.".*, `".MEMBERS."`.`email` as `staff_email`,										`".MEMBERS."`.`is_reward`,`".MEMBERS."`.`banned`,										`member_role`.`member_role_name`,										(SELECT IFNULL(SUM(`".CHKIN_POINTS."`),0) 										 FROM `".BIZ_CHECKINS."` 										 WHERE `".CHKIN_USER_ID."` IN (SELECT `tmp`.`".STAFF_MEMBER_ID."` FROM `".TBL_STAFF."` `tmp` WHERE `tmp`.`".STAFF_PHONE."`=`".TBL_STAFF."`.`".STAFF_PHONE."`) AND `".CHKIN_BUSS_ID."` IN ({$_rest_ids})) as `pts_earned`,																				(SELECT IFNULL(SUM(`c`.`rwd_points`),0) 										 FROM `pds_redim_cupons` as `c`										 LEFT OUTER JOIN `".BIZ_REWARDS."` as `r` ON  										 `r`.`".RWD_ID."`=`c`.`rwd_deals_sel`																 WHERE `c`.`rwd_usr_id` IN (SELECT `tmp`.`".STAFF_MEMBER_ID."` FROM `".TBL_STAFF."` `tmp` WHERE `tmp`.`".STAFF_PHONE."`=`".TBL_STAFF."`.`".STAFF_PHONE."`) AND `r`.`".RWD_BUSS_ID."` IN ({$_rest_ids})) as `pts_redeemed`,										 				IFNULL(						GREATEST((								SELECT MAX(`chkin_date`) FROM `".BIZ_CHECKINS."` 										 WHERE `".CHKIN_USER_ID."` IN (SELECT `tmp`.`".STAFF_MEMBER_ID."` FROM `".TBL_STAFF."` `tmp` WHERE `tmp`.`".STAFF_PHONE."`=`".TBL_STAFF."`.`".STAFF_PHONE."`) AND `".CHKIN_BUSS_ID."` IN ({$_rest_ids})),      						IFNULL((					        SELECT MAX(`created_date`) FROM `pds_redim_cupons` as `c`										 LEFT OUTER JOIN `".BIZ_REWARDS."` as `r` ON  										 `r`.`".RWD_ID."`=`c`.`rwd_deals_sel`																 WHERE `c`.`rwd_usr_id` IN (SELECT `tmp`.`".STAFF_MEMBER_ID."` FROM `".TBL_STAFF."` `tmp` WHERE `tmp`.`".STAFF_PHONE."`=`".TBL_STAFF."`.`".STAFF_PHONE."`) AND `r`.`".RWD_BUSS_ID."` IN ({$_rest_ids})), 0)) 				,`staff_start_date`) as `last_visit`,										(SELECT IFNULL(SUM(`".CHKIN_POINTS."`),0) 										 FROM `".BIZ_CHECKINS."` 										 WHERE `".CHKIN_USER_ID."` IN (SELECT `tmp`.`".STAFF_MEMBER_ID."` FROM `".TBL_STAFF."` `tmp` WHERE `tmp`.`".STAFF_PHONE."`=`".TBL_STAFF."`.`".STAFF_PHONE."`) AND `".CHKIN_BUSS_ID."` IN ({$_rest_ids}) AND DATE(`".CHKIN_DATE."`)=DATE('".DATE('Y-m-d')."')) as `pts_earlier_today`			 						FROM ".TBL_STAFF." 						INNER JOIN ".MEMBERS." ON 						".STAFF_MEMBER_ID."=".MEMBERS.".`id` 						INNER JOIN `member_role` ON 						".MEMBERS.".`member_role_id`=`member_role`.`member_role_id`".RET;						//echo $qry;				//exit;						$and = "HAVING ".RET;				if($array['exclude_banned'] == 1) {			$qry .= $and." `banned` = 0 ".RET;			$and = "AND".RET;		}		if($array[STAFF_ID] != "") {			$qry .= $and.STAFF_ID." = '".$array[STAFF_ID]."'".RET;			$and = "AND".RET;		}		if($array[STAFF_MEMBER_ID] != "") {			$qry .= $and.STAFF_MEMBER_ID." = '".$array[STAFF_MEMBER_ID]."'".RET;			$and = "AND".RET;		}				if($array['gt_than_id'] != "") {			$qry .= $and.STAFF_MEMBER_ID." >= '".$array['gt_than_id']."'".RET;			$and = "AND".RET;		}				if($array[STAFF_RESTAURENT] != "") {			$qry .= $and.STAFF_RESTAURENT." = '".$array[STAFF_RESTAURENT]."'".RET;			$and = "AND".RET;		}		if(is_gt_zero_num($array["isActive"])) {			$qry .= $and.$tbl_staff_active_condition;			$and = "AND".RET;		}				if(is_gt_zero_num($array["only_employee"])) {			$qry .= $and." ".MEMBERS.".`member_role_id` != ".ROLE_CUSTOMER.RET;			$and = "AND".RET;		}					if(is_gt_zero_num($array["only_customers"])) {			$qry .= $and." ".MEMBERS.".`member_role_id` = ".ROLE_CUSTOMER.RET;			$and = "AND".RET;		}				if(is_gt_zero_num($array["sms_subscribed"])) {			//$qry .= $and." ".MEMBERS.".`sms_subscribed` = ".$array["sms_subscribed"].RET;			$qry .= $and." ".STAFF_IS_CRM_SUBSCRIBED." = ".$array["sms_subscribed"].RET;			$and = "AND".RET;		}				if($array['search_fname'] != "") {			$qry .= $and." ".STAFF_FNAME." LIKE '%".$array['search_fname']."%'".RET;			$and = "AND".RET;		}					if($array['search_lname'] != "") {			$qry .= $and." ".STAFF_LNAME." LIKE '%".$array['search_lname']."%'".RET;			$and = "AND".RET;		}					if($array['search_email'] != "") {			$qry .= $and." ".MEMBERS.".`email` LIKE '%".$array['search_email']."%'".RET;			$and = "AND".RET;		}					if($array['search_phone'] != "") {			$qry .= $and." ".STAFF_PHONE." LIKE '%".$array['search_phone']."%'".RET;			$and = "AND".RET;		}							if(is_gt_zero_num($array['search_last_visit'])) {			$qry .= $and." DATE(`last_visit`) <= ( CURDATE() - INTERVAL ".$array['search_last_visit']." DAY )".RET;			$and = "AND".RET;		}					if(is_gt_zero_num($array["is_reward"])) {			//$qry .= $and." ".MEMBERS.".`is_reward` = ".$array["is_reward"].RET;			$qry .= $and." ".STAFF_IS_REWARD." = ".$array["is_reward"].RET;			$and = "AND".RET;		}							if(is_not_empty($array["search_total_points"])) {			$qry .= $and." "." `pts_earned` >= ".$array["search_total_points"].RET;			$and = "AND".RET;		}				if(is_not_empty($array["search_redeemed_points"])) {			$qry .= $and." "." `pts_redeemed` >= ".$array["search_redeemed_points"].RET;			$and = "AND".RET;		}					if(is_not_empty($array["search_balance_points"])) {			$qry .= $and." "."`pts_earned` >= ".$array["search_balance_points"].RET;			$and = "AND".RET;		}		if(is_not_empty($array[OFFSET_TITLE]) && is_not_empty($array[LIMIT_TITLE])) {			$qry_with_limit  = $qry." LIMIT ".$array[OFFSET_TITLE].",".$array[LIMIT_TITLE];		}else{			$qry_with_limit  = $qry;		}		$result = mysql_query ($qry_with_limit);		//echo "qry_with_limit=$qry_with_limit <br>";				$r1 = mysql_query($qry);		$result_found = mysql_num_rows($r1);		$class_objects = array();		if($result) {			while ($record = mysql_fetch_assoc($result)) {				$isActive= 0;				//..check deactive date is not set or 0				if((is_not_empty($record[TBL_STAFF_DEACTIVE_DATE])==false) || (is_gt_zero_num(strtotime($record[TBL_STAFF_DEACTIVE_DATE]))== false)){									$isActive = 1; 				}else{					//..check the deactive date is greater than todays date					if(strtotime($record[TBL_STAFF_DEACTIVE_DATE]) > strtotime(date(DATE_FORMAT))){						$isActive = 1;					}				}								if($isArray){					$class_object = array();					$class_object['staff_id']=$record[STAFF_ID];					$class_object['staff_member_id']=$record[STAFF_MEMBER_ID];					$class_object['staff_address']=$record[STAFF_ADDRESS];					$class_object['staff_lname']=$record[STAFF_LNAME];					$class_object['staff_fname']=$record[STAFF_FNAME];					$class_object['staff_full_name']= implode(' ',array($record[STAFF_FNAME],$record[STAFF_LNAME]));					$class_object['member_role_name']= $record['member_role_name'];					$class_object['staff_restaurent']=$record[STAFF_RESTAURENT];										$class_object['staff_email']=$record['staff_email'];					$class_object['usr_without_email']=_chk_if_usr_witout_email($record['staff_email']);					$class_object['staff_phone']=$record['staff_phone'];					$class_object["staff_signup_flg"]=$record['staff_signup_flg'];					//..multi resatrant changes					//$class_object['staff_is_reward']=$record['is_reward'];					$class_object['staff_is_reward']=$record[STAFF_IS_REWARD];					$class_object['staff_is_crm_subscribed']=$record[STAFF_IS_CRM_SUBSCRIBED];										$class_object['total_points']=(is_gt_zero_num($record['pts_earned']) ? $record['pts_earned'] : 0);					$class_object['redeem_points']=(is_gt_zero_num($record['pts_redeemed']) ? $record['pts_redeemed'] : 0);					$class_object['balance_points']=intval($record['pts_earned']-$record['pts_redeemed']);										$class_object['pts_earlier_today']=(is_gt_zero_num($record['pts_earlier_today']) ? $record['pts_earlier_today'] : 0);										//..get user multiplier based on the loyalty level					$class_object['staff_award_multiplier']=tbl_loyalty_level::GetAwardMultiplier($record[STAFF_LOYALTY_LEVEL]);										$class_object['isActive']=$isActive;				}				$class_objects[$record[STAFF_ID]] = $class_object;			}		}		return $class_objects;	}//..End readArray		public function _get_cust_all_pts($usr_phone){		$spl="SELECT IFNULL(SUM(`".CHKIN_POINTS."`),0) 		 FROM `".BIZ_CHECKINS."` 		 WHERE `".CHKIN_USER_ID."` IN (SELECT `tmp`.`".STAFF_MEMBER_ID."` FROM `".TBL_STAFF."` `tmp` WHERE `tmp`.`".STAFF_PHONE."`=`".TBL_STAFF."`.`".STAFF_PHONE."`);";		 		 		}}//..End tbl_staff?>