<?php/**********************************************************************hm_states.class.phpGenerated by STRUCTY 2012.12.12 12:18:43.Copyright 2011 Structy, Frédéric Aebi. All rights reserved.**********************************************************************/define('TBL_ORDER_CONFIRMATION_CODES', 'tbl_order_confirmation_codes'); class tbl_order_confirmation_codes{    	public static function verifyConfirmationCode ($customerPhone,$timestamp,$confirmationCode,$restaurant){ 		$date = date("Y-m-d H:i:s",$timestamp); 		$recordCount = 0; 		if($res = mysql_query('SELECT code_id FROM `tbl_order_confirmation_codes` WHERE code_text="'.$confirmationCode.'" AND `code_customer_phone`="'.$customerPhone.'" AND   `code_restaurant`='.$restaurant.' AND `code_start_date`="'.$date.'" AND  `code_timestamp`="'.$timestamp.'"')){ 			$recordCount = mysql_num_rows($res);		}   		return $recordCount;	}	public static function updateConfirmationCode ($customerPhone,$timestamp,$orderNo,$restaurant){ 		$date = date("Y-m-d H:i:s",$timestamp); 		return  mysql_query('UPDATE `tbl_order_confirmation_codes` SET code_order='.$orderNo.' WHERE  `code_customer_phone`="'.$customerPhone.'" AND   `code_restaurant`='.$restaurant.' AND `code_start_date`="'.$date.'" AND  `code_timestamp`="'.$timestamp.'"');	}	public static function createConfirmationCode ($customerPhone,$restaurant){		$timestamp = time();		$date = date("Y-m-d H:i:s",$timestamp); 		$code_txt = self::generateCode($customerPhone,$timestamp);		mysql_query('INSERT INTO `tbl_order_confirmation_codes`(	`code_text`, `code_customer_phone`,  `code_restaurant`, `code_start_date`,  `code_timestamp`) VALUES ("'.$code_txt.'","'.$customerPhone.'",'.$restaurant.',"'.$date.'","'.$timestamp.'")'); 		  		return array('code'=>$code_txt,'timestamp'=>$timestamp);	}		public static function generateCode($customerPhone,$timestamp){ 		$code_txt =  $customerPhone + $timestamp; 		$newChar = array();		$charList = str_split($code_txt,1);		$alphaNumericChars = array('0','1','2','3','4','5','6','7','8','9');		/*$alphaNumericChars = array('a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q','r','s','t','u','v','w','x','y','z','A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z','0','1','2','3','4','5','6','7','8','9');*/		$alphaNumericCharsCount = count($alphaNumericChars);		$_cnt=1;		foreach($charList as $chr){			if($_cnt<=4){				$chrCode = (int) $chr + rand(0, $alphaNumericCharsCount)-1; 				$newChar[] =  ($chrCode >= $alphaNumericCharsCount) ? $chr : $alphaNumericChars[$chrCode]; 			}						$_cnt=$_cnt+1;  		}		return implode($newChar);	}			public static function sendSMS($phoneNo,$message){		/*$username 		= ''; // Enter your businesssms username here		$password  		= ''; // Enter your businesssms password here 		$baseurl 			="http://www.businesssms.co.in";		$phoneNumber 	= '91'.$phoneNo;				$Text = urlencode($message);				//Invoke HTTP Submit url		$url = $baseurl."/sms.aspx?Id=".$username."&Pwd=".$password."&PhNo=".$phoneNumber."&text=".$Text;				$ret = curl_init($url);		curl_setopt($ret, CURLOPT_RETURNTRANSFER, true);		curl_exec($ret);*/		send_sms_using_twilio(array($phoneNo),$message);	 	}		public static function sendFAX($faxName,$faxNo,$htmlMsg){				 		/**************** Settings begin **************/ 		$username            = 'shridhar.inforesha';  // Insert your InterFAX username here		$password            = 'shrinfo47';  // Insert your InterFAX password here		$filetype            = 'HTML'; // File format; supported types are listed at 		// http://www.interfax.net/en/help/supported_file_types 		$postponetime        = '2001-12-31T00:00:00-00:00';  // don't postpone		$retries             = '3';		$csid                = 'AA CSID';		$pageheader          = 'To: {To} From: {From} Pages: {TotalPages}';		$subject             = 'Anything goes';		$replyemail          = '';		$page_size           = 'A4';		$page_orientation    = 'Portrait';		$high_resolution     = FALSE;		$fine_rendering      = TRUE;		  		/**************** Settings end ****************/ 			//fax the form contents  			$client = new SoapClient("http://ws.interfax.net/dfs.asmx?WSDL"); 			// load all Web Service parameters 			$params->Username          =  $username;			$params->Password          =  $password;			$params->FaxNumbers        =  $faxNo;			$params->Contacts          =  $faxName;			$params->FilesData         =  $htmlMsg;			$params->FileTypes         =  $filetype;			$params->FileSizes         =  strlen($htmlMsg) ;			$params->Postpone          =  $postponetime;			$params->RetriesToPerform  =  $retries;			$params->CSID              =  $csid;			$params->PageHeader        =  $pageheader;			$params->JobID             =  '';			$params->Subject           =  $subject;			$params->ReplyAddress      =  $replyemail;			$params->PageSize          =  $page_size;			$params->PageOrientation   =  $page_orientation;			$params->IsHighResolution  =  $high_resolution; 			$params->IsFineRendering   =  $fine_rendering;			 			// submit document for faxing			$result = $client->SendfaxEx_2($params); 			// capture return value			return $result->SendfaxEx_2Result; 	}  	 }