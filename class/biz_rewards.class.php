<?phpdefine("BIZ_REWARDS", "biz_rewards"); define('RWD_ID', 'rwd_id'); define('RWD_BUSS_ID', 'rwd_buss_id'); define('RWD_CUP_ID', 'rwd_cup_id'); define('RWD_TYPE', 'rwd_type'); define('RWD_ONE_POINT_VAL', 'rwd_one_point_val'); define('RWD_POINT_LIMIT', 'rwd_point_limit'); define('RWD_BASIC', 'rwd_basic'); define('RWD_TOTAL_BALANCE', 'rwd_total_balance'); define('RWD_LR_TYPE', 'rwd_lr_type'); define('RWD_IS_REDUCTION', 'rwd_is_reduction'); define('RWD_IS_RECURRING', 'rwd_is_recurring'); define('RWD_IS_ONE_TIME', 'rwd_is_one_time'); define('RWD_CHECK_IN', 'rwd_check_in'); define('RWD_IS_QUEST_ASC', 'rwd_is_quest_asc'); define('RWD_COUPON_ID', 'rwd_coupon_id'); define('RWD_IS_NON_ENDING', 'rwd_is_non_ending');define('RWD_START_DT', 'rwd_start_dt'); define('RWD_END_DT', 'rwd_end_dt'); define('RWD_CREATED_DT', 'rwd_created_dt'); define('RWD_UPDATED_DT', 'rwd_updated_dt'); define('RWD_LOYALTY_LEVEL', 'rwd_loyalty_level');define("BIZ_REWARDS_ACTIVE_DATE",  "rwd_created_dt");define("BIZ_REWARDS_DEACTIVE_DATE",  "rwd_updated_dt");$biz_rewards_active_condition= " (".BIZ_REWARDS_DEACTIVE_DATE." is NULL OR ".BIZ_REWARDS_DEACTIVE_DATE." = 0 OR ".BIZ_REWARDS_DEACTIVE_DATE." > CURDATE( )) ";class biz_rewards {	private $rwd_id;	private $rwd_buss_id;	private $rwd_cup_id;	private $rwd_type;	private $rwd_one_point_val;	private $rwd_point_limit;		private $rwd_basic;	private $rwd_total_balance;	private $rwd_lr_type;	private $rwd_is_reduction;	private $rwd_is_recurring;	private $rwd_is_one_time;		private $rwd_check_in;	private $rwd_is_quest_asc;	private $rwd_coupon_id;		private $rwd_is_non_ending;	private $rwd_loyalty_level;		private $rwd_start_dt;	private $rwd_end_dt;	private $rwd_created_dt;	private $rwd_updated_dt;	private $biz_rewards_active_date;	private $biz_rewards_deactive_date;	public function setrwd_id($pArg="0") {$this->rwd_id=$pArg;}	public function setrwd_buss_id($pArg="0") {$this->rwd_buss_id=$pArg;}	public function setrwd_cup_id($pArg="0") {$this->rwd_cup_id=$pArg;}	public function setrwd_type($pArg="0") {$this->rwd_type=$pArg;}	public function setrwd_one_point_val($pArg="0") {$this->rwd_one_point_val=$pArg;}	public function setrwd_point_limit($pArg="0") {$this->rwd_point_limit=$pArg;}		public function setrwd_basic($pArg="0") {$this->rwd_basic=$pArg;}	public function setrwd_total_balance($pArg="0") {$this->rwd_total_balance=$pArg;}	public function setrwd_lr_type($pArg="0") {$this->rwd_lr_type=$pArg;}	public function setrwd_is_reduction($pArg="0") {$this->rwd_is_reduction=$pArg;}	public function setrwd_is_recurring($pArg="0") {$this->rwd_is_recurring=$pArg;}	public function setrwd_is_one_time($pArg="0") {$this->rwd_is_one_time=$pArg;}		public function setrwd_check_in($pArg="0") {$this->rwd_check_in=$pArg;}	public function setrwd_is_quest_asc($pArg="0") {$this->rwd_is_quest_asc=$pArg;}	public function setrwd_coupon_id($pArg="0") {$this->rwd_coupon_id=$pArg;}		public function setrwd_is_non_ending($pArg="0") {$this->rwd_is_non_ending=$pArg;}		public function setrwd_start_dt($pArg="0") {$this->rwd_start_dt=$pArg;}	public function setrwd_end_dt($pArg="0") {$this->rwd_end_dt=$pArg;}	public function setrwd_created_dt($pArg="0") {$this->rwd_created_dt=$pArg;}	public function setrwd_updated_dt($pArg="0") {$this->rwd_updated_dt=$pArg;}	public function setrwd_loyalty_level($pArg="0") {$this->rwd_loyalty_level=$pArg;}		public function setbiz_rewards_active_date($pArg="0") {$this->biz_rewards_active_date=$pArg;}	public function setbiz_rewards_deactive_date($pArg="0") {$this->biz_rewards_deactive_date=$pArg;}	public function getrwd_id() {return $this->rwd_id;}	public function getrwd_buss_id() {return $this->rwd_buss_id;}	public function getrwd_cup_id() {return $this->rwd_cup_id;}	public function getrwd_type() {return $this->rwd_type;}	public function getrwd_one_point_val() {return $this->rwd_one_point_val;}	public function getrwd_point_limit() {return $this->rwd_point_limit;}		public function getrwd_basic() {return $this->rwd_basic;}	public function getrwd_total_balance() {return $this->rwd_total_balance;}	public function getrwd_lr_type() {return $this->rwd_lr_type;}	public function getrwd_is_reduction() {return $this->rwd_is_reduction;}	public function getrwd_is_recurring() {return $this->rwd_is_recurring;}	public function getrwd_is_one_time() {return $this->rwd_is_one_time;}		public function getrwd_check_in() {return $this->rwd_check_in;}	public function getrwd_is_quest_asc() {return $this->rwd_is_quest_asc;}	public function getrwd_coupon_id() {return $this->rwd_coupon_id;}		public function getrwd_is_non_ending() {return $this->rwd_is_non_ending;}	public function getrwd_loyalty_level() {return $this->rwd_loyalty_level;}		public function getrwd_start_dt() {return $this->rwd_start_dt;}	public function getrwd_end_dt() {return $this->rwd_end_dt;}	public function getrwd_created_dt() {return $this->rwd_created_dt;}	public function getrwd_updated_dt() {return $this->rwd_updated_dt;}	public function getbiz_rewards_active_date($pArg="0") {return $this->biz_rewards_active_date;}	public function getbiz_rewards_deactive_date($pArg="0") {return $this->biz_rewards_deactive_date;}	public function readObject($array = array()) {		$qry = "SELECT *".RET."FROM ".BIZ_REWARDS.RET;		$and = "WHERE".RET;		if($array[RWD_ID] != "") {			$qry .= $and.RWD_ID." = '".$array[RWD_ID]."'".RET;			$and = "AND".RET;		}		if($array[RWD_BUSS_ID] != "") {			$qry .= $and.RWD_BUSS_ID." = '".$array[RWD_BUSS_ID]."'".RET;			$and = "AND".RET;		}		if($array[RWD_CUP_ID] != "") {			$qry .= $and.RWD_CUP_ID." = '".$array[RWD_CUP_ID]."'".RET;			$and = "AND".RET;		}		if($array[RWD_TYPE] != "") {			$qry .= $and.RWD_TYPE." = '".$array[RWD_TYPE]."'".RET;			$and = "AND".RET;		}		if($array[RWD_ONE_POINT_VAL] != "") {			$qry .= $and.RWD_ONE_POINT_VAL." = '".$array[RWD_ONE_POINT_VAL]."'".RET;			$and = "AND".RET;		}		if($array[RWD_POINT_LIMIT] != "") {			$qry .= $and.RWD_POINT_LIMIT." = '".$array[RWD_POINT_LIMIT]."'".RET;			$and = "AND".RET;		}				if($array[RWD_BASIC] != "") {			$qry .= $and.RWD_BASIC." = '".$array[RWD_BASIC]."'".RET;			$and = "AND".RET;		}		if($array[RWD_TOTAL_BALANCE] != "") {			$qry .= $and.RWD_TOTAL_BALANCE." = '".$array[RWD_TOTAL_BALANCE]."'".RET;			$and = "AND".RET;		}		if($array[RWD_LR_TYPE] != "") {			$qry .= $and.RWD_LR_TYPE." = '".$array[RWD_LR_TYPE]."'".RET;			$and = "AND".RET;		}		if($array[RWD_IS_REDUCTION] != "") {			$qry .= $and.RWD_IS_REDUCTION." = '".$array[RWD_IS_REDUCTION]."'".RET;			$and = "AND".RET;		}		if($array[RWD_IS_RECURRING] != "") {			$qry .= $and.RWD_IS_RECURRING." = '".$array[RWD_IS_RECURRING]."'".RET;			$and = "AND".RET;		}		if($array[RWD_IS_ONE_TIME] != "") {			$qry .= $and.RWD_IS_ONE_TIME." = '".$array[RWD_IS_ONE_TIME]."'".RET;			$and = "AND".RET;		}		if($array[RWD_CHECK_IN] != "") {			$qry .= $and.RWD_CHECK_IN." = '".$array[RWD_CHECK_IN]."'".RET;			$and = "AND".RET;		}		if($array[RWD_IS_QUEST_ASC] != "") {			$qry .= $and.RWD_IS_QUEST_ASC." = '".$array[RWD_IS_QUEST_ASC]."'".RET;			$and = "AND".RET;		}		if($array[RWD_COUPON_ID] != "") {			$qry .= $and.RWD_COUPON_ID." = '".$array[RWD_COUPON_ID]."'".RET;			$and = "AND".RET;		}				if($array[RWD_IS_NON_ENDING] != "") {			$qry .= $and.RWD_IS_NON_ENDING." = '".$array[RWD_IS_NON_ENDING]."'".RET;			$and = "AND".RET;		}		if($array[RWD_START_DT] != "") {			$qry .= $and.RWD_START_DT." = '".$array[RWD_START_DT]."'".RET;			$and = "AND".RET;		}		if($array[RWD_END_DT] != "") {			$qry .= $and.RWD_END_DT." = '".$array[RWD_END_DT]."'".RET;			$and = "AND".RET;		}		if($array[RWD_CREATED_DT] != "") {			$qry .= $and.RWD_CREATED_DT." = '".$array[RWD_CREATED_DT]."'".RET;			$and = "AND".RET;		}		if($array[RWD_UPDATED_DT] != "") {			$qry .= $and.RWD_UPDATED_DT." = '".$array[RWD_UPDATED_DT]."'".RET;			$and = "AND".RET;		}				if($array[RWD_LOYALTY_LEVEL] != "") {			$qry .= $and.RWD_LOYALTY_LEVEL." = '".$array[RWD_LOYALTY_LEVEL]."'".RET;			$and = "AND".RET;		}	$result = mysql_query($qry);		if($result) {			while ($row = mysql_fetch_array($result)) {				$record = $row;				break;//end after first record			}			if(count($record[0]) == 0) {				return array();			} else {				$this->setrwd_id($record[RWD_ID]);				$this->setrwd_buss_id($record[RWD_BUSS_ID]);				$this->setrwd_cup_id($record[RWD_CUP_ID]);				$this->setrwd_type($record[RWD_TYPE]);				$this->setrwd_one_point_val($record[RWD_ONE_POINT_VAL]);				$this->setrwd_point_limit($record[RWD_POINT_LIMIT]);								$this->setrwd_basic($record[RWD_BASIC]);				$this->setrwd_total_balance($record[RWD_TOTAL_BALANCE]);				$this->setrwd_lr_type($record[RWD_LR_TYPE]);				$this->setrwd_is_reduction($record[RWD_IS_REDUCTION]);				$this->setrwd_is_recurring($record[RWD_IS_RECURRING]);				$this->setrwd_is_one_time($record[RWD_IS_ONE_TIME]);								$this->setrwd_check_in($record[RWD_CHECK_IN]);				$this->setrwd_is_quest_asc($record[RWD_IS_QUEST_ASC]);				$this->setrwd_coupon_id($record[RWD_COUPON_ID]);								$this->setrwd_is_non_ending($record[RWD_IS_NON_ENDING]);				$this->setrwd_loyalty_level($record[RWD_LOYALTY_LEVEL]);								$this->setrwd_start_dt($record[RWD_START_DT]);				$this->setrwd_end_dt($record[RWD_END_DT]);				$this->setrwd_created_dt($record[RWD_CREATED_DT]);				$this->setrwd_updated_dt($record[RWD_UPDATED_DT]);				$this->setbiz_rewards_active_date($record[BIZ_REWARDS_ACTIVE_DATE]);				$this->setbiz_rewards_deactive_date($record[BIZ_REWARDS_DEACTIVE_DATE]);				return true;			}		}	}	public static function readArray($array = array(),&$result_found=0,$isArray=1) {		global $biz_rewards_active_condition;		//$qry = "SELECT *".RET."FROM ".BIZ_REWARDS.RET;		$qry = "SELECT `".BIZ_REWARDS ."`.*,`pds_list_promotions`.`title`,									`pds_list_promotions`.`start_date`,`pds_list_promotions`.`end_date`,									`pds_list_promotions`.`comments`,`img_ext`,`restaurent_img` 						FROM ".BIZ_REWARDS ." 						INNER JOIN `pds_list_promotions` 						ON ".RWD_COUPON_ID."=`pds_list_promotions`.`id`						INNER JOIN `tbl_restaurent` 						ON `".RWD_BUSS_ID."`=`restaurent_id`						";						$and = "WHERE".RET;		if($array[RWD_ID] != "") {			$qry .= $and.RWD_ID." = '".$array[RWD_ID]."'".RET;			$and = "AND".RET;		}		if($array[RWD_BUSS_ID] != "") {			$qry .= $and.RWD_BUSS_ID." = '".$array[RWD_BUSS_ID]."'".RET;			$and = "AND".RET;		}		if($array[RWD_CUP_ID] != "") {			$qry .= $and.RWD_CUP_ID." = '".$array[RWD_CUP_ID]."'".RET;			$and = "AND".RET;		}		if($array[RWD_TYPE] != "") {			$qry .= $and.RWD_TYPE." = '".$array[RWD_TYPE]."'".RET;			$and = "AND".RET;		}		if($array[RWD_ONE_POINT_VAL] != "") {			$qry .= $and.RWD_ONE_POINT_VAL." = '".$array[RWD_ONE_POINT_VAL]."'".RET;			$and = "AND".RET;		}		if($array[RWD_POINT_LIMIT] != "") {			$qry .= $and.RWD_POINT_LIMIT." = '".$array[RWD_POINT_LIMIT]."'".RET;			$and = "AND".RET;		}				if($array[RWD_BASIC] != "") {			$qry .= $and.RWD_BASIC." = '".$array[RWD_BASIC]."'".RET;			$and = "AND".RET;		}		if($array[RWD_TOTAL_BALANCE] != "") {			$qry .= $and.RWD_TOTAL_BALANCE." = '".$array[RWD_TOTAL_BALANCE]."'".RET;			$and = "AND".RET;		}		if($array[RWD_LR_TYPE] != "") {			$qry .= $and.RWD_LR_TYPE." = '".$array[RWD_LR_TYPE]."'".RET;			$and = "AND".RET;		}		if($array[RWD_IS_REDUCTION] != "") {			$qry .= $and.RWD_IS_REDUCTION." = '".$array[RWD_IS_REDUCTION]."'".RET;			$and = "AND".RET;		}		if($array[RWD_IS_RECURRING] != "") {			$qry .= $and.RWD_IS_RECURRING." = '".$array[RWD_IS_RECURRING]."'".RET;			$and = "AND".RET;		}		if($array[RWD_IS_ONE_TIME] != "") {			$qry .= $and.RWD_IS_ONE_TIME." = '".$array[RWD_IS_ONE_TIME]."'".RET;			$and = "AND".RET;		}		if($array[RWD_CHECK_IN] != "") {			$qry .= $and.RWD_CHECK_IN." = '".$array[RWD_CHECK_IN]."'".RET;			$and = "AND".RET;		}		if($array[RWD_IS_QUEST_ASC] != "") {			$qry .= $and.RWD_IS_QUEST_ASC." = '".$array[RWD_IS_QUEST_ASC]."'".RET;			$and = "AND".RET;		}		if($array[RWD_COUPON_ID] != "") {			$qry .= $and.RWD_COUPON_ID." = '".$array[RWD_COUPON_ID]."'".RET;			$and = "AND".RET;		}		if($array[RWD_IS_NON_ENDING] != "") {			$qry .= $and.RWD_IS_NON_ENDING." = '".$array[RWD_IS_NON_ENDING]."'".RET;			$and = "AND".RET;		}				if($array[RWD_START_DT] != "") {			$qry .= $and.RWD_START_DT." = '".$array[RWD_START_DT]."'".RET;			$and = "AND".RET;		}		if($array[RWD_END_DT] != "") {			$qry .= $and.RWD_END_DT." = '".$array[RWD_END_DT]."'".RET;			$and = "AND".RET;		}		if(($array['is_within_range'] != "") && ($array['is_within_range']==1 )) {			$qry .= $and." ((CURDATE( ) >= `".RWD_START_DT."` ) AND ( CURDATE( ) <= `".RWD_END_DT."`))".RET;			$and = "AND".RET;		}				if($array[RWD_CREATED_DT] != "") {			$qry .= $and.RWD_CREATED_DT." = '".$array[RWD_CREATED_DT]."'".RET;			$and = "AND".RET;		}		if($array[RWD_UPDATED_DT] != "") {			$qry .= $and.RWD_UPDATED_DT." = '".$array[RWD_UPDATED_DT]."'".RET;			$and = "AND".RET;		}		if(is_gt_zero_num($array["isActive"])) {			$qry .= $and.$biz_rewards_active_condition;;			$and = "AND".RET;		}		if($array[RWD_LOYALTY_LEVEL] != "") {			$qry .= $and.RWD_LOYALTY_LEVEL." = '".$array[RWD_LOYALTY_LEVEL]."'".RET;			$and = "AND".RET;		}		if(is_not_empty($array[SORT_ON]) && is_not_empty($array[SORT_BY])) {		$qry .=" ORDER BY ".$array[SORT_ON]." ".$array[SORT_BY];		}		if(is_not_empty($array[OFFSET_TITLE]) && is_not_empty($array[LIMIT_TITLE])) {			$qry_with_limit  = $qry." LIMIT ".$array[OFFSET_TITLE].",".$array[LIMIT_TITLE];		}else{			$qry_with_limit  = $qry;		}		//echo $qry_with_limit;				$result = mysql_query ($qry_with_limit);		$r1 = mysql_query($qry);		if($r1){			$result_found = mysql_num_rows($r1);		}		$class_objects = array();		if($result) {			while ($record = mysql_fetch_assoc($result)) {				$isActive= 0;				//..check deactive date is not set or 0				if((is_not_empty($record[BIZ_REWARDS_DEACTIVE_DATE])==false) || (is_gt_zero_num(strtotime($record[BIZ_REWARDS_DEACTIVE_DATE]))== false)){					$isActive = 1; 				}else{					//..check the deactive date is greater than todays date					if(strtotime($record[BIZ_REWARDS_DEACTIVE_DATE]) > strtotime(date(DATE_FORMAT))){						$isActive = 1;					}				}				if($isArray){					$class_object = array();					$class_object["rwd_id"]=$record[RWD_ID];					$class_object["rwd_buss_id"]=$record[RWD_BUSS_ID];					$class_object["rwd_cup_id"]=$record[RWD_CUP_ID];					$class_object["rwd_type"]=$record[RWD_TYPE];					$class_object["rwd_one_point_val"]=$record[RWD_ONE_POINT_VAL];					$class_object["rwd_point_limit"]=$record[RWD_POINT_LIMIT];					$class_object["rwd_check_in"]=$record[RWD_CHECK_IN];					$class_object["rwd_is_quest_asc"]=$record[RWD_IS_QUEST_ASC];					$class_object["rwd_coupon_id"]=$record[RWD_COUPON_ID];										//..fields for the image					$class_object["prom_title"]=$record['title'];						$class_object["img_ext"]=$record['img_ext'];					$class_object["restaurent_img"]=$record['restaurent_img'];					$class_object["comments"]=$record['comments'];											$class_object["rwd_basic"]=$record[RWD_BASIC];					$class_object["rwd_total_balance"]=$record[RWD_TOTAL_BALANCE];					$class_object["rwd_lr_type"]=$record[RWD_LR_TYPE];					$class_object["rwd_is_reduction"]=$record[RWD_IS_REDUCTION];					$class_object["rwd_is_recurring"]=$record[RWD_IS_RECURRING];					$class_object["rwd_is_one_time"]=$record[RWD_IS_ONE_TIME];									$class_object["rwd_is_non_ending"]=$record[RWD_IS_NON_ENDING];					$class_object["rwd_loyalty_level"]=$record[RWD_LOYALTY_LEVEL];										$class_object["rwd_start_dt"]=$record[RWD_START_DT];					$class_object["rwd_end_dt"]=$record[RWD_END_DT];					$class_object["rwd_created_dt"]=$record[RWD_CREATED_DT];					$class_object["rwd_updated_dt"]=$record[RWD_UPDATED_DT];										$class_object['formatted_start_date'] =date('m/d/Y',strtotime($record['start_date']));					$class_object['formatted_end_date'] =date('m/d/Y',strtotime($record['end_date']));										$class_object["isActive"]=$isActive;				}else{					$class_object = new biz_rewards();					$class_object->setrwd_id($record[RWD_ID]);					$class_object->setrwd_buss_id($record[RWD_BUSS_ID]);					$class_object->setrwd_cup_id($record[RWD_CUP_ID]);					$class_object->setrwd_type($record[RWD_TYPE]);					$class_object->setrwd_one_point_val($record[RWD_ONE_POINT_VAL]);					$class_object->setrwd_point_limit($record[RWD_POINT_LIMIT]);										$class_object->setrwd_basic($record[RWD_BASIC]);					$class_object->setrwd_total_balance($record[RWD_TOTAL_BALANCE]);					$class_object->setrwd_lr_type($record[RWD_LR_TYPE]);					$class_object->setrwd_is_reduction($record[RWD_IS_REDUCTION]);					$class_object->setrwd_is_recurring($record[RWD_IS_RECURRING]);					$class_object->setrwd_is_one_time($record[RWD_IS_ONE_TIME]);										$class_object->setrwd_check_in($record[RWD_CHECK_IN]);					$class_object->setrwd_is_quest_asc($record[RWD_IS_QUEST_ASC]);					$class_object->setrwd_coupon_id($record[RWD_COUPON_ID]);										$class_object->setrwd_is_non_ending($record[RWD_IS_NON_ENDING]);					$class_object->setrwd_loyalty_level($record[RWD_LOYALTY_LEVEL]);										$class_object->setrwd_start_dt($record[RWD_START_DT]);					$class_object->setrwd_end_dt($record[RWD_END_DT]);					$class_object->setrwd_created_dt($record[RWD_CREATED_DT]);					$class_object->setrwd_updated_dt($record[RWD_UPDATED_DT]);				}				$class_objects[$record[RWD_ID]] = $class_object;			}		}		return $class_objects;	}//..End readArray	public function insert() {		if($this->getrwd_id() != '') {			$qry  = "UPDATE ".BIZ_REWARDS.RET."SET".RET."			".RWD_ID." = '".$this->getrwd_id()."',".RET."			".RWD_BUSS_ID." = '".$this->getrwd_buss_id()."',".RET."			".RWD_CUP_ID." = '".$this->getrwd_cup_id()."',".RET."			".RWD_TYPE." = '".$this->getrwd_type()."',".RET."			".RWD_ONE_POINT_VAL." = '".$this->getrwd_one_point_val()."',".RET."			".RWD_POINT_LIMIT." = '".$this->getrwd_point_limit()."',".RET."						".RWD_BASIC." = '".$this->getrwd_basic()."',".RET."			".RWD_TOTAL_BALANCE." = '".$this->getrwd_total_balance()."',".RET."			".RWD_LR_TYPE." = '".$this->getrwd_lr_type()."',".RET."			".RWD_IS_REDUCTION." = '".$this->getrwd_is_reduction()."',".RET."			".RWD_IS_RECURRING." = '".$this->getrwd_is_recurring()."',".RET."			".RWD_IS_ONE_TIME." = '".$this->getrwd_is_one_time()."',".RET."						".RWD_CHECK_IN." = '".$this->getrwd_check_in()."',".RET."			".RWD_IS_QUEST_ASC." = '".$this->getrwd_is_quest_asc()."',".RET."			".RWD_COUPON_ID." = '".$this->getrwd_coupon_id()."',".RET."						".RWD_IS_NON_ENDING." = '".$this->getrwd_is_non_ending()."',".RET."						".RWD_START_DT." = '".$this->getrwd_start_dt()."',".RET."			".RWD_END_DT." = '".$this->getrwd_end_dt()."',".RET."			".RWD_CREATED_DT." = '".$this->getrwd_created_dt()."',".RET."			".RWD_UPDATED_DT." = '".$this->getrwd_updated_dt()."',".RET."			".RWD_LOYALTY_LEVEL." = '".$this->getrwd_loyalty_level()."'".RET.			"WHERE ".RWD_ID." = ".$this->getrwd_id().RET;			mysql_query($qry);		} else {			$qry  = "INSERT INTO ".BIZ_REWARDS." (".RET.			"".RWD_BUSS_ID.", ".RWD_CUP_ID.", ".RWD_TYPE.", ".RWD_ONE_POINT_VAL.", ".RWD_POINT_LIMIT.", ".RWD_BASIC.", ".RWD_TOTAL_BALANCE.", ".RWD_LR_TYPE.", ".RWD_IS_REDUCTION.", ".RWD_IS_RECURRING.", ".RWD_IS_ONE_TIME.", ".RWD_CHECK_IN.", ".RWD_IS_QUEST_ASC.", ".RWD_COUPON_ID.", ".RWD_IS_NON_ENDING.", ".RWD_START_DT.", ".RWD_END_DT.", ".RWD_CREATED_DT.", ".RWD_UPDATED_DT.", ".RWD_LOYALTY_LEVEL.RET.				") VALUES (".RET.			"'".$this->getrwd_buss_id()."',".RET.			"'".$this->getrwd_cup_id()."',".RET.			"'".$this->getrwd_type()."',".RET.			"'".$this->getrwd_one_point_val()."',".RET.			"'".$this->getrwd_point_limit()."',".RET.						"'".$this->getrwd_basic()."',".RET.			"'".$this->getrwd_total_balance()."',".RET.			"'".$this->getrwd_lr_type()."',".RET.			"'".$this->getrwd_is_reduction()."',".RET.			"'".$this->getrwd_is_recurring()."',".RET.			"'".$this->getrwd_is_one_time()."',".RET.						"'".$this->getrwd_check_in()."',".RET.			"'".$this->getrwd_is_quest_asc()."',".RET.			"'".$this->getrwd_coupon_id()."',".RET.						"'".$this->getrwd_is_non_ending()."',".RET.						"'".$this->getrwd_start_dt()."',".RET.			"'".$this->getrwd_end_dt()."',".RET.			"'".$this->getrwd_created_dt()."',".RET.			"'".$this->getrwd_updated_dt()."',".RET.			"'".$this->getrwd_loyalty_level()."'".RET.			")".RET;			$res = mysql_query($qry);			$this->setrwd_id(mysql_insert_id());		}	}//..End Insert	public static function delete($array = array()) {		$qry = "DELETE".RET."FROM ".BIZ_REWARDS.RET;		$and = "WHERE".RET;		if($array[RWD_ID] != "") {			$qry .= $and.RWD_ID." IN (".$array[RWD_ID].")".RET;			$and = "AND".RET;		}		if($array[RWD_BUSS_ID] != "") {			$qry .= $and.RWD_BUSS_ID." = '".$array[RWD_BUSS_ID]."'".RET;			$and = "AND".RET;		}		if($array[RWD_CUP_ID] != "") {			$qry .= $and.RWD_CUP_ID." = '".$array[RWD_CUP_ID]."'".RET;			$and = "AND".RET;		}		if($array[RWD_TYPE] != "") {			$qry .= $and.RWD_TYPE." = '".$array[RWD_TYPE]."'".RET;			$and = "AND".RET;		}		if($array[RWD_ONE_POINT_VAL] != "") {			$qry .= $and.RWD_ONE_POINT_VAL." = '".$array[RWD_ONE_POINT_VAL]."'".RET;			$and = "AND".RET;		}		if($array[RWD_POINT_LIMIT] != "") {			$qry .= $and.RWD_POINT_LIMIT." = '".$array[RWD_POINT_LIMIT]."'".RET;			$and = "AND".RET;		}				if($array[RWD_BASIC] != "") {			$qry .= $and.RWD_BASIC." = '".$array[RWD_BASIC]."'".RET;			$and = "AND".RET;		}		if($array[RWD_TOTAL_BALANCE] != "") {			$qry .= $and.RWD_TOTAL_BALANCE." = '".$array[RWD_TOTAL_BALANCE]."'".RET;			$and = "AND".RET;		}		if($array[RWD_LR_TYPE] != "") {			$qry .= $and.RWD_LR_TYPE." = '".$array[RWD_LR_TYPE]."'".RET;			$and = "AND".RET;		}		if($array[RWD_IS_REDUCTION] != "") {			$qry .= $and.RWD_IS_REDUCTION." = '".$array[RWD_IS_REDUCTION]."'".RET;			$and = "AND".RET;		}		if($array[RWD_IS_RECURRING] != "") {			$qry .= $and.RWD_IS_RECURRING." = '".$array[RWD_IS_RECURRING]."'".RET;			$and = "AND".RET;		}		if($array[RWD_IS_ONE_TIME] != "") {			$qry .= $and.RWD_IS_ONE_TIME." = '".$array[RWD_IS_ONE_TIME]."'".RET;			$and = "AND".RET;		}		if($array[RWD_CHECK_IN] != "") {			$qry .= $and.RWD_CHECK_IN." = '".$array[RWD_CHECK_IN]."'".RET;			$and = "AND".RET;		}		if($array[RWD_IS_QUEST_ASC] != "") {			$qry .= $and.RWD_IS_QUEST_ASC." = '".$array[RWD_IS_QUEST_ASC]."'".RET;			$and = "AND".RET;		}		if($array[RWD_COUPON_ID] != "") {			$qry .= $and.RWD_COUPON_ID." = '".$array[RWD_COUPON_ID]."'".RET;			$and = "AND".RET;		}				if($array[RWD_IS_NON_ENDING] != "") {			$qry .= $and.RWD_IS_NON_ENDING." = '".$array[RWD_IS_NON_ENDING]."'".RET;			$and = "AND".RET;		}		if($array[RWD_START_DT] != "") {			$qry .= $and.RWD_START_DT." = '".$array[RWD_START_DT]."'".RET;			$and = "AND".RET;		}		if($array[RWD_END_DT] != "") {			$qry .= $and.RWD_END_DT." = '".$array[RWD_END_DT]."'".RET;			$and = "AND".RET;		}		if($array[RWD_CREATED_DT] != "") {			$qry .= $and.RWD_CREATED_DT." = '".$array[RWD_CREATED_DT]."'".RET;			$and = "AND".RET;		}		if($array[RWD_UPDATED_DT] != "") {			$qry .= $and.RWD_UPDATED_DT." = '".$array[RWD_UPDATED_DT]."'".RET;			$and = "AND".RET;		}		if($array[RWD_LOYALTY_LEVEL] != "") {			$qry .= $and.RWD_LOYALTY_LEVEL." = '".$array[RWD_LOYALTY_LEVEL]."'".RET;			$and = "AND".RET;		}		$res = mysql_query($qry);		if($res){			return OPERATION_SUCCESS;		};		return OPERATION_FAIL;	}//..End Delete	public function isAlreadyThere($rwd_buss_id ,$rwd_cup_id ,$rwd_type ,$rwd_one_point_val ,$rwd_point_limit ,$rwd_check_in ,$rwd_is_quest_asc ,$rwd_coupon_id ,$rwd_start_dt ,$rwd_end_dt ,$rwd_created_dt ,$rwd_updated_dt,$rwd_loyalty_level) {		$unique_arr = array();			//$unique_arr[RWD_ID]=$rwd_id;			$unique_arr[RWD_BUSS_ID]=$rwd_buss_id;			//$unique_arr[RWD_CUP_ID]=$rwd_cup_id;			//$unique_arr[RWD_TYPE]=$rwd_type;			//$unique_arr[RWD_ONE_POINT_VAL]=$rwd_one_point_val;			//$unique_arr[RWD_POINT_LIMIT]=$rwd_point_limit;			//$unique_arr[RWD_CHECK_IN]=$rwd_check_in;			//$unique_arr[RWD_IS_QUEST_ASC]=$rwd_is_quest_asc;			$unique_arr[RWD_COUPON_ID]=$rwd_coupon_id;			//$unique_arr[RWD_START_DT]=$rwd_start_dt;			//$unique_arr[RWD_END_DT]=$rwd_end_dt;			//$unique_arr[RWD_CREATED_DT]=$rwd_created_dt;			//$unique_arr[RWD_UPDATED_DT]=$rwd_updated_dt;			$unique_arr[RWD_LOYALTY_LEVEL]=$rwd_loyalty_level;					if(is_not_empty($unique_arr)){			return $this->readObject($unique_arr);		}		return false;	}//..isAlreadyThere	public function create($rwd_buss_id ,$rwd_cup_id ,$rwd_type ,$rwd_one_point_val ,$rwd_point_limit ,$rwd_basic ,$rwd_total_balance ,$rwd_lr_type ,$rwd_is_reduction ,$rwd_is_recurring ,$rwd_is_one_time ,$rwd_check_in ,$rwd_is_quest_asc ,$rwd_coupon_id ,$rwd_start_dt ,$rwd_end_dt ,$rwd_created_dt ,$rwd_updated_dt,$rwd_is_non_ending=0,$rwd_loyalty_level=0) {		if(is_not_empty($rwd_buss_id)){			if($this->isAlreadyThere($rwd_buss_id ,$rwd_cup_id ,$rwd_type ,$rwd_one_point_val ,$rwd_point_limit ,$rwd_check_in ,$rwd_is_quest_asc ,$rwd_coupon_id ,$rwd_start_dt ,$rwd_end_dt ,$rwd_created_dt ,$rwd_updated_dt,$rwd_loyalty_level)){				return OPERATION_DUPLICATE;			}else{				$this->setrwd_id("");				$this->setrwd_buss_id($rwd_buss_id);				$this->setrwd_cup_id($rwd_cup_id);				$this->setrwd_type($rwd_type);				$this->setrwd_one_point_val($rwd_one_point_val);				$this->setrwd_point_limit($rwd_point_limit);								$this->setrwd_basic($rwd_basic);				$this->setrwd_total_balance($rwd_total_balance);				$this->setrwd_lr_type($rwd_lr_type);				$this->setrwd_is_reduction($rwd_is_reduction);				$this->setrwd_is_recurring($rwd_is_recurring);				$this->setrwd_is_one_time($rwd_is_one_time);								$this->setrwd_check_in($rwd_check_in);				$this->setrwd_is_quest_asc($rwd_is_quest_asc);				$this->setrwd_coupon_id($rwd_coupon_id);								$this->setrwd_is_non_ending($rwd_is_non_ending);				$this->setrwd_loyalty_level($rwd_loyalty_level);								$this->setrwd_start_dt(date(DATE_FORMAT,strtotime($rwd_start_dt)));				if($rwd_is_non_ending==1){					$this->setrwd_end_dt(date(DATE_FORMAT,strtotime("+20 year")));				}else{					$this->setrwd_end_dt(date(DATE_FORMAT,strtotime($rwd_end_dt)));				}								$this->setrwd_created_dt(date(DATE_FORMAT));				//$this->setrwd_updated_dt($rwd_updated_dt);				$this->insert();				return $this->getrwd_id();			}		}		return OPERATION_FAIL;	}//..create	public function update($rwd_id, $rwd_buss_id, $rwd_cup_id, $rwd_type, $rwd_one_point_val, $rwd_point_limit,$rwd_basic ,$rwd_total_balance ,$rwd_lr_type ,$rwd_is_reduction ,$rwd_is_recurring ,$rwd_is_one_time ,$rwd_check_in, $rwd_is_quest_asc, $rwd_coupon_id, $rwd_start_dt, $rwd_end_dt, $rwd_created_dt, $rwd_updated_dt,$rwd_is_non_ending=0,$rwd_loyalty_level=0) {		if(is_gt_zero_num($rwd_id)){			if ($this->readObject(array(RWD_ID=>$rwd_id))){				$this->setrwd_buss_id($rwd_buss_id);				$this->setrwd_cup_id($rwd_cup_id);				$this->setrwd_type($rwd_type);				$this->setrwd_one_point_val($rwd_one_point_val);				$this->setrwd_point_limit($rwd_point_limit);								$this->setrwd_basic($rwd_basic);				$this->setrwd_total_balance($rwd_total_balance);				$this->setrwd_lr_type($rwd_lr_type);				$this->setrwd_is_reduction($rwd_is_reduction);				$this->setrwd_is_recurring($rwd_is_recurring);				$this->setrwd_is_one_time($rwd_is_one_time);								$this->setrwd_check_in($rwd_check_in);				$this->setrwd_is_quest_asc($rwd_is_quest_asc);				$this->setrwd_coupon_id($rwd_coupon_id);								$this->setrwd_is_non_ending($rwd_is_non_ending);				$this->setrwd_loyalty_level($rwd_loyalty_level);								$this->setrwd_start_dt(date(DATE_FORMAT,strtotime($rwd_start_dt)));				if($rwd_is_non_ending==1){					$this->setrwd_end_dt(date(DATE_FORMAT,strtotime("+20 year")));				}else{					$this->setrwd_end_dt(date(DATE_FORMAT,strtotime($rwd_end_dt)));				}				//$this->setrwd_end_dt(date(DATE_FORMAT,strtotime($rwd_end_dt)));				//$this->setrwd_created_dt($rwd_created_dt);				//$this->setrwd_updated_dt($rwd_updated_dt);				$this->insert();				return OPERATION_SUCCESS;			}		}		return OPERATION_FAIL;	}//..update		public function activate($rwd_id){		if(is_not_empty($rwd_id)){			//if ($this->readObject(array(RWD_ID=>$rwd_id))){				$qry  = "UPDATE ".BIZ_REWARDS.RET."SET".RET."			".BIZ_REWARDS_DEACTIVE_DATE." = '".date(EMPTY_DATE_FORMAT)."' WHERE ".RWD_ID." IN ({$rwd_id})";				$res = mysql_query($qry);				if($res){					return 1;				}			//}		}		return 0;	}//..end activate	public function deactivate($rwd_id){		if(is_not_empty($rwd_id)){			//if ($this->readObject(array(RWD_ID=>$rwd_id))){				$qry  = "UPDATE ".BIZ_REWARDS.RET."SET".RET."			".BIZ_REWARDS_DEACTIVE_DATE." = '".date(DATE_FORMAT)."' WHERE ".RWD_ID." IN ({$rwd_id})";								$res = mysql_query($qry);				if($res){					return 1;				}			//}		}		return 0;	}//..end deactivate	public static function GetInfo($rwd_id) {		$info = array();		if($rwd_id != ""){			$obj_biz_rewards = new biz_rewards();			if($obj_biz_rewards->readObject(array("rwd_id"=>$rwd_id))){				$info["rwd_id"]=$obj_biz_rewards->getrwd_id();				$info["rwd_buss_id"]=$obj_biz_rewards->getrwd_buss_id();				$info["rwd_cup_id"]=$obj_biz_rewards->getrwd_cup_id();				$info["rwd_type"]=$obj_biz_rewards->getrwd_type();				$info["rwd_one_point_val"]=$obj_biz_rewards->getrwd_one_point_val();				$info["rwd_point_limit"]=$obj_biz_rewards->getrwd_point_limit();								$info["rwd_basic"]=$obj_biz_rewards->getrwd_basic();				$info["rwd_total_balance"]=$obj_biz_rewards->getrwd_total_balance();				$info["rwd_lr_type"]=$obj_biz_rewards->getrwd_lr_type();				$info["rwd_is_reduction"]=$obj_biz_rewards->getrwd_is_reduction();				$info["rwd_is_recurring"]=$obj_biz_rewards->getrwd_is_recurring();				$info["rwd_is_one_time"]=$obj_biz_rewards->getrwd_is_one_time();								$info["rwd_check_in"]=$obj_biz_rewards->getrwd_check_in();				$info["rwd_is_quest_asc"]=$obj_biz_rewards->getrwd_is_quest_asc();				$info["rwd_coupon_id"]=$obj_biz_rewards->getrwd_coupon_id();								$info["rwd_is_non_ending"]=$obj_biz_rewards->getrwd_is_non_ending();				$info["rwd_loyalty_level"]=$obj_biz_rewards->getrwd_loyalty_level();								$info["rwd_start_dt"]=$obj_biz_rewards->getrwd_start_dt();				$info["rwd_end_dt"]=$obj_biz_rewards->getrwd_end_dt();				$info["rwd_created_dt"]=$obj_biz_rewards->getrwd_created_dt();				$info["rwd_updated_dt"]=$obj_biz_rewards->getrwd_updated_dt();				$info["isActive"] = 0;				//..check deactive date is not set or 0				if((is_not_empty($obj_biz_rewards->getbiz_rewards_deactive_date())==false)  || (is_gt_zero_num(strtotime($obj_biz_rewards->getbiz_rewards_deactive_date()))== false)){					$info["isActive"] = 1;				}else{					//..check the deactive date is greater than todays date					if(strtotime($obj_biz_rewards->getbiz_rewards_deactive_date()) > strtotime(date(DATE_FORMAT))){						$info["isActive"] = 1;					}				}			}		unset($obj_biz_rewards);		return $info;		}	}//..End GetInfo	public static function GetFields($data){		global $biz_rewards_active_condition;		$arr = array();		if(is_not_empty($data)){			$qry ="SELECT ".$data['key_field'].",".$data['value_field']." FROM ".BIZ_REWARDS."";			if(is_gt_zero_num($data['isActive'])){				$qry .= " WHERE ".$biz_rewards_active_condition;			}			$res = mysql_query($qry); 			if($res){				while($row=mysql_fetch_assoc($res)){					$arr[$row[$data['key_field']]] = $row[$data['value_field']];				}			}		}		return $arr;	}//.. End of GetFields		//..function to get the rewards overall stats	public static function getRewardUserStats($user_id,$rest_id=''){		$_usr_grp =get_userid_rest_by_group($user_id);		    /*if($rest_id==''){			$rest_id=$_SESSION[SES_RESTAURANT];					}		if($group_id==''){			$group_id=$_SESSION['curr_restant'][RESTAURENT_GROUP];		}*/		$stats=array();		//..Step-A]		//..fetch the total points		/*$sql='SELECT SUM(`'.CHKIN_POINTS.'`) as `pts_earned` 					FROM `'.BIZ_CHECKINS.'` 					WHERE `'.CHKIN_USER_ID.'`='.$user_id;	*/							$sql='SELECT SUM(`'.CHKIN_POINTS.'`) as `pts_earned` 					FROM `'.BIZ_CHECKINS.'` 					WHERE `'.CHKIN_USER_ID.'` IN ('.$_usr_grp['user_ids'].') AND `'.CHKIN_BUSS_ID.'` IN ('.$_usr_grp['rest_ids'].'					)';			//echo $sql;		//exit;							$total_pts=DB::ExecScalarQry($sql);			//..Step-B]		//..fetch the Redeemed values		$sql='SELECT SUM(`c`.`rwd_points`) as `pts_redeemed`,								 GROUP_CONCAT(DISTINCT(`rwd_deals_sel`)) as `redeemed_rewards_lst`					FROM `pds_redim_cupons` as `c`							LEFT OUTER JOIN `'.BIZ_REWARDS.'` as `r` ON  					`r`.`'.RWD_ID.'`=`c`.`rwd_deals_sel`							  WHERE `c`.`rwd_usr_id` IN ('.$_usr_grp['user_ids'].')  AND `r`.`'.RWD_BUSS_ID.'` IN (					'.$_usr_grp['rest_ids'].'					)';		//echo $sql;		/*$sql='SELECT SUM(`c`.`rwd_points`) as `pts_redeemed`					FROM `'.PDS_REDIM_CUPONS.'` as `c`					INNER JOIN `'.BIZ_REWARDS.'` as `r` ON  					`r`.`'.RWD_ID.'`=`c`.`rwd_usr_id`				  WHERE `c`.`rwd_usr_id`='.$user_id;*/		$total_redeem_pts=DB::ExecQry($sql,1);				if(is_gt_zero_num($total_pts)){			//$stats['total_points']=number_format(floatval($total_pts),2);			$stats['total_points']=round(floatval($total_pts),2);		}else{			$stats['total_points']=0;		}				if(is_not_empty($total_redeem_pts)){			if(is_gt_zero_num(floatval($total_redeem_pts['pts_redeemed']))){				//$stats['redeem_points']= number_format(floatval($total_redeem_pts['pts_redeemed']),2);				$stats['redeem_points']= round(floatval($total_redeem_pts['pts_redeemed']),2);			}else{				$stats['redeem_points']=0;			}			if(is_not_empty($total_redeem_pts['redeemed_rewards_lst'])){				$stats['redeemed_rewards_lst']=explode(',',$total_redeem_pts['redeemed_rewards_lst']);			}else{				$stats['redeemed_rewards_lst']=array();			}					}else{			$stats['redeem_points']=0;			$stats['redeemed_rewards_lst']=array();		}					//..Step-C]		//..balance is mere difference between A and B		//$stats['balance_points']=number_format(floatval($stats['total_points']-$stats['redeem_points']),2);		$stats['balance_points']=round(($total_pts-floatval($stats['redeem_points'])),2);							//..Step-IV]		//..points captured earlier today		$sql='SELECT SUM(`'.CHKIN_POINTS.'`) as `pts_earned`    					FROM `'.BIZ_CHECKINS.'` 					WHERE `'.CHKIN_USER_ID.'`='.$user_id.' AND `'.CHKIN_BUSS_ID.'`='.$rest_id.' AND DATE(`'.CHKIN_DATE.'`)=DATE(NOW())';		$today_earlier_pts=DB::ExecScalarQry($sql);		if(is_not_empty($today_earlier_pts)){				$stats['today_earlier_pts']=$today_earlier_pts;		}else{				$stats['today_earlier_pts']=0;		}										return $stats;					} 		//..Rewardwise stats such as count and points	public static function get_reward_redeemed_stats($user_id,$rwd_id){		$stats=array();		//..Get the count of uptill now consumed 		$sql='SELECT COUNT(`c`.`id`) as `count_redeemed`,SUM(`c`.`rwd_points`) as `pts_redeemed`  		FROM `pds_redim_cupons` as `c`			  WHERE `c`.`rwd_usr_id`='.$user_id.' AND `c`.`rwd_deals_sel`='.$rwd_id;		$result=DB::ExecQry($sql,1);		if(is_not_empty($result)){			$stats=$result;		}else{			$stats['count_redeemed']=0;			$stats['pts_redeemed']=0;		}		return $stats;	}		public static function get_lst_rwd_lr_type(){		return array('b'=>'Basic','rm'=>'Recurring Milestone','m'=>'Milestone');	}			public static function get_lst_rwd_total_balance(){		return array('total'=>'Total','balance'=>'Balance');	}		//..check redeem within 2 hour by same customer	public static function chk_if_redeem_wthin_2_hrs($cust_id,$tbl_id){			$is_found=DB::ExecScalarQry('SELECT COUNT(`c`.`id`) as `is_fnd` FROM `pds_redim_cupons` as `c` WHERE `c`.`rwd_usr_id`='.$cust_id.' AND `created_date` > SUBDATE( "'.date(DATE_FORMAT).'", INTERVAL 2 HOUR);');		return $is_found;	}		//..Get reward id 	public static function _get_rwd_id_for_prom_id($promotion_id){		$_rwd_rec=DB::ExecQry("SELECT * FROM `biz_rewards` WHERE `rwd_coupon_id`={$promotion_id};",1);		return $_rwd_rec; 	}	}//..End biz_rewards?>