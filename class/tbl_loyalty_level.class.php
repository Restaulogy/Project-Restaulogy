<?php/**********************************************************************tbl_loyalty_level.class.phpGenerated by STRUCTY 2017.03.29 06:09:06.Copyright 2011 Structy, Frédéric Aebi. All rights reserved.**********************************************************************/define("TBL_LOYALTY_LEVEL", "tbl_loyalty_level"); define('LOYLEV_ID', 'loylev_id'); define('LOYLEV_LEVEL', 'loylev_level'); define('LOYLEV_DESC', 'loylev_desc'); define('LOYLEV_RESTAURANT', 'loylev_restaurant'); define('LOYLEV_MIN_PT', 'loylev_min_pt'); define('LOYLEV_MAX_PT', 'loylev_max_pt'); define('LOYLEV_SEQ', 'loylev_seq'); define('LOYLEV_MULTIPLY_FACTOR', 'loylev_multiply_factor'); define('LOYLEV_START_DATE', 'loylev_start_date'); define('LOYLEV_END_DATE', 'loylev_end_date'); define("TBL_LOYALTY_LEVEL_ACTIVE_DATE",  LOYLEV_START_DATE);define("TBL_LOYALTY_LEVEL_DEACTIVE_DATE",  LOYLEV_END_DATE);$tbl_loyalty_level_active_condition= " (`".TBL_LOYALTY_LEVEL_DEACTIVE_DATE."` is NULL OR `".TBL_LOYALTY_LEVEL_DEACTIVE_DATE."` = 0 OR `".TBL_LOYALTY_LEVEL_DEACTIVE_DATE."` > CURDATE( )) ";class tbl_loyalty_level {	private $loylev_id;	private $loylev_level;	private $loylev_desc;	private $loylev_restaurant;	private $loylev_min_pt;	private $loylev_max_pt;	private $loylev_seq;	private $loylev_multiply_factor;	private $loylev_start_date;	private $loylev_end_date;	private $tbl_loyalty_level_active_date;	private $tbl_loyalty_level_deactive_date;	public function setloylev_id($pArg="0") {$this->loylev_id=$pArg;}	public function setloylev_level($pArg="0") {$this->loylev_level=$pArg;}	public function setloylev_desc($pArg="0") {$this->loylev_desc=$pArg;}	public function setloylev_restaurant($pArg="0") {$this->loylev_restaurant=$pArg;}	public function setloylev_min_pt($pArg="0") {$this->loylev_min_pt=$pArg;}	public function setloylev_max_pt($pArg="0") {$this->loylev_max_pt=$pArg;}	public function setloylev_seq($pArg="0") {$this->loylev_seq=$pArg;}	public function setloylev_multiply_factor($pArg="0") {$this->loylev_multiply_factor=$pArg;}	public function setloylev_start_date($pArg="0") {$this->loylev_start_date=$pArg;}	public function setloylev_end_date($pArg="0") {$this->loylev_end_date=$pArg;}	public function settbl_loyalty_level_active_date($pArg="0") {$this->tbl_loyalty_level_active_date=$pArg;}	public function settbl_loyalty_level_deactive_date($pArg="0") {$this->tbl_loyalty_level_deactive_date=$pArg;}	public function getloylev_id() {return $this->loylev_id;}	public function getloylev_level() {return $this->loylev_level;}	public function getloylev_desc() {return $this->loylev_desc;}	public function getloylev_restaurant() {return $this->loylev_restaurant;}	public function getloylev_min_pt() {return $this->loylev_min_pt;}	public function getloylev_max_pt() {return $this->loylev_max_pt;}	public function getloylev_seq() {return $this->loylev_seq;}	public function getloylev_multiply_factor() {return $this->loylev_multiply_factor;}	public function getloylev_start_date() {return $this->loylev_start_date;}	public function getloylev_end_date() {return $this->loylev_end_date;}	public function gettbl_loyalty_level_active_date($pArg="0") {return $this->tbl_loyalty_level_active_date;}	public function gettbl_loyalty_level_deactive_date($pArg="0") {return $this->tbl_loyalty_level_deactive_date;}	public function readObject($array = array()) {		$qry = "SELECT *".RET."FROM ".TBL_LOYALTY_LEVEL.RET;		$and = "WHERE".RET;		if($array[LOYLEV_ID] != "") {			$qry .= $and.LOYLEV_ID." = '".$array[LOYLEV_ID]."'".RET;			$and = "AND".RET;		}		if($array[LOYLEV_LEVEL] != "") {			$qry .= $and.LOYLEV_LEVEL." = '".$array[LOYLEV_LEVEL]."'".RET;			$and = "AND".RET;		}		if($array[LOYLEV_DESC] != "") {			$qry .= $and.LOYLEV_DESC." = '".$array[LOYLEV_DESC]."'".RET;			$and = "AND".RET;		}		if($array[LOYLEV_RESTAURANT] != "") {			$qry .= $and.LOYLEV_RESTAURANT." = '".$array[LOYLEV_RESTAURANT]."'".RET;			$and = "AND".RET;		}		if($array[LOYLEV_MIN_PT] != "") {			$qry .= $and.LOYLEV_MIN_PT." = '".$array[LOYLEV_MIN_PT]."'".RET;			$and = "AND".RET;		}		if($array[LOYLEV_MAX_PT] != "") {			$qry .= $and.LOYLEV_MAX_PT." = '".$array[LOYLEV_MAX_PT]."'".RET;			$and = "AND".RET;		}		if($array[LOYLEV_SEQ] != "") {			$qry .= $and.LOYLEV_SEQ." = '".$array[LOYLEV_SEQ]."'".RET;			$and = "AND".RET;		}		if($array[LOYLEV_MULTIPLY_FACTOR] != "") {			$qry .= $and.LOYLEV_MULTIPLY_FACTOR." = '".$array[LOYLEV_MULTIPLY_FACTOR]."'".RET;			$and = "AND".RET;		}		if($array[LOYLEV_START_DATE] != "") {			$qry .= $and.LOYLEV_START_DATE." = '".$array[LOYLEV_START_DATE]."'".RET;			$and = "AND".RET;		}		if($array[LOYLEV_END_DATE] != "") {			$qry .= $and.LOYLEV_END_DATE." = '".$array[LOYLEV_END_DATE]."'".RET;			$and = "AND".RET;		}	$result = mysql_query($qry);		if($result) {			while ($row = mysql_fetch_array($result)) {				$record = $row;				break;//end after first record			}			if(count($record[0]) == 0) {				return array();			} else {				$this->setloylev_id($record[LOYLEV_ID]);				$this->setloylev_level($record[LOYLEV_LEVEL]);				$this->setloylev_desc($record[LOYLEV_DESC]);				$this->setloylev_restaurant($record[LOYLEV_RESTAURANT]);				$this->setloylev_min_pt($record[LOYLEV_MIN_PT]);				$this->setloylev_max_pt($record[LOYLEV_MAX_PT]);				$this->setloylev_seq($record[LOYLEV_SEQ]);				$this->setloylev_multiply_factor($record[LOYLEV_MULTIPLY_FACTOR]);				$this->setloylev_start_date($record[LOYLEV_START_DATE]);				$this->setloylev_end_date($record[LOYLEV_END_DATE]);				$this->settbl_loyalty_level_active_date($record[TBL_LOYALTY_LEVEL_ACTIVE_DATE]);				$this->settbl_loyalty_level_deactive_date($record[TBL_LOYALTY_LEVEL_DEACTIVE_DATE]);				return true;			}		}	}	public static function readArray($array = array(),&$result_found=0,$isArray=1) {		global $tbl_loyalty_level_active_condition;		$qry = "SELECT *".RET."FROM ".TBL_LOYALTY_LEVEL.RET;		$and = "WHERE".RET;		if($array[LOYLEV_ID] != "") {			$qry .= $and.LOYLEV_ID." = '".$array[LOYLEV_ID]."'".RET;			$and = "AND".RET;		}		if($array[LOYLEV_LEVEL] != "") {			$qry .= $and.LOYLEV_LEVEL." = '".$array[LOYLEV_LEVEL]."'".RET;			$and = "AND".RET;		}		if($array[LOYLEV_DESC] != "") {			$qry .= $and.LOYLEV_DESC." = '".$array[LOYLEV_DESC]."'".RET;			$and = "AND".RET;		}		if($array[LOYLEV_RESTAURANT] != "") {			$qry .= $and.LOYLEV_RESTAURANT." = '".$array[LOYLEV_RESTAURANT]."'".RET;			$and = "AND".RET;		}		if($array[LOYLEV_MIN_PT] != "") {			$qry .= $and.LOYLEV_MIN_PT." = '".$array[LOYLEV_MIN_PT]."'".RET;			$and = "AND".RET;		}		if($array[LOYLEV_MAX_PT] != "") {			$qry .= $and.LOYLEV_MAX_PT." = '".$array[LOYLEV_MAX_PT]."'".RET;			$and = "AND".RET;		}		if($array[LOYLEV_SEQ] != "") {			$qry .= $and.LOYLEV_SEQ." = '".$array[LOYLEV_SEQ]."'".RET;			$and = "AND".RET;		}		if($array[LOYLEV_MULTIPLY_FACTOR] != "") {			$qry .= $and.LOYLEV_MULTIPLY_FACTOR." = '".$array[LOYLEV_MULTIPLY_FACTOR]."'".RET;			$and = "AND".RET;		}		if($array[LOYLEV_START_DATE] != "") {			$qry .= $and.LOYLEV_START_DATE." = '".$array[LOYLEV_START_DATE]."'".RET;			$and = "AND".RET;		}		if($array[LOYLEV_END_DATE] != "") {			$qry .= $and.LOYLEV_END_DATE." = '".$array[LOYLEV_END_DATE]."'".RET;			$and = "AND".RET;		}		if(is_gt_zero_num($array["isActive"])) {			$qry .= $and.$tbl_loyalty_level_active_condition;;			$and = "AND".RET;		}		if(is_not_empty($array[SORT_ON]) && is_not_empty($array[SORT_BY])) {		$qry .=" ORDER BY ".$array[SORT_ON]." ".$array[SORT_BY];		}		if(is_not_empty($array[OFFSET_TITLE]) && is_not_empty($array[LIMIT_TITLE])) {			$qry_with_limit  = $qry." LIMIT ".$array[OFFSET_TITLE].",".$array[LIMIT_TITLE];		}else{			$qry_with_limit  = $qry;		}		$result = mysql_query ($qry_with_limit);		$r1 = mysql_query($qry);		if($r1){			$result_found = mysql_num_rows($r1);		}		$class_objects = array();		if($result) {			while ($record = mysql_fetch_assoc($result)) {				$isActive= 0;				//..check deactive date is not set or 0				if((is_not_empty($record[TBL_LOYALTY_LEVEL_DEACTIVE_DATE])==false) || (is_gt_zero_num(strtotime($record[TBL_LOYALTY_LEVEL_DEACTIVE_DATE]))== false)){					$isActive = 1; 				}else{					//..check the deactive date is greater than todays date					if(strtotime($record[TBL_LOYALTY_LEVEL_DEACTIVE_DATE]) > strtotime(date(DATE_FORMAT))){						$isActive = 1;					}				}				if($isArray){					$class_object = array();					$class_object["loylev_id"]=$record[LOYLEV_ID];					$class_object["loylev_level"]=$record[LOYLEV_LEVEL];					$class_object["loylev_desc"]=$record[LOYLEV_DESC];					$class_object["loylev_restaurant"]=$record[LOYLEV_RESTAURANT];					$class_object["loylev_min_pt"]=$record[LOYLEV_MIN_PT];					$class_object["loylev_max_pt"]=$record[LOYLEV_MAX_PT];					$class_object["loylev_seq"]=$record[LOYLEV_SEQ];					$class_object["loylev_multiply_factor"]=$record[LOYLEV_MULTIPLY_FACTOR];					$class_object["loylev_start_date"]=$record[LOYLEV_START_DATE];					$class_object["loylev_end_date"]=$record[LOYLEV_END_DATE];					$class_object["isActive"]=$isActive;				}else{					$class_object = new tbl_loyalty_level();					$class_object->setloylev_id($record[LOYLEV_ID]);					$class_object->setloylev_level($record[LOYLEV_LEVEL]);					$class_object->setloylev_desc($record[LOYLEV_DESC]);					$class_object->setloylev_restaurant($record[LOYLEV_RESTAURANT]);					$class_object->setloylev_min_pt($record[LOYLEV_MIN_PT]);					$class_object->setloylev_max_pt($record[LOYLEV_MAX_PT]);					$class_object->setloylev_seq($record[LOYLEV_SEQ]);					$class_object->setloylev_multiply_factor($record[LOYLEV_MULTIPLY_FACTOR]);					$class_object->setloylev_start_date($record[LOYLEV_START_DATE]);					$class_object->setloylev_end_date($record[LOYLEV_END_DATE]);				}				$class_objects[$record[LOYLEV_ID]] = $class_object;			}		}		return $class_objects;	}//..End readArray	public function insert() {		if($this->getloylev_id() != '') {			$qry  = "UPDATE ".TBL_LOYALTY_LEVEL.RET."SET".RET."			".LOYLEV_ID." = '".$this->getloylev_id()."',".RET."			".LOYLEV_LEVEL." = '".$this->getloylev_level()."',".RET."			".LOYLEV_DESC." = '".$this->getloylev_desc()."',".RET."			".LOYLEV_RESTAURANT." = '".$this->getloylev_restaurant()."',".RET."			".LOYLEV_MIN_PT." = '".$this->getloylev_min_pt()."',".RET."			".LOYLEV_MAX_PT." = '".$this->getloylev_max_pt()."',".RET."			".LOYLEV_SEQ." = '".$this->getloylev_seq()."',".RET."			".LOYLEV_MULTIPLY_FACTOR." = '".$this->getloylev_multiply_factor()."',".RET."			".LOYLEV_START_DATE." = '".$this->getloylev_start_date()."',".RET."			".LOYLEV_END_DATE." = '".$this->getloylev_end_date()."'".RET.			"WHERE ".LOYLEV_ID." = ".$this->getloylev_id().RET;			mysql_query($qry);		} else {			$qry  = "INSERT INTO ".TBL_LOYALTY_LEVEL." (".RET.			"".LOYLEV_LEVEL.", ".LOYLEV_DESC.", ".LOYLEV_RESTAURANT.", ".LOYLEV_MIN_PT.", ".LOYLEV_MAX_PT.", ".LOYLEV_SEQ.", ".LOYLEV_MULTIPLY_FACTOR.", ".LOYLEV_START_DATE.", ".LOYLEV_END_DATE.RET.				") VALUES (".RET.			"'".$this->getloylev_level()."',".RET.			"'".$this->getloylev_desc()."',".RET.			"'".$this->getloylev_restaurant()."',".RET.			"'".$this->getloylev_min_pt()."',".RET.			"'".$this->getloylev_max_pt()."',".RET.			"'".$this->getloylev_seq()."',".RET.			"'".$this->getloylev_multiply_factor()."',".RET.			"'".$this->getloylev_start_date()."',".RET.			"'".$this->getloylev_end_date()."'".RET.			")".RET;			$res = mysql_query($qry);			$this->setloylev_id(mysql_insert_id());		}	}//..End Insert	public static function delete($array = array()) {		$qry = "DELETE".RET."FROM ".TBL_LOYALTY_LEVEL.RET;		$and = "WHERE".RET;		if($array[LOYLEV_ID] != "") {			$qry .= $and.LOYLEV_ID." = '".$array[LOYLEV_ID]."'".RET;			$and = "AND".RET;		}		if($array[LOYLEV_LEVEL] != "") {			$qry .= $and.LOYLEV_LEVEL." = '".$array[LOYLEV_LEVEL]."'".RET;			$and = "AND".RET;		}		if($array[LOYLEV_DESC] != "") {			$qry .= $and.LOYLEV_DESC." = '".$array[LOYLEV_DESC]."'".RET;			$and = "AND".RET;		}		if($array[LOYLEV_RESTAURANT] != "") {			$qry .= $and.LOYLEV_RESTAURANT." = '".$array[LOYLEV_RESTAURANT]."'".RET;			$and = "AND".RET;		}		if($array[LOYLEV_MIN_PT] != "") {			$qry .= $and.LOYLEV_MIN_PT." = '".$array[LOYLEV_MIN_PT]."'".RET;			$and = "AND".RET;		}		if($array[LOYLEV_MAX_PT] != "") {			$qry .= $and.LOYLEV_MAX_PT." = '".$array[LOYLEV_MAX_PT]."'".RET;			$and = "AND".RET;		}		if($array[LOYLEV_SEQ] != "") {			$qry .= $and.LOYLEV_SEQ." = '".$array[LOYLEV_SEQ]."'".RET;			$and = "AND".RET;		}		if($array[LOYLEV_MULTIPLY_FACTOR] != "") {			$qry .= $and.LOYLEV_MULTIPLY_FACTOR." = '".$array[LOYLEV_MULTIPLY_FACTOR]."'".RET;			$and = "AND".RET;		}		if($array[LOYLEV_START_DATE] != "") {			$qry .= $and.LOYLEV_START_DATE." = '".$array[LOYLEV_START_DATE]."'".RET;			$and = "AND".RET;		}		if($array[LOYLEV_END_DATE] != "") {			$qry .= $and.LOYLEV_END_DATE." = '".$array[LOYLEV_END_DATE]."'".RET;			$and = "AND".RET;		}		$res = mysql_query($qry);		if($res){			return OPERATION_SUCCESS;		};		return OPERATION_FAIL;	}//..End Delete	public function isAlreadyThere($loylev_level ,$loylev_desc ,$loylev_restaurant ,$loylev_min_pt ,$loylev_max_pt ,$loylev_seq ,$loylev_multiply_factor ,$loylev_start_date ,$loylev_end_date) {		$unique_arr = array();			//$unique_arr[LOYLEV_ID]=$loylev_id;			//$unique_arr[LOYLEV_LEVEL]=$loylev_level;			//$unique_arr[LOYLEV_DESC]=$loylev_desc;			//$unique_arr[LOYLEV_RESTAURANT]=$loylev_restaurant;			//$unique_arr[LOYLEV_MIN_PT]=$loylev_min_pt;			//$unique_arr[LOYLEV_MAX_PT]=$loylev_max_pt;			//$unique_arr[LOYLEV_SEQ]=$loylev_seq;			//$unique_arr[LOYLEV_MULTIPLY_FACTOR]=$loylev_multiply_factor;			//$unique_arr[LOYLEV_START_DATE]=$loylev_start_date;			//$unique_arr[LOYLEV_END_DATE]=$loylev_end_date;		if(is_not_empty($unique_arr)){			return $this->readObject($unique_arr);		}		return false;	}//..isAlreadyThere	public function create($loylev_level ,$loylev_desc ,$loylev_restaurant ,$loylev_min_pt ,$loylev_max_pt ,$loylev_seq ,$loylev_multiply_factor ,$loylev_start_date ,$loylev_end_date) {		if(is_not_empty($loylev_level)){			if($this->isAlreadyThere($loylev_level ,$loylev_desc ,$loylev_restaurant ,$loylev_min_pt ,$loylev_max_pt ,$loylev_seq ,$loylev_multiply_factor ,$loylev_start_date ,$loylev_end_date)){				return OPERATION_DUPLICATE;			}else{				$this->setloylev_id("");				$this->setloylev_level($loylev_level);				$this->setloylev_desc($loylev_desc);				$this->setloylev_restaurant($loylev_restaurant);				$this->setloylev_min_pt($loylev_min_pt);				$this->setloylev_max_pt($loylev_max_pt);				$this->setloylev_seq($loylev_seq);				$this->setloylev_multiply_factor($loylev_multiply_factor);				$this->setloylev_start_date(date(DATE_FORMAT));				$this->insert();				return $this->getloylev_id();			}		}		return OPERATION_FAIL;	}//..create	public function update($loylev_id, $loylev_level, $loylev_desc, $loylev_restaurant, $loylev_min_pt, $loylev_max_pt, $loylev_seq, $loylev_multiply_factor, $loylev_start_date, $loylev_end_date) {		if(is_gt_zero_num($loylev_id)){			if ($this->readObject(array(LOYLEV_ID=>$loylev_id))){				$this->setloylev_level($loylev_level);				$this->setloylev_desc($loylev_desc);				$this->setloylev_restaurant($loylev_restaurant);				$this->setloylev_min_pt($loylev_min_pt);				$this->setloylev_max_pt($loylev_max_pt);				$this->setloylev_seq($loylev_seq);				$this->setloylev_multiply_factor($loylev_multiply_factor);				$this->insert();				return OPERATION_SUCCESS;			}		}		return OPERATION_FAIL;	}//..update	public function activate($loylev_id){		if(is_gt_zero_num($loylev_id)){			if ($this->readObject(array(LOYLEV_ID=>$loylev_id))){				$qry  = "UPDATE ".TBL_LOYALTY_LEVEL.RET."SET".RET."			".TBL_LOYALTY_LEVEL_DEACTIVE_DATE." = '".date(EMPTY_DATE_FORMAT)."' WHERE ".LOYLEV_ID."={$loylev_id}";				$res = mysql_query($qry);				if($res){					return 1;				}			}		}		return 0;	}//..end activate	public function deactivate($loylev_id){		if(is_gt_zero_num($loylev_id)){			if ($this->readObject(array(LOYLEV_ID=>$loylev_id))){				$qry  = "UPDATE ".TBL_LOYALTY_LEVEL.RET."SET".RET."			".TBL_LOYALTY_LEVEL_DEACTIVE_DATE." = '".date(DATE_FORMAT)."' WHERE ".LOYLEV_ID."={$loylev_id}";				$res = mysql_query($qry);				if($res){					return 1;				}			}		}		return 0;	}//..end deactivate	public static function GetInfo($loylev_id) {		$info = array();		if($loylev_id != ""){			$obj_tbl_loyalty_level = new tbl_loyalty_level();			if($obj_tbl_loyalty_level->readObject(array("loylev_id"=>$loylev_id))){				$info["loylev_id"]=$obj_tbl_loyalty_level->getloylev_id();				$info["loylev_level"]=$obj_tbl_loyalty_level->getloylev_level();				$info["loylev_desc"]=$obj_tbl_loyalty_level->getloylev_desc();				$info["loylev_restaurant"]=$obj_tbl_loyalty_level->getloylev_restaurant();				$info["loylev_min_pt"]=$obj_tbl_loyalty_level->getloylev_min_pt();				$info["loylev_max_pt"]=$obj_tbl_loyalty_level->getloylev_max_pt();				$info["loylev_seq"]=$obj_tbl_loyalty_level->getloylev_seq();				$info["loylev_multiply_factor"]=$obj_tbl_loyalty_level->getloylev_multiply_factor();				$info["loylev_start_date"]=$obj_tbl_loyalty_level->getloylev_start_date();				$info["loylev_end_date"]=$obj_tbl_loyalty_level->getloylev_end_date();				$info["isActive"] = 0;				//..check deactive date is not set or 0				if((is_not_empty($obj_tbl_loyalty_level->gettbl_loyalty_level_deactive_date())==false)  || (is_gt_zero_num(strtotime($obj_tbl_loyalty_level->gettbl_loyalty_level_deactive_date()))== false)){					$info["isActive"] = 1;				}else{					//..check the deactive date is greater than todays date					if(strtotime($obj_tbl_loyalty_level->gettbl_loyalty_level_deactive_date()) > strtotime(date(DATE_FORMAT))){						$info["isActive"] = 1;					}				}			}		unset($obj_tbl_loyalty_level);		return $info;		}	}//..End GetInfo	public static function GetFields($data){		global $tbl_loyalty_level_active_condition;		$arr = array();		if(is_not_empty($data)){			$qry ="SELECT `".$data['key_field']."`,`".$data['value_field']."` FROM `".TBL_LOYALTY_LEVEL."`";			if(is_gt_zero_num($data['isActive'])){				$qry .= " WHERE `".LOYLEV_RESTAURANT."`=".$data[LOYLEV_RESTAURANT]." AND ".$tbl_loyalty_level_active_condition;				}			//echo $qry;			//exit;			$res = mysql_query($qry); 			if($res){				while($row=mysql_fetch_assoc($res)){					$arr[$row[$data['key_field']]] = $row[$data['value_field']];				}			}		}		return $arr;	}//.. End of GetFields	//..function to calculate the new level from points	public static function GetNewLevelByPoints($_usr_id,$_points){		//..get user details		$_usr_det=get_user($_usr_id);		//..get new level after ading points		$sql='SELECT `'.LOYLEV_ID.'` 				FROM `'.TBL_LOYALTY_LEVEL.'` 				WHERE '.$_points.'>=`'.LOYLEV_MIN_PT.'` AND 					  '.$_points.'<=`'.LOYLEV_MAX_PT.'` AND 					  `'.LOYLEV_RESTAURANT.'`='.$_usr_det[STAFF_RESTAURENT].';';		//echo $sql;			  		$_new_level=DB::ExecScalarQry($sql);			//..Check current level and new level seq		$_cur_level_det=tbl_loyalty_level::GetInfo($_usr_det[STAFF_LOYALTY_LEVEL]);		$_new_level_det=tbl_loyalty_level::GetInfo($_new_level);				//print_r($_cur_level_det);		//print_r($_new_level_det);				if($_new_level_det[LOYLEV_SEQ]>$_cur_level_det[LOYLEV_SEQ]){			$sql='UPDATE `'.TBL_STAFF.'` SET					`'.STAFF_LOYALTY_LEVEL.'` ='.$_new_level.'								  WHERE 					  `'.STAFF_ID.'`='.$_usr_det[STAFF_ID].';';			//echo $sql;		  			DB::ExecNonQry($sql);			}		//exit;		return $_new_level;	}		//..Function to get award point multiplier	public static function GetAwardMultiplier($_loyalty_level=0,$_rest_id=0){		$_awd_multiply=_DEFT_MULTIPLIER;		//..get user details		//..for his level get award point multiplier		if(is_gt_zero_num($_loyalty_level)){			$sql='SELECT `'.LOYLEV_MULTIPLY_FACTOR.'` 				  FROM `'.TBL_LOYALTY_LEVEL.'` 				  WHERE `'.LOYLEV_ID.'`='.$_loyalty_level.';';				  			$_awd_multiply=DB::ExecScalarQry($sql);		}else{			$_rslt_fnd=0;			//..try to get basic level if entered any loyalty level						$_rest_level_lst=tbl_loyalty_level::readArray(array('isActive'=>1,LOYLEV_RESTAURANT=>$_rest_id,LIMIT_TITLE=>1,SORT_BY=>'ASC',SORT_ON=>LOYLEV_SEQ),$_rslt_fnd,1);			if(is_not_empty($_rest_level_lst)){				//..Get first record only				$_rest_level_lst=array_shift($_rest_level_lst);				$_awd_multiply= $_rest_level_lst[LOYLEV_MULTIPLY_FACTOR];						}		}				return $_awd_multiply;	}		//..function to setDefaultLevel to all customers of restaurant	public static function setDefaultLevel($_level_id,$_rest_id){				//..		if(is_gt_zero_num($_level_id) && is_gt_zero_num($_rest_id)){			$sql='UPDATE `'.TBL_STAFF.'` SET `'.STAFF_LOYALTY_LEVEL.'`='.$_level_id.' 				WHERE `'.STAFF_RESTAURENT.'`='.$_rest_id.' ;';			DB::ExecNonQry($sql);		}	}		//..function to get default loyalty level for restaurant	public static function GetDefltLoyLevForusr($_rest_id){		//..get new level after ading points		$sql='SELECT `'.LOYLEV_ID.'` 				FROM `'.TBL_LOYALTY_LEVEL.'` 				WHERE `'.LOYLEV_SEQ.'`=1 AND 					  `'.LOYLEV_RESTAURANT.'`='.$_rest_id.';';		//echo $sql;			  		$_deflt_level=DB::ExecScalarQry($sql);				return $_deflt_level;	}}//..End tbl_loyalty_level?>