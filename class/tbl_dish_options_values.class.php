<?php/**********************************************************************tbl_dish_options_values.class.phpGenerated by STRUCTY 2013.04.11 10:41:38.Copyright 2011 Structy, Frédéric Aebi. All rights reserved.**********************************************************************/define('TBL_DISH_OPTIONS_VALUES', 'tbl_dish_options_values'); define('DISH_OPT_VAL_ID', 'dish_opt_val_id'); define('DISH_OPT_VAL_OPTION_ID', 'dish_opt_val_option_id'); define('DISH_OPT_VAL_VALUE', 'dish_opt_val_value'); define('DISH_OPT_VAL_ISDELETED','dish_opt_val_isdeleted');define('DISH_OPT_VAL_ETHOR_VARIANT','dish_opt_val_ethor_variant');define('TBL_DISH_OPTIONS_VALUES_ACTIVE_DATE', '');define('TBL_DISH_OPTIONS_VALUES_DEACTIVE_DATE', '');$tbl_dish_options_values_active_condition= ' ('.TBL_DISH_OPTIONS_VALUES_DEACTIVE_DATE.' is NULL OR '.TBL_DISH_OPTIONS_VALUES_DEACTIVE_DATE.' = 0 OR '.TBL_DISH_OPTIONS_VALUES_DEACTIVE_DATE.' > CURDATE( )) ';define('TBL_DISH_OPTIONS_VALUES_SEPERATOR','<br>');class tbl_dish_options_values {	private $dish_opt_val_id;	private $dish_opt_val_option_id;	private $dish_opt_val_value;	private $dish_opt_val_isdeleted;	private $tbl_dish_options_values_active_date;	private $tbl_dish_options_values_deactive_date; 		private $dish_opt_val_ethor_variant;	 	public function setdish_opt_val_id($pArg='0') {$this->dish_opt_val_id=$pArg;}	public function setdish_opt_val_option_id($pArg='0') {$this->dish_opt_val_option_id=$pArg;}	public function setdish_opt_val_value($pArg='0') {$this->dish_opt_val_value=$pArg;}	public function setdish_opt_val_isdeleted($pArg='0') {$this->dish_opt_val_isdeleted=$pArg;}	public function settbl_dish_options_values_active_date($pArg='0') {$this->tbl_dish_options_values_active_date=$pArg;}	public function settbl_dish_options_values_deactive_date($pArg='0') {$this->tbl_dish_options_values_deactive_date=$pArg;}		public function setdish_opt_val_ethor_variant($pArg='0') {$this->dish_opt_val_ethor_variant=$pArg;}	public function getdish_opt_val_id() {return $this->dish_opt_val_id;}	public function getdish_opt_val_option_id() {return $this->dish_opt_val_option_id;}	public function getdish_opt_val_value() {return $this->dish_opt_val_value;}	public function getdish_opt_val_isdeleted() {return $this->dish_opt_val_isdeleted;}	public function gettbl_dish_options_values_active_date() {return $this->tbl_dish_options_values_active_date;}	public function gettbl_dish_options_values_deactive_date() {return $this->tbl_dish_options_values_deactive_date;}		public function getdish_opt_val_ethor_variant() {return $this->dish_opt_val_ethor_variant;}	public function readObject($array = array()) {		$qry = "SELECT *".RET." FROM ".TBL_DISH_OPTIONS_VALUES."						WHERE ".DISH_OPT_VAL_ISDELETED." <> 1 ".RET;		$and = "AND".RET;				if($array[DISH_OPT_VAL_ETHOR_VARIANT] != "") {			$qry .= $and.DISH_OPT_VAL_ETHOR_VARIANT." = '".$array[DISH_OPT_VAL_ETHOR_VARIANT]."'".RET;			$and = "AND".RET;		}				if($array[DISH_OPT_VAL_ID] != "") {			$qry .= $and.DISH_OPT_VAL_ID." = '".$array[DISH_OPT_VAL_ID]."'".RET;			$and = "AND".RET;		}		if($array[DISH_OPT_VAL_OPTION_ID] != "") {			$qry .= $and.DISH_OPT_VAL_OPTION_ID." = '".$array[DISH_OPT_VAL_OPTION_ID]."'".RET;			$and = "AND".RET;		}		if($array[DISH_OPT_VAL_VALUE] != "") {			$qry .= $and.DISH_OPT_VAL_VALUE." = '".$array[DISH_OPT_VAL_VALUE]."'".RET;			$and = "AND".RET;		}				if($array[DISH_OPT_VAL_ISDELETED] != "") {			$qry .= $and.DISH_OPT_VAL_ISDELETED." = '".$array[DISH_OPT_VAL_ISDELETED]."'".RET;			$and = "AND".RET;		}		//echo $qry;		//exit;		$result = mysql_query($qry);		if($result) {			while ($row = mysql_fetch_array($result)) {				$record = $row;				break;//end after first record			}			if(count($record[0]) == 0) {				return array();			} else {				$this->setdish_opt_val_id($record[DISH_OPT_VAL_ID]);				$this->setdish_opt_val_option_id($record[DISH_OPT_VAL_OPTION_ID]);				$this->setdish_opt_val_value($record[DISH_OPT_VAL_VALUE]);				$this->setdish_opt_val_isdeleted($record[DISH_OPT_VAL_ISDELETED]);								$this->setdish_opt_val_ethor_variant($record[DISH_OPT_VAL_ETHOR_VARIANT]);								$this->settbl_dish_options_values_active_date($record[TBL_DISH_OPTIONS_VALUES_ACTIVE_DATE]);				$this->settbl_dish_options_values_deactive_date($record[TBL_DISH_OPTIONS_VALUES_DEACTIVE_DATE]);				return true;			}		}	}	public static function readArray($array = array(),&$result_found=0,$isArray=1) {		global $tbl_dish_options_values_active_condition;		$qry = "SELECT *".RET."FROM ".TBL_DISH_OPTIONS_VALUES.RET."WHERE ".DISH_OPT_VAL_ISDELETED." <> 1 ".RET;				$and = "AND".RET;					if($array[DISH_OPT_VAL_ETHOR_VARIANT] != "") {			$qry .= $and.DISH_OPT_VAL_ETHOR_VARIANT." = '".$array[DISH_OPT_VAL_ETHOR_VARIANT]."'".RET;			$and = "AND".RET;		}				if($array[DISH_OPT_VAL_ID] != "") {			$qry .= $and.DISH_OPT_VAL_ID." = '".$array[DISH_OPT_VAL_ID]."'".RET;			$and = "AND".RET;		}		if($array[DISH_OPT_VAL_OPTION_ID] != "") {			$qry .= $and.DISH_OPT_VAL_OPTION_ID." = '".$array[DISH_OPT_VAL_OPTION_ID]."'".RET;			$and = "AND".RET;		}		if($array[DISH_OPT_VAL_VALUE] != "") {			$qry .= $and.DISH_OPT_VAL_VALUE." = '".$array[DISH_OPT_VAL_VALUE]."'".RET;			$and = "AND".RET;		}				if($array[DISH_OPT_VAL_ISDELETED] != "") {			$qry .= $and.DISH_OPT_VAL_ISDELETED." = '".$array[DISH_OPT_VAL_ISDELETED]."'".RET;			$and = "AND".RET;		}		if(is_gt_zero_num($array["isActive"])) {			$qry .= $and.$tbl_dish_options_values_active_condition;;			$and = "AND".RET;		}		if(is_not_empty($array[SORT_ON]) && is_not_empty($array[SORT_BY])) {		$qry .=" ORDER BY ".$array[SORT_ON]." ".$array[SORT_BY];		}		if(is_not_empty($array[OFFSET_TITLE]) && is_not_empty($array[LIMIT_TITLE])) {			$qry_with_limit  = $qry." LIMIT ".$array[OFFSET_TITLE].",".$array[LIMIT_TITLE];		}else{			$qry_with_limit  = $qry;		}		$result = mysql_query ($qry_with_limit);		$r1 = mysql_query($qry);		if($r1){			$result_found = mysql_num_rows($r1);		}		$class_objects = array();		if($result) {			while ($record = mysql_fetch_assoc($result)) {				$isActive= 0;				//..check deactive date is not set or 0				if((is_not_empty($record[TBL_DISH_OPTIONS_VALUES_DEACTIVE_DATE])==false) || (is_gt_zero_num(strtotime($record[TBL_DISH_OPTIONS_VALUES_DEACTIVE_DATE]))== false)){					$isActive = 1; 				}else{					//..check the deactive date is greater than todays date					if(strtotime($record[TBL_DISH_OPTIONS_VALUES_DEACTIVE_DATE]) > strtotime(date(DATE_FORMAT))){						$isActive = 1;					}				}				if($isArray){					$class_object = array();					$class_object['dish_opt_val_id']=$record[DISH_OPT_VAL_ID];					$class_object['dish_opt_val_option_id']=$record[DISH_OPT_VAL_OPTION_ID];					$class_object['dish_opt_val_value']=$record[DISH_OPT_VAL_VALUE];					$class_object[DISH_OPT_VAL_ISDELETED]=$record[DISH_OPT_VAL_ISDELETED];										$class_object['dish_opt_val_ethor_variant']=$record[DISH_OPT_VAL_ETHOR_VARIANT];										$class_object['isActive']=$isActive;				}else{					$class_object = new tbl_dish_options_values();					$class_object->setdish_opt_val_id($record[DISH_OPT_VAL_ID]);					$class_object->setdish_opt_val_option_id($record[DISH_OPT_VAL_OPTION_ID]);					$class_object->setdish_opt_val_value($record[DISH_OPT_VAL_VALUE]);					$class_object->setdish_opt_val_isdeleted($record[DISH_OPT_VAL_ISDELETED]);										$class_object->setdish_opt_val_ethor_variant($record[DISH_OPT_VAL_ETHOR_VARIANT]);				}				$class_objects[$record[DISH_OPT_VAL_ID]] = $class_object;			}		}		return $class_objects;	}//..End readArray	public function insert() {		if($this->getdish_opt_val_id() != '') {			$qry  = "UPDATE ".TBL_DISH_OPTIONS_VALUES.RET."SET".RET."			".DISH_OPT_VAL_ID." = '".$this->getdish_opt_val_id()."',".RET."			".DISH_OPT_VAL_OPTION_ID." = '".$this->getdish_opt_val_option_id()."',".RET."			".DISH_OPT_VAL_ISDELETED." = '".$this->getdish_opt_val_isdeleted()."',".RET."									".DISH_OPT_VAL_ETHOR_VARIANT." = '".$this->getdish_opt_val_ethor_variant()."',".RET."						".DISH_OPT_VAL_VALUE." = '".$this->getdish_opt_val_value()."'".RET.						"WHERE ".DISH_OPT_VAL_ID." = ".$this->getdish_opt_val_id().RET;			mysql_query($qry);		} else {			$qry  = "INSERT INTO ".TBL_DISH_OPTIONS_VALUES." (".RET.			"".DISH_OPT_VAL_OPTION_ID.", ".DISH_OPT_VAL_VALUE.", ".DISH_OPT_VAL_ETHOR_VARIANT.RET.				") VALUES (".RET.			"'".$this->getdish_opt_val_option_id()."',".RET.			"'".$this->getdish_opt_val_value()."',".RET.			"'".$this->getdish_opt_val_ethor_variant()."'".RET.			")".RET;			$res = mysql_query($qry);			$this->setdish_opt_val_id(mysql_insert_id());		}	}//..End Insert	public static function delete($array = array()) {		$qry = "DELETE".RET."FROM ".TBL_DISH_OPTIONS_VALUES.RET;		$and = "WHERE".RET;		if($array[DISH_OPT_VAL_ID] != "") {			$qry .= $and.DISH_OPT_VAL_ID." IN (".$array[DISH_OPT_VAL_ID].")".RET;			//$qry .= $and.DISH_OPT_VAL_ID." = '".$array[DISH_OPT_VAL_ID]."'".RET;			$and = "AND".RET;		}		if($array[DISH_OPT_VAL_OPTION_ID] != "") {			$qry .= $and.DISH_OPT_VAL_OPTION_ID." = '".$array[DISH_OPT_VAL_OPTION_ID]."'".RET;			$and = "AND".RET;		}		if($array[DISH_OPT_VAL_VALUE] != "") {			$qry .= $and.DISH_OPT_VAL_VALUE." = '".$array[DISH_OPT_VAL_VALUE]."'".RET;			$and = "AND".RET;		}//echo "qry=$qry";		$res = mysql_query($qry);		if($res){			return OPERATION_SUCCESS;		};		return OPERATION_FAIL;	}//..End Delete		public function remove($array=array()){		$qry = "UPDATE ".TBL_DISH_OPTIONS_VALUES." SET ".DISH_OPT_VAL_ISDELETED."=1 ".RET;		$and = "WHERE ".RET;		if($array[DISH_OPT_VAL_ID] != "") {			$qry .= $and.DISH_OPT_VAL_ID." IN (".$array[DISH_OPT_VAL_ID].")".RET;			//$qry .= $and.DISH_OPT_VAL_ID." = '".$array[DISH_OPT_VAL_ID]."'".RET;			$and = "AND".RET;		}		if($array[DISH_OPT_VAL_OPTION_ID] != "") {			$qry .= $and.DISH_OPT_VAL_OPTION_ID." IN (".$array[DISH_OPT_VAL_OPTION_ID].")".RET;			$and = "AND".RET;		}		if($array[DISH_OPT_VAL_VALUE] != "") {			$qry .= $and.DISH_OPT_VAL_VALUE." = '".$array[DISH_OPT_VAL_VALUE]."'".RET;			$and = "AND".RET;		}//echo "qry=$qry";		$res = mysql_query($qry);		if($res){			return OPERATION_SUCCESS;		};		return OPERATION_FAIL;	}	public function isAlreadyThere($dish_opt_val_option_id ,$dish_opt_val_value) {		$unique_arr = array();			//$unique_arr[DISH_OPT_VAL_ID]=$dish_opt_val_id;			//$unique_arr[DISH_OPT_VAL_OPTION_ID]=$dish_opt_val_option_id;			//$unique_arr[DISH_OPT_VAL_VALUE]=$dish_opt_val_value;		if(is_not_empty($unique_arr)){			return $this->readObject($unique_arr);		}		return false;	}//..isAlreadyThere	public function create($dish_opt_val_option_id ,$dish_opt_val_value,$dish_opt_val_ethor_variant='') {		if(is_not_empty($dish_opt_val_option_id)){			if($this->isAlreadyThere($dish_opt_val_option_id ,$dish_opt_val_value)){				return OPERATION_DUPLICATE;			}else{				$this->setdish_opt_val_id('');				$this->setdish_opt_val_option_id($dish_opt_val_option_id);				$this->setdish_opt_val_value($dish_opt_val_value);								$this->setdish_opt_val_ethor_variant($dish_opt_val_ethor_variant);				$this->insert();				return $this->getdish_opt_val_id();			}		}		return OPERATION_FAIL;	}//..create	public function update($dish_opt_val_id, $dish_opt_val_option_id, $dish_opt_val_value,$dish_opt_val_ethor_variant='') {		if(is_gt_zero_num($dish_opt_val_id)){			if ($this->readObject(array(DISH_OPT_VAL_ID=>$dish_opt_val_id))){								$this->setdish_opt_val_option_id($dish_opt_val_option_id);				$this->setdish_opt_val_value($dish_opt_val_value);								if(is_not_empty($dish_opt_val_ethor_variant))					$this->setdish_opt_val_ethor_variant($dish_opt_val_ethor_variant);								$this->insert();				return OPERATION_SUCCESS;			}		}		return OPERATION_FAIL;	}//..update	public function activate($dish_opt_val_id){		if(is_gt_zero_num($dish_opt_val_id)){			if ($this->readObject(array(DISH_OPT_VAL_ID=>$dish_opt_val_id))){				$qry  = 'UPDATE '.TBL_DISH_OPTIONS_VALUES.RET.'SET'.RET.''.TBL_DISH_OPTIONS_VALUES_DEACTIVE_DATE.' = \''.date(EMPTY_DATE_FORMAT).'\' WHERE '.DISH_OPT_VAL_ID.'='.$dish_opt_val_id;				$res = mysql_query($qry);				if($res){					return 1;				}			}		}		return 0;	}//..end activate	public function deactivate($dish_opt_val_id){		if(is_gt_zero_num($dish_opt_val_id)){			if ($this->readObject(array(DISH_OPT_VAL_ID=>$dish_opt_val_id))){				$qry  = 'UPDATE '.TBL_DISH_OPTIONS_VALUES.RET.'SET'.RET.''.TBL_DISH_OPTIONS_VALUES_DEACTIVE_DATE.' = \''.date(DATE_FORMAT).'\' WHERE '.DISH_OPT_VAL_ID.'='.$dish_opt_val_id;				$res = mysql_query($qry);				if($res){					return 1;				}			}		}		return 0;	}//..end deactivate	public static function GetInfo($dish_opt_val_id) {		$info = array();		if($dish_opt_val_id != ''){			$obj_tbl_dish_options_values = new tbl_dish_options_values();			if($obj_tbl_dish_options_values->readObject(array('dish_opt_val_id'=>$dish_opt_val_id))){				$info['dish_opt_val_id']=$obj_tbl_dish_options_values->getdish_opt_val_id();				$info['dish_opt_val_option_id']=$obj_tbl_dish_options_values->getdish_opt_val_option_id();				$info['dish_opt_val_value']=$obj_tbl_dish_options_values->getdish_opt_val_value();				$info['dish_opt_val_ethor_variant']=$obj_tbl_dish_options_values->getdish_opt_val_ethor_variant();								$info['isActive'] = 0;				//..check deactive date is not set or 0				if((is_not_empty($obj_tbl_dish_options_values->gettbl_dish_options_values_deactive_date())==false)  || (is_gt_zero_num(strtotime($obj_tbl_dish_options_values->gettbl_dish_options_values_deactive_date()))== false)){					$info['isActive'] = 1;				}else{					//..check the deactive date is greater than todays date					if(strtotime($obj_tbl_dish_options_values->gettbl_dish_options_values_deactive_date()) > strtotime(date(DATE_FORMAT))){						$info['isActive'] = 1;					}				}			}		unset($obj_tbl_dish_options_values);		return $info;		}	}//..End GetInfo	public static function GetFields($data){		global $tbl_dish_options_values_active_condition;		$arr = array();		if(is_not_empty($data)){			$qry ='SELECT '.$data['key_field'].','.$data['value_field'].' FROM '.TBL_DISH_OPTIONS_VALUES.'';			if(is_gt_zero_num($data['isActive'])){				$qry .= ' WHERE '.$tbl_dish_options_values_active_condition;			}			$res = mysql_query($qry); 			if($res){				while($row=mysql_fetch_assoc($res)){					$arr[$row[$data['key_field']]] = $row[$data['value_field']];				}			}		}		return $arr;	}//.. End of GetFields		/*public static function insertBulkOptionValues($option_values,$option_id){		$sql = "";			}		public static function updateBulkOptionValues($option_values,$option_id){		$sql = "";		}*/		public static function getAllValuesForOption($option_id){ 	 if(is_gt_zero_num($option_id)){	 		 	   return DB::ExecScalarQry('SELECT GROUP_CONCAT('.DISH_OPT_VAL_VALUE.' SEPARATOR \';\') FROM '.TBL_DISH_OPTIONS_VALUES.' WHERE '.DISH_OPT_VAL_ISDELETED.'<> 1 AND '.DISH_OPT_VAL_OPTION_ID.' = '. $option_id);	 } 		return '';}	  /**	* Return all the Dish Option values for Dish	* @param integer $dish_id	* @return array  */ 	public static function getAllDishOptionsValuesForDish($dish_id){	  $info = array();		if($dish_id){			$sql = 'SELECT dish_opt_val_id, dish_opt_val_value, dish_opt_id, dish_opt_name, dish_opt_type, dish_opt_mandotory  FROM '.TBL_DISH_OPTIONS_VALUES.' INNER JOIN '.TBL_DISH_OPTIONS.'  on '.DISH_OPT_VAL_OPTION_ID.' = '.DISH_OPT_ID.'  WHERE '.DISH_OPT_VAL_ISDELETED.'<> 1 AND  '.DISH_OPT_DISH_ID.' ='.$dish_id.' ORDER BY '.DISH_OPT_ID;			$res = mysql_query($sql);			if($res){ 				$x = 0;				while($row = mysql_fetch_assoc($res)){					$info[$x] = $row;					$x++;				}			}		} 	  return $info;	}		/**	* Return all the Dish Option values for Submenu	* @param integer $submenu_id	* @return array  */ 	public static function getAllDishOptionsValuesForSubmenu($submenu_id){	  $info = array();		if($submenu_id){			$sql = 'SELECT dish_opt_val_id, dish_opt_val_value, dish_opt_id, dish_opt_name, dish_opt_type, dish_opt_mandotory  FROM '.TBL_DISH_OPTIONS_VALUES.' INNER JOIN '.TBL_DISH_OPTIONS.'   on '.DISH_OPT_VAL_OPTION_ID.' = '.DISH_OPT_ID.'  WHERE '.DISH_OPT_VAL_ISDELETED.'<>1 AND '.DISH_OPT_SUBMENU.' ='.$submenu_id.' ORDER BY '.DISH_OPT_ID;  			$res = mysql_query($sql);			if($res){ 				$x = 0;				while($row = mysql_fetch_assoc($res)){					$info[$x] = $row;					$x++;				}			}		} 	  return $info;	} }//..End tbl_dish_options_values ?>