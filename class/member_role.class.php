<?php/**********************************************************************member_role.class.phpGenerated by STRUCTY 2013.03.18 11:04:13.Copyright 2011 Structy, Frédéric Aebi. All rights reserved.**********************************************************************/define("MEMBER_ROLE", "member_role"); define('MEMBER_ROLE_ID', 'member_role_id'); define('MEMBER_ROLE_NAME', 'member_role_name'); define('MEMBER_ROLE_START_DATE', 'member_role_start_date'); define('MEMBER_ROLE_END_DATE', 'member_role_end_date'); define("MEMBER_ROLE_ACTIVE_DATE", "member_role_start_date");define("MEMBER_ROLE_DEACTIVE_DATE", "member_role_end_date");$member_role_active_condition= " (".MEMBER_ROLE_DEACTIVE_DATE." is NULL OR ".MEMBER_ROLE_DEACTIVE_DATE." > CURDATE( )) ";class member_role {	private $member_role_id;	private $member_role_name;	private $member_role_start_date;	private $member_role_end_date;	private $member_role_active_date;	private $member_role_deactive_date;	public function setmember_role_id($pArg="0") {$this->member_role_id=$pArg;}	public function setmember_role_name($pArg="0") {$this->member_role_name=$pArg;}	public function setmember_role_start_date($pArg="0") {$this->member_role_start_date=$pArg;}	public function setmember_role_end_date($pArg="0") {$this->member_role_end_date=$pArg;}	public function setmember_role_active_date($pArg="0") {$this->member_role_active_date=$pArg;}	public function setmember_role_deactive_date($pArg="0") {$this->member_role_deactive_date=$pArg;}	public function getmember_role_id() {return $this->member_role_id;}	public function getmember_role_name() {return $this->member_role_name;}	public function getmember_role_start_date() {return $this->member_role_start_date;}	public function getmember_role_end_date() {return $this->member_role_end_date;}	public function getmember_role_active_date($pArg="0") {return $this->member_role_active_date;}	public function getmember_role_deactive_date($pArg="0") {return $this->member_role_deactive_date;}	public function readObject($array = array()) {		$qry = "SELECT *".RET."FROM ".MEMBER_ROLE.RET;		$and = "WHERE".RET;		if($array[MEMBER_ROLE_ID] != "") {			$qry .= $and.MEMBER_ROLE_ID." = '".$array[MEMBER_ROLE_ID]."'".RET;			$and = "AND".RET;		}		if($array[MEMBER_ROLE_NAME] != "") {			$qry .= $and.MEMBER_ROLE_NAME." = '".$array[MEMBER_ROLE_NAME]."'".RET;			$and = "AND".RET;		}		if($array[MEMBER_ROLE_START_DATE] != "") {			$qry .= $and.MEMBER_ROLE_START_DATE." = '".$array[MEMBER_ROLE_START_DATE]."'".RET;			$and = "AND".RET;		}		if($array[MEMBER_ROLE_END_DATE] != "") {			$qry .= $and.MEMBER_ROLE_END_DATE." = '".$array[MEMBER_ROLE_END_DATE]."'".RET;			$and = "AND".RET;		}	$result = mysql_query($qry);		if($result) {			while ($row = mysql_fetch_array($result)) {				$record = $row;				break;//end after first record			}			if(count($record[0]) == 0) {				return array();			} else {				$this->setmember_role_id($record[MEMBER_ROLE_ID]);				$this->setmember_role_name($record[MEMBER_ROLE_NAME]);				$this->setmember_role_start_date($record[MEMBER_ROLE_START_DATE]);				$this->setmember_role_end_date($record[MEMBER_ROLE_END_DATE]);				$this->setmember_role_active_date($record[MEMBER_ROLE_ACTIVE_DATE]);				$this->setmember_role_deactive_date($record[MEMBER_ROLE_DEACTIVE_DATE]);				return true;			}		}	}	public static function readArray($array = array(),&$result_found=0,$isArray=1) {		global $member_role_active_condition;		$qry = "SELECT *".RET."FROM ".MEMBER_ROLE.RET;		$and = "WHERE".RET;		if($array[MEMBER_ROLE_ID] != "") {			$qry .= $and.MEMBER_ROLE_ID." = '".$array[MEMBER_ROLE_ID]."'".RET;			$and = "AND".RET;		}		if($array[MEMBER_ROLE_NAME] != "") {			$qry .= $and.MEMBER_ROLE_NAME." = '".$array[MEMBER_ROLE_NAME]."'".RET;			$and = "AND".RET;		}		if($array[MEMBER_ROLE_START_DATE] != "") {			$qry .= $and.MEMBER_ROLE_START_DATE." = '".$array[MEMBER_ROLE_START_DATE]."'".RET;			$and = "AND".RET;		}		if($array[MEMBER_ROLE_END_DATE] != "") {			$qry .= $and.MEMBER_ROLE_END_DATE." = '".$array[MEMBER_ROLE_END_DATE]."'".RET;			$and = "AND".RET;		}				if(is_gt_zero_num($array["no_developer"])) {			$qry .= $and.MEMBER_ROLE_ID." <> ".ROLE_DEV." ".RET;			$and = "AND".RET;		}		if(is_gt_zero_num($array["isActive"])) {			$qry .= $and.$member_role_active_condition;;		}		if(is_not_empty($array["offset"]) && is_not_empty($array["limit"])) {			$qry_with_limit  = $qry." LIMIT ".$array["offset"].",".$array["limit"];		}else{			$qry_with_limit  = $qry;		}		$result = mysql_query ($qry_with_limit);		$r1 = mysql_query($qry);		$result_found = mysql_num_rows($r1);		$class_objects = array();		if($result) {			while ($record = mysql_fetch_assoc($result)) {				$isActive= 0;				//..check deactive date is not set or 0				if(is_not_empty($record[MEMBER_ROLE_DEACTIVE_DATE])==false || strtotime($record[MEMBER_ROLE_DEACTIVE_DATE]) == 0){					$isActive = 1; 				}else{					//..check the deactive date is greater than todays date					if(strtotime($record[MEMBER_ROLE_DEACTIVE_DATE]) >= strtotime(date("Y-m-d h:i:s"))){						$isActive = 1;					}				}				if($isArray){					$class_object = array();					$class_object["member_role_id"]=$record[MEMBER_ROLE_ID];					$class_object["member_role_name"]=$record[MEMBER_ROLE_NAME];					$class_object["member_role_start_date"]=$record[MEMBER_ROLE_START_DATE];					$class_object["member_role_end_date"]=$record[MEMBER_ROLE_END_DATE];					$class_object["isActive"]=$isActive;				}else{					$class_object = new member_role();					$class_object->setmember_role_id($record[MEMBER_ROLE_ID]);					$class_object->setmember_role_name($record[MEMBER_ROLE_NAME]);					$class_object->setmember_role_start_date($record[MEMBER_ROLE_START_DATE]);					$class_object->setmember_role_end_date($record[MEMBER_ROLE_END_DATE]);				}				$class_objects[$record[MEMBER_ROLE_ID]] = $class_object;			}		}		return $class_objects;	}//..End readArray	public function insert() {		if($this->getmember_role_id() != '') {			$qry  = "UPDATE ".MEMBER_ROLE.RET."SET".RET."			".MEMBER_ROLE_ID." = '".$this->getmember_role_id()."',".RET."			".MEMBER_ROLE_NAME." = '".$this->getmember_role_name()."',".RET."			".MEMBER_ROLE_START_DATE." = '".$this->getmember_role_start_date()."',".RET."			".MEMBER_ROLE_END_DATE." = '".$this->getmember_role_end_date()."'".RET.			"WHERE ".MEMBER_ROLE_ID." = ".$this->getmember_role_id().RET;			mysql_query($qry);		} else {			$qry  = "INSERT INTO ".MEMBER_ROLE." (".RET.			"".MEMBER_ROLE_NAME.", ".MEMBER_ROLE_START_DATE.", ".MEMBER_ROLE_END_DATE.RET.				") VALUES (".RET.			"'".$this->getmember_role_name()."',".RET.			"'".$this->getmember_role_start_date()."',".RET.			"'".$this->getmember_role_end_date()."'".RET.			")".RET;			$res = mysql_query($qry);			$this->setmember_role_id(mysql_insert_id());		}	}//..End Insert	public static function delete($array = array()) {		$qry = "DELETE".RET."FROM ".MEMBER_ROLE.RET;		$and = "WHERE".RET;		if($array[MEMBER_ROLE_ID] != "") {			$qry .= $and.MEMBER_ROLE_ID." = '".$array[MEMBER_ROLE_ID]."'".RET;			$and = "AND".RET;		}		if($array[MEMBER_ROLE_NAME] != "") {			$qry .= $and.MEMBER_ROLE_NAME." = '".$array[MEMBER_ROLE_NAME]."'".RET;			$and = "AND".RET;		}		if($array[MEMBER_ROLE_START_DATE] != "") {			$qry .= $and.MEMBER_ROLE_START_DATE." = '".$array[MEMBER_ROLE_START_DATE]."'".RET;			$and = "AND".RET;		}		if($array[MEMBER_ROLE_END_DATE] != "") {			$qry .= $and.MEMBER_ROLE_END_DATE." = '".$array[MEMBER_ROLE_END_DATE]."'".RET;			$and = "AND".RET;		}		mysql_query($qry);	}//..End Delete	public function isAlreadyThere($member_role_name ,$member_role_start_date ,$member_role_end_date) {		$unique_arr = array();			//$unique_arr[MEMBER_ROLE_ID]=$member_role_id;			$unique_arr[MEMBER_ROLE_NAME]=$member_role_name;			//$unique_arr[MEMBER_ROLE_START_DATE]=$member_role_start_date;			//$unique_arr[MEMBER_ROLE_END_DATE]=$member_role_end_date;		if(is_not_empty($unique_arr)){			return $this->readObject($unique_arr);		}		return false;	}//..isAlreadyThere	public function create($member_role_name ,$member_role_start_date ,$member_role_end_date) {		if(is_not_empty($member_role_name)){			if($this->isAlreadyThere($member_role_name ,$member_role_start_date ,$member_role_end_date)){				return -1;			}else{				$this->setmember_role_id("");				$this->setmember_role_name($member_role_name);				$this->setmember_role_start_date(date(DATE_FORMAT));				//$this->setmember_role_end_date(NULL);				$this->insert();				return $this->getmember_role_id();			}		}	}//..create	public function update($member_role_id, $member_role_name, $member_role_start_date, $member_role_end_date) {		if(is_gt_zero_num($member_role_id)){			if ($this->readObject(array(MEMBER_ROLE_ID=>$member_role_id))){				$this->setmember_role_name($member_role_name);				//$this->setmember_role_start_date($member_role_start_date);				//$this->setmember_role_end_date($member_role_end_date);				$this->insert();				return 1;			}		}		return 0;	}//..update	public function activate($member_role_id){		if(is_gt_zero_num($member_role_id)){			if ($this->readObject(array(MEMBER_ROLE_ID=>$member_role_id))){				$qry  = "UPDATE ".MEMBER_ROLE.RET."SET".RET."			".MEMBER_ROLE_DEACTIVE_DATE." = '".date("0000-00-00")."' WHERE ".MEMBER_ROLE_ID."={$member_role_id}";				$res = mysql_query($qry);				if($res){					return 1;				}			}		}		return 0;	}//..end activate	public function deactivate($member_role_id){		if(is_gt_zero_num($member_role_id)){			if ($this->readObject(array(MEMBER_ROLE_ID=>$member_role_id))){				$qry  = "UPDATE ".MEMBER_ROLE.RET."SET".RET."			".MEMBER_ROLE_DEACTIVE_DATE." = '".date("Y-m-d")."' WHERE ".MEMBER_ROLE_ID."={$member_role_id}";			 				$res = mysql_query($qry);				if($res){					return 1;				}			}		}		return 0;	}//..end deactivate	public function GetInfo($member_role_id) {		$info = array();		if($member_role_id != ""){			if($this->readObject(array("member_role_id"=>$member_role_id))){				$info["member_role_id"]=$this->getmember_role_id();				$info["member_role_name"]=$this->getmember_role_name();				$info["member_role_start_date"]=$this->getmember_role_start_date();				$info["member_role_end_date"]=$this->getmember_role_end_date();				$info["isActive"] = 0;				//..check deactive date is not set or 0				if(is_not_empty($this->getmember_role_deactive_date())==false  || strtotime($this->getmember_role_deactive_date()) == 0){					$info["isActive"] = 1;				}else{					//..check the deactive date is greater than todays date					if(strtotime($this->getmember_role_deactive_date()) >= strtotime(date("Y-m-d h:i:s"))){						$info["isActive"] = 1;					}				}			}		return $info;		}	}//..End GetInfo		public static function GetFields($data){		global $member_role_active_condition;		$arr = array();		if(is_not_empty($data)){			$qry ="SELECT ".$data['key_field'].",".$data['value_field']." FROM ".MEMBER_ROLE."";			if(is_gt_zero_num($data['isActive'])){				$qry .= " WHERE ".$member_role_active_condition;			}			$res = mysql_query($qry); 			if($res){				while($row=mysql_fetch_assoc($res)){					$arr[$row[$data['key_field']]] = $row[$data['value_field']];				}			}		}		return $arr;	}//.. End of GetFields}//..End member_role?>