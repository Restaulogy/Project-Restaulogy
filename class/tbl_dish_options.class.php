<?php/**********************************************************************tbl_dish_options.class.phpGenerated by STRUCTY 2013.09.20 08:07:59.Copyright 2011 Structy, Frédéric Aebi. All rights reserved.**********************************************************************/define('TBL_DISH_OPTIONS', 'tbl_dish_options'); define('DISH_OPT_ID', 'dish_opt_id'); define('DISH_OPT_DISH_ID', 'dish_opt_dish_id'); define('DISH_OPT_NAME', 'dish_opt_name'); define('DISH_OPT_TYPE', 'dish_opt_type'); define('DISH_OPT_SUBMENU', 'dish_opt_submenu');define('DISH_OPT_MANDOTORY','dish_opt_mandotory'); define('DISH_OPT_START_DATE', 'dish_opt_start_date'); define('DISH_OPT_END_DATE', 'dish_opt_end_date'); define('TBL_DISH_OPTIONS_ACTIVE_DATE',  DISH_OPT_START_DATE);define('TBL_DISH_OPTIONS_DEACTIVE_DATE',  DISH_OPT_END_DATE);$tbl_dish_options_active_condition= ' ('.TBL_DISH_OPTIONS_DEACTIVE_DATE.' is NULL OR '.TBL_DISH_OPTIONS_DEACTIVE_DATE.' = 0 OR '.TBL_DISH_OPTIONS_DEACTIVE_DATE.' > CURDATE( )) ';class tbl_dish_options {	private $dish_opt_id;	private $dish_opt_dish_id;	private $dish_opt_name;	private $dish_opt_type;	private $dish_opt_submenu;	private $dish_opt_mandotory;	private $dish_opt_start_date;	private $dish_opt_end_date;	private $tbl_dish_options_active_date;	private $tbl_dish_options_deactive_date;	public function setdish_opt_id($pArg='0') {$this->dish_opt_id=$pArg;}	public function setdish_opt_dish_id($pArg='0') {$this->dish_opt_dish_id=$pArg;}	public function setdish_opt_name($pArg='0') {$this->dish_opt_name=$pArg;}	public function setdish_opt_type($pArg='0') {$this->dish_opt_type=$pArg;}	public function setdish_opt_submenu($pArg='0') {$this->dish_opt_submenu=$pArg;}	public function setdish_opt_mandotory($pArg='0') {$this->dish_opt_mandotory=$pArg;}	public function setdish_opt_start_date($pArg='0') {$this->dish_opt_start_date=$pArg;}	public function setdish_opt_end_date($pArg='0') {$this->dish_opt_end_date=$pArg;}	public function settbl_dish_options_active_date($pArg='0') {$this->tbl_dish_options_active_date=$pArg;}	public function settbl_dish_options_deactive_date($pArg='0') {$this->tbl_dish_options_deactive_date=$pArg;}	public function getdish_opt_id() {return $this->dish_opt_id;}	public function getdish_opt_dish_id() {return $this->dish_opt_dish_id;}	public function getdish_opt_name() {return $this->dish_opt_name;}	public function getdish_opt_type() {return $this->dish_opt_type;}	public function getdish_opt_submenu() {return $this->dish_opt_submenu;}	public function getdish_opt_mandotory() {return $this->dish_opt_mandotory;}	public function getdish_opt_start_date() {return $this->dish_opt_start_date;}	public function getdish_opt_end_date() {return $this->dish_opt_end_date;}	public function gettbl_dish_options_active_date() {return $this->tbl_dish_options_active_date;}	public function gettbl_dish_options_deactive_date() {return $this->tbl_dish_options_deactive_date;}	public function readObject($array = array()) {		$qry = "SELECT *".RET."FROM ".TBL_DISH_OPTIONS.RET;		$and = "WHERE".RET;		if($array[DISH_OPT_ID] != "") {			$qry .= $and.DISH_OPT_ID." = '".$array[DISH_OPT_ID]."'".RET;			$and = "AND".RET;		}		if($array[DISH_OPT_DISH_ID] != "") {			$qry .= $and.DISH_OPT_DISH_ID." = '".$array[DISH_OPT_DISH_ID]."'".RET;			$and = "AND".RET;		}		if($array[DISH_OPT_NAME] != "") {			$qry .= $and.DISH_OPT_NAME." = '".$array[DISH_OPT_NAME]."'".RET;			$and = "AND".RET;		}		if($array[DISH_OPT_TYPE] != "") {			$qry .= $and.DISH_OPT_TYPE." = '".$array[DISH_OPT_TYPE]."'".RET;			$and = "AND".RET;		}		if($array[DISH_OPT_SUBMENU] != "") {			$qry .= $and.DISH_OPT_SUBMENU." = '".$array[DISH_OPT_SUBMENU]."'".RET;			$and = "AND".RET;		}				if($array[DISH_OPT_MANDOTORY] != "") {			$qry .= $and.DISH_OPT_MANDOTORY." = '".$array[DISH_OPT_MANDOTORY]."'".RET;			$and = "AND".RET;		}		if($array[DISH_OPT_START_DATE] != "") {			$qry .= $and.DISH_OPT_START_DATE." = '".$array[DISH_OPT_START_DATE]."'".RET;			$and = "AND".RET;		}		if($array[DISH_OPT_END_DATE] != "") {			$qry .= $and.DISH_OPT_END_DATE." = '".$array[DISH_OPT_END_DATE]."'".RET;			$and = "AND".RET;		}	$result = mysql_query($qry);		if($result) {			while ($row = mysql_fetch_array($result)) {				$record = $row;				break;//end after first record			}			if(count($record[0]) == 0) {				return array();			} else {				$this->setdish_opt_id($record[DISH_OPT_ID]);				$this->setdish_opt_dish_id($record[DISH_OPT_DISH_ID]);				$this->setdish_opt_name($record[DISH_OPT_NAME]);				$this->setdish_opt_type($record[DISH_OPT_TYPE]);				$this->setdish_opt_submenu($record[DISH_OPT_SUBMENU]);				$this->setdish_opt_mandotory($record[DISH_OPT_MANDOTORY]);				$this->setdish_opt_start_date($record[DISH_OPT_START_DATE]);				$this->setdish_opt_end_date($record[DISH_OPT_END_DATE]);				$this->settbl_dish_options_active_date($record[TBL_DISH_OPTIONS_ACTIVE_DATE]);				$this->settbl_dish_options_deactive_date($record[TBL_DISH_OPTIONS_DEACTIVE_DATE]);				return true;			}		}	}	public static function readArray($array = array(),&$result_found=0,$isArray=1) {		global $tbl_dish_options_active_condition;		$qry = "SELECT *".RET."FROM ".TBL_DISH_OPTIONS.RET;		$and = "WHERE".RET;		if($array[DISH_OPT_ID] != "") {			$qry .= $and.DISH_OPT_ID." = '".$array[DISH_OPT_ID]."'".RET;			$and = "AND".RET;		}		if($array[DISH_OPT_DISH_ID] != "") {			$qry .= $and.DISH_OPT_DISH_ID." = '".$array[DISH_OPT_DISH_ID]."'".RET;			$and = "AND".RET;		}		if($array[DISH_OPT_NAME] != "") {			$qry .= $and.DISH_OPT_NAME." = '".$array[DISH_OPT_NAME]."'".RET;			$and = "AND".RET;		}		if($array[DISH_OPT_TYPE] != "") {			$qry .= $and.DISH_OPT_TYPE." = '".$array[DISH_OPT_TYPE]."'".RET;			$and = "AND".RET;		}		if($array[DISH_OPT_SUBMENU] != "") {			$qry .= $and.DISH_OPT_SUBMENU." = '".$array[DISH_OPT_SUBMENU]."'".RET;			$and = "AND".RET;		}				if($array[DISH_OPT_MANDOTORY] != "") {			$qry .= $and.DISH_OPT_MANDOTORY." = '".$array[DISH_OPT_MANDOTORY]."'".RET;			$and = "AND".RET;		}		if($array[DISH_OPT_START_DATE] != "") {			$qry .= $and.DISH_OPT_START_DATE." = '".$array[DISH_OPT_START_DATE]."'".RET;			$and = "AND".RET;		}		if($array[DISH_OPT_END_DATE] != "") {			$qry .= $and.DISH_OPT_END_DATE." = '".$array[DISH_OPT_END_DATE]."'".RET;			$and = "AND".RET;		}		if(is_gt_zero_num($array["isActive"])) {			$qry .= $and.$tbl_dish_options_active_condition;;			$and = "AND".RET;		}		if(is_not_empty($array[SORT_ON]) && is_not_empty($array[SORT_BY])) {		$qry .=" ORDER BY ".$array[SORT_ON]." ".$array[SORT_BY];		}		if(is_not_empty($array[OFFSET_TITLE]) && is_not_empty($array[LIMIT_TITLE])) {			$qry_with_limit  = $qry." LIMIT ".$array[OFFSET_TITLE].",".$array[LIMIT_TITLE];		}else{			$qry_with_limit  = $qry;		}		$result = mysql_query ($qry_with_limit);		$r1 = mysql_query($qry);		if($r1){			$result_found = mysql_num_rows($r1);		}		$class_objects = array();		if($result) {			while ($record = mysql_fetch_assoc($result)) {				$isActive= 0;				//..check deactive date is not set or 0				if((is_not_empty($record[TBL_DISH_OPTIONS_DEACTIVE_DATE])==false) || (is_gt_zero_num(strtotime($record[TBL_DISH_OPTIONS_DEACTIVE_DATE]))== false)){					$isActive = 1; 				}else{					//..check the deactive date is greater than todays date					if(strtotime($record[TBL_DISH_OPTIONS_DEACTIVE_DATE]) > strtotime(date(DATE_FORMAT))){						$isActive = 1;					}				}				if($isArray){					$class_object = array();					$class_object[DISH_OPT_ID]=$record[DISH_OPT_ID];					$class_object[DISH_OPT_DISH_ID]=$record[DISH_OPT_DISH_ID];					$class_object[DISH_OPT_NAME]=$record[DISH_OPT_NAME];					$class_object[DISH_OPT_TYPE]=$record[DISH_OPT_TYPE];					$class_object[DISH_OPT_SUBMENU]=$record[DISH_OPT_SUBMENU];					$class_object[DISH_OPT_MANDOTORY]=$record[DISH_OPT_MANDOTORY];					$class_object[DISH_OPT_START_DATE]=$record[DISH_OPT_START_DATE];					$class_object[DISH_OPT_END_DATE]=$record[DISH_OPT_END_DATE];					$class_object['dish_opt_values'] = tbl_dish_options_values::getAllValuesForOption($record[DISH_OPT_ID]); 					 					$class_object['isActive']=$isActive;				}else{					$class_object = new tbl_dish_options();					$class_object->setdish_opt_id($record[DISH_OPT_ID]);					$class_object->setdish_opt_dish_id($record[DISH_OPT_DISH_ID]);					$class_object->setdish_opt_name($record[DISH_OPT_NAME]);					$class_object->setdish_opt_type($record[DISH_OPT_TYPE]);					$class_object->setdish_opt_submenu($record[DISH_OPT_SUBMENU]);					$class_object->setdish_opt_mandotory($record[DISH_OPT_MANDOTORY]);					$class_object->setdish_opt_start_date($record[DISH_OPT_START_DATE]);					$class_object->setdish_opt_end_date($record[DISH_OPT_END_DATE]);				}				$class_objects[$record[DISH_OPT_ID]] = $class_object;			}		}		return $class_objects;	}//..End readArray	public function insert() {		if($this->getdish_opt_id() != '') {			$qry  = "UPDATE ".TBL_DISH_OPTIONS.RET."SET".RET."			".DISH_OPT_ID." = '".$this->getdish_opt_id()."',".RET."			".DISH_OPT_DISH_ID." = '".$this->getdish_opt_dish_id()."',".RET."			".DISH_OPT_NAME." = '".$this->getdish_opt_name()."',".RET."			".DISH_OPT_TYPE." = '".$this->getdish_opt_type()."',".RET."			".DISH_OPT_SUBMENU." = '".$this->getdish_opt_submenu()."',".RET."			".DISH_OPT_MANDOTORY." = '".$this->getdish_opt_mandotory()."',".RET."			".DISH_OPT_START_DATE." = '".$this->getdish_opt_start_date()."',".RET."			".DISH_OPT_END_DATE." = '".$this->getdish_opt_end_date()."'".RET.			"WHERE ".DISH_OPT_ID." = ".$this->getdish_opt_id().RET;			mysql_query($qry);		} else {			$qry  = "INSERT INTO ".TBL_DISH_OPTIONS." (".RET.			"".DISH_OPT_DISH_ID.", ".DISH_OPT_NAME.", ".DISH_OPT_TYPE.", ".DISH_OPT_SUBMENU.",".DISH_OPT_MANDOTORY.", ".DISH_OPT_START_DATE.", ".DISH_OPT_END_DATE.RET.				") VALUES (".RET.			"'".$this->getdish_opt_dish_id()."',".RET.			"'".$this->getdish_opt_name()."',".RET.			"'".$this->getdish_opt_type()."',".RET.			"'".$this->getdish_opt_submenu()."',".RET.			"'".$this->getdish_opt_mandotory()."',".RET.			"'".$this->getdish_opt_start_date()."',".RET.			"'".$this->getdish_opt_end_date()."'".RET.			")".RET;			$res = mysql_query($qry);			$this->setdish_opt_id(mysql_insert_id());		}	}//..End Insert	public static function delete($array = array()) {		$qry = "DELETE".RET."FROM ".TBL_DISH_OPTIONS.RET;		$and = "WHERE".RET;		if($array[DISH_OPT_ID] != "") {			//$qry .= $and.DISH_OPT_ID." = '".$array[DISH_OPT_ID]."'".RET;			$qry .= $and.DISH_OPT_ID." IN (".$array[DISH_OPT_ID].")".RET;			$and = "AND".RET;		}		if($array[DISH_OPT_DISH_ID] != "") {			$qry .= $and.DISH_OPT_DISH_ID." = '".$array[DISH_OPT_DISH_ID]."'".RET;			$and = "AND".RET;		}		if($array[DISH_OPT_NAME] != "") {			$qry .= $and.DISH_OPT_NAME." = '".$array[DISH_OPT_NAME]."'".RET;			$and = "AND".RET;		}		if($array[DISH_OPT_TYPE] != "") {			$qry .= $and.DISH_OPT_TYPE." = '".$array[DISH_OPT_TYPE]."'".RET;			$and = "AND".RET;		}		if($array[DISH_OPT_SUBMENU] != "") {			$qry .= $and.DISH_OPT_SUBMENU." = '".$array[DISH_OPT_SUBMENU]."'".RET;			$and = "AND".RET;		}				if($array[DISH_OPT_MANDOTORY] != "") {			$qry .= $and.DISH_OPT_MANDOTORY." = '".$array[DISH_OPT_MANDOTORY]."'".RET;			$and = "AND".RET;		}		if($array[DISH_OPT_START_DATE] != "") {			$qry .= $and.DISH_OPT_START_DATE." = '".$array[DISH_OPT_START_DATE]."'".RET;			$and = "AND".RET;		}		if($array[DISH_OPT_END_DATE] != "") {			$qry .= $and.DISH_OPT_END_DATE." = '".$array[DISH_OPT_END_DATE]."'".RET;			$and = "AND".RET;		}		$res = mysql_query($qry);		if($res){			return OPERATION_SUCCESS;		};		return OPERATION_FAIL;	}//..End Delete	public function isAlreadyThere($dish_opt_dish_id ,$dish_opt_name ,$dish_opt_type ,$dish_opt_submenu ,$dish_opt_start_date ,$dish_opt_end_date) {		$unique_arr = array();			//$unique_arr[DISH_OPT_ID]=$dish_opt_id;			//$unique_arr[DISH_OPT_DISH_ID]=$dish_opt_dish_id;			//$unique_arr[DISH_OPT_NAME]=$dish_opt_name;			//$unique_arr[DISH_OPT_TYPE]=$dish_opt_type;			//$unique_arr[DISH_OPT_SUBMENU]=$dish_opt_submenu;			//$unique_arr[DISH_OPT_START_DATE]=$dish_opt_start_date;			//$unique_arr[DISH_OPT_END_DATE]=$dish_opt_end_date;		if(is_not_empty($unique_arr)){			return $this->readObject($unique_arr);		}		return false;	}//..isAlreadyThere	public function create($dish_opt_dish_id ,$dish_opt_name ,$dish_opt_type ,$dish_opt_submenu , $dish_opt_mandotory=0) {		if(is_gt_zero_num($dish_opt_dish_id) || is_gt_zero_num($dish_opt_submenu)){			if($this->isAlreadyThere($dish_opt_dish_id ,$dish_opt_name ,$dish_opt_type ,$dish_opt_submenu ,$dish_opt_start_date ,$dish_opt_end_date)){				return OPERATION_DUPLICATE;			}else{				$this->setdish_opt_id('');				$this->setdish_opt_dish_id($dish_opt_dish_id);				$this->setdish_opt_name($dish_opt_name);				$this->setdish_opt_type($dish_opt_type);				$this->setdish_opt_submenu($dish_opt_submenu);				$this->setdish_opt_mandotory($dish_opt_mandotory);				$this->setdish_opt_start_date(date(DATE_FORMAT));				$this->insert();				return $this->getdish_opt_id();			}		}		return OPERATION_FAIL;	}//..create	public function update($dish_opt_id, $dish_opt_dish_id, $dish_opt_name, $dish_opt_type, $dish_opt_submenu, $dish_opt_mandotory=0) {		if(is_gt_zero_num($dish_opt_id)){			if ($this->readObject(array(DISH_OPT_ID=>$dish_opt_id))){				$this->setdish_opt_dish_id($dish_opt_dish_id);				$this->setdish_opt_name($dish_opt_name);				$this->setdish_opt_type($dish_opt_type);				$this->setdish_opt_submenu($dish_opt_submenu);				$this->setdish_opt_mandotory($dish_opt_mandotory);				$this->insert();				return OPERATION_SUCCESS;			}		}		return OPERATION_FAIL;	}//..update	public function activate($dish_opt_id){		if(is_not_empty($dish_opt_id)){			//if ($this->readObject(array(DISH_OPT_ID=>$dish_opt_id))){  				$qry  = 'UPDATE '.TBL_DISH_OPTIONS.RET.'SET'.RET.'			'.TBL_DISH_OPTIONS_DEACTIVE_DATE.' = \''.date(EMPTY_DATE_FORMAT).'\' WHERE '.DISH_OPT_ID.' IN ('.$dish_opt_id.')';		 				$res = mysql_query($qry);				if($res){					return 1;				}			//}		}		return 0;	}//..end activate	public function deactivate($dish_opt_id){		if(is_not_empty($dish_opt_id)){			//if ($this->readObject(array(DISH_OPT_ID=>$dish_opt_id))){				$qry  = 'UPDATE '.TBL_DISH_OPTIONS.RET.'SET'.RET.'			'.TBL_DISH_OPTIONS_DEACTIVE_DATE.' = \''.date(DATE_FORMAT).'\' WHERE '.DISH_OPT_ID.' IN ('.$dish_opt_id.')'; 				$res = mysql_query($qry);				if($res){ 					tbl_sbmnu_dish_opt_price::delete(array(DISH_OPT_ID=>$dish_opt_id));					return 1;				}			//}		}		return 0;	}//..end deactivate	public static function GetInfo($dish_opt_id) {		$info = array();		if($dish_opt_id != ''){			$obj_tbl_dish_options = new tbl_dish_options();			if($obj_tbl_dish_options->readObject(array('dish_opt_id'=>$dish_opt_id))){				$info['dish_opt_id']=$obj_tbl_dish_options->getdish_opt_id();				$info['dish_opt_dish_id']=$obj_tbl_dish_options->getdish_opt_dish_id();				$info['dish_opt_name']=$obj_tbl_dish_options->getdish_opt_name();				$info['dish_opt_type']=$obj_tbl_dish_options->getdish_opt_type();				$info['dish_opt_submenu']=$obj_tbl_dish_options->getdish_opt_submenu();				$info['dish_opt_mandotory']=$obj_tbl_dish_options->getdish_opt_mandotory();				$info['dish_opt_start_date']=$obj_tbl_dish_options->getdish_opt_start_date();				$info['dish_opt_end_date']=$obj_tbl_dish_options->getdish_opt_end_date();				$info['dish_opt_values'] = tbl_dish_options_values::getAllValuesForOption($info['dish_opt_id']);				$info['isActive'] = 0;				//..check deactive date is not set or 0				if((is_not_empty($obj_tbl_dish_options->gettbl_dish_options_deactive_date())==false)  || (is_gt_zero_num(strtotime($obj_tbl_dish_options->gettbl_dish_options_deactive_date()))== false)){					$info['isActive'] = 1;				}else{					//..check the deactive date is greater than todays date					if(strtotime($obj_tbl_dish_options->gettbl_dish_options_deactive_date()) > strtotime(date(DATE_FORMAT))){						$info['isActive'] = 1;					}				}			}		unset($obj_tbl_dish_options);		return $info;		}	}//..End GetInfo	public static function GetFields($data){		global $tbl_dish_options_active_condition;		$arr = array();		if(is_not_empty($data)){			$qry ="SELECT ".$data['key_field'].",".$data['value_field']." FROM ".TBL_DISH_OPTIONS."";			if(is_gt_zero_num($data['isActive'])){				$qry .= " WHERE ".$tbl_dish_options_active_condition;				}			$res = mysql_query($qry); 			if($res){				while($row=mysql_fetch_assoc($res)){					$arr[$row[$data['key_field']]] = $row[$data['value_field']];				}			}		}		return $arr;	}//.. End of GetFields			public static function getOptionTypes(){		return array('text'=>'Text','checkbox'=>'Checkbox','dropdown'=>'Dropdown');	}}//..End tbl_dish_options?>