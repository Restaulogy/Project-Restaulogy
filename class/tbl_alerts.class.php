<?php/****************************************************************tbl_alerts.class.phpGenerated by STRUCTY 2013.05.18 12:49:31.Copyright 2011 Structy, Frédéric Aebi. All rights reserved.****************************************************************/define('TBL_ALERTS', 'tbl_alerts'); define('ALERT_ID', 'alert_id'); define('ALERT_TABLE_ID', 'alert_table_id'); define('ALERT_SERVER', 'alert_server');define('ALERT_CUSTOMER', 'alert_customer'); define('ALERT_POST_TYPE', 'alert_post_type'); define('ALERT_POST_ID', 'alert_post_id'); define('ALERT_VIEWED_ON', 'alert_viewed_on'); define('ALERT_MSG', 'alert_msg'); define('ALERT_STATUS', 'alert_status'); define('ALERT_NOTIFY', 'alert_notify'); define('ALERT_PERSON','alert_person');define('ALERT_PERSON_TYPE','alert_person_type');define('ALERT_RESTAURANT','alert_restaurant');define('ALERT_IS_URGENT','alert_is_urgent');define('ALERT_IS_CHECKED','alert_is_checked');define('ALERT_FLG_NOW_LATER','alert_flg_now_later');define('ALERT_START_DATE', 'alert_start_date'); define('ALERT_END_DATE', 'alert_end_date'); define('ALERT_TMP_ORDER','TEMP_ORDER');define('ALERT_CHK_OUT','CHECK_OUT');define('ALERT_EXD_ORDER','EXCEED_ORDER');define('ALERT_TMP_REQST','TEMP_REQUEST'); define('ALERT_PNDG_REQST','PENDING_REQUEST'); define('ALERT_PNDG_ORDER','PENDING_ORDER');define('ALERT_PNDG_CUPON','PENDING_COUPON');define('ALERT_CNF_CUPON','COUPON_CONFIRM');define('ALERT_CUPON_REQST','COUPON_REQUEST');//..for the rewardsdefine('REWARD_CUST','REWARD_CUST');//..for wait quedefine('ALERT_NEW_QUE','NEW_QUE');define('ALERT_TIME_OUT','TIME_OUT');define('ALERT_QUE_CANCEL','QUE_CANCELLED'); define('ALERT_WAIT_MSG','WAIT_MESSAGE');//define('ALERT_CLAIMED_COUPON','CLAIMED_COUPON');define('ALERT_MISC','MISC');define('ALERT_ORDER','ORDER');define('ALERT_SUB_ORDER','SUB_ORDER');define('ALERT_REQST','REQUEST');define('ALERT_ORDER_PICKED','ORDER_PICKED'); define('ALERT_ORD_CONFIRM_DELAY','ORDER_CONFIRM_DELAY');//..New chnages done for status and notification//..Dt: 25 Oct 2013//define('ALERT_FOR_MANGER',0); //define('ALERT_FOR_KITCHEN',-1);define('ALERT_FOR_MANGER',-2);define('ALERT_FOR_ADMIN',-3);define('ALERT_FOR_KITCHEN',-5);define('ALERT_FOR_OWNER',-6);define('ALERT_FOR_BAR',-8);//..constant for the post type FILTER_BY_CUSTdefine('ALERT_FILTER_ORDER','ORDER');define('ALERT_FILTER_REQUEST','REQUEST');define('ALERT_FILTER_PROMOTION','PROMOTION');define('ALERT_FILTER_GENERAL','GENERAL');define('ALERT_FILTER_ALL','ALL');define('TBL_ALERTS_ACTIVE_DATE',  ALERT_START_DATE);define('TBL_ALERTS_DEACTIVE_DATE',  ALERT_END_DATE);$tbl_alerts_active_condition= ' ('.TBL_ALERTS_DEACTIVE_DATE.' is NULL OR '.TBL_ALERTS_DEACTIVE_DATE.' = 0) ';class tbl_alerts {	private $alert_id;	private $alert_table_id;	private $alert_server;		private $alert_customer;	private $alert_post_type;	private $alert_post_id;	private $alert_viewed_on;	private $alert_msg;	private $alert_status;	private $alert_notify;	private $alert_person;	private $alert_is_urgent;	private $alert_person_type;	private $alert_restaurant;	private $alert_start_date;	private $alert_is_checked;		private $alert_flg_now_later;		private $alert_end_date;	private $tbl_alerts_active_date;	private $tbl_alerts_deactive_date;		public function setalert_id($pArg='0') {$this->alert_id=$pArg;}	public function setalert_table_id($pArg='0') {$this->alert_table_id=$pArg;}	public function setalert_server($pArg='0') {$this->alert_server=$pArg;}		public function setalert_customer($pArg='0') {$this->alert_customer=$pArg;}	public function setalert_post_type($pArg='0') {$this->alert_post_type=$pArg;}	public function setalert_post_id($pArg='0') {$this->alert_post_id=$pArg;}	public function setalert_viewed_on($pArg='0') {$this->alert_viewed_on=$pArg;}	public function setalert_msg($pArg='0') {$this->alert_msg=$pArg;}	public function setalert_status($pArg='0') {$this->alert_status=$pArg;}	public function setalert_notify($pArg='0') {$this->alert_notify=$pArg;}	public function setalert_is_checked($pArg='0') {$this->alert_is_checked=$pArg;}	public function setalert_flg_now_later($pArg='0') {$this->alert_flg_now_later=$pArg;}		public function setalert_person($pArg='0') {$this->alert_person=$pArg;}	public function setalert_person_type($pArg='0') {$this->alert_person_type=$pArg;}	public function setalert_restaurant($pArg='0') {$this->alert_restaurant=$pArg;}	public function setalert_is_urgent($pArg='0') {$this->alert_is_urgent=$pArg;}	public function setalert_start_date($pArg='0') {$this->alert_start_date=$pArg;}	public function setalert_end_date($pArg='0') {$this->alert_end_date=$pArg;}	public function settbl_alerts_active_date($pArg='0') {$this->tbl_alerts_active_date=$pArg;}	public function settbl_alerts_deactive_date($pArg='0') {$this->tbl_alerts_deactive_date=$pArg;}	public function getalert_id() {return $this->alert_id;}	public function getalert_table_id() {return $this->alert_table_id;}	public function getalert_server() {return $this->alert_server;}		public function getalert_customer() {return $this->alert_customer;}	public function getalert_post_type() {return $this->alert_post_type;}	public function getalert_post_id() {return $this->alert_post_id;}	public function getalert_viewed_on() {return $this->alert_viewed_on;}	public function getalert_msg() {return $this->alert_msg;}	public function getalert_status() {return $this->alert_status;}	public function getalert_notify() {return $this->alert_notify;}	public function getalert_person() {return $this->alert_person;}	public function getalert_person_type() {return $this->alert_person_type;}	public function getalert_restaurant() {return $this->alert_restaurant;}  public function getalert_is_urgent() {return $this->alert_is_urgent;}	public function getalert_is_checked() {return $this->alert_is_checked;}		public function getalert_flg_now_later() {return $this->alert_flg_now_later;}		public function getalert_start_date() {return $this->alert_start_date;}	public function getalert_end_date() {return $this->alert_end_date;}	public function gettbl_alerts_active_date() {return $this->tbl_alerts_active_date;}	public function gettbl_alerts_deactive_date() {return $this->tbl_alerts_deactive_date;}	public function readObject($array = array()) {		$qry = "SELECT `alert_id`, `alert_table_id`,`alert_server`, `alert_customer`, `alert_post_type`, `alert_post_id`, `alert_viewed_on`, `alert_msg`, `alert_status`, `alert_notify`,`alert_is_urgent` , `alert_start_date`, `alert_end_date` , `status_name`, `table_number`,`alert_person`,`alert_is_checked` ,`alert_flg_now_later`,  `alert_person_type` ".RET."FROM ".TBL_ALERTS." LEFT OUTER JOIN  ".TBL_DINING_TABLE." ON `alert_table_id` = `table_id` LEFT OUTER JOIN `tbl_statuses` ON `alert_status`".RET;		$and = "WHERE".RET;		if($array[ALERT_ID] != "") {			$qry .= $and.ALERT_ID." = '".$array[ALERT_ID]."'".RET;			$and = "AND".RET;		}				if($array[ALERT_TABLE_ID] != "") {			$qry .= $and.ALERT_TABLE_ID." = '".$array[ALERT_TABLE_ID]."'".RET;			$and = "AND".RET;		}				if($array[ALERT_SERVER] != "") {			$qry .= $and.ALERT_SERVER." IN (".$array[ALERT_SERVER].")".RET;			$and = "AND".RET;		}				if($array[ALERT_CUSTOMER] != "") {			$qry .= $and.ALERT_CUSTOMER." = '".$array[ALERT_CUSTOMER]."'".RET;			$and = "AND".RET;		}		if($array[ALERT_POST_TYPE] != "") {			$qry .= $and.ALERT_POST_TYPE." = '".$array[ALERT_POST_TYPE]."'".RET;			$and = "AND".RET;		}		if($array[ALERT_POST_ID] != "") {			$qry .= $and.ALERT_POST_ID." = '".$array[ALERT_POST_ID]."'".RET;			$and = "AND".RET;		}		if($array[ALERT_VIEWED_ON] != "") {			$qry .= $and.ALERT_VIEWED_ON." = '".$array[ALERT_VIEWED_ON]."'".RET;			$and = "AND".RET;		}		 		if($array[ALERT_MSG] != "") {			$qry .= $and.ALERT_MSG." = '".$array[ALERT_MSG]."'".RET;			$and = "AND".RET;		} 				if(is_not_empty($array[ALERT_PERSON])) {			$qry .= $and.ALERT_PERSON." = '".$array[ALERT_PERSON]."'".RET;			$and = "AND".RET;		}				if(is_not_empty($array[ALERT_NOTIFY])) {			$qry .= $and.ALERT_NOTIFY." = '".$array[ALERT_NOTIFY]."'".RET;			$and = "AND".RET;		}				if(is_not_empty($array[ALERT_PERSON_TYPE])) {			$qry .= $and.ALERT_PERSON_TYPE." = '".$array[ALERT_PERSON_TYPE]."'".RET;			$and = "AND".RET;		}				if(is_not_empty($array[ALERT_RESTAURANT])) {			$qry .= $and.ALERT_RESTAURANT." = '".$array[ALERT_RESTAURANT]."'".RET;			$and = "AND".RET;		}		if($array[ALERT_START_DATE] != "") {			$qry .= $and.ALERT_START_DATE." = '".$array[ALERT_START_DATE]."'".RET;			$and = "AND".RET;		}		if($array[ALERT_END_DATE] != "") {			$qry .= $and.ALERT_END_DATE." = '".$array[ALERT_END_DATE]."'".RET;			$and = "AND".RET;		}				if(is_not_empty($array[ALERT_FLG_NOW_LATER])) {			$qry .= $and.ALERT_FLG_NOW_LATER." = '".$array[ALERT_FLG_NOW_LATER]."'".RET;			$and = "AND".RET;		}    	$result = mysql_query($qry);		if($result) {			while ($row = mysql_fetch_array($result)) {				$record = $row;				break;//end after first record			}			if(count($record[0]) == 0) {				return array();			} else {				$this->setalert_id($record[ALERT_ID]);				$this->setalert_table_id($record[ALERT_TABLE_ID]);				$this->setalert_server($record[ALERT_SERVER]); 				$this->setalert_customer($record[ALERT_CUSTOMER]); 				$this->setalert_post_type($record[ALERT_POST_TYPE]);				$this->setalert_post_id($record[ALERT_POST_ID]);				$this->setalert_viewed_on($record[ALERT_VIEWED_ON]);				$this->setalert_msg($record[ALERT_MSG]);				$this->setalert_status($record[ALERT_STATUS]);				$this->setalert_notify($record[ALERT_NOTIFY]);				$this->setalert_person($record[ALERT_PERSON]);				$this->setalert_restaurant($record[ALERT_RESTAURANT]);				$this->setalert_is_urgent($record[ALERT_IS_URGENT]);				$this->setalert_is_checked($record[ALERT_IS_CHECKED]);								$this->setalert_flg_now_later($record[ALERT_FLG_NOW_LATER]);												$this->setalert_person_type($record[ALERT_PERSON_TYPE]);				$this->setalert_start_date($record[ALERT_START_DATE]);				$this->setalert_end_date($record[ALERT_END_DATE]);				$this->settbl_alerts_active_date($record[TBL_ALERTS_ACTIVE_DATE]);				$this->settbl_alerts_deactive_date($record[TBL_ALERTS_DEACTIVE_DATE]);				return true;			}		}	}	public static function readArray($array = array(),&$result_found=0,$isArray=1) {		global $tbl_alerts_active_condition;		$qry = "SELECT `alert_id`, `alert_table_id`,`alert_server`, `alert_customer`, `alert_post_type`, `alert_post_id`, `alert_viewed_on`, `alert_msg`, `alert_status`, `alert_notify`, `alert_start_date`, `alert_end_date` , IF(TIMESTAMPDIFF(SECOND,`alert_start_date`,NOW()) > IFNULL(`".STATUS_EXP_TIME."`,0),1,0) `is_delayed`  , `".STATUS_NAME."`, `".STATUS_EXP_TIME."` ,  `table_number`,`alert_person`,`alert_person_type` ,`alert_is_checked`,`alert_flg_now_later` , `alert_is_urgent` ".RET."FROM ".TBL_ALERTS." LEFT OUTER JOIN  ".TBL_DINING_TABLE." ON `alert_table_id` = `table_id` LEFT OUTER JOIN `".TBL_STATUSES."` ON `alert_status`=`status_id` ".RET;		 		$and = "WHERE".RET;		 		if($array[ALERT_ID] != "") {			$qry .= $and.ALERT_ID." = '".$array[ALERT_ID]."'".RET;			$and = "AND".RET;		}		if($array[ALERT_TABLE_ID] != "") {			$qry .= $and.ALERT_TABLE_ID." = '".$array[ALERT_TABLE_ID]."'".RET;			$and = "AND".RET;		}				if($array[ALERT_SERVER] != "") {			$qry .= $and.ALERT_SERVER." IN (".$array[ALERT_SERVER].")".RET;			$and = "AND".RET;		}			if($array[ALERT_CUSTOMER] != "") {			$qry .= $and.ALERT_CUSTOMER." = '".$array[ALERT_CUSTOMER]."'".RET;			$and = "AND".RET;		}		if($array[ALERT_POST_TYPE] != "") {			//$qry .= $and.ALERT_POST_TYPE." = '".$array[ALERT_POST_TYPE]."'".RET;			if(strtoupper($array[ALERT_POST_TYPE])==ALERT_FILTER_ORDER){					$qry .= $and.ALERT_POST_TYPE." IN ('TEMP_ORDER','CHECK_OUT','PENDING_ORDER','EXCEED_ORDER','ORDER','ORDER_CONFIRM_DELAY','SUB_ORDER')".RET;			}elseif(strtoupper($array[ALERT_POST_TYPE])==ALERT_FILTER_REQUEST){					$qry .= $and.ALERT_POST_TYPE." IN ('TEMP_REQUEST','PENDING_REQUEST','REQUEST')".RET;			}elseif(strtoupper($array[ALERT_POST_TYPE])==ALERT_FILTER_PROMOTION){					$qry .= $and.ALERT_POST_TYPE." IN ('PENDING_COUPON','COUPON_CONFIRM','COUPON_REQUEST')".RET;			}elseif(strtoupper($array[ALERT_POST_TYPE])==ALERT_FILTER_GENERAL){					$qry .= $and.ALERT_POST_TYPE." IN ('MISC','REWARD_CUST','')".RET;			}			$and = "AND".RET;		}		if($array[ALERT_POST_ID] != "") {			$qry .= $and.ALERT_POST_ID." = '".$array[ALERT_POST_ID]."'".RET;			$and = "AND".RET;		}		if(is_not_empty($array[ALERT_RESTAURANT])) {			$qry .= $and.ALERT_RESTAURANT." = '".$array[ALERT_RESTAURANT]."'".RET;			$and = "AND".RET;		}			if($array[ALERT_VIEWED_ON] != "") {			$qry .= $and.ALERT_VIEWED_ON." = '".$array[ALERT_VIEWED_ON]."'".RET;			$and = "AND".RET;		}				if(is_not_empty($array[ALERT_PERSON])) {			$qry .= $and.ALERT_PERSON." = '".$array[ALERT_PERSON]."'".RET;			$and = "AND".RET;		}				if($array[ALERT_MSG] != "") {			$qry .= $and.ALERT_MSG." = '".$array[ALERT_MSG]."'".RET;			$and = "AND".RET;		}		if($array[ALERT_START_DATE] != "") {			$qry .= $and.ALERT_START_DATE." = '".$array[ALERT_START_DATE]."'".RET;			$and = "AND".RET;		}		if($array[ALERT_END_DATE] != "") {			$qry .= $and.ALERT_END_DATE." = '".$array[ALERT_END_DATE]."'".RET;			$and = "AND".RET;		}		if(is_gt_zero_num($array["isActive"])) {			$qry .= $and.$tbl_alerts_active_condition;			$and = "AND".RET;		}					if(is_gt_zero_num($array["search_isLiveOnly"])) {			$qry .= $and.' DATE('.ALERT_START_DATE.')=CURDATE()'.RET;			$and = "AND".RET;		}				  if(is_not_empty($array[ALERT_FLG_NOW_LATER])) {			$qry .= $and.ALERT_FLG_NOW_LATER." = '".$array[ALERT_FLG_NOW_LATER]."'".RET;			$and = "AND".RET;		}				/*if(is_gt_zero_num($array["is_UnChecked"])) {			$qry .= $and." (".ALERT_VIEWED_ON." IS NULL  OR ".ALERT_VIEWED_ON." = 0 OR ".ALERT_VIEWED_ON." = '".date(EMPTY_DATE_FORMAT)."' ) ".RET;			$and = "AND".RET;		}*/			if(is_not_empty($array[SORT_ON]) && is_not_empty($array[SORT_BY])) {					$qry .=" ORDER BY ".$array[SORT_ON]." ".$array[SORT_BY];				}else{			$qry .=" ORDER BY ".ALERT_ID." DESC";		}		if(is_not_empty($array[OFFSET_TITLE]) && is_not_empty($array[LIMIT_TITLE])) {			$qry_with_limit  = $qry." LIMIT ".$array[OFFSET_TITLE].",".$array[LIMIT_TITLE];		}else{			$qry_with_limit  = $qry;		}		//echo $qry_with_limit. "<hr>";		 		$result = mysql_query ($qry_with_limit);		$r1 = mysql_query($qry);		if($r1){			$result_found = mysql_num_rows($r1);		}		$class_objects = array();		if($result) {			while ($record = mysql_fetch_assoc($result)) {				$isActive= chk_if_record_active($record[TBL_ALERTS_DEACTIVE_DATE]) ;				/*//..check deactive date is not set or 0				if((is_not_empty($record[TBL_ALERTS_DEACTIVE_DATE])==false) || (is_gt_zero_num(strtotime($record[TBL_ALERTS_DEACTIVE_DATE]))== false)){					$isActive = 1; 				}else{					//..check the deactive date is greater than todays date					if(strtotime($record[TBL_ALERTS_DEACTIVE_DATE]) > strtotime(date(DATE_FORMAT))){						$isActive = 1;					}				}*/				if($isArray){					$class_object = array();					$class_object["alert_id"]=$record[ALERT_ID];					$class_object["alert_table_id"]=$record[ALERT_TABLE_ID];					$class_object["alert_server"]=$record[ALERT_SERVER];					if(is_gt_zero_num($record[ALERT_SERVER])){						$class_object["server_name"]=GetMembersFromIDs($record[ALERT_SERVER]);					}else{						$class_object['server_name']='--';					}															$class_object["table_number"]=$record["table_number"];					$class_object["alert_customer"]=$record[ALERT_CUSTOMER];					$class_object["alert_post_type"]=$record[ALERT_POST_TYPE];					$class_object["alert_post_id"]=$record[ALERT_POST_ID];					$class_object["alert_person"]=$record[ALERT_PERSON];					$class_object["alert_person_type"]=$record[ALERT_PERSON_TYPE];					$class_object["alert_viewed_on"]=$record[ALERT_VIEWED_ON];					$class_object["alert_msg"]=$record[ALERT_MSG];					$class_object[ALERT_STATUS] = $record[ALERT_STATUS];					$class_object[ALERT_IS_URGENT] = $record[ALERT_IS_URGENT];					$class_object[ALERT_NOTIFY] = $record[ALERT_NOTIFY];					$class_object[STATUS_NAME] = $record[STATUS_NAME];					$class_object[STATUS_EXP_TIME] = $record[STATUS_EXP_TIME];					$class_object[ALERT_IS_CHECKED] = $record[ALERT_IS_CHECKED];										$class_object[ALERT_FLG_NOW_LATER] = $record[ALERT_FLG_NOW_LATER];										$class_object['is_delayed'] = $record['is_delayed']; 					$class_object["alert_start_date"]=$record[ALERT_START_DATE];					$class_object["alert_end_date"]=$record[ALERT_END_DATE];					$class_object['friendly_created_on'] = friendly_time($class_object["alert_start_date"],1);					$class_object[ALERT_RESTAURANT] = $record[ALERT_RESTAURANT];					$class_object["isActive"]=$isActive;				}else{					$class_object = new tbl_alerts();					$class_object->setalert_id($record[ALERT_ID]);					$class_object->setalert_table_id($record[ALERT_TABLE_ID]);					$class_object->alert_server($record[ALERT_SERVER]);										$class_object->setalert_customer($record[ALERT_CUSTOMER]);					$class_object->setalert_post_type($record[ALERT_POST_TYPE]);					$class_object->setalert_post_id($record[ALERT_POST_ID]);					$class_object->setalert_viewed_on($record[ALERT_VIEWED_ON]);					$class_object->setalert_msg($record[ALERT_MSG]);					$class_object->setalert_status($record[ALERT_STATUS]);					$class_object->alert_notify($record[ALERT_NOTIFY]);					$class_object->setalert_start_date($record[ALERT_START_DATE]);					$class_object->setalert_restaurant($record[ALERT_RESTAURANT]);					$class_object->setalert_end_date($record[ALERT_END_DATE]);					$class_object->setalert_is_checked($record[ALERT_IS_CHECKED]);										$class_object->setalert_flg_now_later($record[ALERT_FLG_NOW_LATER]);				}				$class_objects[$record[ALERT_ID]] = $class_object;			}		}		return $class_objects;	}//..End readArray	public function insert() {		if($this->getalert_id() != '') {			$qry  = "UPDATE ".TBL_ALERTS.RET."SET".RET."			".ALERT_ID." = '".$this->getalert_id()."',".RET."			".ALERT_TABLE_ID." = '".$this->getalert_table_id()."',".RET."			".ALERT_SERVER." = '".$this->getalert_server()."',".RET."			".ALERT_CUSTOMER." = '".$this->getalert_customer()."',".RET."			".ALERT_POST_TYPE." = '".$this->getalert_post_type()."',".RET."			".ALERT_POST_ID." = '".$this->getalert_post_id()."',".RET."			".ALERT_PERSON." = '".$this->getalert_person()."',".RET."			".ALERT_PERSON_TYPE." = '".$this->getalert_person_type()."',".RET."			".ALERT_VIEWED_ON." = '".$this->getalert_viewed_on()."',".RET."			".ALERT_MSG." = '".$this->getalert_msg()."',".RET."			".ALERT_STATUS." = '".$this->getalert_status()."',".RET."			".ALERT_NOTIFY." = '".$this->getalert_notify()."',".RET."			".ALERT_FLG_NOW_LATER." = '".$this->getalert_flg_now_later()."',".RET."						".ALERT_START_DATE." = '".$this->getalert_start_date()."',".RET."			".ALERT_END_DATE." = '".$this->getalert_end_date()."'".RET.			"WHERE ".ALERT_ID." = ".$this->getalert_id().RET;			mysql_query($qry);		} else {			$qry  = "INSERT INTO ".TBL_ALERTS." (".RET.			"".ALERT_TABLE_ID.", ".ALERT_SERVER.", ".ALERT_CUSTOMER.", ".ALERT_POST_TYPE.", ".ALERT_POST_ID.", ".ALERT_VIEWED_ON.", ".ALERT_MSG.",".ALERT_STATUS.",".ALERT_NOTIFY.",".ALERT_FLG_NOW_LATER.",".ALERT_PERSON.",".ALERT_PERSON_TYPE.",".ALERT_IS_URGENT.", ".ALERT_START_DATE.", ".ALERT_END_DATE.", ".ALERT_RESTAURANT.RET.				") VALUES (".RET.			"'".$this->getalert_table_id()."',".RET.			"'".$this->getalert_server()."',".RET.						"'".$this->getalert_customer()."',".RET.			"'".$this->getalert_post_type()."',".RET.			"'".$this->getalert_post_id()."',".RET.			"'".$this->getalert_viewed_on()."',".RET.			"'".$this->getalert_msg()."',".RET.			"'".$this->getalert_status()."',".RET.			"'".$this->getalert_notify()."',".RET.			"'".$this->getalert_flg_now_later()."',".RET.			"'".$this->getalert_person()."',".RET.			"'".$this->getalert_person_type()."',".RET.			"'".$this->getalert_is_urgent()."',".RET.			"'".$this->getalert_start_date()."',".RET.			"'".$this->getalert_end_date()."',".RET.			"'".$_SESSION[SES_RESTAURANT]."'".RET.			")".RET;  			 			$res = mysql_query($qry);			$this->setalert_id(mysql_insert_id());		}	}//..End Insert	public static function delete($array = array()) {		$qry = "DELETE".RET."FROM ".TBL_ALERTS.RET;		$and = "WHERE".RET;		if($array[ALERT_ID] != "") {			$qry .= $and.ALERT_ID." = '".$array[ALERT_ID]."'".RET;			$and = "AND".RET;		}		if($array[ALERT_TABLE_ID] != "") {			$qry .= $and.ALERT_TABLE_ID." = '".$array[ALERT_TABLE_ID]."'".RET;			$and = "AND".RET;		}				if($array[ALERT_SERVER] != "") {			$qry .= $and.ALERT_SERVER." IN (".$array[ALERT_SERVER].")".RET;			$and = "AND".RET;		}			if($array[ALERT_CUSTOMER] != "") {			$qry .= $and.ALERT_CUSTOMER." = '".$array[ALERT_CUSTOMER]."'".RET;			$and = "AND".RET;		}		if($array[ALERT_POST_TYPE] != "") {			$qry .= $and.ALERT_POST_TYPE." = '".$array[ALERT_POST_TYPE]."'".RET;			$and = "AND".RET;		}		if($array[ALERT_POST_ID] != "") {			$qry .= $and.ALERT_POST_ID." = '".$array[ALERT_POST_ID]."'".RET;			$and = "AND".RET;		}		if($array[ALERT_VIEWED_ON] != "") {			$qry .= $and.ALERT_VIEWED_ON." = '".$array[ALERT_VIEWED_ON]."'".RET;			$and = "AND".RET;		}		if($array[ALERT_MSG] != "") {			$qry .= $and.ALERT_MSG." = '".$array[ALERT_MSG]."'".RET;			$and = "AND".RET;		}				if(is_not_empty($array[ALERT_PERSON])) {			$qry .= $and.ALERT_PERSON." = '".$array[ALERT_PERSON]."'".RET;			$and = "AND".RET;		}				if(is_not_empty($array[ALERT_PERSON_TYPE])) {			$qry .= $and.ALERT_PERSON." = '".$array[ALERT_PERSON]."'".RET;			$and = "AND".RET;		}		if($array[ALERT_START_DATE] != "") {			$qry .= $and.ALERT_START_DATE." = '".$array[ALERT_START_DATE]."'".RET;			$and = "AND".RET;		}		if($array[ALERT_END_DATE] != "") {			$qry .= $and.ALERT_END_DATE." = '".$array[ALERT_END_DATE]."'".RET;			$and = "AND".RET;		}				if(is_not_empty($array[ALERT_FLG_NOW_LATER])) {			$qry .= $and.ALERT_FLG_NOW_LATER." = '".$array[ALERT_FLG_NOW_LATER]."'".RET;			$and = "AND".RET;		}		$res = mysql_query($qry);		if($res){			return OPERATION_SUCCESS;		};		return OPERATION_FAIL;	}//..End Delete	public function isAlreadyThere($alert_table_id ,$alert_customer ,$alert_post_type ,$alert_post_id ,$alert_msg,$alert_person=0,$alert_status=0,$alert_notify=0) {		$unique_arr = array();			//$unique_arr[ALERT_ID]=$alert_id;			 $unique_arr[ALERT_TABLE_ID]= $alert_table_id;			//$unique_arr[ALERT_CUSTOMER]=$alert_customer;			 $unique_arr[ALERT_POST_TYPE]=$alert_post_type;			 $unique_arr[ALERT_POST_ID]=  $alert_post_id; 			 if(is_gt_zero_num($alert_status)){			 	$unique_arr[ALERT_STATUS]=  $alert_status;			 } 			 if(is_gt_zero_num($alert_notify)){			 				 	$unique_arr[ALERT_NOTIFY]=  $alert_notify;			 }			 $unique_arr[ALERT_PERSON] = $alert_person;			//$unique_arr[ALERT_VIEWED_ON]=$alert_viewed_on;			//$unique_arr[ALERT_MSG]=$alert_msg;			//$unique_arr[ALERT_START_DATE]=$alert_start_date;			//$unique_arr[ALERT_END_DATE]=$alert_end_date; 	  if(is_gt_zero_num($alert_status) && is_gt_zero_num($alert_notify)){				if(is_not_empty($unique_arr)){					return $this->readObject($unique_arr);				}		}		return false;	}//..isAlreadyThere		//..Removed condition of the mandatory table id ..we need that for	//..online order placing	public function create($alert_table_id ,$alert_customer ,$alert_post_type ,$alert_post_id ,$alert_msg,$alert_person=0,$alert_person_type=CUST_TYPE_LOGIN,$isViewed=0,$alert_status=0,$alert_notify=0,$alert_is_urgent=0,$alert_flg_now_later=0) {				if($this->isAlreadyThere($alert_table_id ,$alert_customer ,$alert_post_type ,$alert_post_id, $alert_msg,$alert_person,$alert_status,$alert_notify)){				return OPERATION_DUPLICATE;			}else{						 $this->setalert_id("");			$this->setalert_table_id($alert_table_id);			$this->setalert_customer($alert_customer);			$this->setalert_post_type($alert_post_type);			$this->setalert_post_id($alert_post_id); 			$this->setalert_msg($alert_msg);			$this->setalert_person($alert_person);			$this->setalert_status($alert_status);			$this->setalert_notify($alert_notify);						$this->setalert_flg_now_later($alert_flg_now_later);						$this->setalert_person_type($alert_person_type);			$this->setalert_is_urgent($alert_is_urgent);			$this->setalert_start_date(date(DATE_FORMAT));			if(is_gt_zero_num($isViewed)){				$this->setalert_viewed_on(date(DATE_FORMAT)); 			}			//..get defualt employee and add to db2			if(is_gt_zero_num($alert_table_id)){				$alert_server=GetDfltTblEmployee($alert_table_id);			}else{				$alert_server=NULL;			}			//echo "$alert_server,$alert_table_id";			//exit;			$this->setalert_server($alert_server);			$this->insert(); 			return $this->getalert_id();    }	}//..create	/*public function create($alert_table_id ,$alert_customer ,$alert_post_type ,$alert_post_id ,$alert_msg,$alert_person=0,$alert_person_type=CUST_TYPE_LOGIN) {		if(is_not_empty($alert_table_id)){			if($this->isAlreadyThere($alert_table_id ,$alert_customer ,$alert_post_type ,$alert_post_id, $alert_msg,$alert_person)){				return OPERATION_DUPLICATE;			}else{				$this->setalert_id("");				$this->setalert_table_id($alert_table_id);				$this->setalert_customer($alert_customer);				$this->setalert_post_type($alert_post_type);				$this->setalert_post_id($alert_post_id); 				$this->setalert_msg($alert_msg);				$this->setalert_person($alert_person);				$this->setalert_person_type($alert_person_type);				$this->setalert_start_date(date(DATE_FORMAT));				//..get defualt employee and add to db2				if(is_gt_zero_num($alert_table_id)){					$alert_server=GetDfltTblEmployee($alert_table_id);				}else{					$alert_server=NULL;				}				//echo "$alert_server,$alert_table_id";				//exit;				$this->setalert_server($alert_server);				$this->insert();				return $this->getalert_id();			}		}		return OPERATION_FAIL;	}//..create*/	public function update($alert_id, $alert_table_id, $alert_customer, $alert_post_type, $alert_post_id, $alert_viewed_on, $alert_msg, $alert_start_date, $alert_end_date,$alert_flg_now_later=0) {		if(is_gt_zero_num($alert_id)){			if ($this->readObject(array(ALERT_ID=>$alert_id))){				$this->setalert_table_id($alert_table_id);				$this->setalert_customer($alert_customer);				$this->setalert_post_type($alert_post_type);				$this->setalert_post_id($alert_post_id);				$this->setalert_viewed_on($alert_viewed_on);				$this->setalert_flg_now_later($alert_flg_now_later);				$this->setalert_msg($alert_msg);				$this->insert();				return OPERATION_SUCCESS;			}		}		return OPERATION_FAIL;	}//..update	public function activate($alert_id){		if(is_gt_zero_num($alert_id)){			if ($this->readObject(array(ALERT_ID=>$alert_id))){				$qry  = "UPDATE ".TBL_ALERTS.RET."SET".RET."			".TBL_ALERTS_DEACTIVE_DATE." = '".date(EMPTY_DATE_FORMAT)."' WHERE ".ALERT_ID."={$alert_id}";				$res = mysql_query($qry);				if($res){					return 1;				}			}		}		return 0;	}//..end activate	public function deactivate($alert_id){		if(is_not_empty($alert_id)){			//if ($this->readObject(array(ALERT_ID=>$alert_id))){				$qry  = "UPDATE ".TBL_ALERTS.RET."SET".RET."			".TBL_ALERTS_DEACTIVE_DATE." = '".date(DATE_FORMAT)."' WHERE ".ALERT_ID." IN ({$alert_id})";				$res = mysql_query($qry);				if($res){					return 1;				}			//}		}		return 0;	}//..end deactivate			/**	* Remark the Alert as checked 	* @param integer $alert_id 	* @return boolean	*/	public function checkAlert($alert_id){		if(is_gt_zero_num($alert_id)){			if ($this->readObject(array(ALERT_ID=>$alert_id))){				return DB::ExecNonQry('UPDATE '.TBL_ALERTS.RET.'SET'.RET.' '.ALERT_IS_CHECKED.' = 1 WHERE '.ALERT_ID.'='.$alert_id); 			}		}		return 0;	}		/**	* Change the flag to now or later 	* @param integer $alert_id 	* @return boolean	*/	public function markAsNowLater($alert_id){		$chng_flag_sts=0;		if(is_gt_zero_num($alert_id)){			if ($this->readObject(array(ALERT_ID=>$alert_id))){				if($this->getalert_flg_now_later()==0)					$chng_flag_sts=1;				else					$chng_flag_sts=0;					return DB::ExecNonQry('UPDATE '.TBL_ALERTS.RET.'SET'.RET.' '.ALERT_FLG_NOW_LATER.' = '.$chng_flag_sts.' WHERE '.ALERT_ID.'='.$alert_id); 			}		}		return 0;	}	public static function GetInfo($alert_id) {		$info = array();		if($alert_id != ''){			$obj_tbl_alerts = new tbl_alerts();			if($obj_tbl_alerts->readObject(array('alert_id'=>$alert_id))){				$info['alert_id']=$obj_tbl_alerts->getalert_id();				$info['alert_table_id']=$obj_tbl_alerts->getalert_table_id();				$info['alert_customer']=$obj_tbl_alerts->getalert_customer();				$info['alert_post_type']=$obj_tbl_alerts->getalert_post_type();				$info['alert_post_id']=$obj_tbl_alerts->getalert_post_id();				$info['alert_viewed_on']=$obj_tbl_alerts->getalert_viewed_on();				$info['alert_msg']=$obj_tbl_alerts->getalert_msg();				$info['alert_status']=$obj_tbl_alerts->getalert_status();				$info['alert_notify']=$obj_tbl_alerts->getalert_notify();								$info['alert_flg_now_later']=$obj_tbl_alerts->getalert_flg_now_later();								$info['alert_person']=$obj_tbl_alerts->getalert_person();				$info['alert_person_type']=$obj_tbl_alerts->getalert_person_type();				$info['alert_is_urgent']=$obj_tbl_alerts->getalert_is_urgent();				$info['alert_start_date']=$obj_tbl_alerts->getalert_start_date();				$info['alert_end_date']=$obj_tbl_alerts->getalert_end_date();								$info['isActive'] = 0;				//..check deactive date is not set or 0				if((is_not_empty($obj_tbl_alerts->gettbl_alerts_deactive_date())==false)  || (is_gt_zero_num(strtotime($obj_tbl_alerts->gettbl_alerts_deactive_date()))== false)){					$info['isActive'] = 1;				}else{					//..check the deactive date is greater than todays date					if(strtotime($obj_tbl_alerts->gettbl_alerts_deactive_date()) > strtotime(date(DATE_FORMAT))){						$info['isActive'] = 1;					}				}			}		unset($obj_tbl_alerts);		return $info;		}	}//..End GetInfo	public static function GetFields($data){		global $tbl_alerts_active_condition;		$arr = array();		if(is_not_empty($data)){			$qry ="SELECT ".$data['key_field'].",".$data['value_field']." FROM ".TBL_ALERTS."";			if(is_gt_zero_num($data['isActive'])){				$qry .= " WHERE ".$tbl_alerts_active_condition;			}			$res = mysql_query($qry); 			if($res){				while($row=mysql_fetch_assoc($res)){					$arr[$row[$data['key_field']]] = $row[$data['value_field']];				}			}		}		return $arr;	}//.. End of GetFields			public static function isNewAlert($person=0,$person_type=CUST_TYPE_LOGIN,$table_id=0){ 		/*if(is_gt_zero_num($person)){*/			$qry =   'SELECT COUNT('.ALERT_ID.') FROM '.TBL_ALERTS." WHERE (".ALERT_VIEWED_ON.' IS NULL OR '.ALERT_VIEWED_ON.' = 0) AND DATE('.ALERT_START_DATE.')=CURDATE() AND '.ALERT_RESTAURANT.'='.$_SESSION[SES_RESTAURANT].(is_gt_zero_num($table_id) ? ' AND '.ALERT_TABLE_ID.'='.$table_id : ' AND '.ALERT_PERSON.'='.$person.'  AND '.ALERT_PERSON_TYPE.'=\''.$person_type.'\'');			//echo $qry;		/*}else{			$qry =   'SELECT COUNT('.ALERT_ID.') FROM '.TBL_ALERTS." WHERE (".ALERT_VIEWED_ON.' IS NULL OR '.ALERT_VIEWED_ON.' = 0) AND '.ALERT_PERSON.'=0 AND DATE('.ALERT_START_DATE.')=CURDATE() AND '.ALERT_PERSON_TYPE.'=\''.$person_type.'\'';		}*/		 				$res = mysql_query($qry);		if($res && mysql_num_rows($res)){			return mysql_result($res,0);		}				return 0;	} 	//...function to show the new alerts based on the table and alert type	public static function isNewAlert_tabletypebased($table_id=0,$alert_post_type=''){ 		global $Global_member,$sesslife;		$result_found=0;			$cust_type = CUST_TYPE_LOGIN;		if($sesslife){			$alert_person = $Global_member['member_id'];			if($Global_member['member_role_id']==ROLE_CUSTOMER || $Global_member['member_role_id']==ROLE_WAITER){				$alert_person = $Global_member['member_id'];			}else{				$alert_person = -($Global_member['member_role_id']);			}		}elseif(is_gt_zero_num($_SESSION[SES_COOKIE_UID])){			$alert_person = $_SESSION[SES_COOKIE_UID];			$cust_type = CUST_TYPE_COOKIE;		}			 		$search_array = array('isActive'=>1,ALERT_PERSON=>$alert_person,ALERT_PERSON_TYPE=>$cust_type,ALERT_RESTAURANT=>$_SESSION[SES_RESTAURANT],ALERT_POST_TYPE =>$alert_post_type,'search_isLiveOnly'=>1,ALERT_TABLE_ID=>$table_id);				$objtbl_alerts=new tbl_alerts();		$tbl_alertslist = $objtbl_alerts->readArray($search_array,$result_found,1);		unset($tbl_alertslist);		unset($objtbl_alerts);				return $result_found;			} 			public static function viewAlerts($alert_id = 0,$returnUpdated=0){		global $Global_member,$sesslife; 			$condition = '';		if(is_gt_zero_num($alert_id)){			$condition .= ' AND '.ALERT_ID.'='.$alert_id; 		}else{			 if($sesslife || is_gt_zero_num($_SESSION[SES_COOKIE_UID])){					/*if(in_array($Global_member['member_role_id'],array(ROLE_MANAGER,ROLE_ADMIN,ROLE_OWNER))){*/				 /*if($Global_member['member_role_id']==ROLE_MANAGER){				 	$condition .= ' AND '.ALERT_PERSON.'='.ALERT_FOR_MANGER;				 }elseif($Global_member['member_role_id']==ROLE_KITCHEN){				 	$condition .= ' AND '.ALERT_PERSON.'='.ALERT_FOR_KITCHEN;				 }elseif(is_gt_zero_num($_SESSION[SES_COOKIE_UID])){				 		$condition .= ' AND '.ALERT_PERSON.'='.$_SESSION[SES_COOKIE_UID].' AND '.ALERT_PERSON_TYPE.'=\''.CUST_TYPE_COOKIE.'\'';				 }else{				 	$condition .= ' AND '.ALERT_PERSON.'='.$Global_member['member_id'].' AND '.ALERT_PERSON_TYPE.'=\''.CUST_TYPE_LOGIN.'\'';				 }*/				 				 if(is_gt_zero_num($Global_member['member_id'])){				 	if($Global_member['member_role_id']==ROLE_CUSTOMER || $Global_member['member_role_id']==ROLE_WAITER){				 		$condition .= ' AND '.ALERT_PERSON.'='.$Global_member['member_id'];				 	}else{				 		$condition .= ' AND '.ALERT_PERSON.'='.-($Global_member['member_role_id']).'';				 	}				 }else{					 	if(is_gt_zero_num($_SESSION[SES_COOKIE_UID])){					 		$condition .= ' AND '.ALERT_PERSON.'='.$_SESSION[SES_COOKIE_UID].' AND '.ALERT_PERSON_TYPE.'=\''.CUST_TYPE_COOKIE.'\'';					 }else{					 		$condition .=' AND 0';					 }				 } 			}  		}		$arr = array();		if(is_gt_zero_num($returnUpdated)){			$return = DB::ExecScalarQry('SELECT GROUP_CONCAT('.ALERT_ID.') FROM '.TBL_ALERTS.' WHERE ('.ALERT_VIEWED_ON.' IS NULL OR '.ALERT_VIEWED_ON.' = 0) AND DATE('.ALERT_START_DATE.')=CURDATE() '.$condition.' AND '.ALERT_RESTAURANT.'='.$_SESSION[SES_RESTAURANT].';');		 $arr =	biz_explode(',',$return);		}  				$res =  DB::ExecNonQry('UPDATE '.TBL_ALERTS.' SET '.ALERT_VIEWED_ON.'=NOW() WHERE ('.ALERT_VIEWED_ON.' IS NULL OR '.ALERT_VIEWED_ON.' = 0) AND DATE('.ALERT_START_DATE.')=CURDATE() '.$condition.' AND '.ALERT_RESTAURANT.'='.$_SESSION[SES_RESTAURANT].';'); 		if(is_gt_zero_num($returnUpdated)==FALSE){			$arr = $res;		}		return $arr;	} 			public static function sendDelayNotificationForPost($post_ids=''){		$sql_cond = ''; 		//..get the all the max alert ids	/*	$sql_qry='SELECT MAX(`alert_id`) 							FROM `tbl_alerts` 							WHERE 							DATE_FORMAT(`alert_start_date`, \'%Y%m%d\' ) = DATE_FORMAT( NOW( ),\'%Y%m%d\') 							ORDER BY `alert_post_id`,`alert_post_type`';*/		//echo " 1. sql_qry=$sql_qry <br>"; 		//$max_alert_list = DB::ExecQry($sql_qry);		$sql_qry = 'SELECT alert_post_id,alert_post_type,alert_table_id,`alert_id`,alert_status,alert_notify FROM `tbl_alerts` WHERE DATE_FORMAT(`alert_start_date`, \'%Y%m%d\' ) = DATE_FORMAT( NOW( ),\'%Y%m%d\') ORDER BY  alert_id desc';	 		$todays_alerts = DB::ExecQry($sql_qry);	 	  $post_alert = array();		foreach($todays_alerts as $alert){							$nm = $alert['alert_post_type'] .'_'. $alert['alert_post_id']; 			  $last_status_id = self::getPostWiseCurrentStatus($alert['alert_post_id'], $alert['alert_post_type'], $alert['alert_table_id']);				/*echo $alert['alert_post_id'],'  ', $alert['alert_post_type'],':', $last_status_id ,' == ', $alert['alert_status'], '<br>';*/				if($last_status_id == $alert['alert_status']){				  if((!is_gt_zero_num($post_alert[$nm])) || ($post_alert[$nm] < $alert['id'])){  						$post_alert[$nm] = $alert['alert_id'];					  				  } 				}				  		}		 		//echo '<hr>';						  /* print_r($post_alert);exit;  */				//print_r($max_alert_list);		 		if(is_not_empty($post_alert)){			/*$max_alert_ids = array();*/			/*foreach($post_alert as $arr){				foreach($arr as $val){					$max_alert_ids[] = $val;				}			} */			$max_alert_ids = biz_implode(',',$post_alert);			 			/*if(is_not_empty($post_ids)){				$sql_cond = ' AND '.ALERT_ID.' in ('.$post_ids.')';			}else{				$sql_cond = ' AND '.ALERT_ID.' in ('.$max_alert_ids.')';			}*/			if(is_not_empty($max_alert_ids)){				$sql_cond = ' AND '.ALERT_ID.' in ('.$max_alert_ids.')';			}			/* echo $sql_cond;exit; */			//.. Now fetch the status deatils for the max alerts ids			 			if(is_not_empty($sql_cond)){				$sql_qry='SELECT 				*,TIME_TO_SEC( TIMEDIFF( NOW( ),`alert_start_date`)) `alert_diff`									FROM `tbl_alerts` 									INNER JOIN '.TBL_STATUSES.' 									ON '.ALERT_STATUS.'='.STATUS_ID.' 									LEFT OUTER JOIN '.TBL_NOTIFICATIONS.' 									ON '.ALERT_NOTIFY.' = '.NOTIFY_ID.' 									WHERE 1 '.$sql_cond;				//echo " 2. sql_qry=$sql_qry <br>";					/*echo $sql_qry;		*/						$curr_list = DB::ExecQry($sql_qry);				 		  						 if(is_not_empty($curr_list)){		 	 //..Fetch all the statuses for notifications having ondelay true			 	 $delayed_notification = tbl_notifications::readArray(array(NOTIFY_IS_DELAYED=>1));			 $delay_statuses = array();			 foreach($delayed_notification as $val){			 	 $delay_statuses[] = $val[NOTIFY_STATUS];			 }			 if(is_not_empty($delay_statuses)){			 		$delay_statuses=array_unique($delay_statuses);			 }			 //print_r($delay_statuses);			 //..If delayed statuses are there 			 if(is_not_empty($delay_statuses) && is_not_empty($delayed_notification)){ 			 	 //if(is_not_empty($delayed_notification)){				 	 //..get all the ids from the delayed status notification				 	 $delay_notify_list = array_keys($delayed_notification);				   /*print_r($curr_list);exit; */					 foreach($curr_list as $val){					 	//echo $val['alert_diff'] .">". $val[STATUS_EXP_TIME]." = ".$val[ALERT_NOTIFY];					 //	print_r($val);					 	//..check if alert status is in delayed status						if(in_array($val[ALERT_STATUS],$delay_statuses)){											//.check if alert notification is not in delayed notification						 	 if(!in_array($val[ALERT_NOTIFY],$delay_notify_list)){	 	 								//..check whether the expectation time is greater than								 if($val['alert_diff'] > $val[STATUS_EXP_TIME]){								 		//echo "i am finally in ..<hr>";										//echo $val[ALERT_TABLE_ID],$val[ALERT_CUSTOMER],$val[ALERT_POST_ID],$val[ALERT_POST_TYPE],$val[ALERT_PERSON],$val[ALERT_PERSON_TYPE],NULL,NULL,1;								 	  biz_send_status_notifications($val[ALERT_TABLE_ID],$val[ALERT_CUSTOMER],$val[ALERT_POST_ID],$val[ALERT_STATUS], $val[ALERT_SERVER],$val[ALERT_PERSON],$val[ALERT_PERSON_TYPE],NULL,1);  										/*echo 'xxx',$val[ALERT_TABLE_ID],$val[ALERT_CUSTOMER],$val[ALERT_POST_ID],$val[ALERT_STATUS], $val[ALERT_SERVER],$val[ALERT_PERSON],$val[ALERT_PERSON_TYPE],NULL,1,' <br>';*/									 /*biz_send_alert($val[ALERT_TABLE_ID],$val[ALERT_CUSTOMER],$val[ALERT_POST_ID],$msg,$person=0,$post_type=ALERT_MISC,$person_type=CUST_TYPE_LOGIN,$notify_type='',$send_flash_msg=0,$status=0,$notify=0,$is_urgent=0);*/								 } 							 }						 }					   					 }//...end foreach($curr_list as $val)					 			 	 			 } //.end if(is_not_empty($delay_statuses)){ 		 } //..end if(is_not_empty($curr_list)){				 		} 	 } 	 return $arr;		    }  private static function getPostWiseCurrentStatus($post_id,$post_type,$table_id){ 	 $ret = 0; 	 if(is_gt_zero_num($post_id) && is_not_empty($post_type)){	 	 switch($post_type){		 		case ALERT_SUB_ORDER:					$ret = tbl_sub_orders::getCurrentStatus($post_id);				break; 				case ALERT_PNDG_ORDER: 				case ALERT_ORDER : 				case ALERT_TMP_ORDER: 				case ALERT_ORD_CONFIRM_DELAY: 				case ALERT_CHK_OUT: 				case ALERT_CUPON_REQST: 				case ALERT_CNF_CUPON:					$ret = tbl_orders::getCurrentStatus($post_id);				break;				case ALERT_REQST : 				case ALERT_TMP_REQST : 				case ALERT_PNDG_REQST:					$ret = tbl_services_requests::getCurrentStatus($post_id);				break;				case ALERT_SUB_ORDER:					$ret = tbl_sub_orders::getCurrentStatus($post_id);				break; 				case ALERT_PNDG_CUPON:					$ret = 0;					break; 			  default:					$ret = tbl_table_status_link::GetLastTableStatus($table_id) ;				break;		 } 	 }	 return $ret;   }			}//..End tbl_alerts?>