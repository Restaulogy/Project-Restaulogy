<?phpinclude_once(dirname(dirname(__FILE__))."/init.php");include_once("header.php");$active_page = "tbl_landing_page";if(($sesslife==true) && ($Global_member['member_role_id'] == ROLE_ADMIN || $Global_member['member_role_id'] == ROLE_MANAGER) && (is_gt_zero_num($_SESSION[SES_RESTAURANT]))){$is_preview= get_input("is_preview",0);$lnd_pg_id= get_input("lnd_pg_id");$lnd_pg_restaurant= get_input("lnd_pg_restaurant");/*$lnd_pg_background= get_input("lnd_pg_background");$lnd_pg_menu= get_input("lnd_pg_menu");$lnd_pg_promotion= get_input("lnd_pg_promotion");$lnd_pg_loyalty= get_input("lnd_pg_loyalty");$lnd_pg_connect= get_input("lnd_pg_connect");$lnd_pg_reviews= get_input("lnd_pg_reviews");$lnd_pg_service_req= get_input("lnd_pg_service_req");*/$lnd_pg_background= '';$lnd_pg_menu= '';$lnd_pg_promotion= '';$lnd_pg_loyalty= '';$lnd_pg_connect= '';$lnd_pg_reviews= '';$lnd_pg_service_req= '';$lnd_pg_lbl_menu= get_input("lnd_pg_lbl_menu",'Menu');$lnd_pg_lbl_promotion= get_input("lnd_pg_lbl_promotion",'Promotions');$lnd_pg_lbl_loyalty= get_input("lnd_pg_lbl_loyalty",'Loyalty Rewards');$lnd_pg_lbl_connect= get_input("lnd_pg_lbl_connect",'Connect');$lnd_pg_lbl_reviews= get_input("lnd_pg_lbl_reviews",'Reviews');$lnd_pg_lbl_service_req= get_input("lnd_pg_lbl_service_req",'Request Service');$lnd_pg_lbl_font_color= get_input("lnd_pg_lbl_font_color",'FFFFFF');$lnd_pg_background_color= get_input("lnd_pg_background_color",'000');$lnd_pg_start_date= get_input("lnd_pg_start_date");$lnd_pg_end_date= get_input("lnd_pg_end_date");$action = strtoupper(get_input(ACTION_TITLE));$mode = strtoupper(get_input(MODE_TITLE,MODE_UPDATE));$offset = get_input(OFFSET_TITLE,OFFSET_VALUE);$limit =  get_input(LIMIT_TITLE,LIMIT_VALUE);$sort_on = get_input(SORT_ON,"lnd_pg_id");$sort_by=$new_sort="";biz_set_sorting_var($sort_by,$new_sort);$url = "{$website}/user/tbl_landing_page.php";$navigationURL = $url."?".SORT_ON."={$sort_on}&".SORT_BY."={$sort_by}";$isSuccess = "";//..delete particular image deleteif($action=='DELT_IMG' && is_gt_zero_num($lnd_pg_id)){	$del_fld= get_input("del_fld");	if(is_not_empty($del_fld)){		//..Delete previous file		tbl_landing_page::delete_if_prev_image($lnd_pg_id,$del_fld,PATHROOT.LAND_PG_UPLOAD_PATH);		//...Update the database		tbl_landing_page::delete_image_associated($lnd_pg_id,$del_fld);		$_SESSION[SES_FLASH_MSG] = '<div class="success">Selected image deleted successfully.</div>';		unset($action);	}else{		$_SESSION[SES_FLASH_MSG] = '<div class="success">Please select image to delete.</div>';	}}if(is_not_empty($action)){	//..Image save logic	$lnd_pg_background=tbl_landing_page::save_land_pg_images($_FILES,'lnd_pg_background',$lnd_pg_id,$action);	$lnd_pg_menu=tbl_landing_page::save_land_pg_images($_FILES,'lnd_pg_menu',$lnd_pg_id,$action);	$lnd_pg_promotion=tbl_landing_page::save_land_pg_images($_FILES,'lnd_pg_promotion',$lnd_pg_id,$action);	$lnd_pg_loyalty=tbl_landing_page::save_land_pg_images($_FILES,'lnd_pg_loyalty',$lnd_pg_id,$action);	$lnd_pg_connect=tbl_landing_page::save_land_pg_images($_FILES,'lnd_pg_connect',$lnd_pg_id,$action);	$lnd_pg_reviews=tbl_landing_page::save_land_pg_images($_FILES,'lnd_pg_reviews',$lnd_pg_id,$action);	$lnd_pg_service_req=tbl_landing_page::save_land_pg_images($_FILES,'lnd_pg_service_req',$lnd_pg_id,$action);}$objtbl_landing_page= new tbl_landing_page();if(is_not_empty($action)){	switch($action){		case ACTION_CREATE: 			$isSuccess = $objtbl_landing_page->create($lnd_pg_restaurant, $lnd_pg_background, $lnd_pg_menu, $lnd_pg_promotion, $lnd_pg_loyalty, $lnd_pg_connect, $lnd_pg_reviews, $lnd_pg_service_req,$lnd_pg_lbl_menu, $lnd_pg_lbl_promotion, $lnd_pg_lbl_loyalty, $lnd_pg_lbl_connect, $lnd_pg_lbl_reviews, $lnd_pg_lbl_service_req, $lnd_pg_lbl_font_color, $lnd_pg_start_date, $lnd_pg_end_date,$lnd_pg_background_color);			break;		case ACTION_UPDATE: 			$isSuccess = $objtbl_landing_page->update($lnd_pg_id, $lnd_pg_restaurant, $lnd_pg_background, $lnd_pg_menu, $lnd_pg_promotion, $lnd_pg_loyalty, $lnd_pg_connect, $lnd_pg_reviews, $lnd_pg_service_req,$lnd_pg_lbl_menu, $lnd_pg_lbl_promotion, $lnd_pg_lbl_loyalty, $lnd_pg_lbl_connect, $lnd_pg_lbl_reviews, $lnd_pg_lbl_service_req, $lnd_pg_lbl_font_color,  $lnd_pg_start_date, $lnd_pg_end_date,$lnd_pg_background_color);			break;		case ACTION_DELETE: 			$isSuccess = $objtbl_landing_page->delete(array(LND_PG_ID=>$lnd_pg_id));			break;		case ACTION_ACTIVATE: 			$isSuccess = $objtbl_landing_page->activate($lnd_pg_id);			break;		case ACTION_DEACTIVATE: 			$isSuccess = $objtbl_landing_page->deactivate($lnd_pg_id);			break;	}//..switch}//..ifif(is_not_empty($isSuccess)){	if(is_gt_zero_num($isSuccess)){		$err .= "<div class='info'>".$_lang['tbl_landing_page'][$action]['SUCCESS_MSG']."</div>";	}elseif($isSuccess == OPERATION_FAIL){		$err .= "<div class='error'>".$_lang['tbl_landing_page'][$action]['FAILURE_MSG']."</div>";	}elseif($isSuccess == OPERATION_DUPLICATE){		$err .= "<div class='error'>".$_lang['tbl_landing_page'][$action]['DUPLICATE_MSG']."</div>";	}}//..if	$result_found=0;	$tbl_landing_pagelist = $objtbl_landing_page->readArray(array(OFFSET_TITLE=>$offset,LIMIT_TITLE=>$limit,SORT_BY=>$sort_by,SORT_ON=>$sort_on),$result_found,1);	$allpageCount = 0;	$currentPage = 0;	$smarty->assign('pagination',biz_pagination(array("url"=>$navigationURL,LIMIT_TITLE=>$limit,OFFSET_TITLE=>$offset,"count"=>$result_found),$allpageCount,$currentPage));	$smarty->assign('allpageCount',$allpageCount);	$smarty->assign('currentPage',$currentPage);	$smarty->assign('tbl_landing_pagelist', $tbl_landing_pagelist);	$smarty->assign('result_found',$result_found);	$template = "tbl_landing_page/tbl_landing_page.tpl";		$breadcrumbs[] = array(				 	'link'=>$website.'/user/pref_mng_cntrols.php',					'title'=>$_lang['main']['pref_mng_cntrls']); 	$breadcrumbs[] = array(				 	'link'=>$website.'/user/tbl_landing_page.php',					'title'=>$_lang['tbl_landing_page']['title']);	if (is_not_empty($mode)){		//..&& is_gt_zero_num($lnd_pg_id)		if(($mode == MODE_VIEW || $mode==MODE_UPDATE)){			//..Steps to check if corrospodning record is present if not add newt_bell()			$tbl_landing_pageinfo=tbl_landing_page::GetInfo(0,$_SESSION[SES_RESTAURANT]);			if(is_not_empty($tbl_landing_pageinfo)==false){/*				$_new_insrt_id =$objtbl_landing_page->create($_SESSION[SES_RESTAURANT], '', '', '', '', '', '', '', $lnd_pg_lbl_menu, $lnd_pg_lbl_promotion, $lnd_pg_lbl_loyalty, $lnd_pg_lbl_connect, $lnd_pg_lbl_reviews, $lnd_pg_lbl_service_req, $lnd_pg_lbl_font_color,'', '');	*/				$_new_insrt_id =$objtbl_landing_page->create($_SESSION[SES_RESTAURANT], $lnd_pg_background, $lnd_pg_menu, $lnd_pg_promotion, $lnd_pg_loyalty, $lnd_pg_connect, $lnd_pg_reviews, $lnd_pg_service_req,$lnd_pg_lbl_menu, $lnd_pg_lbl_promotion, $lnd_pg_lbl_loyalty, $lnd_pg_lbl_connect, $lnd_pg_lbl_reviews, $lnd_pg_lbl_service_req, $lnd_pg_lbl_font_color, $lnd_pg_start_date, $lnd_pg_end_date,$lnd_pg_background_color);								$tbl_landing_pageinfo= tbl_landing_page::GetInfo($_new_insrt_id);			}						//print_r($tbl_landing_pageinfo);			$smarty->assign('tbl_landing_pageinfo',$tbl_landing_pageinfo);			if($mode==MODE_UPDATE){				$smarty->assign("isUpdate",1);			}			if($is_preview==1){				$template = "dashboard.tpl";			}else{				$template = "tbl_landing_page/view.tpl";			}								}elseif($mode == MODE_CREATE){			$template = "tbl_landing_page/create.tpl";		}}	$smarty->assign('page_url', $url);	$smarty->assign('navigationURL',$navigationURL);	$smarty->assign('new_sort',$new_sort);	$smarty->assign('active_page',$active_page);}else{	$_SESSION[SES_FLASH_MSG] = '<div class="success">Not authorized to access this page.</div>';	$template="index.tpl";}include_once("footer.php");?>