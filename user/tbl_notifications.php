<?phpinclude_once(dirname(dirname(__FILE__))."/init.php");include_once("header.php");$active_page = "tbl_notifications"; if($sesslife==true){ $notify_id= get_input("notify_id");$notify_name= get_input("notify_name");$notify_message= get_input("notify_message");$notify_status= get_input("notify_status",$_SESSION[SES_STATUS]);$notify_to_role= get_input("notify_to_role");$notify_is_urgent= get_input("notify_is_urgent");$notify_is_delayed= get_input("notify_is_delayed");$notify_type = get_input('notify_type','ALERT');$notify_restaurent= get_input("notify_restaurent");$notify_start_date= get_input("notify_start_date");$notify_end_date= get_input("notify_end_date");$sel_notify_id = get_input('sel_menu');$action = strtoupper(get_input(ACTION_TITLE));$mode = strtoupper(get_input(MODE_TITLE));$offset = get_input(OFFSET_TITLE,OFFSET_VALUE);$limit =  get_input(LIMIT_TITLE,LIMIT_VALUE);$sort_on = get_input(SORT_ON,"notify_id");$sort_by=$new_sort="";biz_set_sorting_var($sort_by,$new_sort);$url = "{$website}/user/tbl_notifications.php?notify_status={$notify_status}";$navigationURL = $url."?".SORT_ON."={$sort_on}&".SORT_BY."={$sort_by}";$isSuccess = "";if($sel_notify_id){ 		$sel_notify_ids = biz_implode(',',array_keys($sel_notify_id)); }    $objtbl_notifications= new tbl_notifications();if(is_gt_zero_num($notify_status)){	$_SESSION[SES_STATUS] = $notify_status;	//..fetch the status name and the event TYPE	$objtbl_statuses=new tbl_statuses();	$tbl_statusesinfo= $objtbl_statuses->GetInfo($notify_status);	unset($objtbl_statuses);}if(is_not_empty($action)){ 	switch($action){		case ACTION_CREATE: 		 if(is_not_empty($notify_to_role)){		 	 foreach($notify_to_role as $role){			 		$isSuccess = $objtbl_notifications->create($notify_name, $notify_message, $notify_status, $role, $notify_is_urgent, $notify_is_delayed,$notify_type);			 }		 }						break;		case ACTION_UPDATE: 		 if(is_not_empty($notify_to_role)){		 	 foreach($notify_to_role as $role){				$isSuccess = $objtbl_notifications->update($notify_id, $notify_name, $notify_message, $notify_status, $role, $notify_is_urgent, $notify_is_delayed, $notify_type);			}		 }			break;					case ACTION_DELETE: 			//$isSuccess = $objtbl_notifications->delete(array(NOTIFY_ID=>$notify_id));			if(is_not_empty($sel_notify_ids)){ 		 	 $isSuccess = $objtbl_notifications->delete(array(NOTIFY_ID=>$sel_notify_ids));		 }else{		 	 $isSuccess = $objtbl_notifications->delete(array(NOTIFY_ID=>$notify_id));		 }			break;					case ACTION_ACTIVATE: 			//$isSuccess = $objtbl_notifications->activate($notify_id);					if(is_not_empty($sel_notify_ids)){ 			 	 $isSuccess = $objtbl_notifications->activate($sel_notify_ids);			}else{			 	 $isSuccess = $objtbl_notifications->activate($notify_id);			}			break;					case ACTION_DEACTIVATE: 			//$isSuccess = $objtbl_notifications->deactivate($notify_id);			if(is_not_empty($sel_notify_ids)){ 			 	 $isSuccess = $objtbl_notifications->deactivate($sel_notify_ids);			}else{			 	 $isSuccess = $objtbl_notifications->deactivate($notify_id);			}			break;	}//..switch}//..ifif(is_not_empty($isSuccess)){	if(is_gt_zero_num($isSuccess)){		$_SESSION[SES_FLASH_MSG] = "<div class='success'>".$_lang['tbl_notifications'][$action]['SUCCESS_MSG']."</div>";	}elseif($isSuccess == OPERATION_FAIL){		$_SESSION[SES_FLASH_MSG] = "<div class='error'>".$_lang['tbl_notifications'][$action]['FAILURE_MSG']."</div>";	}elseif($isSuccess == OPERATION_DUPLICATE){		$_SESSION[SES_FLASH_MSG] =  "<div class='info'>".$_lang['tbl_notifications'][$action]['DUPLICATE_MSG']."</div>";	}}//..if	$result_found=0;	$tbl_notificationslist = $objtbl_notifications->readArray(array(NOTIFY_STATUS=>$notify_status,OFFSET_TITLE=>$offset,LIMIT_TITLE=>$limit,SORT_BY=>$sort_by,SORT_ON=>$sort_on),$result_found,1);	$allpageCount = 0;	$currentPage = 0;	$smarty->assign('pagination',biz_pagination(array("url"=>$navigationURL,LIMIT_TITLE=>$limit,OFFSET_TITLE=>$offset,"count"=>$result_found),$allpageCount,$currentPage));	$smarty->assign('allpageCount',$allpageCount);	$smarty->assign('currentPage',$currentPage);	$smarty->assign('tbl_notificationslist', $tbl_notificationslist);	$smarty->assign('result_found',$result_found);	$smarty->assign('notify_status',$notify_status);	$template = "tbl_notifications/grid.tpl";	$breadcrumbs[] = array(				 	'link'=>$website.'/user/pref_mng_cntrols.php',					'title'=>$_lang['main']['pref_mng_cntrls']);	$breadcrumbs[] = array(				 	'link'=>$website.'/user/tbl_statuses.php?status_event='.$tbl_statusesinfo['status_event'],					'title'=>$_lang['tbl_statuses']['title']);	$breadcrumbs[] = array(				 	'link'=>$website.'/user/tbl_notifications.php?notify_status='.$notify_status,					'title'=>$_lang['tbl_notifications']['title']);						if (is_not_empty($mode)){		if(($mode == MODE_VIEW || $mode==MODE_UPDATE) && is_gt_zero_num($notify_id)){			$tbl_notificationsinfo= $objtbl_notifications->GetInfo($notify_id);			$smarty->assign('tbl_notificationsinfo',$tbl_notificationsinfo);			if($mode==MODE_UPDATE){				$smarty->assign("isUpdate",1);			}			$template = "tbl_notifications/view.tpl";		}elseif($mode == MODE_CREATE){			$template = "tbl_notifications/create.tpl";		}	} 	  $member_roles=member_role::readArray(array('isActive'=>1,'no_developer'=>1));	$smarty->assign('member_roles',$member_roles); 	$smarty->assign('page_url', $url);	$smarty->assign('navigationURL',$navigationURL);	$smarty->assign('new_sort',$new_sort);	$smarty->assign('active_page',$active_page);	$smarty->assign('tbl_statusesinfo', $tbl_statusesinfo);	 }else{	$template="index.tpl";} include_once("footer.php");?>