<?phpinclude_once(dirname(dirname(__FILE__)).'/init.php');include_once('header.php');$active_page = 'tbl_transfer';if($sesslife==true){//..variables for the various transfer options $trans_type= get_input('trans_type','server');$transfer_now= get_input('transfer_now',0);$trans_id= get_input('trans_id');$emp_shift = get_input('emp_shift',0);$employee = get_input('employee');$emp_shift_table = get_input('emp_shift_table',0);/*$trans_table= get_input('trans_table');$trans_old_server= get_input('trans_old_server');$trans_new_server= get_input('trans_new_server');$trans_created_by= get_input('trans_created_by');*/$trans_time_from= get_input('trans_time_from');$trans_time_to= get_input('trans_time_to');/*$trans_start_date= get_input('trans_start_date');$trans_end_date= get_input('trans_end_date');*/$action = strtoupper(get_input(ACTION_TITLE));$mode = strtoupper(get_input(MODE_TITLE));$offset = get_input(OFFSET_TITLE,OFFSET_VALUE);$limit =  get_input(LIMIT_TITLE,LIMIT_VALUE);$sort_on = get_input(SORT_ON,'trans_id');$sort_by=$new_sort='';biz_set_sorting_var($sort_by,$new_sort);$url = $website.'/user/tbl_transfer.php';$navigationURL = $url.'?'.SORT_ON.'='.$sort_on.'&'.SORT_BY.'='.$sort_by;$isSuccess = '';$objtbl_transfer= new tbl_transfer();$objtbl_emp_shift_assignment= new tbl_emp_shift_assignment();$curr_shift=tbl_shift::getCurrentShift();  //..If form is posted logic goes hereif(is_gt_zero_num($transfer_now)){		//..first fetch all  $info = tbl_emp_shift_assignment::GetInfo($emp_shift); $tables = array();  if($info[EMP_SFT_EMPLOYEE] == $employee){ 	 //..do not transfer 	 $isSuccess = OPERATION_DUPLICATE; }else{ 		//..update the end time of last employee shift  		 	tbl_emp_shift_table::updtEndTimeofLstEmpSft($emp_shift,$trans_time_from,$emp_shift_table); 		if(is_gt_zero_num($emp_shift_table)){			$tables = $emp_shift_table;		}else{ 			$tables = $info[EMP_SFT_TABLES];		}				if($objtbl_emp_shift_assignment->readObject(array(EMP_SFT_DATE =>$info[EMP_SFT_DATE],EMP_SFT_SHIFT=>$info[EMP_SFT_SHIFT],EMP_SFT_EMPLOYEE=>$employee))){				$emp_shift_id = $objtbl_emp_shift_assignment->getemp_sft_id(); 		 		$isSuccess = tbl_emp_shift_table::bulk_insert($emp_shift_id,$tables,1,$trans_time_from); 			}else{				$isSuccess = $objtbl_emp_shift_assignment->create($employee,$info[EMP_SFT_SHIFT],$info[EMP_SFT_DATE], $tables,1,$trans_time_from);			}  }   $table_arr = biz_explode(',',$tables);   if(is_gt_zero_num($isSuccess)){	 foreach($table_arr as $table_id){	 	@tbl_services_requests::update_new_sever($table_id,$employee); 		@tbl_orders::update_new_sever($table_id,$employee);		@tbl_table_status_link::update_new_sever($table_id,$employee);	 }  	}     }  if(is_not_empty($isSuccess)){	if(is_gt_zero_num($isSuccess)){ 		 $_SESSION[SES_FLASH_MSG] = "<div class='success'>".$_lang[TBL_EMP_SHIFT_ASSIGNMENT]['TRANSFER']['SUCCESS_MSG']."</div>";	}elseif($isSuccess == OPERATION_FAIL){		 $_SESSION[SES_FLASH_MSG] = "<div class='error'>".$_lang[TBL_EMP_SHIFT_ASSIGNMENT]['TRANSFER']['FAILURE_MSG']."</div>";	}elseif($isSuccess == OPERATION_DUPLICATE){		 $_SESSION[SES_FLASH_MSG]= "<div class='info'>".$_lang[TBL_EMP_SHIFT_ASSIGNMENT]['TRANSFER']['DUPLICATE_MSG']."</div>";	}}//..if	$employeelist = GetShiftEmployees();	$tablelist = tbl_dining_table::GetActiveDiningTables();		$smarty->assign('employeelist',$employeelist);		$smarty->assign('tablelist',$tablelist);		$smarty->assign('emp_shift',$curr_shift);  $smarty->assign('emp_date',date('Y-m-d'));								$result_found=0;	if($trans_type=='server'){		//..first get the current shift tables and servers				//..fetch list of all shift employees	according time		$tbl_emp_shift_assignmentlist = $objtbl_emp_shift_assignment->readArray(array(EMP_SFT_DATE=>date('Y-m-d'),EMP_SFT_SHIFT=>$curr_shift,SES_RESTAURANT=>$_SESSION[SES_RESTAURANT]),$result_found,1,1); 		$template = 'tbl_transfer/serverwise.tpl';		$smarty->assign('tbl_emp_shift_assignmentlist',$tbl_emp_shift_assignmentlist); 		//print_r($tbl_emp_shift_assignmentlist);		//..get the table list,server list 		/*$tbl_tables=tbl_dining_table::readArray(array('is_active'=>1,TABLE_RESTAURANT=>$_SESSION[SES_RESTAURANT]));*/		 		//print_r($tbl_emp_shift_assignmentlist);	}elseif($trans_type=='table'){		//..fetch list of all shift employees	 		$tablewiselist = $objtbl_emp_shift_assignment->GetShiftEmployeeTablewise(array(),$result_found) ;  	  $smarty->assign('tablewiselist',$tablewiselist); 		$template = 'tbl_transfer/tablewise.tpl';	}elseif($trans_type=='list'){		$tbl_transferlist = $objtbl_transfer->readArray(array(OFFSET_TITLE=>$offset,LIMIT_TITLE=>$limit,SORT_BY=>$sort_by,SORT_ON=>$sort_on),$result_found,1);		$template = 'tbl_transfer/grid.tpl';	}		$allpageCount = 0;	$currentPage = 0;	$smarty->assign('pagination',biz_pagination(array('url'=>$navigationURL,LIMIT_TITLE=>$limit,OFFSET_TITLE=>$offset,'count'=>$result_found),$allpageCount,$currentPage));	$smarty->assign('allpageCount',$allpageCount);	$smarty->assign('currentPage',$currentPage);	$smarty->assign('tbl_transferlist', $tbl_transferlist);	$smarty->assign('result_found',$result_found);	//$template = 'tbl_transfer/grid.tpl';	if (is_not_empty($mode)){		if(($mode == MODE_VIEW || $mode==MODE_UPDATE) && is_gt_zero_num($trans_id)){			$tbl_transferinfo= $objtbl_transfer->GetInfo($trans_id);			$smarty->assign('tbl_transferinfo',$tbl_transferinfo);			if($mode==MODE_UPDATE){				$smarty->assign('isUpdate',1);			}			$template = 'tbl_transfer/view.tpl';		}elseif($mode == MODE_CREATE){			$template = 'tbl_transfer/create.tpl';		}	}	$smarty->assign('page_url', $url);	$smarty->assign('navigationURL',$navigationURL);	$smarty->assign('new_sort',$new_sort);	$smarty->assign('active_page',$active_page);	//..variables for the transfer options	$smarty->assign('trans_type',$trans_type); 	}else{	$template='index.tpl';}include_once('footer.php');?>