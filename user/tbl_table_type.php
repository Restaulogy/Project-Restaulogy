<?phpinclude_once(dirname(dirname(__FILE__)).'/init.php');include_once('header.php'); $tbl_type_id= get_input('tbl_type_id');$tbl_type_name= get_input('tbl_type_name');$tbl_type_description= get_input('tbl_type_description');$tbl_type_start_date= get_input('tbl_type_start_date');$tbl_type_enddate= get_input('tbl_type_enddate');$action = strtoupper(get_input('action'));$mode = strtoupper(get_input('mode'));$offset = get_input(OFFSET_TITLE,OFFSET_VALUE);$limit =  get_input(LIMIT_TITLE,LIMIT_VALUE);$url = $website.'/user/tbl_table_type.php';$isSuccess = '';$objtbl_table_type= new tbl_table_type();$_SESSION[SES_TABLE_TYPE] = 0;//..get list of selected items$sel_table_type= get_input('sel_table_type');$lst_sel_ids='';if(is_not_empty($sel_table_type)){		$lst_sel_ids=implode(',', array_keys($sel_table_type));}  if(is_not_empty($action)){	switch($action){		case 'CREATE': 			$isSuccess = $objtbl_table_type->create($tbl_type_name, $tbl_type_description, $tbl_type_start_date, $tbl_type_enddate);			break;		case 'UPDATE': 			$isSuccess = $objtbl_table_type->update($tbl_type_id, $tbl_type_name, $tbl_type_description, $tbl_type_start_date, $tbl_type_enddate);			break;		case 'DELETE':			 tbl_dining_table::readArray(array(TABLE_TYPE=>$lst_sel_ids),$cnt); 			 if(is_gt_zero_num($cnt)){			 					 	 $_SESSION[SES_FLASH_MSG] = '<div class="error">There are tables which are using this Table Type. So you cannot delete this Table Type.</div>';			 }else{				   if(is_not_empty($lst_sel_ids)){						$isSuccess = $objtbl_table_type->delete(array(TBL_TYPE_ID=>$lst_sel_ids));					}else{						$isSuccess = OPERATION_FAIL;				  } 			 }			   			/* */						break;		case 'ACTIVATE': 			$isSuccess = $objtbl_table_type->activate($tbl_type_id);			break;		case 'DEACTIVATE': 			$isSuccess = $objtbl_table_type->deactivate($tbl_type_id);			break;	}//..switch}//..ifif(is_not_empty($isSuccess)){	if(is_gt_zero_num($isSuccess)){		$_SESSION[SES_FLASH_MSG] = '<div class="info">'.$_lang['tbl_table_type'][$action]['SUCCESS_MSG'].'</div>';	}else{		$_SESSION[SES_FLASH_MSG] =  '<div class="error">'.$_lang['tbl_table_type'][$action]['FAILURE_MSG'].'</div>';	}}//..if      if(is_not_empty($action)){	switch($action){		case ACTION_ACTIVATE:		case ACTION_DEACTIVATE:		$mode = UPDATE;		break;	}} 	$result_found=0;	$tbl_table_typelist = $objtbl_table_type->readArray(array(TBL_TYPE_RESTARENT=>$_SESSION[SES_RESTAURANT],'offset'=>$offset,'limit'=>$limit),$result_found,1);	$smarty->assign('pagination',biz_pagination(array('url'=>$url,'limit'=>$limit,'offset'=>$offset,'count'=>$result_found)));	$smarty->assign('tbl_table_typelist', $tbl_table_typelist);	$smarty->assign('result_found',$result_found);	$template = 'tbl_table_type/tbl_table_type.tpl';		$breadcrumbs[] =  array(					 	'link'=>$website.'/user/pref_mng_cntrols.php',						'title'=>$_lang['main']['pref_mng_cntrls']);							$breadcrumbs[] =  array(					 	'link'=>$website.'/user/tbl_dining_table.php',						'title'=>$_lang['tbl_dining_table']['listing_title']); 	$breadcrumbs[] =  array(					 	'link'=>$url,						'title'=>$_lang['tbl_table_type']['listing_title']); 		if (is_not_empty($mode)){		if(($mode == 'VIEW' || $mode=='UPDATE') && is_gt_zero_num($tbl_type_id)){			$tbl_table_typeinfo= $objtbl_table_type->GetInfo($tbl_type_id);			if($tbl_table_typeinfo){				$breadcrumbs[] =  array(					 	'link'=>$url.'?'.MODE_TITLE.'='.$mode.'&tbl_type_id='.$tbl_table_typeinfo['tbl_type_id'],						'title'=>$tbl_table_typeinfo['tbl_type_name'].getModeSubTitle($mode)); 			}			$smarty->assign('tbl_table_typeinfo',$tbl_table_typeinfo);			/*if($mode=='UPDATE'){				$smarty->assign('isUpdate',1);			}*/			$smarty->assign('isUpdate',1);			$template = 'tbl_table_type/view.tpl';		}elseif($mode == 'NEW'){		$breadcrumbs[] =  array(					 	'link'=>$url.'?'.MODE_TITLE.'='.$mode.'&tbl_type_id='.$tbl_table_typeinfo['tbl_type_id'],						'title'=>$_lang['tbl_table_type']['create_title']); 			$template = 'tbl_table_type/create.tpl'; 		}}	$smarty->assign('page_url', $url);include_once('footer.php');?>