<?phpinclude_once(dirname(dirname(__FILE__))."/init.php");include_once("header.php"); if($sesslife==true){$srvc_stg_id= get_input("srvc_stg_id");$srvc_stg_service_id= get_input("srvc_stg_service_id");$srvc_stg_name= get_input("srvc_stg_name");$srvc_stg_description= get_input("srvc_stg_description");$srvc_stg_thresh_hold_time= get_input("srvc_stg_thresh_hold_time");$srvc_stg_sort_order= get_input("srvc_stg_sort_order");$srvc_stg_start_time= get_input("srvc_stg_start_time");$srvc_stg_end_time= get_input("srvc_stg_end_time");$action = strtoupper(get_input(ACTION_TITLE));$mode = strtoupper(get_input(MODE_TITLE));$offset = get_input(OFFSET_TITLE,OFFSET_VALUE);$limit =  get_input(LIMIT_TITLE,LIMIT_VALUE);$url = "{$website}/user/tbl_service_stage.php?srvc_stg_service_id=$srvc_stg_service_id";//..get list of selected items$sel_tbl_service_stage= get_input("sel_tbl_service_stage");$lst_sel_ids='';if(is_not_empty($sel_tbl_service_stage)){		$lst_sel_ids=implode(',', array_keys($sel_tbl_service_stage));} $isSuccess = "";$objtbl_service_stage= new tbl_service_stage();if(is_not_empty($action)){	switch($action){		case ACTION_CREATE: 			$isSuccess = $objtbl_service_stage->create($srvc_stg_service_id, $srvc_stg_name, $srvc_stg_description, $srvc_stg_thresh_hold_time, $srvc_stg_sort_order, $srvc_stg_start_time, $srvc_stg_end_time);			break;		case ACTION_UPDATE: 			$isSuccess = $objtbl_service_stage->update($srvc_stg_id, $srvc_stg_service_id, $srvc_stg_name, $srvc_stg_description, $srvc_stg_thresh_hold_time, $srvc_stg_sort_order, $srvc_stg_start_time, $srvc_stg_end_time);			break;		case ACTION_DELETE:   			if(is_not_empty($lst_sel_ids)){				$isSuccess = $objtbl_service_stage->delete(array(SRVC_STG_ID=>$lst_sel_ids));			}else{				$_SESSION['disp_msg'] .= "<div class='error'>".$_lang['main']['select_ids']['empty']."</div>";			}						break;						case ACTION_ACTIVATE: 			$isSuccess = $objtbl_service_stage->activate($srvc_stg_id);			break;		case ACTION_DEACTIVATE: 			$isSuccess = $objtbl_service_stage->deactivate($srvc_stg_id);			break;	}//..switch}//..ifif(is_not_empty($isSuccess)){	if(is_gt_zero_num($isSuccess)){		$_SESSION['disp_msg'] .= "<div class='info'>".$_lang['tbl_service_stage'][$action]['SUCCESS_MSG']."</div>";	}elseif($isSuccess == OPERATION_FAIL){		$_SESSION['disp_msg'] .= "<div class='error'>".$_lang['tbl_service_stage'][$action]['FAILURE_MSG']."</div>";	}elseif($isSuccess == OPERATION_DUPLICATE){		$_SESSION['disp_msg'] .= "<div class='error'>".$_lang['tbl_service_stage'][$action]['DUPLICATE_MSG']."</div>";	}}//..ifif(is_not_empty($action)){	switch($action){		case ACTION_CREATE:  		case ACTION_UPDATE:  		case ACTION_DELETE:  		echo '<script type="text/javascript">window.location.href="'.$website.'/user/tbl_services_code.php?srvc_id='.$srvc_stg_service_id.'&'.MODE_TITLE.'='.MODE_UPDATE.'"</script>'; 	break;		case ACTION_ACTIVATE: 		case ACTION_DEACTIVATE: 		echo '<script type="text/javascript">window.location.href="'.$website.'/user/tbl_service_stage.php?srvc_stg_id='.$srvc_stg_id.'&'.MODE_TITLE.'='.MODE_UPDATE.'"</script>';		break;			}}	$result_found=0;	$tbl_service_stagelist = $objtbl_service_stage->readArray(array(SRVC_STG_SERVICE_ID=>$srvc_stg_service_id,OFFSET_TITLE=>$offset,LIMIT_TITLE=>$limit),$result_found,1);	//print_r($tbl_service_stagelist);	$smarty->assign('pagination',biz_pagination(array(SRVC_STG_SERVICE_ID=>$srvc_stg_service_id,"url"=>$url,LIMIT_TITLE=>$limit,OFFSET_TITLE=>$offset,"count"=>$result_found)));	    $obj_srvc_id = new tbl_services_code();	$service_info = $obj_srvc_id->GetInfo($srvc_stg_service_id);	$smarty->assign('service_info',$service_info);	$breadcrumbs[] = array("link"=>$website."/user/pref_mng_cntrols.php", "title"=>$_lang['main']['navbar']['controls']);	$breadcrumbs[] = array("link"=>$website."/user/tbl_services_code.php", "title"=>$_lang['tbl_services_code']['listing_title']);	if($service_info){		$breadcrumbs[] = array("link"=>$website."/user/tbl_services_code.php?srvc_id=".$service_info['srvc_id']."&mode=VIEW", "title"=>$service_info['srvc_name']);		}	/*$breadcrumbs[] = array("link"=>$url, "title"=>$_lang['tbl_service_stage']['listing_title']);	*/		$smarty->assign('srvc_stg_service_id',$srvc_stg_service_id);		$smarty->assign('tbl_service_stagelist', $tbl_service_stagelist);	$smarty->assign('result_found',$result_found);	$template = "tbl_service_stage/tbl_service_stage.tpl";	if (is_not_empty($mode)){		if(($mode == MODE_VIEW || $mode==MODE_UPDATE) && is_gt_zero_num($srvc_stg_id)){			$tbl_service_stageinfo= $objtbl_service_stage->GetInfo($srvc_stg_id);			if(is_not_empty($tbl_service_stageinfo)){   				$breadcrumbs[] = array("link"=>$url."?srvc_stg_id=".$tbl_service_stageinfo['srvc_stg_id']."&".MODE_TITLE."=".$mode, "title"=>$tbl_service_stageinfo['srvc_stg_name'].getModeSubTitle($mode));  }			$smarty->assign('tbl_service_stageinfo',$tbl_service_stageinfo);			/*if($mode==MODE_UPDATE){				$smarty->assign("isUpdate",1);			}*/			$smarty->assign("isUpdate",1);			$template = "tbl_service_stage/view.tpl";		}elseif($mode == MODE_CREATE){			$breadcrumbs[] = array("link"=>$url."&".MODE_TITLE."=".$mode, "title"=>$_lang['tbl_service_stage']['create_title']); 			$template = "tbl_service_stage/create.tpl";		}}			$smarty->assign('page_url', $url);}else{	$template="index.tpl";}include_once("footer.php");?>