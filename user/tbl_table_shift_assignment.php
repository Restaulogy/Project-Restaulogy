<?phpinclude_once(dirname(dirname(__FILE__)).'/init.php');include_once('header.php');$active_page = 'tbl_emp_shift_assignment';$emp_sft_id					= get_input('emp_sft_id'); $emp_sft_employee		= get_input('emp_sft_employee');$emp_sft_shift			= get_input('emp_sft_shift',1);$emp_sft_date				= get_input('emp_sft_date',date('Y-m-d'));$emp_sft_from_dt		= get_input('emp_sft_from_dt',$emp_sft_date);$emp_sft_to_dt			= get_input('emp_sft_to_dt',$emp_sft_date);$emp_sft_tables			= get_input('emp_sft_tables');$emp_sft_start_date	= get_input('emp_sft_start_date');$emp_sft_end_date		= get_input('emp_sft_end_date'); $from_date					= get_input('from_date',date('Y-m-d'));$to_date						= get_input('to_date',date('Y-m-d',strtotime('+7 day')));$week								= get_input('week',0);$month 							= get_input('month',0);//..variable for cancel employee shifts$emp_to_cancle_sft= get_input('emp_to_cancle_sft','');$employee = get_input('employee',0);$shift 		= get_input('shift',0);if(is_gt_zero_num($week)){	 $weekdays = biz_getWeekdays($week);	 $emp_sft_from_dt = $weekdays[0];	 $emp_sft_to_dt = $weekdays[6];  }elseif(is_gt_zero_num($month)){	 $monthdays = biz_getMonthdays($month);	 $emp_sft_from_dt = $monthdays[1];	 $emp_sft_to_dt = $monthdays[count($monthdays)];  } $_REQUEST['emp_sft_from_dt'] = $emp_sft_from_dt;$_REQUEST['emp_sft_to_dt'] = $emp_sft_to_dt;$action = strtoupper(get_input(ACTION_TITLE));$mode = strtoupper(get_input(MODE_TITLE));$offset = get_input(OFFSET_TITLE,OFFSET_VALUE);$limit =  get_input(LIMIT_TITLE,LIMIT_VALUE);$sort_on = get_input(SORT_ON,'emp_sft_id');$sort_by=$new_sort='';biz_set_sorting_var($sort_by,$new_sort);$url = $website.'/user/tbl_emp_shift_assignment.php';$navigationURL = $url.'?'.SORT_ON.'='.$sort_on.'&'.SORT_BY.'='.$sort_by;$isSuccess = '';if($sesslife==true && is_gt_zero_num($emp_sft_shift) && is_not_empty($emp_sft_date) ){$objtbl_emp_shift_assignment= new tbl_emp_shift_assignment();if(is_not_empty($action)){	switch($action){		case ACTION_CREATE: 			$isSuccess = $objtbl_emp_shift_assignment->create($emp_sft_employee, $emp_sft_shift, $emp_sft_date, $emp_sft_tables, $emp_sft_start_date, $emp_sft_end_date);			break;		case ACTION_UPDATE: 			$isSuccess = $objtbl_emp_shift_assignment->update($emp_sft_id, $emp_sft_employee, $emp_sft_shift, $emp_sft_date, $emp_sft_tables, $emp_sft_start_date, $emp_sft_end_date);			break;		case ACTION_DELETE: 			$isSuccess = $objtbl_emp_shift_assignment->delete(array(EMP_SFT_ID=>$emp_sft_id));			break;		case ACTION_ACTIVATE: 			$isSuccess = $objtbl_emp_shift_assignment->activate($emp_sft_id);			break;		case ACTION_DEACTIVATE: 			$isSuccess = $objtbl_emp_shift_assignment->deactivate($emp_sft_id);			break;					case 'CANCEL_SHIFT': 			if(is_not_empty($emp_to_cancle_sft))				$isSuccess = tbl_emp_shift_assignment::cancelShiftsAssigned($emp_to_cancle_sft);			else				$err .= '<div class="error">'.$_lang['tbl_emp_shift_assignment']['CANCEL']['EMP_REQD'].'</div>';				break;		}//..switch}//..ifif(is_not_empty($isSuccess)){	if(is_gt_zero_num($isSuccess)){		$_SESSION[SES_FLASH_MSG] = '<div class="success">'.$_lang['tbl_emp_shift_assignment'][$action]['SUCCESS_MSG'].'</div>';	}elseif($isSuccess == OPERATION_FAIL){		$_SESSION[SES_FLASH_MSG] =  '<div class="error">'.$_lang['tbl_emp_shift_assignment'][$action]['FAILURE_MSG'].'</div>';	}elseif($isSuccess == OPERATION_DUPLICATE){		$_SESSION[SES_FLASH_MSG] =  '<div class="info">'.$_lang['tbl_emp_shift_assignment'][$action]['DUPLICATE_MSG'].'</div>';	}}//..if	$result_found=0;	$tbl_emp_shift_assignmentlist = $objtbl_emp_shift_assignment->readArray(array(OFFSET_TITLE=>$offset,LIMIT_TITLE=>$limit,SORT_BY=>$sort_by,SORT_ON=>$sort_on,SES_RESTAURANT=>$_SESSION[SES_RESTAURANT]));		//print_r($tbl_emp_shift_assignmentlist);	$allpageCount = 0;	$currentPage = 0;	$smarty->assign('pagination',biz_pagination(array('url'=>$navigationURL,LIMIT_TITLE=>$limit,OFFSET_TITLE=>$offset,'count'=>$result_found),$allpageCount,$currentPage));	$smarty->assign('allpageCount',$allpageCount);	$smarty->assign('currentPage',$currentPage);	$smarty->assign('tbl_emp_shift_assignmentlist', $tbl_emp_shift_assignmentlist);	$smarty->assign('result_found',$result_found);	$template = 'tbl_emp_shift_assignment/tbl_emp_shift_assignment.tpl';	if (is_not_empty($mode)){		if(($mode == MODE_VIEW || $mode==MODE_UPDATE) && is_gt_zero_num($emp_sft_id)){			$tbl_emp_shift_assignmentinfo= $objtbl_emp_shift_assignment->GetInfo($emp_sft_id);			$smarty->assign('tbl_emp_shift_assignmentinfo',$tbl_emp_shift_assignmentinfo);			if($mode==MODE_UPDATE){				$smarty->assign('isUpdate',1);			}			$template = 'tbl_emp_shift_assignment/view.tpl';		}elseif($mode == MODE_CREATE){			$template = 'tbl_emp_shift_assignment/create.tpl'; 		}		}		$template = 'tbl_emp_shift_assignment/table_assign.tpl';				$breadcrumbs[] = array(				 	'link'=>$website.'/user/pref_mng_cntrols.php',					'title'=>$_lang['main']['pref_mng_cntrls']);		$breadcrumbs[] = array(				 	'link'=>$website.'/user/tbl_shift.php',					'title'=>$_lang['tbl_table_shift_assignment']['short_title']); 	 		/*$breadcrumbs[] = array(				 	'link'=>$website.'/user/tbl_table_shift_assignment.php',					'title'=>$_lang['tbl_emp_shift_assignment']['table_title']);*/		 if($mode==MODE_UPDATE){		 	$breadcrumbs[] = array(				 	'link'=>$website.'/user/tbl_table_shift_assignment.php?mode='.$mode,					'title'=>'Edit Schedule');		 }else{		 	$breadcrumbs[] = array(				 	'link'=>$website.'/user/tbl_table_shift_assignment.php',					'title'=>'View Schedule');		 }									$daywise_rpt=1;		//$daywise_rpt = tbl_shift_weekdays::getdayWiseShifts(date($from_date),date($to_date)); 			//..get all combobox/select box options listing 	$tbl_lst=tbl_dining_table::GetFields(array('key_field'=>TABLE_ID,'value_field'=>TABLE_NUMBER,'isActive'=>1)); 	$smarty->assign('tables',$tbl_lst);	//print_r($tbl_lst);	//$emp_lst=tbl_staff::GetActiveEmployees();	//$emp_lst=tbl_emp_shift_assignment::readArray(array(EMP_SFT_SHIFT=>$emp_sft_shift,EMP_SFT_DATE=>$emp_sft_date,'isActive'=>1));		$num_rws=0; 	$search_arr = array(SES_RESTAURANT=>$_SESSION[SES_RESTAURANT],'isActive'=>1,'emp_sft_from_dt'=>$emp_sft_from_dt,'emp_sft_to_dt'=>$emp_sft_to_dt,SORT_ON=>EMP_SFT_DATE,SORT_BY=>'Asc');	if(is_gt_zero_num($employee)){		$search_arr[EMP_SFT_EMPLOYEE] = $employee;	}	if(is_gt_zero_num($shift)){		$search_arr[EMP_SFT_SHIFT] = $shift;	}	$list_employee =tbl_emp_shift_assignment::readArray($search_arr); 	 	//..fetch the active shifts for that date	$rslt_fnd=0;	$search_arr = array('isActive'=>1,SHIFT_RESTAURENT=>$_SESSION[SES_RESTAURANT]);	if(is_gt_zero_num($shift)){		$search_arr[SHIFT_ID] = $shift;	}	$shift_lst=tbl_shift::readArray($search_arr,$rslt_fnd,1,1,$emp_sft_date); 	$emp_lst= array();	   foreach($list_employee as $key=>$lst){ 						$emp_lst[$lst[EMP_SFT_DATE]][$lst['emp_sft_employee']]['shift'][$lst['emp_sft_shift']]['tables_arr'] = $lst['tables_arr']; 			$emp_lst[$lst[EMP_SFT_DATE]][$lst['emp_sft_employee']]['shift'][$lst['emp_sft_shift']]['table_list'] = $lst['table_list']; 			$emp_lst[$lst[EMP_SFT_DATE]][$lst['emp_sft_employee']]['shift'][$lst['emp_sft_shift']]['emp_sft_id'] = $lst['emp_sft_id'];			$emp_lst[$lst[EMP_SFT_DATE]][$lst['emp_sft_employee']]['employee_name'] = $lst['employee_name'];			 			$emp_sft_ids = biz_explode(',',$emp_lst[$lst[EMP_SFT_DATE]][$lst['emp_sft_employee']]['emp_sft_ids']);			$emp_sft_ids[] = $lst['emp_sft_id'];			$emp_lst[$lst[EMP_SFT_DATE]][$lst['emp_sft_employee']]['emp_sft_ids'] = biz_implode(',',$emp_sft_ids); 		}	    			$smarty->assign('shifts',$shift_lst);	$smarty->assign('shifts_cnt',count($shift_lst));	$smarty->assign('shiftlist',tbl_shift::GetFields(array('key_field'=>SHIFT_ID,'value_field'=>SHIFT_NAME,'isActive'=>1)));  	$smarty->assign('employeelist',GetShiftEmployees());		$smarty->assign('tablelist', tbl_dining_table::GetActiveDiningTables());	$smarty->assign('emp_lst',$emp_lst); 	$smarty->assign('emp_sft_date',$emp_sft_date);	$smarty->assign('emp_sft_shift',$emp_sft_shift);     /*$smarty->assign('from_date',$from_date);    $smarty->assign('to_date',$to_date);*/ 		$smarty->assign('page_url', $url);	$smarty->assign('navigationURL',$navigationURL);	$smarty->assign('new_sort',$new_sort);	$smarty->assign('active_page',$active_page); }else{	$template='index.tpl';} include_once('footer.php');?>