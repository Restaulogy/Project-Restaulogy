<?phpinclude_once(dirname(dirname(__FILE__))."/init.php");include_once("header.php");$active_page = "tbl_discounts"; if($sesslife==true){ $discount_id= get_input("discount_id");$discount_name= get_input("discount_name");$discount_desc= get_input("discount_desc");$discount_percent= get_input("discount_percent");$discount_type= get_input("discount_type");$discount_start_date= get_input("discount_start_date");$discount_end_date= get_input("discount_end_date");$action = strtoupper(get_input(ACTION_TITLE));$mode = strtoupper(get_input(MODE_TITLE));$offset = get_input(OFFSET_TITLE,OFFSET_VALUE);$limit =  get_input(LIMIT_TITLE,LIMIT_VALUE);$sort_on = get_input(SORT_ON,"discount_id");$sort_by=$new_sort="";biz_set_sorting_var($sort_by,$new_sort);$url = "{$website}/user/tbl_discounts.php";$navigationURL = $url."?".SORT_ON."={$sort_on}&".SORT_BY."={$sort_by}";$isSuccess = "";$objtbl_discounts= new tbl_discounts();//..get list of selected items$sel_discounts= get_input("sel_discounts");$lst_sel_ids='';if(is_not_empty($sel_discounts)){		$lst_sel_ids=implode(',', array_keys($sel_discounts));} if(is_not_empty($action)){	switch($action){		case ACTION_CREATE: 			$isSuccess = $objtbl_discounts->create($discount_name, $discount_desc, $discount_percent,$discount_type, $discount_start_date, $discount_end_date);			break;		case ACTION_UPDATE: 			$isSuccess = $objtbl_discounts->update($discount_id, $discount_name, $discount_desc, $discount_percent,$discount_type, $discount_start_date, $discount_end_date);			break;		case ACTION_DELETE: 			//$isSuccess = $objtbl_discounts->delete(array(DISCOUNT_ID=>$discount_id));			//break;			if(is_not_empty($lst_sel_ids)){				$isSuccess = $objtbl_discounts->delete(array(DISCOUNT_ID=>$lst_sel_ids));			}else{				$isSuccess = OPERATION_FAIL;			}						break;		case ACTION_ACTIVATE: 			$isSuccess = $objtbl_discounts->activate($discount_id);			break;		case ACTION_DEACTIVATE: 			$isSuccess = $objtbl_discounts->deactivate($discount_id);			break;	}//..switch}//..ifif(is_not_empty($isSuccess)){	if(is_gt_zero_num($isSuccess)){		$_SESSION[SES_FLASH_MSG] .= "<div class='success'>".$_lang['tbl_discounts'][$action]['SUCCESS_MSG']."</div>";	}elseif($isSuccess == OPERATION_FAIL){		$_SESSION[SES_FLASH_MSG] .= "<div class='error'>".$_lang['tbl_discounts'][$action]['FAILURE_MSG']."</div>";	}elseif($isSuccess == OPERATION_DUPLICATE){		$_SESSION[SES_FLASH_MSG] .= "<div class='info'>".$_lang['tbl_discounts'][$action]['DUPLICATE_MSG']."</div>";	}}//..if	$result_found=0;	$tbl_discountslist = $objtbl_discounts->readArray(array(DISCOUNT_RESTAURENT=>$_SESSION[SES_RESTAURANT],OFFSET_TITLE=>$offset,LIMIT_TITLE=>$limit,SORT_BY=>$sort_by,SORT_ON=>$sort_on),$result_found,1);	$allpageCount = 0;	$currentPage = 0;	$smarty->assign('pagination',biz_pagination(array("url"=>$navigationURL,LIMIT_TITLE=>$limit,OFFSET_TITLE=>$offset,"count"=>$result_found),$allpageCount,$currentPage));	$smarty->assign('allpageCount',$allpageCount);	$smarty->assign('currentPage',$currentPage);	$smarty->assign('tbl_discountslist', $tbl_discountslist);	$smarty->assign('result_found',$result_found);	$template = "tbl_discounts/tbl_discounts.tpl";	$breadcrumbs[] = array(					 	'link'=>$website.'/user/pref_mng_cntrols.php',						'title'=>$_lang['main']['pref_mng_cntrls']);	$breadcrumbs[] = array(					 	'link'=>$url,						'title'=>$_lang['tbl_discounts']['listing_title']); 	if (is_not_empty($mode)){		if(($mode == MODE_VIEW || $mode==MODE_UPDATE) && is_gt_zero_num($discount_id)){			$tbl_discountsinfo= $objtbl_discounts->GetInfo($discount_id);			if(is_not_empty($tbl_discountsinfo)){				$breadcrumbs[] = array(					 	'link'=>$website.'/user/tbl_discounts.php?discount_id='.$discount_id,						'title'=>$tbl_discountsinfo['discount_name']);			}			$smarty->assign('tbl_discountsinfo',$tbl_discountsinfo);						if($mode==MODE_UPDATE){				$smarty->assign("isUpdate",1);			}			$template = "tbl_discounts/view.tpl";		}elseif($mode == MODE_CREATE){			$template = "tbl_discounts/create.tpl";			$breadcrumbs[] = array(					 	'link'=>$website.'/user/tbl_discounts.php?'.MODE_TITLE.'='.MODE_CREATE,						'title'=>$_lang['tbl_discounts']['create_title']);    }}	$smarty->assign('page_url', $url);	$smarty->assign('navigationURL',$navigationURL);	$smarty->assign('new_sort',$new_sort);	$smarty->assign('active_page',$active_page);	$smarty->assign('amount_types',GetAmountTypes()); }else{	$template="index.tpl";} include_once("footer.php");?>