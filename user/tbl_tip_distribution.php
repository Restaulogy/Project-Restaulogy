<?phpinclude_once(dirname(dirname(__FILE__)).'/init.php');include_once('header.php');$active_page = 'tbl_tip_distribution'; if($sesslife==true){ $tip_dis_id= get_input('tip_dis_id');$tip_dis_name= get_input('tip_dis_name');$tip_dis_total_amnt= get_input('tip_dis_total_amnt');$tip_dis_type= get_input('tip_dis_type');$tip_dis_shared_among= biz_implode(',',get_input('tip_dis_shared_among'));$tip_dis_period_from= get_input('tip_dis_period_from');$tip_dis_period_from= date(DATE_FORMAT,strtotime($tip_dis_period_from));$tip_dis_period_to= get_input('tip_dis_period_to');$tip_dis_period_to= date(DATE_FORMAT,strtotime($tip_dis_period_to));$tip_dis_is_paid= get_input('tip_dis_is_paid');$tip_dis_start_date= get_input('tip_dis_start_date');$tip_dis_end_date= get_input('tip_dis_end_date');$action = strtoupper(get_input(ACTION_TITLE));$mode = strtoupper(get_input(MODE_TITLE));$offset = get_input(OFFSET_TITLE,OFFSET_VALUE);$limit =  get_input(LIMIT_TITLE,LIMIT_VALUE);$sort_on = get_input(SORT_ON,'tip_dis_id');$sort_by=$new_sort='';biz_set_sorting_var($sort_by,$new_sort);$url = $website.'/user/tbl_tip_distribution.php';$navigationURL = $url.'?'.SORT_ON.'='.$sort_on.'&'.SORT_BY.'='.$sort_by;$isSuccess = '';$sel_tip_dis= get_input('sel_tip_dis');$lst_sel_ids='';if(is_not_empty($sel_tip_dis)){		$lst_sel_ids=biz_implode(',', array_keys($sel_tip_dis));}  $objtbl_tip_distribution= new tbl_tip_distribution(); if(is_not_empty($action)){  	switch($action){				case ACTION_CREATE: 			$isSuccess = $objtbl_tip_distribution->create($tip_dis_name, $tip_dis_total_amnt, $tip_dis_type, $tip_dis_shared_among, $tip_dis_period_from, $tip_dis_period_to, $tip_dis_start_date, $tip_dis_end_date);			break;		case ACTION_UPDATE: 			$isSuccess = $objtbl_tip_distribution->update($tip_dis_id, $tip_dis_name, $tip_dis_total_amnt, $tip_dis_type, $tip_dis_shared_among, $tip_dis_period_from, $tip_dis_period_to, $tip_dis_start_date, $tip_dis_end_date,$tip_dis_is_paid);			break;		case ACTION_DELETE: 		if(is_not_empty($lst_sel_ids)){						$isSuccess = $objtbl_tip_distribution->delete(array(TIP_DIS_ID=>$lst_sel_ids));			$objtbl_tip_distribution->updateOrderTipDistribution($lst_sel_ids,1);		}else{			$isSuccess = $objtbl_tip_distribution->delete(array(TIP_DIS_ID=>$tip_dis_id));			$objtbl_tip_distribution->updateOrderTipDistribution($tip_dis_id,1);		}						case "MKPAID": 			$isSuccess = $objtbl_tip_distribution->mkpaid($tip_dis_id);;			break;		case "MKUNPAID": 			$isSuccess = $objtbl_tip_distribution->mkunpaid($tip_dis_id);;			break;					case ACTION_ACTIVATE: 		if(is_not_empty($lst_sel_ids)){			$isSuccess = $objtbl_tip_distribution->activate($lst_sel_ids);		}else{			$isSuccess = $objtbl_tip_distribution->activate($tip_dis_id);		}			break;		case ACTION_DEACTIVATE: 	  if(is_not_empty($lst_sel_ids)){			$isSuccess = $objtbl_tip_distribution->deactivate($lst_sel_ids);		}else{			$isSuccess = $objtbl_tip_distribution->deactivate($tip_dis_id);		}			break;	}//..switch}//..ifif(is_not_empty($isSuccess)){	if(is_gt_zero_num($isSuccess)){		$_SESSION[SES_FLASH_MSG] .= '<div class="success">'.$_lang['tbl_tip_distribution'][$action]['SUCCESS_MSG'].'</div>';	}elseif($isSuccess == OPERATION_FAIL){		$_SESSION[SES_FLASH_MSG] .=  '<div class="error">'.$_lang['tbl_tip_distribution'][$action]['FAILURE_MSG'].'</div>';	}elseif($isSuccess == OPERATION_DUPLICATE){		$_SESSION[SES_FLASH_MSG] .=  '<div class="info">'.$_lang['tbl_tip_distribution'][$action]['DUPLICATE_MSG'].'</div>';	}}//..if	$result_found=0;	$tbl_tip_distributionlist = $objtbl_tip_distribution->readArray(array(TIP_DIS_RESTAURENT => $_SESSION[SES_RESTAURANT],OFFSET_TITLE=>$offset,LIMIT_TITLE=>$limit,SORT_BY=>$sort_by,SORT_ON=>$sort_on),$result_found,1);	$allpageCount = 0;	$currentPage = 0;	$smarty->assign('pagination',biz_pagination(array('url'=>$navigationURL,LIMIT_TITLE=>$limit,OFFSET_TITLE=>$offset,'count'=>$result_found),$allpageCount,$currentPage));	$smarty->assign('allpageCount',$allpageCount);	$smarty->assign('currentPage',$currentPage);	$smarty->assign('tbl_tip_distributionlist', $tbl_tip_distributionlist);	$smarty->assign('result_found',$result_found);	$template = 'tbl_tip_distribution/tbl_tip_distribution.tpl';		$breadcrumbs[] =  array('link'=>$website.'/user/pref_mng_cntrols.php',						'title'=>$_lang['main']['pref_mng_cntrls']) ;	$breadcrumbs[] =  array('link'=>$website.'/user/tbl_tip_distribution.php',						'title'=>$_lang[TBL_TIP_DISTRIBUTION]['listing_title']) ;	if (is_not_empty($mode)){		if(($mode == MODE_VIEW || $mode==MODE_UPDATE) && is_gt_zero_num($tip_dis_id)){			$tbl_tip_distributioninfo= $objtbl_tip_distribution->GetInfo($tip_dis_id);			$breadcrumbs[] =  array('link'=>$website.'/user/tbl_tip_distribution.php?'.MODE_TITLE.'='.$mode.'&'.TIP_DIS_ID.'='.$tip_dis_id,					'title'=>$tbl_tip_distributioninfo[TIP_DIS_NAME]);			 			$smarty->assign('tbl_tip_distributioninfo',$tbl_tip_distributioninfo);			if($mode==MODE_UPDATE){				$smarty->assign('isUpdate',1);			}			$template = 'tbl_tip_distribution/view.tpl';		}elseif($mode == MODE_CREATE){				$breadcrumbs[] =  array('link'=>$website.'/user/tbl_tip_distribution.php?'.MODE_TITLE.'='.$mode,				'title'=>$_lang[TBL_TIP_DISTRIBUTION]['create_title']);			$template = 'tbl_tip_distribution/create.tpl'; 		}elseif($mode == MODE_REPORT){			$breadcrumbs[] =  array('link'=>$website.'/user/tbl_tip_distribution.php?'.MODE_TITLE.'='.$mode,				'title'=>$_lang[TBL_TIP_DISTRIBUTION]['report_title']);			$template = 'tbl_tip_distribution/report.tpl';		}} 	 	 //print_r($arr);	//$smarty->assign('reportlist',tbl_tip_distribution::report());	$smarty->assign('disttypelist',tbl_tip_distribution::enumDistributionType());	$smarty->assign('employeelist', tbl_staff::GetActiveEmployees());	$smarty->assign('page_url', $url);	$smarty->assign('navigationURL',$navigationURL);	$smarty->assign('new_sort',$new_sort);	$smarty->assign('active_page',$active_page); }else{	$template='index.tpl';}  include_once('footer.php');?>