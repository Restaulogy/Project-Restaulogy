<?phpinclude_once(dirname(dirname(__FILE__)).'/init.php');include_once('header.php');//print_r($_REQUEST);//print_r($_SESSION);//..detect mobile$detect = new Mobile_Detect;$deviceType = ($detect->isMobile() ? ($detect->isTablet() ? 'tablet' : 'phone') : 'computer');$active_page = 'tbl_menu';//if($sesslife==true){$menu_id= get_input('menu_id', 0);$menu_name= get_input('menu_name');$menu_category= get_input('menu_category');$menu_display_order= get_input('menu_display_order',0);$menu_route= get_input('menu_route',5);$menu_ethor_cat_id= get_input('menu_ethor_cat_id','');$sbmnu_dish_id= get_input('sbmnu_dish_id');$is_preview= get_input('is_preview',0);$is_onlinestore= get_input('online_store',0); $scnd_online_store= get_input('scnd_online_store',0);$sel_menu = get_input('sel_menu');$menu_restaurent = get_input('menu_restaurent',$_SESSION[SES_RESTAURANT]);//..fields for searching$add_filter= get_input('add_filter',0);$cancel_filter= get_input('cancel_filter',0);$search_attrib= get_input('search_attrib',array());$search_keyword= get_input('search_keyword','');$search_price= get_input('search_price',0);$search_submenu= get_input('search_submenu',0);$search_allergy= get_input('search_allergy',array());//..following fields if order is totally new order or add items to order//..add it to sessionif(is_not_empty($_REQUEST['nor_tot_new_ord'])){	uset_nor_session();	$_SESSION['nor_tot_new_ord']=$_REQUEST['nor_tot_new_ord'];}if(is_not_empty($_REQUEST['nor_order_id']) && is_not_empty($_REQUEST['nor_table_id']) && is_not_empty($_REQUEST['nor_order_customer_name'])){	uset_nor_session();	$_SESSION['nor_order_id']=$_REQUEST['nor_order_id'];	$_SESSION['nor_table_id']=$_REQUEST['nor_table_id'];	$_SESSION['nor_order_customer_name']=$_REQUEST['nor_order_customer_name'];}$search_menu= get_input('search_menu',$menu_id);$web_redt= get_input('web_redt',0);//echo "search_submenu=$search_submenu";if(is_gt_zero_num($menu_id)==false){	unset($_SESSION['menu_filt']);}if(is_gt_zero_num($cancel_filter)){		unset($_SESSION['menu_filt']);	//$_SESSION[SES_FLASH_MSG] = '<div class="info">Filter successfully removed.</div>';}if(is_gt_zero_num($add_filter)){		$_SESSION['menu_filt']=tbl_submenu_dishes::_customer_filter_menu($search_attrib,$search_keyword,$search_price,$search_submenu,$search_allergy,$search_menu);	$_SESSION['menu_filt']['search_attrib']=$search_attrib;	$_SESSION['menu_filt']['search_keyword']=$search_keyword;		$_SESSION['menu_filt']['search_price']=$search_price;		$_SESSION['menu_filt']['search_submenu']=$search_submenu;	$_SESSION['menu_filt']['search_menu']=$search_menu;	$_SESSION['menu_filt']['search_allergy']=$search_allergy;	}//print_r($_SESSION['menu_filt']);if(is_gt_zero_num($menu_restaurent)){	$_SESSION[SES_RESTAURANT] = $menu_restaurent; //..Online store option//..If this is online customer if(is_gt_zero_num($is_onlinestore)){ 	$_SESSION = array();	$_SESSION[SES_ONLINE_STORE]= 1;	$_SESSION[SES_RESTAURANT] = $menu_restaurent;	//LogMeOut(0);		biz_script_forward($website.'/user/tbl_menu.php?scnd_online_store=1&menu_restaurent='.$menu_restaurent.'&is_preview=1');		if(isCustomer()){		//$_SESSION[SES_ONLINE_STORE]= 1;	}}if(is_gt_zero_num($scnd_online_store)){ 	$_SESSION[SES_ONLINE_STORE]= 1;	}if(is_gt_zero_num($_SESSION[SES_ONLINE_STORE])){	$_SESSION['qr_sess_expired']=0;	unset($_SESSION['qr_sess_expired']);}if(is_not_empty($_SESSION[SES_CART])){  if($Global_member['member_role_id'] == ROLE_ADMIN || $Global_member['member_role_id'] == ROLE_MANAGER){     //donothing  }else{    $is_preview = 1;  }}if(is_gt_zero_num($menu_id)){	$_SESSION[SES_MENU] = $menu_id;}//echo "is_preview=$is_preview|action=$action|mode=$mode";$mnu_wkdy_avail=array();//..default values for all days don't show'$mnu_wkdy_sunday=$mnu_wkdy_monday=$mnu_wkdy_tuesday=$mnu_wkdy_wednesday=$mnu_wkdy_thursday=$mnu_wkdy_friday=$mnu_wkdy_saturday='N';if(is_not_empty($_POST['mnu_wkdy_avail'])){	$mnu_wkdy_avail=$_POST['mnu_wkdy_avail']; 	//print_r($mnu_wkdy_avail);	//..capture the posted values in to the variables	foreach($mnu_wkdy_avail as $val){		switch (strtoupper($val)) {			case 'SUN':			   $mnu_wkdy_sunday='Y';			   			   break;			case 'MON':			   $mnu_wkdy_monday='Y';			   break;			case 'TUE':			   $mnu_wkdy_tuesday='Y';			   break;			case 'WED':			   $mnu_wkdy_wednesday='Y';			   break;			case 'THU':			   $mnu_wkdy_thursday='Y';			   break;			case 'FRI':			   $mnu_wkdy_friday='Y';			   break;			case 'SAT':			   $mnu_wkdy_saturday='Y';			   break;		}	}}$mnu_wkdy_sunday_start= get_input('mnu_wkdy_sunday_start');$mnu_wkdy_sunday_end= get_input('mnu_wkdy_sunday_end');$mnu_wkdy_monday_start= get_input('mnu_wkdy_monday_start');$mnu_wkdy_monday_end= get_input('mnu_wkdy_monday_end');$mnu_wkdy_tuesday_start= get_input('mnu_wkdy_tuesday_start');$mnu_wkdy_tuesday_end= get_input('mnu_wkdy_tuesday_end');$mnu_wkdy_wednesday_start= get_input('mnu_wkdy_wednesday_start');$mnu_wkdy_wednesday_end= get_input('mnu_wkdy_wednesday_end');$mnu_wkdy_thursday_start= get_input('mnu_wkdy_thursday_start');$mnu_wkdy_thursday_end= get_input('mnu_wkdy_thursday_end');$mnu_wkdy_friday_start= get_input('mnu_wkdy_friday_start');$mnu_wkdy_friday_end= get_input('mnu_wkdy_friday_end');$mnu_wkdy_saturday_start= get_input('mnu_wkdy_saturday_start');$mnu_wkdy_saturday_end= get_input('mnu_wkdy_saturday_end');$menu_desc= get_input('menu_desc');$menu_start_timing= get_input('menu_start_timing');$menu_end_timing= get_input('menu_end_timing');$menu_start_date= get_input('menu_start_date');$menu_end_date= get_input('menu_end_date');$action = strtoupper(get_input(ACTION_TITLE));$mode = strtoupper(get_input(MODE_TITLE));$offset = get_input(OFFSET_TITLE,OFFSET_VALUE);$limit =  get_input(LIMIT_TITLE,LIMIT_VALUE);$sort_on = get_input(SORT_ON,'menu_display_order');//..Get the menu from the search submenuif(is_gt_zero_num($search_submenu)){		//..we need to show the submenu dishes when we search	$sub_mnu_details=tbl_sub_menu::GetInfo($search_submenu);	$menu_id=$sub_mnu_details[SUBMNU_MENU];	$_SESSION[SES_MENU] = $menu_id;	unset($sub_mnu_details);	$mode = MODE_VIEW;	$is_preview=1;}//..set session$_SESSION['mnu_sel']='menu';//..Image save logic//..$menu_image= get_input('menu_image');$menu_image='';if((isset($_FILES['menu_image'])) && (is_not_empty($_FILES['menu_image']['name']))){	$save_path=PATHROOT.MNU_IMG_UPLOAD_PATH;	$file_save_nm=time().'_'.$_FILES['menu_image']['name'];		//now save the new file	$sv_fl_rslt=SaveFile($_FILES,'menu_image',$save_path,$file_save_nm);	if($sv_fl_rslt==1){		$menu_image=$file_save_nm;				if($action==ACTION_UPDATE){			//..Delete previous file			tbl_menu::deletePrevMnuImg($menu_id,$save_path);		}		//..Everything OK database insert/update will ok from here	}else{				$err .= '<div class="info">'.$sv_fl_rslt.'</div>';	}		}$sort_by=$new_sort='';biz_set_sorting_var($sort_by,$new_sort);$url = $website.'/user/tbl_menu.php';$navigationURL = $url.'?'.SORT_ON.'='.$sort_on.'&'.SORT_BY.'='.$sort_by;$isSuccess = '';$objtbl_menu= new tbl_menu();$objtbl_mnu_weekdays= new tbl_mnu_weekdays();if($sel_menu){ 		$sel_menu_ids = biz_implode(',',array_keys($sel_menu)); } if(is_not_empty($action)){	 	switch($action){		case ACTION_CREATE: 			$isSuccess = $objtbl_menu->create(mysql_real_escape_string($menu_name), $menu_category, mysql_real_escape_string($menu_desc), $menu_image, $menu_start_timing, $menu_end_timing, $menu_restaurent,$menu_route,$menu_display_order,$menu_ethor_cat_id);			if($isSuccess>0)				$isSuccess =$objtbl_mnu_weekdays->create($isSuccess ,$mnu_wkdy_sunday ,$mnu_wkdy_monday ,$mnu_wkdy_tuesday ,$mnu_wkdy_wednesday ,$mnu_wkdy_thursday ,$mnu_wkdy_friday ,$mnu_wkdy_saturday,$mnu_wkdy_sunday_start, $mnu_wkdy_sunday_end, $mnu_wkdy_monday_start, $mnu_wkdy_monday_end, $mnu_wkdy_tuesday_start, $mnu_wkdy_tuesday_end, $mnu_wkdy_wednesday_start, $mnu_wkdy_wednesday_end, $mnu_wkdy_thursday_start, $mnu_wkdy_thursday_end, $mnu_wkdy_friday_start, $mnu_wkdy_friday_end, $mnu_wkdy_saturday_start, $mnu_wkdy_saturday_end);			break;		case ACTION_UPDATE: 			$isSuccess = $objtbl_menu->update($menu_id, mysql_real_escape_string($menu_name), $menu_category, mysql_real_escape_string($menu_desc), $menu_image, $menu_start_timing, $menu_end_timing, $menu_restaurent,$menu_route,$menu_display_order,$menu_ethor_cat_id);			//..First check if the weekday's record is associated with this menu 			$cor_weekDay_rec=$objtbl_mnu_weekdays->GetMenuInfo($menu_id);			if(is_not_empty($cor_weekDay_rec)){				//..record found update It				$isSuccess =$objtbl_mnu_weekdays->update($cor_weekDay_rec["mnu_wkdy_id"], $menu_id, $mnu_wkdy_sunday, $mnu_wkdy_monday, $mnu_wkdy_tuesday, $mnu_wkdy_wednesday, $mnu_wkdy_thursday, $mnu_wkdy_friday, $mnu_wkdy_saturday,$mnu_wkdy_sunday_start, $mnu_wkdy_sunday_end, $mnu_wkdy_monday_start, $mnu_wkdy_monday_end, $mnu_wkdy_tuesday_start, $mnu_wkdy_tuesday_end, $mnu_wkdy_wednesday_start, $mnu_wkdy_wednesday_end, $mnu_wkdy_thursday_start, $mnu_wkdy_thursday_end, $mnu_wkdy_friday_start, $mnu_wkdy_friday_end, $mnu_wkdy_saturday_start, $mnu_wkdy_saturday_end);			}else{				//..no record found insert into db				$isSuccess =$objtbl_mnu_weekdays->create($menu_id ,$mnu_wkdy_sunday ,$mnu_wkdy_monday ,$mnu_wkdy_tuesday ,$mnu_wkdy_wednesday ,$mnu_wkdy_thursday ,$mnu_wkdy_friday ,$mnu_wkdy_saturday,$mnu_wkdy_sunday_start, $mnu_wkdy_sunday_end, $mnu_wkdy_monday_start, $mnu_wkdy_monday_end, $mnu_wkdy_tuesday_start, $mnu_wkdy_tuesday_end, $mnu_wkdy_wednesday_start, $mnu_wkdy_wednesday_end, $mnu_wkdy_thursday_start, $mnu_wkdy_thursday_end, $mnu_wkdy_friday_start, $mnu_wkdy_friday_end, $mnu_wkdy_saturday_start, $mnu_wkdy_saturday_end);			}						break;		case ACTION_DELETE: 		 if(is_not_empty($sel_menu_ids)){ 		 	 $isSuccess = $objtbl_menu->delete(array(MENU_ID=>$sel_menu_ids));		 }else{		 	 $isSuccess = $objtbl_menu->delete(array(MENU_ID=>$menu_id));		 }						break;		case ACTION_ACTIVATE:			if(is_not_empty($sel_menu_ids)){ 			 $isSuccess = $objtbl_menu->activate($sel_menu_ids);		 }else{		 	 $isSuccess = $objtbl_menu->activate($menu_id);		 } 			 			break;		case ACTION_DEACTIVATE: 			if(is_not_empty($sel_menu_ids)){ 				$isSuccess = $objtbl_menu->deactivate($sel_menu_ids);		 }else{		 	 $isSuccess = $objtbl_menu->deactivate($menu_id);		 }  			break;	}//..switch}//..ifif(is_not_empty($isSuccess)){	if(is_gt_zero_num($isSuccess)){		$_SESSION[SES_FLASH_MSG] .= '<div class="success">'.$_lang['tbl_menu'][$action]['SUCCESS_MSG'].'</div>';	}elseif($isSuccess == OPERATION_FAIL){		$_SESSION[SES_FLASH_MSG] .=  '<div class="error">'.$_lang['tbl_menu'][$action]['FAILURE_MSG'].'</div>';	}elseif($isSuccess == OPERATION_DUPLICATE){		$_SESSION[SES_FLASH_MSG] .=  '<div class="info">'.$_lang['tbl_menu'][$action]['DUPLICATE_MSG'].'</div>';	}}//..if 	$result_found=0;	$mnu_filt_con=array(OFFSET_TITLE=>$offset,LIMIT_TITLE=>$limit,SORT_BY=>$sort_by,SORT_ON=>$sort_on,MENU_RESTAURENT=>$_SESSION[SES_RESTAURANT]);	if(($Global_member['member_role_id'] != ROLE_ADMIN && $Global_member['member_role_id'] != ROLE_MANAGER)|| ($is_preview==true)){				$mnu_filt_con['isActive']=1;		//..To show menu preview		if(is_not_empty($_SESSION['menu_filt']['menu'])){			$mnu_filt_con[MENU_ID]=$_SESSION['menu_filt']['menu'];						//$tbl_menulist = $objtbl_menu->readArray($mnu_filt_con,$result_found,1,1,1);			//$tbl_menulist = $objtbl_menu->readArray(array(MENU_ID => $_SESSION['menu_filt']['menu'],'isActive'=>1,OFFSET_TITLE=>$offset,LIMIT_TITLE=>$limit,SORT_BY=>$sort_by,SORT_ON=>$sort_on,MENU_RESTAURENT=>$_SESSION[SES_RESTAURANT]),$result_found,1,1,1);		}else{			//$tbl_menulist = $objtbl_menu->readArray(array('isActive'=>1,OFFSET_TITLE=>$offset,LIMIT_TITLE=>$limit,SORT_BY=>$sort_by,SORT_ON=>$sort_on,MENU_RESTAURENT=>$_SESSION[SES_RESTAURANT]),$result_found,1,1,1);		}		$tbl_menulist = $objtbl_menu->readArray($mnu_filt_con,$result_found,1,1,1);				//..if menu no menu available as per weekdays availability then show all		if(is_not_empty($tbl_menulist)==false){			$tbl_menulist = $objtbl_menu->readArray($mnu_filt_con,$result_found,1);		}			//print_r($mnu_filt_con);	}else{		//$tbl_menulist = $objtbl_menu->readArray(array(OFFSET_TITLE=>$offset,LIMIT_TITLE=>$limit,SORT_BY=>$sort_by,SORT_ON=>$sort_on,MENU_RESTAURENT=>$_SESSION[SES_RESTAURANT]),$result_found,1);			$tbl_menulist = $objtbl_menu->readArray($mnu_filt_con,$result_found,1);	}		$first_mnu_index = 0;	 	if(is_not_empty($tbl_menulist)){		$first_mnu_index = array_keys($tbl_menulist);			if(is_gt_zero_num($first_mnu_index[0])){			$first_mnu_index = $first_mnu_index[0];		} 	}		//..Logic to select the first default menu from the list when not selecetd  	if(isCustomer()){		$is_preview=1;	}	if((is_gt_zero_num($menu_id)==FALSE) && (is_not_empty($action)==FALSE) &&(is_not_empty($mode)==FALSE) && ($is_preview==1)){		$menu_id=$first_mnu_index;		$_SESSION[SES_MENU] = $menu_id;		$mode = MODE_VIEW;	}				//..Get all list of Menu Categories	$lst_mnu_cats = tbl_menu_category::GetFields(array('key_field' => 'mnu_cat_id','value_field' => 'mnu_cat_name' ));		//print_r($lst_mnu_cats);	$smarty->assign('lst_mnu_cats', $lst_mnu_cats);		//..menu routing methods	$lst_mnu_routes = array(ROLE_KITCHEN => 'KITCHEN',ROLE_BAR => 'BAR');	$smarty->assign('lst_mnu_routes', $lst_mnu_routes);	$allpageCount = 0;	$currentPage = 0;	$smarty->assign('pagination',biz_pagination(array('url'=>$navigationURL,LIMIT_TITLE=>$limit,OFFSET_TITLE=>$offset,'count'=>$result_found),$allpageCount,$currentPage));	$smarty->assign('allpageCount',$allpageCount);	$smarty->assign('currentPage',$currentPage);	$smarty->assign('tbl_menulist', $tbl_menulist);	$smarty->assign('first_mnu_index', $first_mnu_index);	$smarty->assign('result_found',$result_found);	//echo $Global_member['member_role_id'] ."==".ROLE_MANAGER;	if(($Global_member['member_role_id'] != ROLE_ADMIN && $Global_member['member_role_id'] != ROLE_MANAGER)|| ($is_preview==true)){		$template = 'tbl_menu/cust_list.tpl';		//$template = 'tbl_menu/cust_view.tpl';	}else{		$template = 'tbl_menu/tbl_menu.tpl';	}	//echo "template=$template";	//$template = "tbl_menu/grid.tpl";	switch($_SESSION['member_role_id']){	 case ROLE_ADMIN :   	 case ROLE_MANAGER :	 case ROLE_OWNER : 	 						$breadcrumbs[] = array(   							'link'=>$website.'/user/pref_mng_cntrols.php',						'title'=>$_lang['main']['pref_mng_cntrls']);							break;	 case ROLE_WAITER :    $breadcrumbs[] = array(   							'link'=>$website.'/user/dashboard.php',							'title'=>$_lang['main']['customer_nav_menu']['dashboard']							);														break;	/*		default :    $breadcrumbs[0] = array(   							'link'=>$website.'/user/dashboard.php',							'title'=>$_lang['main']['customer_nav_menu']['dashboard'] );					break;	*/							 	} 					$breadcrumbs[] = array(						 	'link'=>$url.'?web_redt='.$web_redt.'&is_preview='.$is_preview,							'title'=>$_lang['tbl_menu']['listing_title']); 								if (is_not_empty($mode)){			if(($mode == MODE_VIEW || $mode==MODE_UPDATE) && is_gt_zero_num($menu_id)){			$tbl_menuinfo= $objtbl_menu->GetInfo($menu_id);			//print_r($tbl_menuinfo);						if($tbl_menuinfo){				if(is_gt_zero_num($is_preview)){					$tmptitle =  $tbl_menuinfo['menu_name'];				}else{					$tmptitle =  $tbl_menuinfo['menu_name'].getModeSubTitle($mode);				}								$breadcrumbs[] = array( 'link'=>$url.'?web_redt='.$web_redt.'&mode='.MODE_VIEW.'&menu_id='.$menu_id.'&is_preview='.$is_preview,'title'=>$tmptitle);			} 						$smarty->assign('tbl_menuinfo',$tbl_menuinfo);									if($mode==MODE_UPDATE){				$smarty->assign("isUpdate",1);			}			//..Logic To show menu preview..get full menu details						$tbl_menu_full=array();			$fetch_arr = array(MENU_ID => $menu_id,OFFSET_TITLE=>$offset,LIMIT_TITLE=>$limit,SORT_BY=>$sort_by,SORT_ON=>$sort_on);						if(($Global_member['member_role_id'] != ROLE_ADMIN && $Global_member['member_role_id'] != ROLE_MANAGER )|| ($is_preview==1)){										$fetch_arr['isActive'] = 1;			 					$template = 'tbl_menu/cust_view.tpl';			}else{ 				/*$tbl_menu_full=$objtbl_menu->readArray(array(MENU_ID => $menu_id,OFFSET_TITLE=>$offset,LIMIT_TITLE=>$limit,SORT_BY=>$sort_by,SORT_ON=>$sort_on),$result_found,1,1);			*/					$template = 'tbl_menu/view.tpl';			}				$info = $objtbl_menu->readArray($fetch_arr,$result_found,1);																foreach($info as $mnu_value){					//..Add sub menus to menus					/*if(($Global_member['member_role_id'] != ROLE_ADMIN)|| ($is_preview==true)){						$sub_mnus=tbl_sub_menu::readArray(array(SUBMNU_MENU=>$mnu_value[MENU_ID]));							}else{							$sub_mnus=tbl_sub_menu::readArray(array(SUBMNU_MENU=>$mnu_value[MENU_ID],'isActive'=>1));					} */										if(is_not_empty($_SESSION['menu_filt']['sub_menu'])){						$sub_mnus=tbl_sub_menu::readArray(array(SUBMNU_ID =>$_SESSION['menu_filt']['sub_menu'] ,SUBMNU_MENU=>$mnu_value[MENU_ID],'isActive'=>1));					}else{						$sub_mnus=tbl_sub_menu::readArray(array(SUBMNU_MENU=>$mnu_value[MENU_ID],'isActive'=>1));					}						//..Each submenus add dishes					$y  = 0;										if(is_not_empty($sub_mnus)){						foreach($sub_mnus as $sbmnu_value){							//..Add dishes to sub menus											$sub_mnu_dishes[$y]=$sbmnu_value;							$submenu_dish_count = 0;							/*								if(($Global_member['member_role_id'] != ROLE_ADMIN)|| ($is_preview==true)){							$sub_mnu_dishes[$y]['dishes']=tbl_submenu_dishes::readArray(array(SBMNU_DISH_SUBMENU=>$sbmnu_value[SUBMNU_ID],'isActive'=>1),$submenu_dish_count,1,1);							}else{								$sub_mnu_dishes[$y]['dishes']=tbl_submenu_dishes::readArray(array(SBMNU_DISH_SUBMENU=>$sbmnu_value[SUBMNU_ID]),$submenu_dish_count,1,1);							}							*/														if(is_not_empty($_SESSION['menu_filt']['sub_menu_dish'])){								$sub_mnu_dishes[$y]['dishes']=tbl_submenu_dishes::readArray(array(SBMNU_DISH_ID=>$_SESSION['menu_filt']['sub_menu_dish'],SBMNU_DISH_SUBMENU=>$sbmnu_value[SUBMNU_ID],'isActive'=>1),$submenu_dish_count,1,1);							}else{								$sub_mnu_dishes[$y]['dishes']=tbl_submenu_dishes::readArray(array(SBMNU_DISH_SUBMENU=>$sbmnu_value[SUBMNU_ID],'isActive'=>1),$submenu_dish_count,1,1);							}											$sub_mnu_dishes[$y]['dishes_count'] = $submenu_dish_count;							$y++;						}						}					$tbl_menu_full=$mnu_value;					$tbl_menu_full['submenu']=$sub_mnu_dishes;						$x=$x+1;					}						 //print_r($tbl_menu_full['submenu']);			$smarty->assign('mnu_full_deatils', $tbl_menu_full);						}elseif($mode == MODE_CREATE){			$breadcrumbs[] = array( 'link'=>$url.'?mode='.$mode.'&is_preview='.$is_preview ,					'title'=>$_lang['tbl_menu']['create_title'] );								//..Get the max display order			$_mx_disply_ord=DB::ExecScalarQry('SELECT MAX(`'.MENU_DISPLAY_ORDER.'`) as mx_ord FROM `'.TBL_MENU.'` WHERE `'.MENU_RESTAURENT.'`='.$_SESSION[SES_RESTAURANT].';');	$smarty->assign('mx_disply_ord', ($_mx_disply_ord+1));						$template = 'tbl_menu/create.tpl';		}}	$smarty->assign('mnu_sel', 'menu');	$smarty->assign('page_url', $url);	$smarty->assign('navigationURL',$navigationURL);	$smarty->assign('new_sort',$new_sort);	$smarty->assign('active_page',$active_page);	$smarty->assign('is_preview',$is_preview);			$smarty->assign('web_redt',$web_redt);		//..for sub menu dish..add to cart	if(is_gt_zero_num($sbmnu_dish_id)){		$objtbl_submenu_dishes=new tbl_submenu_dishes();			$tbl_submenu_dishesinfo= $objtbl_submenu_dishes->GetInfo($sbmnu_dish_id);				 $dish_option_prices = tbl_sbmnu_dish_opt_price::getAllOptionValuePricesForDish($sbmnu_dish_id,$tbl_submenu_dishesinfo[SBMNU_DISH_DISH],$only_matched);			 $submenu_option_prices =   tbl_sbmnu_dish_opt_price::getAllOptionValuePricesForSubmenu($sbmnu_dish_id,$tbl_submenu_dishesinfo[SBMNU_DISH_SUBMENU],$only_matched);  		$tbl_submenu_dishesinfo['optionsPrice'] = array_merge($dish_option_prices,$submenu_option_prices);				unset($dish_option_prices);			unset($submenu_option_prices);			unset($objtbl_submenu_dishes);		$smarty->assign('sbmnu_dish_id', $sbmnu_dish_id); 		$smarty->assign('tbl_submenu_dishesinfo',$tbl_submenu_dishesinfo);	}		//..for filter	$lst_dish_attribs=tbl_dish_attrib::GetFields(array('key_field'=>DISH_ATTRIB_ID,'value_field'=>DISH_ATTRIB_NAME,'isActive'=>1));	$smarty->assign('lst_dish_attribs', $lst_dish_attribs);			$lst_allergies=tbl_allergy_list::GetFields(array('key_field'=>ALERGY_ID,'value_field'=>ALERGY_NAME,'isActive'=>1));	$smarty->assign('lst_allergies', $lst_allergies);		//..for filter	$lst_sub_menu=tbl_sub_menu::GetFields(array('key_field'=>SUBMNU_ID,'value_field'=>SUBMNU_NAME,'isActive'=>1));	$smarty->assign('lst_sub_menu', $lst_sub_menu);	if($deviceType!='phone'){		$deviceType='desktop';	}	$smarty->assign('deviceType',$deviceType);		 	/*$smarty->assign('search_attrib', $search_attrib);	$smarty->assign('search_keyword', $search_keyword);		$smarty->assign('search_price', $search_price);*/			}else{	$template='index.tpl';}					/*}else{	$template='index.tpl';}*/include_once('footer.php');?>