<?phpinclude_once(dirname(dirname(__FILE__)).'/init.php');include_once('header.php');if($sesslife==true){ $table_id= get_input('table_id');$table_number= get_input('table_number');$table_seating_capacity= get_input('table_seating_capacity');$table_type= get_input('table_type');$table_desciption= get_input('table_desciption');$table_restaurant= get_input('table_restaurant',$Global_member['restaurant']);$table_qr_code_link= get_input('table_qr_code_link');//..for layout$table_pos_x= get_input('table_pos_x',-1);$table_pos_y= get_input('table_pos_y',-1);$table_dwg_width= get_input('table_dwg_width',0);$table_dwg_height= get_input('table_dwg_height',0);$table_start_date= get_input('table_start_date');$table_end_date= get_input('table_end_date');$action = strtoupper(get_input('action'));$mode = strtoupper(get_input('mode'));$offset = get_input(OFFSET_TITLE,OFFSET_VALUE);$limit =  get_input(LIMIT_TITLE,LIMIT_VALUE);$url = $website.'/user/tbl_dining_table.php';//..get list of selected items$sel_tbl_dining_table= get_input("sel_tbl_dining_table");$lst_sel_ids='';if(is_not_empty($sel_tbl_dining_table)){		$lst_sel_ids=implode(',', array_keys($sel_tbl_dining_table));}$isSuccess = '';$objtbl_dining_table= new tbl_dining_table();$table_types = tbl_table_type::readArray(array(TBL_TYPE_RESTARENT=>$_SESSION[SES_RESTAURANT],'isActive'=>1));$smarty->assign('table_types',$table_types);if(is_not_empty($action)){	switch($action){		case 'CREATE': 			$isSuccess = $objtbl_dining_table->create($table_number, $table_seating_capacity, $table_type, $table_desciption, $table_restaurant, $table_qr_code_link, $table_start_date, $table_end_date,$table_pos_x,$table_pos_y,$table_dwg_width,$table_dwg_height);			break;		case 'UPDATE': 			$isSuccess = $objtbl_dining_table->update($table_id, $table_number, $table_seating_capacity, $table_type, $table_desciption, $table_restaurant, $table_qr_code_link, $table_start_date, $table_end_date, $table_end_date,$table_pos_x,$table_pos_y,$table_dwg_width,$table_dwg_height);			break;		case ACTION_DELETE: 			if(is_not_empty($lst_sel_ids)){				$isSuccess=$objtbl_dining_table->delete(array(TABLE_ID=>$lst_sel_ids));			}else{				$_SESSION[SES_FLASH_MSG] ='<div class="error">'.$_lang['main']['select_ids']['empty'].'</div>';			}						break;				case 'ACTIVATE': 			//$isSuccess = $objtbl_dining_table->activate($table_id);			if(is_not_empty($lst_sel_ids)){				$isSuccess=$objtbl_dining_table->activate($lst_sel_ids);			}else{				$isSuccess = $objtbl_dining_table->activate($table_id);			}				break;		case 'DEACTIVATE': 			//$isSuccess = $objtbl_dining_table->deactivate($table_id);			if(is_not_empty($lst_sel_ids)){				$isSuccess=$objtbl_dining_table->deactivate($lst_sel_ids);			}else{				$isSuccess = $objtbl_dining_table->deactivate($table_id);			}			break;	}//..switch}//..ifif(is_not_empty($isSuccess)){	if(is_gt_zero_num($isSuccess)){		//..for success save for craete and update crete new table drawing 		if($action=='CREATE' || $action=='UPDATE'){			$tbl_layouts=array();			$_tbl_details= $objtbl_dining_table->GetInfo($isSuccess);			if(is_not_empty($_tbl_details)){				//..Add the table layout skecch div						$tbl_layouts[$_tbl_details['table_id']] = table_layout::display($_tbl_details['table_seating_capacity'],0,$_tbl_details['table_number'],'tbl_layout_'.$_tbl_details['table_id']); 				$smarty->assign('tbl_layouts',$tbl_layouts);				}			unset($_tbl_details);						}		$_SESSION[SES_FLASH_MSG] = '<div class="success">'.$_lang['tbl_dining_table'][$action]['SUCCESS_MSG'].'</div>';	}elseif($isSuccess == OPERATION_FAIL){		$_SESSION[SES_FLASH_MSG] = '<div class="error">'.$_lang['tbl_dining_table'][$action]['FAILURE_MSG'].'</div>';	}elseif($isSuccess == OPERATION_DUPLICATE){		$_SESSION[SES_FLASH_MSG] = '<div class="info">'.$_lang['tbl_dining_table'][$action]['DUPLICATE_MSG'].'</div>';	}}//..if	$result_found=0;	$tbl_dining_tablelist = $objtbl_dining_table->readArray(array('offset'=>$offset,'limit'=>$limit,TABLE_RESTAURANT=>$_SESSION[SES_RESTAURANT]),$result_found,1);	$smarty->assign('pagination',biz_pagination(array('url'=>$url,'limit'=>$limit,'offset'=>$offset,'count'=>$result_found)));	$smarty->assign('tbl_dining_tablelist', $tbl_dining_tablelist);	$smarty->assign('result_found',$result_found);	$template = 'tbl_dining_table/tbl_dining_table.tpl';	$breadcrumbs[] = array(					 	'link'=>$website.'/user/pref_mng_cntrols.php',						'title'=>$_lang['main']['pref_mng_cntrls']);	$breadcrumbs[] = array(					 	'link'=>$url,						'title'=>$_lang['tbl_dining_table']['listing_title']); 	if (is_not_empty($mode)){		if(($mode == 'VIEW' || $mode=='UPDATE') && is_gt_zero_num($table_id)){			$tbl_dining_tableinfo= $objtbl_dining_table->GetInfo($table_id);			if($tbl_dining_tableinfo){				$breadcrumbs[] = array(					 	'link'=>$url.'?'.MODE_TITLE.'='.$mode.'&table_id='.$tbl_dining_tableinfo['table_id'],						'title'=>$tbl_dining_tableinfo['table_number'].getModeSubTitle($mode)); 							}			$smarty->assign('tbl_dining_tableinfo',$tbl_dining_tableinfo);			 if($mode=='UPDATE'){				$smarty->assign('isUpdate',1);			} 			$smarty->assign('isUpdate',1);			$template = 'tbl_dining_table/view.tpl';		}elseif($mode == 'NEW'){			$breadcrumbs[] = array(					 	'link'=>$url.'?'.MODE_TITLE.'='.$mode,						'title'=>$_lang['tbl_dining_table']['create_title']); 			$template = 'tbl_dining_table/create.tpl';		}}			$smarty->assign('page_url', $url);}else{ 	$template = 'index.tpl';}include_once('footer.php');?>