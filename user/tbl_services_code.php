<?phpinclude_once(dirname(dirname(__FILE__))."/init.php");include_once("header.php");if($sesslife==true){ $srvc_id= get_input("srvc_id");$srvc_name= get_input("srvc_name");$srvc_description= get_input("srvc_description");$srvc_by_restrnt_or_cust= get_input("srvc_by_restrnt_or_cust");$srvc_cat_id= get_input("srvc_cat_id");$srvc_attend_time_limit= get_input("srvc_attend_time_limit");$srvc_provide_time_limit= get_input("srvc_provide_time_limit");$srvc_start_date= get_input("srvc_start_date");$srvc_end_date= get_input("srvc_end_date");$action = strtoupper(get_input(ACTION_TITLE));$mode = strtoupper(get_input(MODE_TITLE));$offset = get_input(OFFSET_TITLE,OFFSET_VALUE);$limit =  get_input(LIMIT_TITLE,LIMIT_VALUE);//..get list of selected items$sel_services_code= get_input("sel_services_code");$lst_sel_ids='';if(is_not_empty($sel_services_code)){		$lst_sel_ids=implode(',', array_keys($sel_services_code));}//..Image save logic//..$srvc_img= get_input('menu_image');$srvc_img='';if((isset($_FILES['srvc_img'])) && (is_not_empty($_FILES['srvc_img']['name']))){	$save_path=PATHROOT.SRVC_IMG_UPLOAD_PATH;	$file_save_nm=time().'_'.$_FILES['srvc_img']['name'];		//now save the new file	$sv_fl_rslt=SaveFile($_FILES,'srvc_img',$save_path,$file_save_nm);	if($sv_fl_rslt==1){		$srvc_img=$file_save_nm;				if($action==ACTION_UPDATE){			//..Delete previous file			tbl_services_code::deletePrevSrvcImg($srvc_id,$save_path);		}		//..Everything OK database insert/update will ok from here	}else{				$err .= '<div class="info">'.$sv_fl_rslt.'</div>';	}		}$url = "{$website}/user/tbl_services_code.php";$isSuccess = "";$objtbl_services_code= new tbl_services_code();if(is_not_empty($action)){	switch($action){		case "CREATE": 			$isSuccess = $objtbl_services_code->create($srvc_name,$srvc_img,$srvc_cat_id, $srvc_description, $srvc_by_restrnt_or_cust, $srvc_attend_time_limit, $srvc_provide_time_limit, $srvc_start_date, $srvc_end_date);			break;		case "UPDATE": 			$isSuccess = $objtbl_services_code->update($srvc_id,$srvc_name,$srvc_img,$srvc_cat_id, $srvc_description, $srvc_by_restrnt_or_cust, $srvc_attend_time_limit, $srvc_provide_time_limit, $srvc_start_date, $srvc_end_date);			break;		case "DELETE": 			if(is_not_empty($lst_sel_ids)){				$isSuccess = $objtbl_services_code->delete(array(SRVC_ID=>$lst_sel_ids)); 			}else{				$err .= "<div class='error'>".$_lang['main']['select_ids']['empty']."</div>";			}						break;		case "ACTIVATE": 			if(is_not_empty($lst_sel_ids)){				$isSuccess = $objtbl_services_code->activate($lst_sel_ids);			}else{				$isSuccess = $objtbl_services_code->activate($srvc_id);			}			//$isSuccess = $objtbl_services_code->activate($srvc_id);			break;		case "DEACTIVATE": 			//$isSuccess = $objtbl_services_code->deactivate($srvc_id);			if(is_not_empty($lst_sel_ids)){				$isSuccess = $objtbl_services_code->deactivate($lst_sel_ids);			}else{				$isSuccess = $objtbl_services_code->deactivate($srvc_id);			}			break;	}//..switch}//..ifif(is_not_empty($isSuccess)){	 	if(is_gt_zero_num($isSuccess)){		$err .= "<div class='info'>".$_lang['tbl_services_code'][$action]['SUCCESS_MSG']."</div>";	}elseif($isSuccess == OPERATION_FAIL){		$err .= "<div class='error'>".$_lang['tbl_services_code'][$action]['FAILURE_MSG']."</div>";	}elseif($isSuccess == OPERATION_DUPLICATE){		$err .= "<div class='error'>".$_lang['tbl_services_code'][$action]['DUPLICATE_MSG']."</div>";	}}//..ifif(is_not_empty($action)){	switch($action){		CASE ACTION_DEACTIVATE:		CASE ACTION_ACTIVATE:		$mode	= MODE_UPDATE;		break;  	}	}	$result_found=0;	$tbl_services_codelist = $objtbl_services_code->readArray(array(SRVC_RESTAURENT=>$_SESSION[SES_RESTAURANT],"offset"=>$offset,"limit"=>$limit),$result_found,1);	$smarty->assign('pagination',biz_pagination(array("url"=>$url,"limit"=>$limit,"offset"=>$offset,"count"=>$result_found)));	$smarty->assign('tbl_services_codelist', $tbl_services_codelist);	$smarty->assign('result_found',$result_found);	$template = "tbl_services_code/tbl_services_code.tpl";	$breadcrumbs[] = array("link"=>$website."/user/pref_mng_cntrols.php", "title"=>$_lang['main']['navbar']['controls']);		$breadcrumbs[] = array("link"=>$url, "title"=>$_lang['tbl_services_code']['listing_title']);			if (is_not_empty($mode)){		if(($mode == "VIEW" || $mode=="UPDATE") && is_gt_zero_num($srvc_id)){			$tbl_services_codeinfo= $objtbl_services_code->GetInfo($srvc_id);			 			$objtble_service_category = new tbl_service_category();			$tbl_services_codeinfo['category'] = $objtble_service_category->GetInfo($tbl_services_codeinfo[SRVC_CAT_ID]);						unset($objtble_service_category); 			if(is_not_empty($tbl_services_codeinfo)){ 				$breadcrumbs[] = array("link"=>$url."?srvc_id=".$tbl_services_codeinfo['srvc_id']."&".MODE_TITLE."=".$mode, "title"=>$tbl_services_codeinfo['srvc_name'].getModeSubTitle($mode));  			}			$arr = array(); 			$arr[SRVC_DTL_SERVICE_CODE] = $srvc_id; 			$result_found = 0; 			$objservice_details = new tbl_services_details();			$service_detailinfo = $objservice_details->readArray($arr,$result_found,1);			unset($obj);			unset($arr);			$result_found = 0;  			$arr[SRVC_STG_SERVICE_ID] = $srvc_id; 			$tbl_service_stagelist = tbl_service_stage::readArray($arr,$result_found,1);						$smarty->assign('tbl_service_stagelist',$tbl_service_stagelist);			$smarty->assign('service_detailinfo',	$service_detailinfo);			$smarty->assign('tbl_services_codeinfo',$tbl_services_codeinfo);			/*if($mode=="UPDATE"){				$smarty->assign("isUpdate",1);			}*/			$smarty->assign("isUpdate",1);			$template = "tbl_services_code/view.tpl";		}elseif($mode == "NEW"){ 				$breadcrumbs[] = array("link"=>$url."?".MODE_TITLE."=".$mode, "title"=>$_lang['tbl_services_code']['create_title']); 			$template = "tbl_services_code/create.tpl";		}	}	$service_categories = tbl_service_category::readArray(array("isActive"=>1));	$smarty->assign('service_categories', $service_categories);	$smarty->assign('page_url', $url);}else{	$template = "index.tpl";}	include_once("footer.php");?>