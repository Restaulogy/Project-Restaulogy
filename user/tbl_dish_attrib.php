<?phpinclude_once(dirname(dirname(__FILE__))."/init.php");include_once("header.php");$active_page = "tbl_dish_attrib";/*if($sesslife==true){*/$dish_attrib_id= get_input("dish_attrib_id");$dish_attrib_name= get_input("dish_attrib_name");$dish_attrib_desc= get_input("dish_attrib_desc");//$dish_attrib_img= get_input("dish_attrib_img");$dish_attrib_start_date= get_input("dish_attrib_start_date");$dish_attrib_end_date= get_input("dish_attrib_end_date");$action = strtoupper(get_input(ACTION_TITLE));$mode = strtoupper(get_input(MODE_TITLE));$offset = get_input(OFFSET_TITLE,OFFSET_VALUE);$limit =  get_input(LIMIT_TITLE,LIMIT_VALUE);$sort_on = get_input(SORT_ON,"dish_attrib_id");$sel_tbl_dish_attrib = get_input('sel_dish_attrib');if($sel_tbl_dish_attrib){ 		$sel_tbl_dish_attrib_ids = biz_implode(',',array_keys($sel_tbl_dish_attrib)); }//..Image save logic//..$dish_attrib_img= get_input('dish_attrib_img');$dish_attrib_img='';if((isset($_FILES['dish_attrib_img'])) && (is_not_empty($_FILES['dish_attrib_img']['name']))){	$save_path=PATHROOT.DISH_ATTRIB_IMG_UPLOAD_PATH;	$file_save_nm=time().'_'.$_FILES['dish_attrib_img']['name'];		//now save the new file	$sv_fl_rslt=SaveFile($_FILES,'dish_attrib_img',$save_path,$file_save_nm);	if($sv_fl_rslt==1){		$dish_attrib_img=$file_save_nm;				if($action==ACTION_UPDATE){			//..Delete previous file			tbl_dish_attrib::deletePrevDishAttribImg($dish_attrib_id,$save_path);		}		//..Everything OK database insert/update will ok from here	}else{				$err .= '<div class="info">'.$sv_fl_rslt.'</div>';	}		}$sort_by=$new_sort="";biz_set_sorting_var($sort_by,$new_sort);$url = "{$website}/user/tbl_dish_attrib.php";$navigationURL = $url."?".SORT_ON."={$sort_on}&".SORT_BY."={$sort_by}";$isSuccess = "";$objtbl_dish_attrib= new tbl_dish_attrib();if(is_not_empty($action)){	switch($action){		case ACTION_CREATE: 			$isSuccess = $objtbl_dish_attrib->create($dish_attrib_name, $dish_attrib_desc, $dish_attrib_img, $dish_attrib_start_date, $dish_attrib_end_date);			break;		case ACTION_UPDATE: 			$isSuccess = $objtbl_dish_attrib->update($dish_attrib_id, $dish_attrib_name, $dish_attrib_desc, $dish_attrib_img, $dish_attrib_start_date, $dish_attrib_end_date);			break;					case ACTION_DELETE: 		 if(is_not_empty($sel_tbl_dish_attrib_ids)){ 		 	 $isSuccess = $objtbl_dish_attrib->delete(array(DISH_ATTRIB_ID=>$sel_tbl_dish_attrib_ids));		 }else{		 	 $isSuccess = $objtbl_dish_attrib->delete(array(DISH_ATTRIB_ID=>$dish_attrib_id));		 }						break;		case ACTION_ACTIVATE:			if(is_not_empty($sel_tbl_dish_attrib_ids)){ 			 $isSuccess = $objtbl_dish_attrib->activate($sel_tbl_dish_attrib_ids);		 }else{		 	 $isSuccess = $objtbl_dish_attrib->activate($dish_attrib_id);		 } 			 			break;		case ACTION_DEACTIVATE: 			if(is_not_empty($sel_tbl_dish_attrib_ids)){ 				$isSuccess = $objtbl_dish_attrib->deactivate($sel_tbl_dish_attrib_ids);		 }else{		 	 $isSuccess = $objtbl_dish_attrib->deactivate($dish_attrib_id);		 }  			break;			/*case ACTION_DELETE: 			$isSuccess = $objtbl_dish_attrib->delete(array(DISH_ATTRIB_ID=>$dish_attrib_id));			break;		case ACTION_ACTIVATE: 			$isSuccess = $objtbl_dish_attrib->activate($dish_attrib_id);			break;		case ACTION_DEACTIVATE: 			$isSuccess = $objtbl_dish_attrib->deactivate($dish_attrib_id);			break;*/	}//..switch}//..ifif(is_not_empty($isSuccess)){	if(is_gt_zero_num($isSuccess)){		$err .= "<div class='info'>".$_lang['tbl_dish_attrib'][$action]['SUCCESS_MSG']."</div>";	}elseif($isSuccess == OPERATION_FAIL){		$err .= "<div class='error'>".$_lang['tbl_dish_attrib'][$action]['FAILURE_MSG']."</div>";	}elseif($isSuccess == OPERATION_DUPLICATE){		$err .= "<div class='error'>".$_lang['tbl_dish_attrib'][$action]['DUPLICATE_MSG']."</div>";	}}//..if	$result_found=0;	$tbl_dish_attriblist = $objtbl_dish_attrib->readArray(array(OFFSET_TITLE=>$offset,LIMIT_TITLE=>$limit,SORT_BY=>$sort_by,SORT_ON=>$sort_on),$result_found,1);	$allpageCount = 0;	$currentPage = 0;	$smarty->assign('pagination',biz_pagination(array("url"=>$navigationURL,LIMIT_TITLE=>$limit,OFFSET_TITLE=>$offset,"count"=>$result_found),$allpageCount,$currentPage));	$smarty->assign('allpageCount',$allpageCount);	$smarty->assign('currentPage',$currentPage);	$smarty->assign('tbl_dish_attriblist', $tbl_dish_attriblist);	$smarty->assign('result_found',$result_found);	$template = "tbl_dish_attrib/tbl_dish_attrib.tpl";		$breadcrumbs[] = array(				 	'link'=>$website.'/user/pref_mng_cntrols.php',					'title'=>$_lang['main']['pref_mng_cntrls']); 	$breadcrumbs[] = array(				 	'link'=>$website.'/user/tbl_dish_attrib.php',					'title'=>$_lang['tbl_dish_attrib']['title']);	if (is_not_empty($mode)){		if(($mode == MODE_VIEW || $mode==MODE_UPDATE) && is_gt_zero_num($dish_attrib_id)){			$tbl_dish_attribinfo= $objtbl_dish_attrib->GetInfo($dish_attrib_id);			$smarty->assign('tbl_dish_attribinfo',$tbl_dish_attribinfo);			if($mode==MODE_UPDATE){				$smarty->assign("isUpdate",1);			}			$template = "tbl_dish_attrib/view.tpl";		}elseif($mode == MODE_CREATE){			$template = "tbl_dish_attrib/create.tpl";					}}	$smarty->assign('page_url', $url);	$smarty->assign('navigationURL',$navigationURL);	$smarty->assign('new_sort',$new_sort);	$smarty->assign('active_page',$active_page);/*}else{	$template="index.tpl";}*/include_once("footer.php");?>