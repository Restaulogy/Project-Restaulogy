<?phpinclude_once(dirname(dirname(__FILE__))."/init.php");include_once("header.php");$active_page = "tbl_cust_favorites"; if(($sesslife==true) && ($Global_member['member_role_id'] == ROLE_CUSTOMER || $Global_member['member_role_id'] == ROLE_MANAGER)){ $cust_fav_id= get_input("cust_fav_id");$cust_fav_post_id= get_input("cust_fav_post_id");$cust_fav_post_type= get_input("cust_fav_post_type");$cust_fav_desc= get_input("cust_fav_desc");$cust_fav_user= get_input("cust_fav_user");$cust_fav_start_date= get_input("cust_fav_start_date");$cust_fav_end_date= get_input("cust_fav_end_date");$action = strtoupper(get_input(ACTION_TITLE));$mode = strtoupper(get_input(MODE_TITLE));$offset = get_input(OFFSET_TITLE,OFFSET_VALUE);$limit =  get_input(LIMIT_TITLE,LIMIT_VALUE);$flt_cust = get_input(FILTER_BY_CUST,'');$sort_on = get_input(SORT_ON,"cust_fav_id");$sort_by=$new_sort="";biz_set_sorting_var($sort_by,$new_sort);$url = "{$website}/user/tbl_cust_favorites.php";$navigationURL = $url."?".SORT_ON."={$sort_on}&".SORT_BY."={$sort_by}";$isSuccess = "";$objtbl_cust_favorites= new tbl_cust_favorites();//..get list of selected items$sel_cust_favorites= get_input("sel_cust_favorites");$lst_sel_ids='';if(is_not_empty($sel_cust_favorites)){		$lst_sel_ids=implode(',', array_keys($sel_cust_favorites));} if(is_not_empty($action)){	switch($action){		case ACTION_CREATE: 			$isSuccess = $objtbl_cust_favorites->create($cust_fav_post_id, $cust_fav_post_type, $cust_fav_desc, $cust_fav_user, $cust_fav_start_date, $cust_fav_end_date);			break;		case ACTION_UPDATE: 			$isSuccess = $objtbl_cust_favorites->update($cust_fav_id, $cust_fav_post_id, $cust_fav_post_type, $cust_fav_desc, $cust_fav_user, $cust_fav_start_date, $cust_fav_end_date);			break;		/*case ACTION_DELETE: 			$isSuccess = $objtbl_cust_favorites->delete(array(CUST_FAV_ID=>$cust_fav_id));			break;*/		case ACTION_DELETE:  				$isSuccess = OPERATION_FAIL;				$isSuccess = $objtbl_cust_favorites->delete(array(CUST_FAV_ID=>$lst_sel_ids));		break;   		case ACTION_ACTIVATE: 			$isSuccess = $objtbl_cust_favorites->activate($cust_fav_id);			break;		case ACTION_DEACTIVATE: 			$isSuccess = $objtbl_cust_favorites->deactivate($cust_fav_id);			break;	}//..switch}//..if if(is_not_empty($isSuccess)){	if(is_gt_zero_num($isSuccess)){		$_SESSION[SES_FLASH_MSG] = "<div class='success'>".$_lang['tbl_cust_favorites'][$action]['SUCCESS_MSG']."</div>";	}elseif($isSuccess == OPERATION_FAIL){		$_SESSION[SES_FLASH_MSG] =  "<div class='error'>".$_lang['tbl_cust_favorites'][$action]['FAILURE_MSG']."</div>";	}elseif($isSuccess == OPERATION_DUPLICATE){		$_SESSION[SES_FLASH_MSG] =  "<div class='info'>".$_lang['tbl_cust_favorites'][$action]['DUPLICATE_MSG']."</div>";	}}//..if	$result_found=0;		$search_array = array(OFFSET_TITLE=>$offset,LIMIT_TITLE=>$limit,SORT_BY=>$sort_by,SORT_ON=>$sort_on);		if($Global_member['member_role_id'] == ROLE_CUSTOMER){		$search_array[CUST_FAV_USER] = $Global_member['member_id'];	}elseif($Global_member['member_role_id'] == ROLE_MANAGER){		if(is_not_empty($flt_cust)){			$search_array['customer'] = $flt_cust;			$navigationURL .='&'.FILTER_BY_CUST.'='.$flt_cust;			$smarty->assign('flt_cust',$flt_cust);			$smarty->assign('tb_sts_lnk_tab','favorite');		} 	} 		$tbl_cust_favoriteslist = $objtbl_cust_favorites->readArray($search_array,$result_found,1);	$allpageCount = 0;	$currentPage = 0;	$smarty->assign('pagination',biz_pagination(array("url"=>$navigationURL,LIMIT_TITLE=>$limit,OFFSET_TITLE=>$offset,"count"=>$result_found),$allpageCount,$currentPage));	$smarty->assign('allpageCount',$allpageCount);	$smarty->assign('currentPage',$currentPage);	$smarty->assign('tbl_cust_favoriteslist', $tbl_cust_favoriteslist);	$smarty->assign('result_found',$result_found);	$template = "tbl_cust_favorites/grid.tpl";	if (is_not_empty($mode)){		if(($mode == MODE_VIEW || $mode==MODE_UPDATE) && is_gt_zero_num($cust_fav_id)){			$tbl_cust_favoritesinfo= $objtbl_cust_favorites->GetInfo($cust_fav_id);			$smarty->assign('tbl_cust_favoritesinfo',$tbl_cust_favoritesinfo);			if($mode==MODE_UPDATE){				$smarty->assign("isUpdate",1);			}			$template = "tbl_cust_favorites/view.tpl";		}elseif($mode == MODE_CREATE){			$template = "tbl_cust_favorites/create.tpl"; 		}		}  if($Global_member['member_role_id'] == ROLE_CUSTOMER){		$breadcrumbs[] = array(					 	'link'=>$url,						'title'=>$_lang['tbl_cust_favorites']['customer_title']); 	}elseif($Global_member['member_role_id'] == ROLE_MANAGER){		 		if(is_not_empty($flt_cust)){		$breadcrumbs[] = array(					 	'link'=>$url.'?'.FILTER_BY_CUST.'='.$flt_cust,						'title'=>'"'.strtoupper($flt_cust).'" - '.$_lang['tbl_cust_favorites']['title']); 	  }else{			$breadcrumbs[] = array(					 	'link'=>$url,						'title'=>$_lang['tbl_cust_favorites']['listing_title']);		}	}  				 	$smarty->assign('page_url', $url);	$smarty->assign('navigationURL',$navigationURL);	$smarty->assign('new_sort',$new_sort);	$smarty->assign('active_page',$active_page); }else{	$template="index.tpl";} include_once("footer.php");?>