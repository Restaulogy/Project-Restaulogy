<?phpinclude_once(dirname(dirname(__FILE__)).'/init.php');include_once('header.php');$active_page = 'tbl_alerts';tbl_alerts::sendDelayNotificationForPost(); if(($sesslife==true && (in_array($Global_member['member_role_id'],array(ROLE_ADMIN,ROLE_OWNER))==FALSE)) || is_gt_zero_num($_SESSION[SES_COOKIE_UID])){ $alert_id= get_input('alert_id');$alert_table_id= get_input('alert_table_id');$alert_customer= get_input('alert_customer');$alert_post_type= get_input('alert_post_type','');$alert_post_id= get_input('alert_post_id'); $alert_viewed_on= get_input('alert_viewed_on');$alert_msg= get_input('alert_msg');$alert_status= get_input('alert_status'); $alert_person= get_input('alert_person');$search_isLiveOnly= get_input('search_isLiveOnly',0);$search_table= get_input('search_table');$alert_flg_now_later= get_input('alert_flg_now_later',0);$alert_start_date= get_input('alert_start_date');$alert_end_date= get_input('alert_end_date');$action = strtoupper(get_input(ACTION_TITLE));$mode = strtoupper(get_input(MODE_TITLE));$offset = get_input(OFFSET_TITLE,OFFSET_VALUE);$limit =  get_input(LIMIT_TITLE,LIMIT_VALUE);$sort_on = get_input(SORT_ON,'alert_id'); $sort_by=$new_sort='';biz_set_sorting_var($sort_by,$new_sort,'DESC');//$sort_by = 'DESC';//..get list of selected items$sel_tbl_alerts= get_input('sel_tbl_alerts');$lst_sel_ids='';if(is_not_empty($sel_tbl_alerts)){		$lst_sel_ids=implode(',', array_keys($sel_tbl_alerts));}$url = $website.'/user/tbl_alerts.php?alert_post_type='.$alert_post_type;$navigationURL = $url."&".SORT_ON."={$sort_on}&".SORT_BY."={$sort_by}";$isSuccess = "";$objtbl_alerts= new tbl_alerts();if(is_not_empty($action)){	switch($action){		case ACTION_CREATE: 			$isSuccess = $objtbl_alerts->create($alert_table_id, $alert_customer, $alert_post_type, $alert_post_id, $alert_viewed_on, $alert_msg, $alert_person);			break;		case ACTION_UPDATE: 			$isSuccess = $objtbl_alerts->update($alert_id, $alert_table_id, $alert_customer, $alert_post_type, $alert_post_id, $alert_viewed_on, $alert_msg);			break;		case ACTION_DELETE: 			//$isSuccess = $objtbl_alerts->delete(array(ALERT_ID=>$alert_id));		   			if(is_not_empty($lst_sel_ids)){				$isSuccess = $objtbl_alerts->deactivate($lst_sel_ids);			}else{				$isSuccess = $objtbl_alerts->deactivate($alert_id);			}			break;		case ACTION_ACTIVATE: 			$isSuccess = $objtbl_alerts->activate($alert_id);			break;							case ACTION_DEACTIVATE:		  //$isSuccess = $objtbl_alerts->deactivate($alert_id); 			$isSuccess = $objtbl_alerts->checkAlert($alert_id);		  $isSuccess =  OPERATION_SUCCESS;			if($isSuccess){ 				/*if($alert_post_type == ALERT_PNDG_REQST){					if(isCustomer()){						biz_script_forward($website.'/user/tbl_services_requests.php?mode=view&srvc_reqst_id='.$alert_post_id,TRUE); 					}else{						//biz_script_forward($website.'/user/employee_requests.php') ;						biz_script_forward($website.'/user/tbl_services_requests.php?mode=view&srvc_reqst_id='.$alert_post_id,TRUE); 					}				}else*/				if(in_array( $alert_post_type, array(ALERT_PNDG_ORDER , ALERT_ORDER ,ALERT_TMP_ORDER, ALERT_ORD_CONFIRM_DELAY, ALERT_CHK_OUT, ALERT_CUPON_REQST,ALERT_CNF_CUPON,ALERT_SUB_ORDER))){ 				 if($alert_post_type == ALERT_SUB_ORDER){				 	 $subinfo =  tbl_sub_orders::GetInfo($alert_post_id);					 $alert_post_id = $subinfo[SUB_ORDER_ID]; 					 /*biz_script_forward($website.'/user/tbl_orders.php?mode=view&order_id='.$alert_post_id.'&sub_id='.$subinfo[SUB_ID].'&notify_id='.$alert_id,FALSE);*/ 					 biz_script_forward($website.'/user/tbl_orders.php?mode=view&order_id='.$alert_post_id,FALSE);				 }else{				 	biz_script_forward($website.'/user/tbl_orders.php?mode=view&order_id='.$alert_post_id.'&notify_id='.$alert_id,FALSE); 				 }									}elseif(in_array( $alert_post_type, array(ALERT_REQST,ALERT_TMP_REQST,ALERT_PNDG_REQST))){					biz_script_forward($website.'/user/tbl_services_requests.php?mode=view&srvc_reqst_id='.$alert_post_id.'&notify_id='.$alert_id,FALSE); 				}elseif(in_array($alert_post_type,array(ALERT_PNDG_CUPON))){					biz_script_forward($website.'/modules/business_listing/coupon_statistics.php',FALSE); 						}elseif(in_array($alert_post_type,array(REWARD_CUST))){					biz_script_forward($website.'/user/rewrad_point_list.php',FALSE); 						}else{ 					biz_script_forward($website.'/user/tbl_table_status_link.php?latestOnly=1'.'&notify_id='.$alert_id); 				}			}  			break; 					/*		case 'CHECK_VIEWED':			$isSuccess = $objtbl_alerts->viewAlerts($alert_id);		    if($isSuccess){				if($alert_post_type == ALERT_EXD_ORDER){					echo '<script type=\'text/javascript\'>window.location.href="'.$website.'/user/tbl_orders.php";</script>';				}else{					echo '<script type=\'text/javascript\'>window.location.href="'.$website.'/user/tbl_table_status_link.php?latestOnly=1";</script>'; 				}			} 			break; 		*/		}//..switch}//..ifif(is_not_empty($isSuccess)){	if(is_gt_zero_num($isSuccess)){		$_SESSION[SES_FLASH_MSG] = "<div class='success'>".$_lang['tbl_alerts'][$action]['SUCCESS_MSG']."</div>";	}elseif($isSuccess == OPERATION_FAIL){		$_SESSION[SES_FLASH_MSG] = "<div class='error'>".$_lang['tbl_alerts'][$action]['FAILURE_MSG']."</div>";	}elseif($isSuccess == OPERATION_DUPLICATE){		$_SESSION[SES_FLASH_MSG] = "<div class='info'>".$_lang['tbl_alerts'][$action]['DUPLICATE_MSG']."</div>";	}}//..if	$result_found=0;	 $cust_type = CUST_TYPE_LOGIN;	if($sesslife){		$alert_person = $Global_member['member_id'];	/*if(in_array($Global_member['member_role_id'],array(ROLE_MANAGER,ROLE_ADMIN,ROLE_OWNER))){*/	if($Global_member['member_role_id']==ROLE_CUSTOMER || $Global_member['member_role_id']==ROLE_WAITER){		$alert_person = $Global_member['member_id'];	}else{		$alert_person = -($Global_member['member_role_id']);	}	}elseif(is_gt_zero_num($_SESSION[SES_COOKIE_UID])){		$alert_person = $_SESSION[SES_COOKIE_UID];		$cust_type = CUST_TYPE_COOKIE;	}		 	$search_array = array(OFFSET_TITLE=>$offset,LIMIT_TITLE=>$limit,'isActive'=>1,SORT_BY=>$sort_by,SORT_ON=>$sort_on,ALERT_PERSON=>$alert_person,ALERT_PERSON_TYPE=>$cust_type,ALERT_RESTAURANT=>$_SESSION[SES_RESTAURANT],ALERT_POST_TYPE =>$alert_post_type);		//..SEARCH	if(is_gt_zero_num($search_isLiveOnly)){  	$search_array['search_isLiveOnly']= $search_isLiveOnly;  		$navigationURL .='&search_isLiveOnly='.$search_isLiveOnly;		$search_text .= "Live only |&nbsp;";  }		if(is_gt_zero_num($search_table)){  	$search_array[ALERT_TABLE_ID]= $search_table;  		$navigationURL .='&search_table='.$search_table;		$table_info=tbl_dining_table::GetInfo($search_table);		$search_text .= 'Table: '.$table_info['table_number'].'|&nbsp;';		  }			$tbl_alertslist = $objtbl_alerts->readArray($search_array,$result_found,1);	//print_r($tbl_alertslist);		//$tbl_alertslist = $objtbl_alerts->readArray(array(OFFSET_TITLE=>$offset,LIMIT_TITLE=>$limit,'isActive'=>1,SORT_BY=>$sort_by,SORT_ON=>$sort_on,ALERT_PERSON=>$alert_person,ALERT_PERSON_TYPE=>$cust_type,ALERT_RESTAURANT=>$_SESSION[SES_RESTAURANT],ALERT_POST_TYPE =>$alert_post_type),$result_found,1);		$newly_updated =  $objtbl_alerts->viewAlerts(0,1);	 	$allpageCount = 0;	$currentPage = 0;	$smarty->assign('pagination',biz_pagination(array('url'=>$navigationURL,LIMIT_TITLE=>$limit,OFFSET_TITLE=>$offset,'count'=>$result_found),$allpageCount,$currentPage));	$smarty->assign('allpageCount',$allpageCount);	$smarty->assign('currentPage',$currentPage);	$smarty->assign('tbl_alertslist', $tbl_alertslist);	$smarty->assign('result_found',$result_found);	$smarty->assign('newly_updated',$newly_updated);	$template = 'tbl_alerts/grid.tpl';		$breadcrumbs[] = array(					 	'link'=>$url,						'title'=>$_lang['tbl_alerts']['listing_title']); 	if (is_not_empty($mode)){		if(($mode == MODE_VIEW || $mode==MODE_UPDATE) && is_gt_zero_num($alert_id)){			$tbl_alertsinfo= $objtbl_alerts->GetInfo($alert_id);			$smarty->assign('tbl_alertsinfo',$tbl_alertsinfo);			if($mode==MODE_UPDATE){				$smarty->assign('isUpdate',1);			}			$template = 'tbl_alerts/view.tpl';		}elseif($mode == MODE_CREATE){			$template = 'tbl_alerts/create.tpl';		}}	//..Grid click link	$gr_clk_navigationURL=modify_navigattion_url($navigationURL);		$smarty->assign('gr_clk_navigationURL',$gr_clk_navigationURL);	$smarty->assign('page_url', $url);	$smarty->assign('navigationURL',$navigationURL);	$smarty->assign('new_sort',$new_sort);	$smarty->assign('active_page',$active_page);	//..tab selected	$smarty->assign('alert_post_type',$alert_post_type);	$smarty->assign('search_text',$search_text);		}else{	$template='index.tpl';} include_once('footer.php');?>