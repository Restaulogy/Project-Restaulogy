<?phpinclude_once(dirname(dirname(__FILE__))."/init.php");include_once("header.php");//..detect mobile$detect = new Mobile_Detect;$deviceType = ($detect->isMobile() ? ($detect->isTablet() ? 'tablet' : 'phone') : 'computer');$active_page = "tbl_qrcode_log";if($sesslife==true){$qrlog_id= get_input("qrlog_id");$qrlog_member_id= get_input("qrlog_member_id");$qrlog_tbl_id= get_input("qrlog_tbl_id");$qrlog_in_time= get_input("qrlog_in_time");$qrlog_out_time= get_input("qrlog_out_time");$action = strtoupper(get_input(ACTION_TITLE));$mode = strtoupper(get_input(MODE_TITLE));$offset = get_input(OFFSET_TITLE,OFFSET_VALUE);$limit =  get_input(LIMIT_TITLE,10);//LIMIT_VALUE$sort_on = get_input(SORT_ON,"qrlog_id");//..fields specific to the statistcs$rpt_to_show= get_input("rpt_to_show",'loyalty_reward');//..fields for search//by default the start and end date is this month$search_from_dt= get_input("search_from_dt",date('Y-m-01'));$search_to_dt= get_input("search_to_dt",date('Y-m-t'));/*$search_from_dt= get_input("search_from_dt",date('m/01/Y'));$search_to_dt= get_input("search_to_dt",date('m/t/Y'));*/$search_restaurant= get_input("search_restaurant",0);$search_table= get_input("search_table",0);$search_groupby= get_input("search_groupby",'');$do_search= get_input("do_search",0);$filt_text=array();$sort_by=$new_sort="";biz_set_sorting_var($sort_by,$new_sort,"DESC");$url = "{$website}/user/tbl_qrcode_log.php";//$navigationURL = $url."?".SORT_ON."={$sort_on}&".SORT_BY."={$sort_by}";$navigationURL = $url."?".SORT_ON."={$sort_on}&".SORT_BY."={$sort_by}&search_from_dt={$search_from_dt}&search_to_dt={$search_to_dt}&search_restaurant={$search_restaurant}&search_table={$search_table}&search_groupby={$search_groupby}";$isSuccess = "";$objtbl_qrcode_log= new tbl_qrcode_log();if(is_not_empty($action)){	switch($action){		case ACTION_CREATE: 			$isSuccess = $objtbl_qrcode_log->create($qrlog_member_id, $qrlog_tbl_id, $qrlog_in_time, $qrlog_out_time);			break;		case ACTION_UPDATE: 			$isSuccess = $objtbl_qrcode_log->update($qrlog_id, $qrlog_member_id, $qrlog_tbl_id, $qrlog_in_time, $qrlog_out_time);			break;		case ACTION_DELETE: 			$isSuccess = $objtbl_qrcode_log->delete(array(QRLOG_ID=>$qrlog_id));			break;		case ACTION_ACTIVATE: 			$isSuccess = $objtbl_qrcode_log->activate($qrlog_id);			break;		case ACTION_DEACTIVATE: 			$isSuccess = $objtbl_qrcode_log->deactivate($qrlog_id);			break;	}//..switch}//..ifif(is_not_empty($isSuccess)){	if(is_gt_zero_num($isSuccess)){		$err .= "<div class='info'>".$_lang['tbl_qrcode_log'][$action]['SUCCESS_MSG']."</div>";	}elseif($isSuccess == OPERATION_FAIL){		$err .= "<div class='error'>".$_lang['tbl_qrcode_log'][$action]['FAILURE_MSG']."</div>";	}elseif($isSuccess == OPERATION_DUPLICATE){		$err .= "<div class='error'>".$_lang['tbl_qrcode_log'][$action]['DUPLICATE_MSG']."</div>";	}}//..if	$result_found=0;	$arr_filter=array(TABLE_RESTAURANT=>$_SESSION[SES_RESTAURANT],OFFSET_TITLE=>$offset,LIMIT_TITLE=>$limit,SORT_BY=>$sort_by,SORT_ON=>$sort_on);	//..filter criteria	if(is_not_empty($search_from_dt) && is_not_empty($search_to_dt)){			$arr_filter['search_from_dt']=$search_from_dt;			$arr_filter['search_to_dt']=$search_to_dt;			$filt_text[]="Date range:{$search_from_dt}-{$search_to_dt}";	}	/*if(is_gt_zero_num($search_restaurant)){			$arr_filter[TABLE_RESTAURANT]=$search_restaurant;			$resta_info=tbl_restaurent::GetInfo($search_restaurant);				$filt_text[]="Restaurant:".$resta_info["restaurent_name"];	}*/	if(is_gt_zero_num($search_table)){			$arr_filter[QRLOG_TBL_ID]=$search_table;			$table_info=tbl_dining_table::GetInfo($search_table);						$filt_text[]="Table:".$table_info["table_number"];	}		if(is_not_empty($search_groupby)){			$arr_filter['search_groupby']=$search_groupby;			$filt_text[]="Group By:$search_groupby";	}		$result_found_group=0;	$tbl_qrcode_loglist = $objtbl_qrcode_log->readArray($arr_filter,$result_found,1,$result_found_group);	//print_r($tbl_qrcode_loglist);		if($rpt_to_show=="qr_code_log"){			$report_img =	$objtbl_qrcode_log->rpt_show_graph_qrcd($search_groupby,$_SESSION[SES_RESTAURANT],$search_from_dt,$search_to_dt,$search_table,0,0);			$smarty->assign('report_img',$report_img);	}elseif($rpt_to_show=="loyalty_reward"){			$report_img =	$objtbl_qrcode_log->rpt_show_graph_loyalty($search_groupby,$_SESSION[SES_RESTAURANT],$search_from_dt,$search_to_dt,$search_table,0,0);			$smarty->assign('report_img',$report_img);	}elseif($rpt_to_show=="promotions"){			$report_img =	$objtbl_qrcode_log->rpt_show_graph_promotion($search_groupby,$_SESSION[SES_RESTAURANT],$search_from_dt,$search_to_dt,$search_table,0,0);			$smarty->assign('report_img',$report_img);	}	$allpageCount = 0;	$currentPage = 0;	$smarty->assign('pagination',biz_pagination(array("url"=>$navigationURL,LIMIT_TITLE=>$limit,OFFSET_TITLE=>$offset,"count"=>$result_found),$allpageCount,$currentPage));	$smarty->assign('allpageCount',$allpageCount);	$smarty->assign('currentPage',$currentPage);	$smarty->assign('tbl_qrcode_loglist', $tbl_qrcode_loglist);	$smarty->assign('result_found',$result_found);	$smarty->assign('result_found_group',$result_found_group);//..for group by count	$smarty->assign('rpt_to_show',$rpt_to_show);//..which tab to show			//..for filter	$lst_tables=tbl_dining_table::GetFields(array('key_field'=>TABLE_ID,'value_field'=>TABLE_NUMBER,'isActive'=>1));	$smarty->assign('lst_tables', $lst_tables);			//..for filter	$lst_restants=tbl_restaurent::GetFields(array('key_field'=>RESTAURENT_ID,'value_field'=>RESTAURENT_NAME,'isActive'=>1));	$smarty->assign('lst_restants', $lst_restants);		$smarty->assign('search_from_dt',$search_from_dt);	$smarty->assign('search_to_dt',$search_to_dt);	$smarty->assign('search_restaurant',$search_restaurant);	$smarty->assign('search_table',$search_table);	$smarty->assign('search_groupby',$search_groupby);	if(is_not_empty($filt_text)){		$smarty->assign('filt_text',implode('|',array_unique($filt_text)));			}		$template = "tbl_qrcode_log/grid.tpl";		if(is_not_empty($_SESSION['curr_sess_p']) && ($_SESSION['curr_sess_p']=='restaulogy')){			$breadcrumbs[] = array(				 	'link'=>$website.'/user/rest_dashboard.php',					'title'=>$_lang['main']['rest_dashboard']);			}else{		$breadcrumbs[] = array(				 	'link'=>$website.'/user/pref_mng_cntrols.php',					'title'=>$_lang['main']['pref_mng_cntrls']);	} 		$breadcrumbs[] = array(				 	'link'=>$website.'/user/tbl_qrcode_log.php',					'title'=>$_lang['main']['prom_stats']['prom_stats_title']);	if (is_not_empty($mode)){		if(($mode == MODE_VIEW || $mode==MODE_UPDATE) && is_gt_zero_num($qrlog_id)){			$tbl_qrcode_loginfo= $objtbl_qrcode_log->GetInfo($qrlog_id);			$smarty->assign('tbl_qrcode_loginfo',$tbl_qrcode_loginfo);			if($mode==MODE_UPDATE){				$smarty->assign("isUpdate",1);			}			$template = "tbl_qrcode_log/view.tpl";		}elseif($mode == MODE_CREATE){			$template = "tbl_qrcode_log/create.tpl";		}}	$smarty->assign('page_url', $url);	$smarty->assign('navigationURL',$navigationURL);	$smarty->assign('new_sort',$new_sort);	$smarty->assign('active_page',$active_page);		if($deviceType!='phone'){		$deviceType='desktop';	}	$smarty->assign('deviceType',$deviceType);	}else{	$template="index.tpl";}include_once("footer.php");?>