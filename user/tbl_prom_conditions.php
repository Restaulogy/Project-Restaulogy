<?phpinclude_once(dirname(dirname(__FILE__)).'/init.php');include_once(dirname(dirname(__FILE__)).'/modules/business_listing/classes/pds_list_promotions.class.php');include_once('header.php');$active_page = 'tbl_prom_conditions';$prmcon_promotion = get_input('prmcon_promotion',$_SESSION[SES_PROMOTION]);$prmcon_id= get_input('prmcon_id',0);unset($_SESSION[SES_PROM_COND]);unset($_SESSION[SES_CONDITIONS]);/* if((is_gt_zero_num($prmcon_promotion)==false) && (is_gt_zero_num($prmcon_id))){  $_SESSION[SES_PROM_COND] = $prmcon_id;  $prom_conditionsinfo = tbl_prom_conditions ::GetInfo($prmcon_id); if(is_not_empty($prom_conditionsinfo)){ 		$prmcon_promotion  = $prom_cond_info[PRMCON_PROMOTION] ;		unset($prom_conditionsinfo);	}  }*/ if($sesslife==true){  $prmcon_title= get_input('prmcon_title');$prmcon_start_date= get_input('prmcon_start_date');$prmcon_end_date= get_input('prmcon_end_date');$action = strtoupper(get_input(ACTION_TITLE));$mode = strtoupper(get_input(MODE_TITLE));$offset = get_input(OFFSET_TITLE,OFFSET_VALUE);$limit =  get_input(LIMIT_TITLE,LIMIT_VALUE);$sort_on = get_input(SORT_ON,'prmcon_id');$sort_by=$new_sort='';biz_set_sorting_var($sort_by,$new_sort); $url = $website.'/user/tbl_prom_conditions.php?prmcon_promotion='.$prmcon_promotion;$navigationURL = $url.'&'.SORT_ON.'='.$sort_on.'&'.SORT_BY.'='.$sort_by;$isSuccess = '';//..Promotion is must for proceed further//..If condition is there then view= edit else view=createif(is_gt_zero_num($prmcon_promotion)==false){				$_SESSION[SES_FLASH_MSG] = '<div class="error">Please select/create the basic promotion first to view purchase items.</div>';		biz_script_forward($_SERVER['HTTP_REFERER']);}else{		if(is_gt_zero_num($_SESSION[SES_PROMOTION])==FALSE)			$_SESSION[SES_PROMOTION]=$prmcon_promotion;	  //..First check if there any condtion exits for this promotion		$fnd=0;		$obj_conditions=tbl_prom_conditions::readArray(array(PRMCON_PROMOTION=>$prmcon_promotion),$fnd,1);	  		if(is_gt_zero_num($fnd)){			if(is_not_empty($obj_conditions)){ 				$obj_conditions = array_shift($obj_conditions);			 	#$prmcon_promotion  = $prom_cond_info[PRMCON_PROMOTION];				$prmcon_id=$obj_conditions[PRMCON_ID];				unset($obj_conditions);							}				if(is_not_empty($action)==FALSE){			 		$mode = MODE_UPDATE;			}				biz_script_forward($website.'/user/tbl_prom_cond_details.php?promotion='.$prmcon_promotion.'&prcndtl_condition='.$prmcon_id.'&'.MODE_TITLE.'='.MODE_UPDATE);			}else{			 biz_script_forward($website.'/user/tbl_prom_cond_details.php?promotion='.$prmcon_promotion.'&'.MODE_TITLE.'='.MODE_CREATE);		}}$objtbl_prom_conditions= new tbl_prom_conditions();if(is_not_empty($action)){	switch($action){		case ACTION_CREATE: 			$isSuccess = $objtbl_prom_conditions->create($prmcon_promotion, $prmcon_title, $prmcon_start_date, $prmcon_end_date);			break;		case ACTION_UPDATE: 			$isSuccess = $objtbl_prom_conditions->update($prmcon_id, $prmcon_promotion, $prmcon_title, $prmcon_start_date, $prmcon_end_date);			break;		case ACTION_DELETE: 			$isSuccess = $objtbl_prom_conditions->delete(array(PRMCON_ID=>$prmcon_id));			break;		case ACTION_ACTIVATE: 			$isSuccess = $objtbl_prom_conditions->activate($prmcon_id);			break;		case ACTION_DEACTIVATE: 			$isSuccess = $objtbl_prom_conditions->deactivate($prmcon_id);			break;	}//..switch}//..ifif(is_not_empty($isSuccess)){	if(is_gt_zero_num($isSuccess)){		$_SESSION[SES_FLASH_MSG] .= '<div class="success">'.$_lang['tbl_prom_conditions'][$action]['SUCCESS_MSG'].'</div>';	}elseif($isSuccess == OPERATION_FAIL){		$_SESSION[SES_FLASH_MSG] .= '<div class="error">'.$_lang['tbl_prom_conditions'][$action]['FAILURE_MSG'].'</div>';	}elseif($isSuccess == OPERATION_DUPLICATE){		$_SESSION[SES_FLASH_MSG] .= '<div class="info">'.$_lang['tbl_prom_conditions'][$action]['DUPLICATE_MSG'].'</div>';	} 	}//..if	$result_found=0;	$tbl_prom_conditionslist = $objtbl_prom_conditions->readArray(array(OFFSET_TITLE=>$offset,LIMIT_TITLE=>$limit,SORT_BY=>$sort_by,SORT_ON=>$sort_on,PRMCON_PROMOTION=>$prmcon_promotion),$result_found,1);	$allpageCount = 0;	$currentPage = 0;	$smarty->assign('pagination',biz_pagination(array('url'=>$navigationURL,LIMIT_TITLE=>$limit,OFFSET_TITLE=>$offset,'count'=>$result_found),$allpageCount,$currentPage));	$smarty->assign('allpageCount',$allpageCount);	$smarty->assign('currentPage',$currentPage);	$smarty->assign('tbl_prom_conditionslist', $tbl_prom_conditionslist);	$smarty->assign('result_found',$result_found);	$template = 'tbl_prom_conditions/tbl_prom_conditions.tpl';		$breadcrumbs[] = array('link'=>$website.'/modules/business_listing/promotionslisting.php?show_type=PR', 'title'=>$_lang['lbl_coupons']);	$prom_detail = pds_list_promotions::GetPromotionDetail($prmcon_promotion);	if(is_not_empty($prom_detail)){		$breadcrumbs[] = array('link'=>$website.'/modules/business_listing/promotion.php?edit=1&id='.$prmcon_promotion, 'title'=>$prom_detail['title']);	}		$breadcrumbs[] = array('link'=>$website.'/user/tbl_prom_discounts.php?prmdisc_promotion='.$prmcon_promotion, 'title'=>$_lang[TBL_PROM_DISCOUNTS]['title']);		$breadcrumbs[] = array('link'=>$website.'/user/tbl_prom_conditions.php?prmcon_promotion='.$prmcon_promotion, 'title'=>$_lang[TBL_PROM_CONDITIONS]['title']); 		if (is_not_empty($mode)){		if(($mode == MODE_VIEW || $mode==MODE_UPDATE) && is_gt_zero_num($prmcon_id)){			$tbl_prom_conditionsinfo= $objtbl_prom_conditions->GetInfo($prmcon_id);						$smarty->assign('prom_condition',$prmcon_id);			$smarty->assign('promotion',$tbl_prom_conditionsinfo[PRMCON_PROMOTION]); 			$smarty->assign('tbl_prom_conditionsinfo',$tbl_prom_conditionsinfo);			if($mode==MODE_UPDATE){				$smarty->assign('isUpdate',1);			}			$template = 'tbl_prom_conditions/view.tpl';		}elseif($mode == MODE_CREATE){			$template = 'tbl_prom_conditions/create.tpl'; 		}}	//..Get the listing of active promotions	$lst_promotion = pds_list_promotions::GetPromotions();	$smarty->assign('lst_promotion',$lst_promotion);		$smarty->assign('page_url', $url);	$smarty->assign('prmcon_promotion',$prmcon_promotion);	$smarty->assign('navigationURL',$navigationURL);	$smarty->assign('new_sort',$new_sort);	$smarty->assign('active_page',$active_page);	}else{	$template='index.tpl';} include_once('footer.php');?>