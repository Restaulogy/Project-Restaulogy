<?phpinclude_once(dirname(dirname(__FILE__)).'/init.php');include_once('header.php'); $sess_dish = $_SESSION[SES_DISH];$sess_sub_menu = $_SESSION[SES_SUB_MENU];if($_REQUEST['dish_opt_submenu']){	 $sess_dish = 0;}if($_REQUEST['dish_opt_dish_id']){	$sess_sub_menu = 0;} $active_page = 'tbl_dish_options';$dish_opt_id= get_input('dish_opt_id');$dish_opt_dish_id= get_input('dish_opt_dish_id',$sess_dish);$dish_opt_name= get_input('dish_opt_name');$dish_opt_type= get_input('dish_opt_type');$dish_opt_submenu= get_input('dish_opt_submenu',$sess_sub_menu); $dish_opt_start_date= get_input('dish_opt_start_date');$dish_opt_end_date= get_input('dish_opt_end_date'); $dish_opt_mandotory= get_input(DISH_OPT_MANDOTORY,0);$action = strtoupper(get_input(ACTION_TITLE));$mode = strtoupper(get_input(MODE_TITLE));$offset = get_input(OFFSET_TITLE,OFFSET_VALUE);$limit =  get_input(LIMIT_TITLE,LIMIT_VALUE);$sort_on = get_input(SORT_ON,'dish_opt_id');$sort_by=$new_sort='';biz_set_sorting_var($sort_by,$new_sort);$url = $website.'/user/tbl_dish_options.php'; $navigationURL = $url.'?'.SORT_ON.'='.$sort_on.'&'.SORT_BY.'='.$sort_by;$isSuccess = '';//..get list of selected items$sel_dish_options= get_input("sel_dish_options");$lst_sel_ids='';if(is_not_empty($sel_dish_options)){		$lst_sel_ids=biz_implode(',', array_keys($sel_dish_options));  } if($sesslife==true && (is_gt_zero_num($dish_opt_dish_id) || is_gt_zero_num($dish_opt_submenu))){ 	$currDishInfo = array();	$currSubmenuInfo = array();	$search_arr = array(OFFSET_TITLE=>$offset,LIMIT_TITLE=>$limit,SORT_BY=>$sort_by,SORT_ON=>$sort_on);	if($dish_opt_dish_id){		$_SESSION[SES_DISH] = $dish_opt_dish_id; 		//.. Unset the session stored value of the options		$currDishInfo = tbl_dishes::GetInfo($dish_opt_dish_id);		$search_arr[DISH_OPT_DISH_ID]=$dish_opt_dish_id;	}else{		$_SESSION[SES_SUB_MENU] = $dish_opt_submenu; 		//.. Unset the session stored value of the options		$currSubmenuInfo = tbl_sub_menu::GetInfo($dish_opt_submenu);		$search_arr[DISH_OPT_SUBMENU]=$dish_opt_submenu;	}		unset($_SESSION[SES_DISH_OPTION]); $objtbl_dish_options= new tbl_dish_options();if(is_not_empty($action)){ 	switch($action){		case ACTION_CREATE:  			$isSuccess = $objtbl_dish_options->create($dish_opt_dish_id, $dish_opt_name, $dish_opt_type, $dish_opt_submenu,$dish_opt_mandotory);			break;		case ACTION_UPDATE: 			$isSuccess = $objtbl_dish_options->update($dish_opt_id, $dish_opt_dish_id, $dish_opt_name, $dish_opt_type, $dish_opt_submenu,$dish_opt_mandotory);			break;		case ACTION_DELETE: 			if(is_not_empty($lst_sel_ids)){					$isSuccess = $objtbl_dish_options->delete(array(DISH_OPT_ID=>$lst_sel_ids));			}else{				$isSuccess = OPERATION_FAIL;			} 			//$isSuccess = $objtbl_dish_options->delete(array(DISH_OPT_ID=>$dish_opt_id));			break;		case ACTION_ACTIVATE: 		if(is_not_empty($lst_sel_ids)){			 $isSuccess = $objtbl_dish_options->activate($lst_sel_ids); 		}else{			 $isSuccess = $objtbl_dish_options->activate($dish_opt_id);		}			break;		case ACTION_DEACTIVATE: 			if(is_not_empty($lst_sel_ids)){			 $isSuccess = $objtbl_dish_options->deactivate($lst_sel_ids); 		}else{			 $isSuccess = $objtbl_dish_options->deactivate($dish_opt_id);		}			break;	}//..switch}//..ifif(is_not_empty($isSuccess)){	if(is_gt_zero_num($isSuccess)){		/*switch($action){			case ACTION_CREATE : tbl_dish_options_values::insertBulkOptionValues($dish_option_values,$isSuccess);			break; 			case ACTION_UPDATE : tbl_dish_options_values::insertBulkOptionValues($dish_option_values,$dish_opt_id);			break;		}*/ 		$_SESSION[SES_FLASH_MSG] .= '<div class="success">'.$_lang['tbl_dish_options'][$action]['SUCCESS_MSG'].'</div>'; 	}elseif($isSuccess == OPERATION_FAIL){		$_SESSION[SES_FLASH_MSG] .= '<div class="error">'.$_lang['tbl_dish_options'][$action]['FAILURE_MSG'].'</div>';	}elseif($isSuccess == OPERATION_DUPLICATE){		$_SESSION[SES_FLASH_MSG] .= '<div class="info">'.$_lang['tbl_dish_options'][$action]['DUPLICATE_MSG'].'</div>';	}}//..if	$result_found=0;	$info = $objtbl_dish_options->readArray($search_arr,$result_found,1);	$tbl_dish_optionslist = array();	$x = 0;	foreach($info as $val){		$tbl_dish_optionslist[$x] = $val;		$tbl_dish_optionslist[$x]['values'] = tbl_dish_options_values::getAllValuesForOption($val[DISH_OPT_ID]);		$x++;	} 	$allpageCount = 0;	$currentPage = 0;	$smarty->assign('pagination',biz_pagination(array('url'=>$navigationURL,LIMIT_TITLE=>$limit,OFFSET_TITLE=>$offset,'count'=>$result_found),$allpageCount,$currentPage));	$smarty->assign('allpageCount',$allpageCount);	$smarty->assign('currentPage',$currentPage);	$smarty->assign('tbl_dish_optionslist', $tbl_dish_optionslist);	$smarty->assign('result_found',$result_found);	$smarty->assign('currDishInfo',$currDishInfo);  $smarty->assign('currSubmenuInfo',$currSubmenuInfo);	$template = 'tbl_dish_options/tbl_dish_options.tpl';	if (is_not_empty($mode)){		if(($mode == MODE_VIEW || $mode==MODE_UPDATE) && is_gt_zero_num($dish_opt_id)){			$tbl_dish_optionsinfo = $objtbl_dish_options->GetInfo($dish_opt_id);			$tbl_dish_options_valueslist= tbl_dish_options_values::readArray(array(DISH_OPT_VAL_OPTION_ID=>$dish_opt_id)); 			if($tbl_dish_optionsinfo[DISH_OPT_DISH_ID] == $dish_opt_dish_id){				$tbl_dish_optionsinfo['dish_detail'] = $currDishInfo; 			}else{				$tbl_dish_optionsinfo['dish_detail'] = tbl_dishes::GetInfo($tbl_dish_optionsinfo[DISH_OPT_DISH_ID]);			}			 			$smarty->assign('tbl_dish_optionsinfo',$tbl_dish_optionsinfo);			$smarty->assign('tbl_dish_options_valueslist',$tbl_dish_options_valueslist);			if($mode==MODE_UPDATE){				$smarty->assign('isUpdate',1);			}			$template = 'tbl_dish_options/view.tpl';		}elseif($mode == MODE_CREATE){			$template = 'tbl_dish_options/create.tpl';		}}	$smarty->assign('page_url', $url);	$smarty->assign('navigationURL',$navigationURL);	$smarty->assign('new_sort',$new_sort);	$smarty->assign('active_page',$active_page);	$smarty->assign('optionTypeList',$objtbl_dish_options->getOptionTypes());		//..get the sub meu list	$lst_sub_mnu = tbl_sub_menu::readArray(array(MENU_RESTAURENT => $_SESSION[SES_RESTAURANT],'isActive'=>1)); 	$smarty->assign('submenuList',$lst_sub_mnu); 		$breadcrumbs[] = array(					 	'link'=>$website.'/user/pref_mng_cntrols.php',						'title'=>$_lang['main']['pref_mng_cntrls']);	if(is_gt_zero_num($_SESSION[SES_DISH])){		$breadcrumbs[] = array(						 	'link'=>$website.'/user/tbl_dishes.php',							'title'=>$_lang['tbl_dishes']['listing_title']);	}elseif(is_not_empty($currSubmenuInfo)){		$breadcrumbs[] = array(						 	'link'=>$website.'/user/tbl_sub_menu.php?submnu_menu='.$currSubmenuInfo[SUBMNU_MENU],							'title'=>$_lang['tbl_sub_menu']['listing_title']); 		 	$breadcrumbs[] = array(						 	'link'=>$website.'/user/tbl_sub_menu.php?submnu_menu='.$currSubmenuInfo[SUBMNU_MENU].'&'.MODE_TITLE.'='.MODE_UPDATE.'&submnu_id='.$currSubmenuInfo[SUBMNU_ID],							'title'=>$currSubmenuInfo[SUBMNU_NAME]);  	}		$breadcrumbs[] = array(						 	'link'=>$url,							'title'=>'"'.$currDishInfo['dish_name'].'"-'.$_lang['tbl_dish_options']['listing_title']);	}else{	$template='index.tpl';} include_once('footer.php');?>