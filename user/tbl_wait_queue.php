<?phpinclude_once(dirname(dirname(__FILE__)).'/init.php');include_once('header.php');$active_page = 'tbl_wait_queue';  if(($isCustomer) || ($sesslife==true && $_SESSION['member_role_id'] == ROLE_ADMIN)){   $wt_que_id= get_input('wt_que_id');$wt_que_customer= get_input('wt_que_customer');$wt_que_cust_ph_no= get_input('wt_que_cust_ph_no');$wt_que_party_size= get_input('wt_que_party_size');$wt_que_table_type= get_input('wt_que_table_type');$wt_que_table_id= get_input('wt_que_table_id');$wt_que_exp_time= get_input('wt_que_exp_time');$wt_que_is_cancelled= get_input('wt_que_is_cancelled');$wt_que_restaurant= get_input('wt_que_restaurant');$wt_que_by_cust= get_input('wt_que_by_cust');$wt_que_created_on= get_input('wt_que_created_on');$wt_que_completed_on= get_input('wt_que_completed_on');$action = strtoupper(get_input(ACTION_TITLE));$mode = strtoupper(get_input(MODE_TITLE));$offset = get_input(OFFSET_TITLE,OFFSET_VALUE);$limit =  get_input(LIMIT_TITLE,LIMIT_VALUE);$sort_on = get_input(SORT_ON,'wt_que_id');$sort_by=$new_sort='';biz_set_sorting_var($sort_by,$new_sort);$url = $website.'/user/tbl_wait_queue.php';$sort_by = 'DESC';$navigationURL = $url.'?'.SORT_ON.'='.$sort_on.'&'.SORT_BY.'='.$sort_by;$isSuccess = '';$objtbl_wait_queue= new tbl_wait_queue();if(is_not_empty($action)){	switch($action){		case ACTION_CREATE: 			$isSuccess = $objtbl_wait_queue->create($wt_que_customer, $wt_que_cust_ph_no, $wt_que_party_size, $wt_que_table_type, $wt_que_table_id, $wt_que_exp_time, $wt_que_is_cancelled, $wt_que_restaurant, $wt_que_by_cust, $wt_que_created_on, $wt_que_completed_on);			if($isSuccess && $isCustomer){				$_SESSION[SES_CUSTOMER] = $wt_que_customer;				$_SESSION[SES_CUST_PHONE] = $wt_que_cust_ph_no;				$_SESSION[SES_QUEUE] =$isSuccess; 				alertToManager($_SESSION[SES_CUST_PHONE],$isSuccess,ALERT_NEW_QUE);			} 			break;		case ACTION_UPDATE: 			$isSuccess = $objtbl_wait_queue->update($wt_que_id, $wt_que_customer, $wt_que_cust_ph_no, $wt_que_party_size, $wt_que_table_type, $wt_que_table_id, $wt_que_exp_time, $wt_que_is_cancelled, $wt_que_restaurant, $wt_que_by_cust, $wt_que_created_on, $wt_que_completed_on);			break;		case ACTION_DELETE: 			$isSuccess = $objtbl_wait_queue->delete(array(WT_QUE_ID=>$wt_que_id));			break;		case ACTION_ACTIVATE: 			$isSuccess = $objtbl_wait_queue->activate($wt_que_id);			break;		case ACTION_DEACTIVATE: 			$isSuccess = $objtbl_wait_queue->deactivate($wt_que_id,$wt_que_table_id, $wt_que_is_cancelled);						if($isCustomer && is_gt_zero_num($wt_que_is_cancelled)){				 				alertToManager($_SESSION[SES_CUST_PHONE],$isSuccess,ALERT_QUE_CANCEL);				//clearCustSession();  				biz_script_forward($website.'/user/wait_dashboard.php?table_id='.$_SESSION[SES_TABLE].'&frm_qrcd=1');							}			break;	}//..switch}//..ifif(is_not_empty($isSuccess)){  	if(is_gt_zero_num($isSuccess)){		if($action == ACTION_DEACTIVATE){			if($wt_que_is_cancelled){				$_SESSION[SES_FLASH_MSG] = '<div class="info">'.$_lang['tbl_wait_queue'][$action]['CANCEL_MSG'].'</div>';			}else{				$_SESSION[SES_FLASH_MSG] = '<div class="info">'.$_lang['tbl_wait_queue'][$action]['SEATED_MSG'].'</div>';			}		}else{			 $_SESSION[SES_FLASH_MSG] = '<div class="info">'.$_lang['tbl_wait_queue'][$action]['SUCCESS_MSG'].'</div>';		} 	}elseif($isSuccess == OPERATION_FAIL){		$_SESSION[SES_FLASH_MSG] = '<div class="error">'.$_lang['tbl_wait_queue'][$action]['FAILURE_MSG'].'</div>';	}elseif($isSuccess == OPERATION_DUPLICATE){		$_SESSION[SES_FLASH_MSG] = '<div class="error">'.$_lang['tbl_wait_queue'][$action]['DUPLICATE_MSG'].'</div>';	}}//..if 	$result_found=0;		if($isCustomer){		if(is_gt_zero_num($_SESSION[SES_QUEUE])){			$wt_que_id = $_SESSION[SES_QUEUE]; 			$mode = MODE_VIEW ;		}else{			$search_arr = array(OFFSET_TITLE=>$offset,WT_QUE_CUST_PH_NO=>$_SESSION[SES_CUST_PHONE],'latestOnly'=>1,LIMIT_TITLE=>$limit,SORT_BY=>$sort_by,SORT_ON=>$sort_on);		$nav_arr = array('url'=>$navigationURL,'latestOnly'=>1,WT_QUE_CUST_PH_NO=>$_SESSION[SES_CUST_PHONE],LIMIT_TITLE=>$limit,OFFSET_TITLE=>$offset,'count'=>$result_found);		}		/**/	}else{		$search_arr = array(OFFSET_TITLE=>$offset,'latestOnly'=>1,LIMIT_TITLE=>$limit,SORT_BY=>$sort_by,SORT_ON=>$sort_on);		$nav_arr = array('url'=>$navigationURL,'latestOnly'=>1,LIMIT_TITLE=>$limit,OFFSET_TITLE=>$offset,'count'=>$result_found);		$breadcrumbs[] = array('title'=>$_lang['main']['pref_mng_cntrls'],				'link'=>$website.'/user/pref_mng_cntrols.php');	 		$breadcrumbs[] = array('title'=>$_lang['tbl_wait_queue']['listing_title'],				'link'=>$url);	} 	$tbl_wait_queuelist = $objtbl_wait_queue->readArray($search_arr,$result_found,1);	$allpageCount = 0;	$currentPage = 0;	$smarty->assign('pagination',biz_pagination($nav_arr,$allpageCount,$currentPage));	$smarty->assign('allpageCount',$allpageCount);	$smarty->assign('currentPage',$currentPage);	$smarty->assign('tbl_wait_queuelist', $tbl_wait_queuelist);	$smarty->assign('result_found',$result_found); 		$template = 'tbl_wait_queue/grid.tpl';	if (is_not_empty($mode)){		if(($mode == MODE_VIEW || $mode==MODE_UPDATE) && is_gt_zero_num($wt_que_id)){			$tbl_wait_queueinfo= $objtbl_wait_queue->GetInfo($wt_que_id);			$tbl_wait_queueinfo['table_type_info'] = tbl_table_type::GetInfo($tbl_wait_queueinfo['wt_que_table_type']);			$smarty->assign('tbl_wait_queueinfo',$tbl_wait_queueinfo);			if($mode==MODE_UPDATE){				$smarty->assign('isUpdate',1);			}			if($isCustomer){				$breadcrumbs[] = array('title'=>$_lang['tbl_wait_queue']['customer_view_title'].' <small>'.$tbl_wait_queueinfo['wt_que_cust_ph_no'].'</small>',				'link'=>$url.'?wt_que_id='.$tbl_wait_queueinfo['wt_que_id'].'&'.MODE_TITLE.'='.$mode);				$template = 'tbl_wait_queue/cust_view.tpl';			}else{				$breadcrumbs[] = array('title'=>$tbl_wait_queueinfo['wt_que_customer'].' ('.$tbl_wait_queueinfo['wt_que_cust_ph_no'].')' ,				'link'=>$url.'?wt_que_id='.$tbl_wait_queueinfo['wt_que_id'].'&'.MODE_TITLE.'='.$mode);				$template = 'tbl_wait_queue/view.tpl';			}					}elseif($mode == MODE_CREATE){			$breadcrumbs[] = array('title'=>$_lang['tbl_wait_queue']['create_title'],		 	'link'=>$url.'?'.MODE_TITLE.'='.MODE_CREATE);			if(is_gt_zero_num($isAllowNewQue)){				$template = 'tbl_wait_queue/create.tpl';			}else{				$template = 'not_allowed.tpl';			}  		}	}else{		$smarty->assign('isList',1);	}	$smarty->assign('table_types', tbl_table_type::GetFields(array('key_field'=>TBL_TYPE_ID, 'value_field'=>TBL_TYPE_NAME))); 	$smarty->assign('page_url', $url);	$smarty->assign('navigationURL',$navigationURL);	$smarty->assign('new_sort',$new_sort);	$smarty->assign('active_page',$active_page); }else{	$template='index.tpl';}  include_once('footer.php'); ?>