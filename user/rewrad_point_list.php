<?phpini_set('max_execution_time', 0); include_once(dirname(dirname(__FILE__)).'/init.php');include_once(dirname(dirname(__FILE__)).'/modules/business_listing/classes/pds_list_promotions.class.php');include_once('header.php');$active_page = 'rewrad_point_list';//send_sms_using_twilio(array("7588266377"),"HELOOOOOOOOOOOOOOOOOOOOOOO");//send_sms_using_smslane();//send_sms_using_mvayo();//exit;$crm_id= get_input('crm_id');$crm_cust_id= get_input('crm_cust_id');$crm_cust_email= get_input('crm_cust_email');$crm_cust_phone= get_input('crm_cust_phone');$crm_cust_type= get_input('crm_cust_type');$crm_is_subsribed= get_input('crm_is_subsribed');$crm_start_date= get_input('crm_start_date');$crm_end_date= get_input('crm_end_date');$order_id = get_input('order_id',0);$payment_choice = get_input('payment_choice');$action = strtoupper(get_input(ACTION_TITLE));$mode = strtoupper(get_input(MODE_TITLE));$offset = get_input(OFFSET_TITLE,OFFSET_VALUE);//$limit =  get_input(LIMIT_TITLE,LIMIT_VALUE);$limit =  get_input(LIMIT_TITLE,10);$sort_on = get_input(SORT_ON,'crm_id'); /*$prom_id						= get_input('prom_id',0);$sms_msg						  = get_input('sms_msg','');*///print_r($_REQUEST);//..fields for search$search_fname= get_input("search_fname",'');$search_lname= get_input("search_lname",'');$search_email= get_input("search_email",'');$search_phone= get_input("search_phone",'');$search_total_points= get_input("search_total_points",'');$search_redeemed_points= get_input("search_redeemed_points",'');$search_balance_points= get_input("search_balance_points",'');$search_last_visit= get_input("search_last_visit",0);$rpt_to_show= get_input("rpt_to_show",'');$filt_search_phone=get_input('filt_search_phone','');$_is_all_selected=get_input('_is_all_selected','');if(is_not_empty($filt_search_phone)){		//$filt_search_phone=str_replace(array('+','-'), '', filter_var($filt_search_phone, FILTER_SANITIZE_NUMBER_INT));		$filt_search_phone=$phone=_get_us_phone($filt_search_phone);		$_filt_mem_id=DB::ExecScalarQry("SELECT `".STAFF_MEMBER_ID."` FROM `".TBL_STAFF."` INNER JOIN ".MEMBERS." ON `".STAFF_MEMBER_ID."`=`".MEMBERS."`.`id` WHERE `".STAFF_PHONE."`='{$filt_search_phone}' AND `".STAFF_IS_REWARD."`=1 AND `".STAFF_RESTAURENT."`=".$_SESSION[SES_RESTAURANT]);		if(is_gt_zero_num($_filt_mem_id)){			biz_script_forward("{$website}/user/customer_rewards.php?manager_cust_sess_id={$_filt_mem_id}");		}else{			$_SESSION[SES_FLASH_MSG] = '<div class="error">Member not found with this phone number.</div>';		}}if((in_array($Global_member[MEMBER_ROLE_ID], array(ROLE_MANAGER,ROLE_ADMIN,ROLE_OWNER,ROLE_DEV))) || (is_gt_zero_num($order_id) && isCustomer())){	$sort_by=$new_sort='';biz_set_sorting_var($sort_by,$new_sort);//$url = $website.'/user/tbl_crm.php';//$url = $website.'/user/rewrad_point_list.php';$url = $website.'/user/rewrad_point_list.php?search_fname='.$search_fname.'&search_lname='.$search_lname.'&search_email='.$search_email.'&search_phone='.$search_phone.'&search_total_points='.$search_total_points.'&search_redeemed_points='.$search_redeemed_points.'&search_balance_points='.$search_balance_points.'&search_last_visit='.$search_last_visit.'&rpt_to_show='.$rpt_to_show;$navigationURL = $url.'&'.SORT_ON.'='.$sort_on.'&'.SORT_BY.'='.$sort_by;$isSuccess = '';$pst_menu_id						= get_input('pst_menu_id',0);$prom_id						= get_input('prom_id',0);$sms_msg						= get_input('sms_msg','');$sms_text_msg				= get_input('sms_text_msg','');$tab_sms_email			= get_input('tab_sms_email','email');$menu_id						= get_input('menu_id');$sms_msg_mnu						= get_input('sms_msg_mnu','');$sms_text_msg_mnu				= get_input('sms_text_msg_mnu','');if(is_not_empty($sms_msg)){	$sms_msg=nl2br($sms_msg,false);}if(is_not_empty($sms_msg_mnu)){	$sms_msg_mnu=nl2br($sms_msg_mnu,false);}if((is_not_empty($_GET['offset'])==false) && (is_not_empty($action)==false)){	unset($_SESSION['_sel_crm_id_fr_email']);}//..get list of selected items$sel_tbl_staff= get_input('sel_tbl_staff');$lst_sel_ids='';if(is_not_empty($sel_tbl_staff)){		//$lst_sel_ids=implode(',', array_keys($sel_tbl_staff));	//$lst_sel_ids= array_keys($sel_tbl_staff);}if(is_not_empty($_SESSION['_sel_crm_id_fr_email'])){	$lst_sel_ids=array_unique($_SESSION['_sel_crm_id_fr_email']);}else{	$lst_sel_ids=array();}$upfile						= get_input('upfile','');if($mode == 'CSV_IMPORT'){	if(is_not_empty($upfile)){	// check feilds are not empty	if(pathinfo($_FILES["uploaded"]["name"], PATHINFO_EXTENSION)!= 'csv')	{		$error[] = 'Only CSV files accepted!';	}	 	if (!$error){	 	$tot = 0;	$handle = fopen($_FILES["uploaded"]["tmp_name"], "r");	$clmn_name=-1;	$clmn_email=-1;	$clmn_phone=-1;	$is_complete=0;	while (($data = fgetcsv($handle, 1000, ",")) !== FALSE) {	 //..get firsttime only field	 if($tot==0){		for ($columns=0; $columns < count($data); $columns++) {				if(strtoupper(trim($data[$columns]))=='NAME'){					$clmn_name=$columns;				}elseif(strtoupper(trim($data[$columns]))=='PHONE'){					$clmn_phone=$columns;				}elseif(strtoupper(trim($data[$columns]))=='EMAIL'){					$clmn_email=$columns;				}		}	 }	 //echo "$clmn_name/$clmn_email/$clmn_phone <br>";	 if(($clmn_name == -1) || ($clmn_email == -1) || ($clmn_phone == -1)){			$_SESSION[SES_FLASH_MSG] = "<div class='error'> CSV File must have 'NAME','PHONE','EMAIL' as column header.</div>";			break;					}else{			for ($c=0; $c < 1; $c++) {	 	       //Only run if the first column if not equal to name	       if(strtoupper(trim($data[$clmn_name])) !='NAME'){				 		if(is_not_empty($data[$clmn_email])==FALSE){							$crm_cust_email	= "exusr_"._get_lst_member_id()."@tst.com";						}else{							$crm_cust_email	= $data[$clmn_email];							}				 								$crm_cust_phone	=$data[$clmn_phone];				 		if((is_not_empty($crm_cust_email))&&(filter_var($crm_cust_email, FILTER_VALIDATE_EMAIL))) {							if(is_not_empty($data[$clmn_name])){							$full_nm=explode(' ',$data[$clmn_name]);							$fname=$full_nm[$clmn_name];								if(count($full_nm)>1){														$lname=$full_nm[(count($full_nm)-1)];								}else{									$lname='-';								} 							}															$password='sample';							//echo "ROW-$tot]$crm_cust_email,$password,0,$fname,$lname,$crm_cust_phone,0,0,0,1 <br>";							//$isSuccess = registerME($crm_cust_email,$password,0,$fname,$lname,$crm_cust_phone,0,0,0,1);							$_rslt = registerME($crm_cust_email,$password,0,$fname,$lname,$crm_cust_phone,1,0,0,1,$_SESSION[SES_RESTAURANT]);							if($_rslt>0){								$is_complete=$is_complete+1;								}else{								$error[] = 'ROW-'.$tot.'] ..Phone already exists -'.$crm_cust_phone;							}							}else{							if(strtoupper(trim($crm_cust_email))!='EMAIL')								$error[] = 'ROW-'.$tot.'] ..Invalid Email -'.$crm_cust_email;						}		      }	 			 $tot++;		  }			}			}	fclose($handle);	if(is_gt_zero_num($is_complete)){			$_SESSION[SES_FLASH_MSG] = "<div class='success'> CSV File Imported, $is_complete records added </div>";	}		 	}// end no error}//close if isset upfile$err = capture_errors($error);if(is_not_empty($err)){	$_SESSION[SES_FLASH_MSG] =$err;}}$rest_info = tbl_restaurent::GetInfo($_SESSION[SES_RESTAURANT]);//=============================SEARCH================	$result_found=0;	//$tbl_stafflist = $objtbl_crm->readArray(array(CRM_RESTAURANT=>$_SESSION[SES_RESTAURANT],CRM_IS_SUBSRIBED=>1,OFFSET_TITLE=>$offset,LIMIT_TITLE=>$limit,SORT_BY=>$sort_by,SORT_ON=>$sort_on),$result_found,1);	$arr_filter=array();		//echo "search_total_points=$search_total_points ....";	//..filter criteria	if(is_not_empty($search_total_points)){			$arr_filter['search_total_points']=$search_total_points;			$arr_filter['search_total_points']=$search_total_points;			$filt_text[]=$_lang['biz_rewards']['total_points'].">={$search_total_points}";	}		if(is_not_empty($search_redeemed_points)){			$arr_filter['search_redeemed_points']=$search_redeemed_points;			$arr_filter['search_redeemed_points']=$search_redeemed_points;			$filt_text[]=$_lang['biz_rewards']['redeemed_points'].">={$search_redeemed_points}";	}	if(is_not_empty($search_balance_points)){			$arr_filter['search_balance_points']=$search_balance_points;			$arr_filter['search_balance_points']=$search_balance_points;			$filt_text[]=$_lang['biz_rewards']['balance_points'].">={$search_balance_points}";	}		if(is_not_empty($search_fname)){			$arr_filter['search_fname']=$search_fname;			$arr_filter['search_fname']=$search_fname;			$filt_text[]=$_lang['tbl_staff']['label']['staff_fname']." Like {$search_fname}";	}		if(is_not_empty($search_lname)){			$arr_filter['search_lname']=$search_lname;			$arr_filter['search_lname']=$search_lname;			$filt_text[]=$_lang['tbl_staff']['label']['staff_lname']." Like {$search_lname}";	}		if(is_not_empty($search_email)){			$arr_filter['search_email']=$search_email;			$arr_filter['search_email']=$search_email;			$filt_text[]=$_lang['tbl_staff']['label']['search_email']." Like {$search_email}";	}		if(is_not_empty($search_phone)){			$arr_filter['search_phone']=$search_phone;			$arr_filter['search_phone']=$search_phone;			$filt_text[]=$_lang['tbl_staff']['label']['staff_phone']." Like {$search_phone}";	}			if(is_gt_zero_num($search_last_visit)){			$arr_filter['search_last_visit']=$search_last_visit;			$arr_filter['search_last_visit']=$search_last_visit;			$filt_text[]=$_lang['biz_rewards']['last_visit']." >= {$search_last_visit}";	}				//if(is_not_empty($arr_filter)){		//$arr_filter=array(STAFF_RESTAURENT=>$_SESSION[SES_RESTAURANT],'is_reward'=>1,OFFSET_TITLE=>$offset,LIMIT_TITLE=>$limit,SORT_BY=>$sort_by,SORT_ON=>$sort_on);		$arr_filter['exclude_banned']=1;		$arr_filter[STAFF_RESTAURENT]=$_SESSION[SES_RESTAURANT];		$arr_filter['is_reward']=1;				$arr_filter[SORT_BY]=$sort_by;		$arr_filter[SORT_ON]=$sort_on;					//}//=============================END SEARCH============//$objtbl_crm= new tbl_staff(); if(is_not_empty($action)){	switch($action){		case 'SEND_SMS':			//if(is_gt_zero_num($prom_id) && is_not_empty($sms_text_msg) && is_not_empty($lst_sel_ids)){			if(is_not_empty($sms_text_msg) && (is_not_empty($_is_all_selected) || is_not_empty($lst_sel_ids))){					$obj_prom=new pds_list_promotions();					$obj_crm_prom_emails=new crm_prom_emails();					if(is_not_empty($_is_all_selected)){						$tbl_stafflist = tbl_staff::getRewardUserPointsDetails($arr_filter,$result_found,1);						$_arr_to_use=$tbl_stafflist;					}elseif( is_not_empty($lst_sel_ids)){						$_arr_to_use=$lst_sel_ids;					}										//..Loop through each email 					foreach($_arr_to_use as $_crm_id){						//..capture the emails of the selected conatcts						//..$subscriber_emails=get_crm_email_from_id($_crm_id);						if(is_not_empty($_is_all_selected)){							$_crm_id=$_crm_id['staff_id'];						}						//..capture the phone numbers of the selected conatcts						//$phone_nos=get_crm_email_from_id($_crm_id,'phone');						$_staff_rec=tbl_staff::GetInfo(0,$_crm_id);					  $phone_nos=$_staff_rec[STAFF_PHONE];						//..get actual crm						$_act_crm_id=tbl_crm::get_crm_id_from_email($_staff_rec['staff_email']);						if(is_not_empty($phone_nos)){							 //..Now email the promotion to the above emails										 				 //$tmp_rslt=$obj_prom->sms_promtoion($prom_id,array($phone_nos),$_act_crm_id,$sms_text_msg);							 //echo "{$_crm_id}-{$phone_nos}<br>";							 if(is_gt_zero_num($_act_crm_id)){								//..add record to the crm notify											  $_act_crm_id=$obj_crm_prom_emails->create($_act_crm_id, $prom_id,0, '', '');							 }							 if(is_gt_zero_num($prom_id)){								 //..now email the promotion to the above emails				 				 $tmp_rslt=$obj_prom->sms_promtoion($prom_id,array($phone_nos),$_act_crm_id,$sms_text_msg);		 							 }else{							 	 //..if user is subscribed then only send sms to user 								$_is_sub=tbl_crm::is_subscribed_usr(array($phone_nos),$_SESSION[SES_RESTAURANT]);														$isSuccess=0;								if(is_gt_zero_num($_is_sub)){									$_unsub_lnk = ' Unsubscribe:'.biz_get_tiny_url("{$website}/user/tbl_crm_unsubscribe.php?crm_id={$_is_sub}");									$isSuccess=@send_sms_using_twilio(array($phone_nos),$sms_text_msg.$_unsub_lnk);								}																	 }							 							 $isSuccess=1;							 							 							 						}else{							//$_SESSION[SES_FLASH_MSG] =  '<div class="error">'.$_lang["tbl_staff"][$action]["NO_PHONES"].'</div>';							}							}					unset($obj_prom);					unset($obj_crm_prom_emails);					unset($_SESSION['_sel_crm_id_fr_email']);					$_is_all_selected='';			}								if((is_not_empty($menu_id)) && is_not_empty($sms_text_msg_mnu) && (is_not_empty($_is_all_selected) || is_not_empty($lst_sel_ids))){								if(is_not_empty($_is_all_selected)){					$tbl_stafflist = tbl_staff::getRewardUserPointsDetails($arr_filter,$result_found,1);					$_arr_to_use=$tbl_stafflist;				}elseif( is_not_empty($lst_sel_ids)){					$_arr_to_use=$lst_sel_ids;				}								//..Loop through each email 				foreach($_arr_to_use as $_crm_id){					//..capture the emails of the selected conatcts					//..$subscriber_emails=get_crm_email_from_id($_crm_id);					if(is_not_empty($_is_all_selected)){						$_crm_id=$_crm_id['staff_id'];					}					//..capture the phone numbers of the selected conatcts					//$phone_nos=get_crm_email_from_id($_crm_id,'phone');					$_staff_rec=tbl_staff::GetInfo(0,$_crm_id);				    $phone_nos=$_staff_rec[STAFF_PHONE];					if(is_not_empty($phone_nos)){						sms_menu_item($menu_id,array($phone_nos),0,$sms_text_msg_mnu);						 						$isSuccess=1;			 					}					}									unset($_SESSION['_sel_crm_id_fr_email']);				$_is_all_selected='';			}							break;					case 'SEND_EMAIL':			//if(is_gt_zero_num($prom_id) && is_not_empty($lst_sel_ids)){			if((is_not_empty($_is_all_selected) || is_not_empty($lst_sel_ids)) && is_not_empty($sms_msg)){										$obj_prom=new pds_list_promotions();					$obj_crm_prom_emails=new crm_prom_emails();					if( is_not_empty($_is_all_selected)){						$tbl_stafflist = tbl_staff::getRewardUserPointsDetails($arr_filter,$result_found,1);						$_arr_to_use=$tbl_stafflist;					}elseif( is_not_empty($lst_sel_ids)){						$_arr_to_use=$lst_sel_ids;					}					//..Loop through each email 					foreach($_arr_to_use as $_crm_id){						//..capture the emails of the selected conatcts						//..$subscriber_emails=get_crm_email_from_id($_crm_id);						if(is_not_empty($_is_all_selected)){							$_crm_id=$_crm_id['staff_id'];						}						$_staff_rec=tbl_staff::GetInfo(0,$_crm_id);					  $subscriber_emails=$_staff_rec['staff_email'];						//..get actual crm						$_act_crm_id=tbl_crm::get_crm_id_from_email($subscriber_emails);						 						if((is_not_empty($subscriber_emails)) && (_chk_if_usr_witout_email($subscriber_emails)==0)){							//echo "{$_crm_id}-{$subscriber_emails}<br>";  						//..Send::Email promotion		 							try {								 if(is_gt_zero_num($prom_id)){								 	 							 	 									 if(is_gt_zero_num($_act_crm_id)){									 		//..Add record to the crm notify											 	 	 		$_act_crm_id=$obj_crm_prom_emails->create($_act_crm_id, $prom_id,0, '', '');									 }									 $isSuccess=$obj_prom->email_promtoion($prom_id,1,array($subscriber_emails),$_act_crm_id,'',$sms_msg);								   								 }else{								 		$_is_sub=tbl_crm::is_subscribed_usr('',$_SESSION[SES_RESTAURANT],array($subscriber_emails));										if(is_gt_zero_num($_is_sub)){											//$_unsub_lnk = ' Unsubscribe:'.biz_get_tiny_url("{$website}/user/tbl_crm_unsubscribe.php?crm_id={$_is_sub}");								 			$isSuccess=send_mail_using_php('Message from '.$rest_info[RESTAURENT_NAME],$rest_info[RESTAURENT_EMAIL],$subscriber_emails,$sms_msg);								 		}								 }							 	 								 $isSuccess=1;							 							}catch(Exception $e) {							   //echo 'Caught exception: ', $e->getMessage(), "\n";							}													}else{							//$_SESSION[SES_FLASH_MSG] =  '<div class="error">'.$_lang["tbl_staff"][$action]["NO_EMAILS"].'</div>';								$err .= '<div class="error">'.$_staff_rec['full_name'].' does not have email.</div>';							}											}					unset($obj_prom);					unset($obj_crm_prom_emails);					unset($_SESSION['_sel_crm_id_fr_email']);							$_is_all_selected='';				}							if((is_not_empty($menu_id)) && is_not_empty($sms_msg_mnu) && (is_not_empty($_is_all_selected) || is_not_empty($lst_sel_ids))){													if( is_not_empty($_is_all_selected)){						$tbl_stafflist = tbl_staff::getRewardUserPointsDetails($arr_filter,$result_found,1);						$_arr_to_use=$tbl_stafflist;					}elseif( is_not_empty($lst_sel_ids)){						$_arr_to_use=$lst_sel_ids;					}					//..Loop through each email 					foreach($_arr_to_use as $_crm_id){						//..capture the emails of the selected conatcts						//..$subscriber_emails=get_crm_email_from_id($_crm_id);						if(is_not_empty($_is_all_selected)){							$_crm_id=$_crm_id['staff_id'];						}						$_staff_rec=tbl_staff::GetInfo(0,$_crm_id);					    $subscriber_emails=$_staff_rec['staff_email'];						//..get actual crm						$_act_crm_id=tbl_crm::get_crm_id_from_email($subscriber_emails);						 						if((is_not_empty($subscriber_emails)) && (_chk_if_usr_witout_email($subscriber_emails)==0)){							//echo "{$_crm_id}-{$subscriber_emails}<br>";  						//..Send::Email promotion		 							try {								 email_menu_item($menu_id,1,array($subscriber_emails),0,'',$sms_msg_mnu);								 $isSuccess=1;							 							}catch(Exception $e) {							   //echo 'Caught exception: ', $e->getMessage(), "\n";							}													}else{														$err .= '<div class="error">'.$_staff_rec['full_name'].' does not have email.</div>';							}											}										unset($_SESSION['_sel_crm_id_fr_email']);							$_is_all_selected='';				}				break;								case ACTION_CREATE: 			$isSuccess = $objtbl_crm->create($crm_cust_id, $crm_cust_email, $crm_cust_type, $crm_is_subsribed, $crm_cust_phone);			break;		case ACTION_UPDATE: 			$isSuccess = $objtbl_crm->update($crm_id, $crm_cust_id, $crm_cust_email, $crm_cust_type, $crm_is_subsribed, $crm_cust_phone);			break;		case ACTION_DELETE: 			$isSuccess = $objtbl_crm->delete(array(CRM_ID=>$crm_id));			break;		case ACTION_ACTIVATE:			if(is_not_empty($lst_sel_ids)) 				$isSuccess = $objtbl_crm->activate($lst_sel_ids);			break;		case ACTION_DEACTIVATE: 			if(is_not_empty($lst_sel_ids))				$isSuccess = $objtbl_crm->deactivate($lst_sel_ids);			break;							case 'BANN_USER': 			if(is_not_empty($lst_sel_ids)){				$lst_sel_ids=implode(',', $lst_sel_ids);								$objtbl_staff=new tbl_staff();				$isSuccess = $objtbl_staff->ban_user($lst_sel_ids);				unset($objtbl_staff);			}else{				$_SESSION[SES_FLASH_MSG] = '<div class="error">'.$_lang['main']['select_ids']['empty'].'</div>';			}						break;					case 'UNBANN_USER': 			if(is_not_empty($lst_sel_ids)){				$lst_sel_ids=implode(',', $lst_sel_ids);				$objtbl_staff=new tbl_staff();				$isSuccess = $objtbl_staff->unban_user($lst_sel_ids);				unset($objtbl_staff);			}else{				$_SESSION[SES_FLASH_MSG] = '<div class="error">'.$_lang['main']['select_ids']['empty'].'</div>';			}						break;								}//..switch}//..ifif(is_not_empty($isSuccess)){	if(is_gt_zero_num($isSuccess)){		$_SESSION[SES_FLASH_MSG] = '<div class="success">'.$_lang['tbl_crm'][$action]['SUCCESS_MSG'].'</div>';	}elseif($isSuccess == OPERATION_FAIL){		$_SESSION[SES_FLASH_MSG] = '<div class="error">'.$_lang['tbl_crm'][$action]['FAILURE_MSG'].'</div>';	}elseif($isSuccess == OPERATION_DUPLICATE){		$_SESSION[SES_FLASH_MSG] = '<div class="info">'.$_lang['tbl_crm'][$action]['DUPLICATE_MSG'].'</div>';	}}//..if			//print_r($arr_filter);		$arr_filter[OFFSET_TITLE]=$offset;		$arr_filter[LIMIT_TITLE]=$limit;			$tbl_stafflist = tbl_staff::getRewardUserPointsDetails($arr_filter,$result_found,1);		//print_r($tbl_stafflist);		//..Get the listing of active promotions	$lst_promotion = pds_list_promotions::GetPromotions(1);	$smarty->assign('lst_promotion',$lst_promotion);	//..Get the sub menu dish list only for search			$lst_menu = tbl_submenu_dishes::getAllSubMnuDishes();		$smarty->assign('lst_menu',$lst_menu);		$allpageCount = 0;	$currentPage = 0;	$smarty->assign('pagination',biz_pagination(array('url'=>$navigationURL,LIMIT_TITLE=>$limit,OFFSET_TITLE=>$offset,'count'=>$result_found),$allpageCount,$currentPage));	$smarty->assign('allpageCount',$allpageCount);	$smarty->assign('currentPage',$currentPage);	$smarty->assign('tbl_stafflist', $tbl_stafflist);	$smarty->assign('result_found',$result_found);	$template = 'tbl_crm_list/rewrad_point_list.tpl'; 		if(is_not_empty($_SESSION['curr_sess_p']) && ($_SESSION['curr_sess_p']=='restaulogy')){			$breadcrumbs[] = array(				 	'link'=>$website.'/user/rest_dashboard.php',					'title'=>$_lang['main']['rest_dashboard']);			}else{		$breadcrumbs[] = array(					'link'=>$website.'/user/customer_rewards.php', 					'title'=>$_lang['biz_rewards']['title']);	} 		$breadcrumbs[] = array(				 	'link'=>$website.'/user/rewrad_point_list.php',					'title'=>$_lang['biz_rewards']['rwd_points_lst']);							if (is_not_empty($mode)){		if(($mode == MODE_VIEW || $mode==MODE_UPDATE) && is_gt_zero_num($crm_id)){			$tbl_crminfo= $objtbl_crm->GetInfo($crm_id);			$smarty->assign('tbl_crminfo',$tbl_crminfo);			if($mode==MODE_UPDATE){				$smarty->assign('isUpdate',1);			}				$template = 'tbl_crm/view.tpl'; 		}elseif($mode == MODE_CREATE){				$template = 'tbl_crm/create.tpl'; 		}elseif($mode == 'CSV_EXPORT'){				$template = 'tbl_crm_list/csv_export.tpl'; 		}	}			$smarty->assign('page_url', $url);	$smarty->assign('navigationURL',$navigationURL);	$smarty->assign('new_sort',$new_sort);	$smarty->assign('active_page',$active_page);	$smarty->assign('rpt_to_show',$rpt_to_show);	$smarty->assign('tab_sms_email',$tab_sms_email);	$smarty->assign('rest_info',$rest_info);	$smarty->assign('_is_all_selected',$_is_all_selected);		if(is_gt_zero_num($pst_menu_id)){		$_email_mnu=email_preview_menu(array($pst_menu_id),'',1);		$smarty->assign('pst_msg', $_email_mnu['msg']);		$smarty->assign('pst_preview', $_email_mnu['preview']);		$smarty->assign('pst_sms_txt', $_email_mnu['sms_txt']);	}	$smarty->assign('pst_menu_id', $pst_menu_id);			$prom_lst_link= biz_get_tiny_url(WWWROOT."modules/business_listing/promotionslisting.php?show_type=PR&ps_restnt=".$_SESSION[SES_RESTAURANT]);	$smarty->assign('prom_lst_link',$prom_lst_link);		if(is_not_empty($filt_text)){		$smarty->assign('filt_text',implode('|',array_unique($filt_text)));			}	 }else{	$template='index.tpl';} include_once('footer.php');?>