<?phpinclude_once(dirname(dirname(__FILE__))."/init.php");include_once("header.php");$active_page = "tbl_server_pin";if($sesslife==true){$srv_pin_id= get_input("srv_pin_id");$srv_pin_restaurant= get_input("srv_pin_restaurant",$_SESSION[SES_RESTAURANT]);$srv_pin_password= get_input("srv_pin_password");$srv_pin_server= get_input("srv_pin_server",NULL);$srv_pin_start_date= get_input("srv_pin_start_date");$srv_pin_end_date= get_input("srv_pin_end_date");$action = strtoupper(get_input(ACTION_TITLE));$mode = strtoupper(get_input(MODE_TITLE));$offset = get_input(OFFSET_TITLE,OFFSET_VALUE);$limit =  get_input(LIMIT_TITLE,LIMIT_VALUE);$sort_on = get_input(SORT_ON,"srv_pin_id");$sort_by=$new_sort="";biz_set_sorting_var($sort_by,$new_sort);$url = "{$website}/user/tbl_server_pin.php";$navigationURL = $url."?".SORT_ON."={$sort_on}&".SORT_BY."={$sort_by}";$isSuccess = "";$sel_tbl_server_pin= get_input('sel_tbl_server_pin');$lst_sel_ids='';if(is_not_empty($sel_tbl_server_pin)){		$lst_sel_ids=biz_implode(',', array_keys($sel_tbl_server_pin));} //echo $lst_sel_ids;$objtbl_server_pin= new tbl_server_pin();if(is_not_empty($action)){	switch($action){		case ACTION_CREATE: 			$isSuccess = $objtbl_server_pin->create($srv_pin_restaurant, $srv_pin_password, $srv_pin_start_date,$srv_pin_end_date,$srv_pin_server);			break;		case ACTION_UPDATE: 			$isSuccess = $objtbl_server_pin->update($srv_pin_id, $srv_pin_restaurant, $srv_pin_password, $srv_pin_start_date,$srv_pin_end_date,$srv_pin_server);			break;		/*case ACTION_DELETE: 			$isSuccess = $objtbl_server_pin->delete(array(SRV_PIN_ID=>$srv_pin_id));			break;		case ACTION_ACTIVATE: 			$isSuccess = $objtbl_server_pin->activate($srv_pin_id);			break;		case ACTION_DEACTIVATE: 			$isSuccess = $objtbl_server_pin->deactivate($srv_pin_id);			break;*/					case ACTION_DELETE: 			//$isSuccess = $objbiz_rewards->delete(array(RWD_ID=>$rwd_id));			if(is_not_empty($lst_sel_ids)){							$isSuccess = $objtbl_server_pin->delete(array(SRV_PIN_ID=>$lst_sel_ids));			}else{				$isSuccess = $objtbl_server_pin->delete(array(SRV_PIN_ID=>$srv_pin_id));			}					break;		case ACTION_ACTIVATE: 			if(is_not_empty($lst_sel_ids)){							$isSuccess = $objtbl_server_pin->activate($lst_sel_ids);			}else{				$isSuccess = $objtbl_server_pin->activate($srv_pin_id);			}					//$isSuccess = $objbiz_rewards->activate($rwd_id);			break;		case ACTION_DEACTIVATE: 			//$isSuccess = $objbiz_rewards->deactivate($rwd_id);			if(is_not_empty($lst_sel_ids)){							$isSuccess = $objtbl_server_pin->deactivate($lst_sel_ids);			}else{				$isSuccess = $objtbl_server_pin->deactivate($srv_pin_id);			}			break;				}//..switch}//..ifif(is_not_empty($isSuccess)){	if(is_gt_zero_num($isSuccess)){		$err .= "<div class='info'>".$_lang['tbl_server_pin'][$action]['SUCCESS_MSG']."</div>";	}elseif($isSuccess == OPERATION_FAIL){		$err .= "<div class='error'>".$_lang['tbl_server_pin'][$action]['FAILURE_MSG']."</div>";	}elseif($isSuccess == OPERATION_DUPLICATE){		$err .= "<div class='error'>".$_lang['tbl_server_pin'][$action]['DUPLICATE_MSG']."</div>";	}}//..if	$result_found=0;	$tbl_server_pinlist = $objtbl_server_pin->readArray(array(SRV_PIN_RESTAURANT => $_SESSION[SES_RESTAURANT],OFFSET_TITLE=>$offset,LIMIT_TITLE=>$limit,SORT_BY=>$sort_by,SORT_ON=>$sort_on),$result_found,1);	$allpageCount = 0;	$currentPage = 0;	$smarty->assign('pagination',biz_pagination(array("url"=>$navigationURL,LIMIT_TITLE=>$limit,OFFSET_TITLE=>$offset,"count"=>$result_found),$allpageCount,$currentPage));	$smarty->assign('allpageCount',$allpageCount);	$smarty->assign('currentPage',$currentPage);	$smarty->assign('tbl_server_pinlist', $tbl_server_pinlist);	$smarty->assign('result_found',$result_found);	$template = "tbl_server_pin/tbl_server_pin.tpl";		$breadcrumbs[] = array(				 	'link'=>$website.'/user/pref_mng_cntrols.php',					'title'=>$_lang['main']['pref_mng_cntrls']); 	$breadcrumbs[] = array(				 	'link'=>$website.'/user/tbl_server_pin.php',					'title'=>$_lang['tbl_server_pin']['title']);	if (is_not_empty($mode)){		if(($mode == MODE_VIEW || $mode==MODE_UPDATE) && is_gt_zero_num($srv_pin_id)){			$tbl_server_pininfo= $objtbl_server_pin->GetInfo($srv_pin_id);			$smarty->assign('tbl_server_pininfo',$tbl_server_pininfo);			if($mode==MODE_UPDATE){				$smarty->assign("isUpdate",1);			}			$template = "tbl_server_pin/view.tpl";		}elseif($mode == MODE_CREATE){			$template = "tbl_server_pin/create.tpl";		}}	$smarty->assign('lst_servers', tbl_staff::GetActiveEmployees());	$smarty->assign('page_url', $url);	$smarty->assign('navigationURL',$navigationURL);	$smarty->assign('new_sort',$new_sort);	$smarty->assign('active_page',$active_page);}else{	$template="index.tpl";}include_once("footer.php");?>