<?phpinclude_once(dirname(dirname(__FILE__)).'/init.php');include_once('header.php');$active_page = 'tbl_restaurent';$canLogin = 0;$restaurent_id= get_input('restaurent_id',$_SESSION[SES_RESTAURANT]);$restaurent_owner= get_input('restaurent_owner');$restaurent_name= get_input('restaurent_name');$restaurent_address= get_input('restaurent_address');$restaurent_country= get_input('restaurent_country');$restaurent_state= get_input('restaurent_state');$restaurent_city= get_input('restaurent_city');$restaurent_zip= get_input('restaurent_zip');$restaurent_phone_1= get_input('restaurent_phone_1');$restaurent_phone_2= get_input('restaurent_phone_2');$restaurent_email= get_input('restaurent_email');$restaurent_fax= get_input('restaurent_fax');//..field for road$restaurent_website= get_input('restaurent_website');$restaurent_description= get_input('restaurent_description');$restaurent_img = $_FILES[RESTAURENT_IMG];/*$restaurent_lat = get_input('restaurent_lat');$restaurent_lng = get_input('restaurent_lng');*/$restaurent_ethor_store = get_input('restaurent_ethor_store','');$restaurent_is_paypal= get_input('restaurent_is_paypal');$restaurent_paypal_email= get_input('restaurent_paypal_email');$restaurent_start_date= get_input('restaurent_start_date');$restaurent_end_date= get_input('restaurent_end_date');$restaurent_online_ord_start= get_input('restaurent_online_ord_start');$restaurent_online_ord_end= get_input('restaurent_online_ord_end');//..for review system$rev_sys_yelp= get_sql_input("rev_sys_yelp");$rev_sys_tripadvisor= get_sql_input("rev_sys_tripadvisor");$rev_sys_urbanspoon= get_sql_input("rev_sys_urbanspoon");$rev_sys_google= get_sql_input("rev_sys_google");//..for social media$rstcnt_facebook= get_sql_input("rstcnt_facebook");$rstcnt_twitter= get_sql_input("rstcnt_twitter");$rstcnt_linked_in= get_sql_input("rstcnt_linked_in");$restaurent_fdbk_award_pts= get_sql_input("restaurent_fdbk_award_pts");$restaurent_rwd_multiplier= get_sql_input("restaurent_rwd_multiplier");$restaurent_group= get_sql_input("restaurent_group");$action = strtoupper(get_input(ACTION_TITLE));$dfl_mode = '';if($_SESSION['member_role_id'] != ROLE_DEV){	$dfl_mode = MODE_VIEW;} $mode = strtoupper(get_input(MODE_TITLE, $dfl_mode));$offset = get_input(OFFSET_TITLE,OFFSET_VALUE);$limit =  get_input(LIMIT_TITLE,LIMIT_VALUE);$sort_on = get_input(SORT_ON,'restaurent_id');if($sesslife==true || $action == ACTION_CREATE || $mode== MODE_CREATE){	$canLogin = 1;}  if(is_gt_zero_num($canLogin)){  $sort_by=$new_sort=""; biz_set_sorting_var($sort_by,$new_sort);$url = "{$website}/user/tbl_restaurent.php";$navigationURL = $url."?".SORT_ON."={$sort_on}&".SORT_BY."={$sort_by}";$isSuccess = "";$objtbl_restaurent= new tbl_restaurent();if(is_not_empty($action)){	switch($action){		case ACTION_CREATE: 			$isSuccess = $objtbl_restaurent->create($restaurent_owner, $restaurent_name, $restaurent_address, $restaurent_country, $restaurent_state, $restaurent_city, $restaurent_zip, $restaurent_phone_1, $restaurent_phone_2,$restaurent_email,$restaurent_website,$restaurent_description, $restaurent_is_paypal, $restaurent_paypal_email,  $restaurent_online_ord_start,$restaurent_online_ord_end,$restaurent_img,$restaurent_ethor_store,$restaurent_fdbk_award_pts,$restaurent_rwd_multiplier,$restaurent_group,$restaurent_fax);			break;		case ACTION_UPDATE: 			$isSuccess = $objtbl_restaurent->update($restaurent_id, $restaurent_owner, $restaurent_name, $restaurent_address, $restaurent_country, $restaurent_state, $restaurent_city, $restaurent_zip, $restaurent_phone_1, $restaurent_phone_2,$restaurent_email,$restaurent_website,$restaurent_description, $restaurent_is_paypal, $restaurent_paypal_email, $restaurent_online_ord_start,$restaurent_online_ord_end,$restaurent_img,$restaurent_ethor_store,$restaurent_fdbk_award_pts,$restaurent_rwd_multiplier,$restaurent_group,$restaurent_fax);			//..add i to review system			$tbl_review_systems_deatil= tbl_review_systems::GetInfo($restaurent_id);			$objtbl_review_systems=new tbl_review_systems();			if(is_not_empty($tbl_review_systems_deatil)){				$isSuccess = $objtbl_review_systems->update($tbl_review_systems_deatil[REV_SYS_ID], $restaurent_id, $rev_sys_yelp, $rev_sys_tripadvisor, $rev_sys_urbanspoon, $rev_sys_google);			}else{				$isSuccess = $objtbl_review_systems->create($restaurent_id, $rev_sys_yelp, $rev_sys_tripadvisor, $rev_sys_urbanspoon, $rev_sys_google);			}			//..add it to social medias as well.			$_lst_social_media = tbl_rest_connect::GetInfo($restaurent_id);			$objtbl_rest_connect=new tbl_rest_connect();			if(is_not_empty($_lst_social_media)){				$isSuccess = $objtbl_rest_connect->update($_lst_social_media[RSTCNT_ID],$restaurent_id, $rstcnt_facebook, $rstcnt_twitter, $rstcnt_linked_in,'','');			}else{				$isSuccess = $objtbl_rest_connect->create($restaurent_id, $rstcnt_facebook, $rstcnt_twitter, $rstcnt_linked_in,'','');			}				break;		case ACTION_DELETE: 			$isSuccess = $objtbl_restaurent->delete(array(RESTAURENT_ID=>$restaurent_id));			break;		case ACTION_ACTIVATE: 			$isSuccess = $objtbl_restaurent->activate($restaurent_id);			break;		case ACTION_DEACTIVATE: 			$isSuccess = $objtbl_restaurent->deactivate($restaurent_id);			break;	}//..switch}//..ifif(is_not_empty($isSuccess)){	if(is_gt_zero_num($isSuccess)){	 $_SESSION[SES_FLASH_MSG] = '<div class="success">'.$_lang[TBL_RESTAURENT][$action]['SUCCESS_MSG'].'</div>';	}elseif($isSuccess == OPERATION_FAIL){		$_SESSION[SES_FLASH_MSG] = '<div class="error">'.$_lang[TBL_RESTAURENT][$action]['FAILURE_MSG'].'</div>';	}elseif($isSuccess == OPERATION_DUPLICATE){		$_SESSION[SES_FLASH_MSG] = '<div class="info">'.$_lang[TBL_RESTAURENT][$action]['DUPLICATE_MSG'].'</div>';	}}//..if	$result_found=0;	$tbl_restaurentlist = $objtbl_restaurent->readArray(array(OFFSET_TITLE=>$offset,LIMIT_TITLE=>$limit,SORT_BY=>$sort_by,SORT_ON=>$sort_on),$result_found,1);	$allpageCount = 0;	$currentPage = 0;	$smarty->assign('pagination',biz_pagination(array("url"=>$navigationURL,LIMIT_TITLE=>$limit,OFFSET_TITLE=>$offset,"count"=>$result_found),$allpageCount,$currentPage));	$smarty->assign('allpageCount',$allpageCount);	$smarty->assign('currentPage',$currentPage);	$smarty->assign('tbl_restaurentlist', $tbl_restaurentlist);	$smarty->assign('result_found',$result_found);	$template = 'tbl_restaurent/tbl_restaurent.tpl';  if(is_gt_zero_num($isSuccess) && ($action == ACTION_CREATE)){  	$smarty->assign('restaurant_id',$isSuccess);  	//$template = "tbl_restaurent/redirectmanager.tpl";   }elseif (is_not_empty($mode)){		//echo $mode;		if(($mode == MODE_VIEW || $mode==MODE_UPDATE) && is_gt_zero_num($restaurent_id)){			$tbl_restaurentinfo = $objtbl_restaurent->GetInfo($restaurent_id);			$member = new members();			 $tbl_restaurentinfo['member'] = $member->GetInfo($tbl_restaurentinfo['restaurent_owner']); 			unset($member);			$smarty->assign('tbl_restaurentinfo',$tbl_restaurentinfo);			if($mode==MODE_UPDATE){				$smarty->assign("isUpdate",1);			}			$template = "tbl_restaurent/view.tpl";		}elseif($mode == MODE_CREATE){			$template = "tbl_restaurent/create.tpl";	  }  }	$countries_list= getCountries(); 	$state_list = getStates("IN", 1);	$city_list = getCities("MH","IN");	if($tbl_restaurentinfo){		$city_list = getCities($tbl_restaurentinfo['restaurent_state'],$tbl_restaurentinfo['restaurent_country']); 		$state_list = getStates($tbl_restaurentinfo['restaurent_country'], 1);			}else{		$city_list = getCities("MH","IN");		$state_list = getStates("IN", 1); 	}		$breadcrumbs[] = array("link"=>$website."/user/pref_mng_cntrols.php", "title"=>$_lang['main']['navbar']['controls']);		$breadcrumbs[] = array("link"=>$url.'?'.MODE_TITLE.'='.MODE_VIEW, "title"=>$_lang['tbl_restaurent']['title']);	//..get the lst of the groups	$_rest_group_lst=tbl_rest_groups::GetFields(array('isActive'=>1,'key_field'=>RSTGRP_ID,'value_field'=>RSTGRP_GROUP));	$smarty->assign('_rest_group_lst',$_rest_group_lst);		$smarty->assign('countries_list',$countries_list);	$smarty->assign('city_list',$city_list);	$smarty->assign('state_list',$state_list);	$smarty->assign('page_url', $url);	$smarty->assign('navigationURL',$navigationURL);	$smarty->assign('new_sort',$new_sort);	$smarty->assign('active_page',$active_page); }else{	$template="index.tpl";}  include_once("footer.php");?>